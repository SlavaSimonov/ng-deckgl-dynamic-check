(self.webpackChunkangular_deckgl=self.webpackChunkangular_deckgl||[]).push([[179],{803:Uo=>{"use strict";Uo.exports=ns,Uo.exports.default=ns;var _s=1e20;function ns(Gt,Fn,yi,en,Ne,wn){this.fontSize=Gt||24,this.buffer=void 0===Fn?3:Fn,this.cutoff=en||.25,this.fontFamily=Ne||"sans-serif",this.fontWeight=wn||"normal",this.radius=yi||8;var sn=this.size=this.fontSize+2*this.buffer,vt=sn+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=sn,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(vt*vt),this.gridInner=new Float64Array(vt*vt),this.f=new Float64Array(vt),this.z=new Float64Array(vt+1),this.v=new Uint16Array(vt),this.useMetrics=void 0!==this.ctx.measureText("A").actualBoundingBoxLeft,this.middle=Math.round(sn/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function wc(Gt,Fn,yi,en,Ne,wn){for(var sn=0;sn<Fn;sn++)w(Gt,sn,Fn,yi,en,Ne,wn);for(var vt=0;vt<yi;vt++)w(Gt,vt*Fn,1,Fn,en,Ne,wn)}function w(Gt,Fn,yi,en,Ne,wn,sn){var vt,Mn,di,Jn;for(wn[0]=0,sn[0]=-_s,sn[1]=_s,vt=0;vt<en;vt++)Ne[vt]=Gt[Fn+vt*yi];for(vt=1,Mn=0,di=0;vt<en;vt++){do{di=(Ne[vt]-Ne[Jn=wn[Mn]]+vt*vt-Jn*Jn)/(vt-Jn)/2}while(di<=sn[Mn]&&--Mn>-1);wn[++Mn]=vt,sn[Mn]=di,sn[Mn+1]=_s}for(vt=0,Mn=0;vt<en;vt++){for(;sn[Mn+1]<vt;)Mn++;Gt[Fn+vt*yi]=Ne[Jn=wn[Mn]]+(vt-Jn)*(vt-Jn)}}ns.prototype._draw=function(Gt,Fn){var wn,sn,vt,Mn,di,Jn,xn,er,Ci,yi=this.ctx.measureText(Gt),en=yi.width,Ne=2*this.buffer;Fn&&this.useMetrics?(di=Math.floor(yi.actualBoundingBoxAscent),er=this.buffer+Math.ceil(yi.actualBoundingBoxAscent),Jn=this.buffer,xn=this.buffer,wn=(sn=Math.min(this.size,Math.ceil(yi.actualBoundingBoxRight-yi.actualBoundingBoxLeft)))+Ne,vt=(Mn=Math.min(this.size-Jn,Math.ceil(yi.actualBoundingBoxAscent+yi.actualBoundingBoxDescent)))+Ne,this.ctx.textBaseline="alphabetic"):(wn=sn=this.size,vt=Mn=this.size,di=19*this.fontSize/24,Jn=xn=0,er=this.middle,this.ctx.textBaseline="middle"),sn&&Mn&&(this.ctx.clearRect(xn,Jn,sn,Mn),this.ctx.fillText(Gt,this.buffer,er),Ci=this.ctx.getImageData(xn,Jn,sn,Mn));var si=new Uint8ClampedArray(wn*vt);return function Wn(Gt,Fn,yi,en,Ne,wn,sn){wn.fill(_s,0,Fn*yi),sn.fill(0,0,Fn*yi);for(var vt=(Fn-en)/2,Mn=0;Mn<Ne;Mn++)for(var di=0;di<en;di++){var Jn=(Mn+vt)*Fn+di+vt,xn=Gt.data[4*(Mn*en+di)+3]/255;if(1===xn)wn[Jn]=0,sn[Jn]=_s;else if(0===xn)wn[Jn]=_s,sn[Jn]=0;else{var er=Math.max(0,.5-xn),Ci=Math.max(0,xn-.5);wn[Jn]=er*er,sn[Jn]=Ci*Ci}}}(Ci,wn,vt,sn,Mn,this.gridOuter,this.gridInner),wc(this.gridOuter,wn,vt,this.f,this.v,this.z),wc(this.gridInner,wn,vt,this.f,this.v,this.z),function me(Gt,Fn,yi,en,Ne,wn,sn){for(var vt=0;vt<Fn*yi;vt++){var Mn=Math.sqrt(en[vt])-Math.sqrt(Ne[vt]);Gt[vt]=Math.round(255-255*(Mn/wn+sn))}}(si,wn,vt,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:si,metrics:{width:sn,height:Mn,sdfWidth:wn,sdfHeight:vt,top:di,left:0,advance:en}}},ns.prototype.draw=function(Gt){return this._draw(Gt,!1).data},ns.prototype.drawWithMetrics=function(Gt){return this._draw(Gt,!0)}},108:(Uo,_s,ns)=>{"use strict";function Wn(n){return"function"==typeof n}function me(n){const t=n(i=>{Error.call(i),i.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const wc=me(n=>function(t){n(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((i,r)=>`${r+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function w(n,e){if(n){const t=n.indexOf(e);0<=t&&n.splice(t,1)}}class Gt{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const s of t)s.remove(this);else t.remove(this);const{initialTeardown:i}=this;if(Wn(i))try{i()}catch(s){e=s instanceof wc?s.errors:[s]}const{_finalizers:r}=this;if(r){this._finalizers=null;for(const s of r)try{en(s)}catch(a){e=e??[],a instanceof wc?e=[...e,...a.errors]:e.push(a)}}if(e)throw new wc(e)}}add(e){var t;if(e&&e!==this)if(this.closed)en(e);else{if(e instanceof Gt){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(e)}}_hasParent(e){const{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){const{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&w(t,e)}remove(e){const{_finalizers:t}=this;t&&w(t,e),e instanceof Gt&&e._removeParent(this)}}Gt.EMPTY=(()=>{const n=new Gt;return n.closed=!0,n})();const Fn=Gt.EMPTY;function yi(n){return n instanceof Gt||n&&"closed"in n&&Wn(n.remove)&&Wn(n.add)&&Wn(n.unsubscribe)}function en(n){Wn(n)?n():n.unsubscribe()}const Ne={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},wn={setTimeout(n,e,...t){const{delegate:i}=wn;return i?.setTimeout?i.setTimeout(n,e,...t):setTimeout(n,e,...t)},clearTimeout(n){const{delegate:e}=wn;return(e?.clearTimeout||clearTimeout)(n)},delegate:void 0};function sn(n){wn.setTimeout(()=>{const{onUnhandledError:e}=Ne;if(!e)throw n;e(n)})}function vt(){}const Mn=xn("C",void 0,void 0);function xn(n,e,t){return{kind:n,value:e,error:t}}let er=null;function Ci(n){if(Ne.useDeprecatedSynchronousErrorHandling){const e=!er;if(e&&(er={errorThrown:!1,error:null}),n(),e){const{errorThrown:t,error:i}=er;if(er=null,t)throw i}}else n()}class is extends Gt{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,yi(e)&&e.add(this)):this.destination=Ys}static create(e,t,i){return new Zr(e,t,i)}next(e){this.isStopped?Xs(function Jn(n){return xn("N",n,void 0)}(e),this):this._next(e)}error(e){this.isStopped?Xs(function di(n){return xn("E",void 0,n)}(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?Xs(Mn,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const hr=Function.prototype.bind;function xo(n,e){return hr.call(n,e)}class Ir{constructor(e){this.partialObserver=e}next(e){const{partialObserver:t}=this;if(t.next)try{t.next(e)}catch(i){Is(i)}}error(e){const{partialObserver:t}=this;if(t.error)try{t.error(e)}catch(i){Is(i)}else Is(e)}complete(){const{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(t){Is(t)}}}class Zr extends is{constructor(e,t,i){let r;if(super(),Wn(e)||!e)r={next:e??void 0,error:t??void 0,complete:i??void 0};else{let s;this&&Ne.useDeprecatedNextContext?(s=Object.create(e),s.unsubscribe=()=>this.unsubscribe(),r={next:e.next&&xo(e.next,s),error:e.error&&xo(e.error,s),complete:e.complete&&xo(e.complete,s)}):r=e}this.destination=new Ir(r)}}function Is(n){Ne.useDeprecatedSynchronousErrorHandling?function si(n){Ne.useDeprecatedSynchronousErrorHandling&&er&&(er.errorThrown=!0,er.error=n)}(n):sn(n)}function Xs(n,e){const{onStoppedNotification:t}=Ne;t&&wn.setTimeout(()=>t(n,e))}const Ys={closed:!0,next:vt,error:function wo(n){throw n},complete:vt},Zt="function"==typeof Symbol&&Symbol.observable||"@@observable";function ys(n){return n}let Yn=(()=>{class n{constructor(t){t&&(this._subscribe=t)}lift(t){const i=new n;return i.source=this,i.operator=t,i}subscribe(t,i,r){const s=function aa(n){return n&&n instanceof is||function tc(n){return n&&Wn(n.next)&&Wn(n.error)&&Wn(n.complete)}(n)&&yi(n)}(t)?t:new Zr(t,i,r);return Ci(()=>{const{operator:a,source:u}=this;s.add(a?a.call(s,u):u?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(t){try{return this._subscribe(t)}catch(i){t.error(i)}}forEach(t,i){return new(i=vs(i))((r,s)=>{const a=new Zr({next:u=>{try{t(u)}catch(f){s(f),a.unsubscribe()}},error:s,complete:r});this.subscribe(a)})}_subscribe(t){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(t)}[Zt](){return this}pipe(...t){return function Eo(n){return 0===n.length?ys:1===n.length?n[0]:function(t){return n.reduce((i,r)=>r(i),t)}}(t)(this)}toPromise(t){return new(t=vs(t))((i,r)=>{let s;this.subscribe(a=>s=a,a=>r(a),()=>i(s))})}}return n.create=e=>new n(e),n})();function vs(n){var e;return null!==(e=n??Ne.Promise)&&void 0!==e?e:Promise}const Ps=me(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Fi=(()=>{class n extends Yn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const i=new Ks(this,this);return i.operator=t,i}_throwIfClosed(){if(this.closed)throw new Ps}next(t){Ci(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const i of this.currentObservers)i.next(t)}})}error(t){Ci(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:i}=this;for(;i.length;)i.shift().error(t)}})}complete(){Ci(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:i,isStopped:r,observers:s}=this;return i||r?Fn:(this.currentObservers=null,s.push(t),new Gt(()=>{this.currentObservers=null,w(s,t)}))}_checkFinalizedStatuses(t){const{hasError:i,thrownError:r,isStopped:s}=this;i?t.error(r):s&&t.complete()}asObservable(){const t=new Yn;return t.source=this,t}}return n.create=(e,t)=>new Ks(e,t),n})();class Ks extends Fi{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,i;null===(i=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===i||i.call(t,e)}error(e){var t,i;null===(i=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===i||i.call(t,e)}complete(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)}_subscribe(e){var t,i;return null!==(i=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==i?i:Fn}}function ki(n){return e=>{if(function Za(n){return Wn(n?.lift)}(e))return e.lift(function(t){try{return n(t,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function vi(n,e,t,i,r){return new nc(n,e,t,i,r)}class nc extends is{constructor(e,t,i,r,s,a){super(e),this.onFinalize=s,this.shouldUnsubscribe=a,this._next=t?function(u){try{t(u)}catch(f){e.error(f)}}:super._next,this._error=r?function(u){try{r(u)}catch(f){e.error(f)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(u){e.error(u)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}}}function Kn(n,e){return ki((t,i)=>{let r=0;t.subscribe(vi(i,s=>{i.next(n.call(e,s,r++))}))})}function He(n){return this instanceof He?(this.v=n,this):new He(n)}function pt(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=t.apply(n,e||[]),s=[];return r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r;function a(R){i[R]&&(r[R]=function(F){return new Promise(function(V,G){s.push([R,F,V,G])>1||u(R,F)})})}function u(R,F){try{!function f(R){R.value instanceof He?Promise.resolve(R.value.v).then(g,E):M(s[0][2],R)}(i[R](F))}catch(V){M(s[0][3],V)}}function g(R){u("next",R)}function E(R){u("throw",R)}function M(R,F){R(F),s.shift(),s.length&&u(s[0][0],s[0][1])}}function rs(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,e=n[Symbol.asyncIterator];return e?e.call(n):(n=function Ho(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(s){t[s]=n[s]&&function(a){return new Promise(function(u,f){!function r(s,a,u,f){Promise.resolve(f).then(function(g){s({value:g,done:u})},a)}(u,f,(a=n[s](a)).done,a.value)})}}}const on=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function Pr(n){return Wn(n?.then)}function Ma(n){return Wn(n[Zt])}function tn(n){return Symbol.asyncIterator&&Wn(n?.[Symbol.asyncIterator])}function ua(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Aa=function zr(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function vr(n){return Wn(n?.[Aa])}function Xr(n){return pt(this,arguments,function*(){const t=n.getReader();try{for(;;){const{value:i,done:r}=yield He(t.read());if(r)return yield He(void 0);yield yield He(i)}}finally{t.releaseLock()}})}function xi(n){return Wn(n?.getReader)}function os(n){if(n instanceof Yn)return n;if(null!=n){if(Ma(n))return function Wo(n){return new Yn(e=>{const t=n[Zt]();if(Wn(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if(on(n))return function Ja(n){return new Yn(e=>{for(let t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}(n);if(Pr(n))return function Cl(n){return new Yn(e=>{n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,sn)})}(n);if(tn(n))return ha(n);if(vr(n))return function ic(n){return new Yn(e=>{for(const t of n)if(e.next(t),e.closed)return;e.complete()})}(n);if(xi(n))return function le(n){return ha(Xr(n))}(n)}throw ua(n)}function ha(n){return new Yn(e=>{(function U(n,e){var t,i,r,s;return function Vn(n,e,t,i){return new(t||(t=Promise))(function(s,a){function u(E){try{g(i.next(E))}catch(M){a(M)}}function f(E){try{g(i.throw(E))}catch(M){a(M)}}function g(E){E.done?s(E.value):function r(s){return s instanceof t?s:new t(function(a){a(s)})}(E.value).then(u,f)}g((i=i.apply(n,e||[])).next())})}(this,void 0,void 0,function*(){try{for(t=rs(n);!(i=yield t.next()).done;)if(e.next(i.value),e.closed)return}catch(a){r={error:a}}finally{try{i&&!i.done&&(s=t.return)&&(yield s.call(t))}finally{if(r)throw r.error}}e.complete()})})(n,e).catch(t=>e.error(t))})}function $(n,e,t,i=0,r=!1){const s=e.schedule(function(){t(),r?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(s),!r)return s}function re(n,e,t=1/0){return Wn(e)?re((i,r)=>Kn((s,a)=>e(i,s,r,a))(os(n(i,r))),t):("number"==typeof e&&(t=e),ki((i,r)=>function ie(n,e,t,i,r,s,a,u){const f=[];let g=0,E=0,M=!1;const R=()=>{M&&!f.length&&!g&&e.complete()},F=G=>g<i?V(G):f.push(G),V=G=>{s&&e.next(G),g++;let K=!1;os(t(G,E++)).subscribe(vi(e,se=>{r?.(se),s?F(se):e.next(se)},()=>{K=!0},void 0,()=>{if(K)try{for(g--;f.length&&g<i;){const se=f.shift();a?$(e,a,()=>V(se)):V(se)}R()}catch(se){e.error(se)}}))};return n.subscribe(vi(e,F,()=>{M=!0,R()})),()=>{u?.()}}(i,r,n,t)))}function ye(n=1/0){return re(ys,n)}const Te=new Yn(n=>n.complete());function Ce(n){return n&&Wn(n.schedule)}function je(n){return n[n.length-1]}function et(n){return Wn(je(n))?n.pop():void 0}function Ve(n){return Ce(je(n))?n.pop():void 0}function Mt(n,e=0){return ki((t,i)=>{t.subscribe(vi(i,r=>$(i,n,()=>i.next(r),e),()=>$(i,n,()=>i.complete(),e),r=>$(i,n,()=>i.error(r),e)))})}function ht(n,e=0){return ki((t,i)=>{i.add(n.schedule(()=>t.subscribe(i),e))})}function fn(n,e){if(!n)throw new Error("Iterable cannot be null");return new Yn(t=>{$(t,e,()=>{const i=n[Symbol.asyncIterator]();$(t,e,()=>{i.next().then(r=>{r.done?t.complete():t.next(r.value)})},0,!0)})})}function wi(n,e){return e?function oi(n,e){if(null!=n){if(Ma(n))return function Wt(n,e){return os(n).pipe(ht(e),Mt(e))}(n,e);if(on(n))return function Qn(n,e){return new Yn(t=>{let i=0;return e.schedule(function(){i===n.length?t.complete():(t.next(n[i++]),t.closed||this.schedule())})})}(n,e);if(Pr(n))return function $t(n,e){return os(n).pipe(ht(e),Mt(e))}(n,e);if(tn(n))return fn(n,e);if(vr(n))return function nn(n,e){return new Yn(t=>{let i;return $(t,e,()=>{i=n[Aa](),$(t,e,()=>{let r,s;try{({value:r,done:s}=i.next())}catch(a){return void t.error(a)}s?t.complete():t.next(r)},0,!0)}),()=>Wn(i?.return)&&i.return()})}(n,e);if(xi(n))return function pn(n,e){return fn(Xr(n),e)}(n,e)}throw ua(n)}(n,e):os(n)}function ti(...n){const e=Ve(n),t=function Et(n,e){return"number"==typeof je(n)?n.pop():e}(n,1/0),i=n;return i.length?1===i.length?os(i[0]):ye(t)(wi(i,e)):Te}function br(n={}){const{connector:e=(()=>new Fi),resetOnError:t=!0,resetOnComplete:i=!0,resetOnRefCountZero:r=!0}=n;return s=>{let a,u,f,g=0,E=!1,M=!1;const R=()=>{u?.unsubscribe(),u=void 0},F=()=>{R(),a=f=void 0,E=M=!1},V=()=>{const G=a;F(),G?.unsubscribe()};return ki((G,K)=>{g++,!M&&!E&&R();const se=f=f??e();K.add(()=>{g--,0===g&&!M&&!E&&(u=as(V,r))}),se.subscribe(K),!a&&g>0&&(a=new Zr({next:_e=>se.next(_e),error:_e=>{M=!0,R(),u=as(F,t,_e),se.error(_e)},complete:()=>{E=!0,R(),u=as(F,i),se.complete()}}),os(G).subscribe(a))})(s)}}function as(n,e,...t){if(!0===e)return void n();if(!1===e)return;const i=new Zr({next:()=>{i.unsubscribe(),n()}});return e(...t).subscribe(i)}function Hn(n){for(let e in n)if(n[e]===Hn)return e;throw Error("Could not find renamed property on target object.")}function fi(n,e){for(const t in e)e.hasOwnProperty(t)&&!n.hasOwnProperty(t)&&(n[t]=e[t])}function Si(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(Si).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const e=n.toString();if(null==e)return""+e;const t=e.indexOf("\n");return-1===t?e:e.substring(0,t)}function Da(n,e){return null==n||""===n?null===e?"":e:null==e||""===e?n:n+" "+e}const Qs=Hn({__forward_ref__:Hn});function pi(n){return n.__forward_ref__=pi,n.toString=function(){return Si(this())},n}function Kt(n){return function Ec(n){return"function"==typeof n&&n.hasOwnProperty(Qs)&&n.__forward_ref__===pi}(n)?n():n}class st extends Error{constructor(e,t){super(function Ia(n,e){return`NG0${Math.abs(n)}${e?": "+e.trim():""}`}(e,t)),this.code=e}}function an(n){return"string"==typeof n?n:null==n?"":String(n)}function el(n,e){throw new st(-201,!1)}function Co(n,e){null==n&&function Mi(n,e,t,i){throw new Error(`ASSERTION ERROR: ${n}`+(null==i?"":` [Expected=> ${t} ${i} ${e} <=Actual]`))}(e,n,null,"!=")}function lt(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function xr(n){return{providers:n.providers||[],imports:n.imports||[]}}function sc(n){return Pd(n,Tc)||Pd(n,Eh)}function Pd(n,e){return n.hasOwnProperty(e)?n[e]:null}function zu(n){return n&&(n.hasOwnProperty(Vu)||n.hasOwnProperty(Th))?n[Vu]:null}const Tc=Hn({\u0275prov:Hn}),Vu=Hn({\u0275inj:Hn}),Eh=Hn({ngInjectableDef:Hn}),Th=Hn({ngInjectorDef:Hn});var _n=(()=>((_n=_n||{})[_n.Default=0]="Default",_n[_n.Host=1]="Host",_n[_n.Self=2]="Self",_n[_n.SkipSelf=4]="SkipSelf",_n[_n.Optional=8]="Optional",_n))();let cu;function Wi(n){const e=cu;return cu=n,e}function Sh(n,e,t){const i=sc(n);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:t&_n.Optional?null:void 0!==e?e:void el(Si(n))}function Al(n){return{toString:n}.toString()}var qo=(()=>((qo=qo||{})[qo.OnPush=0]="OnPush",qo[qo.Default=1]="Default",qo))(),da=(()=>{return(n=da||(da={}))[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",da;var n})();const tr=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),Dl={},An=[],Il=Hn({\u0275cmp:Hn}),eo=Hn({\u0275dir:Hn}),Ah=Hn({\u0275pipe:Hn}),uu=Hn({\u0275mod:Hn}),Rr=Hn({\u0275fac:Hn}),Pl=Hn({__NG_ELEMENT_ID__:Hn});let oc=0;function jt(n){return Al(()=>{const t=!0===n.standalone,i={},r={type:n.type,providersResolver:null,decls:n.decls,vars:n.vars,factory:null,template:n.template||null,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:i,inputs:null,outputs:null,exportAs:n.exportAs||null,onPush:n.changeDetection===qo.OnPush,directiveDefs:null,pipeDefs:null,standalone:t,dependencies:t&&n.dependencies||null,getStandaloneInjector:null,selectors:n.selectors||An,viewQuery:n.viewQuery||null,features:n.features||null,data:n.data||{},encapsulation:n.encapsulation||da.Emulated,id:"c"+oc++,styles:n.styles||An,_:null,setInput:null,schemas:n.schemas||null,tView:null},s=n.dependencies,a=n.features;return r.inputs=hu(n.inputs,i),r.outputs=hu(n.outputs),a&&a.forEach(u=>u(r)),r.directiveDefs=s?()=>("function"==typeof s?s():s).map(Un).filter(mi):null,r.pipeDefs=s?()=>("function"==typeof s?s():s).map(no).filter(mi):null,r})}function Un(n){return Ai(n)||Ur(n)}function mi(n){return null!==n}function un(n){return Al(()=>({type:n.type,bootstrap:n.bootstrap||An,declarations:n.declarations||An,imports:n.imports||An,exports:n.exports||An,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function hu(n,e){if(null==n)return Dl;const t={};for(const i in n)if(n.hasOwnProperty(i)){let r=n[i],s=r;Array.isArray(r)&&(s=r[1],r=r[0]),t[r]=i,e&&(e[r]=s)}return t}const Jt=jt;function to(n){return{type:n.type,name:n.name,factory:null,pure:!1!==n.pure,standalone:!0===n.standalone,onDestroy:n.type.prototype.ngOnDestroy||null}}function Ai(n){return n[Il]||null}function Ur(n){return n[eo]||null}function no(n){return n[Ah]||null}function nr(n){return Array.isArray(n)&&"object"==typeof n[1]}function ro(n){return Array.isArray(n)&&!0===n[1]}function so(n){return 0!=(8&n.flags)}function Ih(n){return 2==(2&n.flags)}function Ao(n){return 1==(1&n.flags)}function Ae(n){return null!==n.template}function Xe(n){return 0!=(256&n[2])}function Gs(n,e){return n.hasOwnProperty(Rr)?n[Rr]:null}class _u{constructor(e,t,i){this.previousValue=e,this.currentValue=t,this.firstChange=i}isFirstChange(){return this.firstChange}}function Xo(){return Cs}function Cs(n){return n.type.prototype.ngOnChanges&&(n.setInput=Ld),zl}function zl(){const n=Gu(this),e=n?.current;if(e){const t=n.previous;if(t===Dl)n.previous=e;else for(let i in e)t[i]=e[i];n.current=null,this.ngOnChanges(e)}}function Ld(n,e,t,i){const r=Gu(n)||function Vl(n,e){return n[rl]=e}(n,{previous:Dl,current:null}),s=r.current||(r.current={}),a=r.previous,u=this.declaredInputs[t],f=a[u];s[u]=new _u(f&&f.currentValue,e,a===Dl),n[i]=e}Xo.ngInherit=!0;const rl="__ngSimpleChanges__";function Gu(n){return n[rl]||null}function Kr(n){for(;Array.isArray(n);)n=n[0];return n}function Pt(n,e){return Kr(e[n])}function mt(n,e){return Kr(e[n.index])}function $u(n,e){return n.data[e]}function Yo(n,e){return n[e]}function zi(n,e){const t=e[n];return nr(t)?t:t[0]}function ao(n){return 64==(64&n[2])}function Os(n,e){return null==e?null:n[e]}function Ji(n){n[18]=0}function ir(n,e){n[5]+=e;let t=n,i=n[3];for(;null!==i&&(1===e&&1===t[5]||-1===e&&0===t[5]);)i[5]+=e,t=i,i=i[3]}const hn={lFrame:Wr(null),bindingsEnabled:!0};function x(){return hn.bindingsEnabled}function L(){return hn.lFrame.lView}function N(){return hn.lFrame.tView}function q(){let n=Q();for(;null!==n&&64===n.type;)n=n.parent;return n}function Q(){return hn.lFrame.currentTNode}function ue(n,e){const t=hn.lFrame;t.currentTNode=n,t.isParent=e}function he(){return hn.lFrame.isParent}function Ee(){hn.lFrame.isParent=!1}function it(){return hn.lFrame.bindingIndex++}function St(n,e){const t=hn.lFrame;t.bindingIndex=t.bindingRootIndex=n,Pn(e)}function Pn(n){hn.lFrame.currentDirectiveIndex=n}function Di(){return hn.lFrame.currentQueryIndex}function Ei(n){hn.lFrame.currentQueryIndex=n}function ii(n){const e=n[1];return 2===e.type?e.declTNode:1===e.type?n[6]:null}function Nn(n,e,t){if(t&_n.SkipSelf){let r=e,s=n;for(;!(r=r.parent,null!==r||t&_n.Host||(r=ii(s),null===r||(s=s[15],10&r.type))););if(null===r)return!1;e=r,n=s}const i=hn.lFrame=cs();return i.currentTNode=e,i.lView=n,!0}function Ii(n){const e=cs(),t=n[1];hn.lFrame=e,e.currentTNode=t.firstChild,e.lView=n,e.tView=t,e.contextLView=n,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function cs(){const n=hn.lFrame,e=null===n?null:n.child;return null===e?Wr(n):e}function Wr(n){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=e),e}function ma(){const n=hn.lFrame;return hn.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const Oa=ma;function ol(){const n=ma();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function wr(){return hn.lFrame.selectedIndex}function _a(n){hn.lFrame.selectedIndex=n}function Zn(){const n=hn.lFrame;return $u(n.tView,n.selectedIndex)}function On(){hn.lFrame.currentNamespace="svg"}function al(n,e){for(let t=e.directiveStart,i=e.directiveEnd;t<i;t++){const s=n.data[t].type.prototype,{ngAfterContentInit:a,ngAfterContentChecked:u,ngAfterViewInit:f,ngAfterViewChecked:g,ngOnDestroy:E}=s;a&&(n.contentHooks||(n.contentHooks=[])).push(-t,a),u&&((n.contentHooks||(n.contentHooks=[])).push(t,u),(n.contentCheckHooks||(n.contentCheckHooks=[])).push(t,u)),f&&(n.viewHooks||(n.viewHooks=[])).push(-t,f),g&&((n.viewHooks||(n.viewHooks=[])).push(t,g),(n.viewCheckHooks||(n.viewCheckHooks=[])).push(t,g)),null!=E&&(n.destroyHooks||(n.destroyHooks=[])).push(t,E)}}function Io(n,e,t){lo(n,e,3,t)}function Fa(n,e,t,i){(3&n[2])===t&&lo(n,e,t,i)}function ll(n,e){let t=n[2];(3&t)===e&&(t&=2047,t+=1,n[2]=t)}function lo(n,e,t,i){const s=i??-1,a=e.length-1;let u=0;for(let f=void 0!==i?65535&n[18]:0;f<a;f++)if("number"==typeof e[f+1]){if(u=e[f],null!=i&&u>=i)break}else e[f]<0&&(n[18]+=65536),(u<s||-1==s)&&(hc(n,t,e,f),n[18]=(4294901760&n[18])+f+2),f++}function hc(n,e,t,i){const r=t[i]<0,s=t[i+1],u=n[r?-t[i]:t[i]];if(r){if(n[2]>>11<n[18]>>16&&(3&n[2])===e){n[2]+=2048;try{s.call(u)}finally{}}}else try{s.call(u)}finally{}}class ya{constructor(e,t,i){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=i}}function Na(n,e,t){let i=0;for(;i<t.length;){const r=t[i];if("number"==typeof r){if(0!==r)break;i++;const s=t[i++],a=t[i++],u=t[i++];n.setAttribute(e,a,u,s)}else{const s=r,a=t[++i];uo(s)?n.setProperty(e,s,a):n.setAttribute(e,s,a),i++}}return i}function Uf(n){return 3===n||4===n||6===n}function uo(n){return 64===n.charCodeAt(0)}function Fh(n,e){if(null!==e&&0!==e.length)if(null===n||0===n.length)n=e.slice();else{let t=-1;for(let i=0;i<e.length;i++){const r=e[i];"number"==typeof r?t=r:0===t||Nh(n,t,r,null,-1===t||2===t?e[++i]:null)}}return n}function Nh(n,e,t,i,r){let s=0,a=n.length;if(-1===e)a=-1;else for(;s<n.length;){const u=n[s++];if("number"==typeof u){if(u===e){a=-1;break}if(u>e){a=s-1;break}}}for(;s<n.length;){const u=n[s];if("number"==typeof u)break;if(u===t){if(null===i)return void(null!==r&&(n[s+1]=r));if(i===n[s+1])return void(n[s+2]=r)}s++,null!==i&&s++,null!==r&&s++}-1!==a&&(n.splice(a,0,e),s=a+1),n.splice(s++,0,t),null!==i&&n.splice(s++,0,i),null!==r&&n.splice(s++,0,r)}function rr(n){return-1!==n}function Pc(n){return 32767&n}function va(n,e){let t=function Po(n){return n>>16}(n),i=e;for(;t>0;)i=i[15],t--;return i}let kc=!0;function qu(n){const e=kc;return kc=n,e}let Bh=0;const Ul={};function Bd(n,e){const t=jf(n,e);if(-1!==t)return t;const i=e[1];i.firstCreatePass&&(n.injectorIndex=e.length,Rc(i.data,n),Rc(e,null),Rc(i.blueprint,null));const r=zd(n,e),s=n.injectorIndex;if(rr(r)){const a=Pc(r),u=va(r,e),f=u[1].data;for(let g=0;g<8;g++)e[s+g]=u[a+g]|f[a+g]}return e[s+8]=r,s}function Rc(n,e){n.push(0,0,0,0,0,0,0,0,e)}function jf(n,e){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===e[n.injectorIndex+8]?-1:n.injectorIndex}function zd(n,e){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let t=0,i=null,r=e;for(;null!==r;){if(i=Wf(r),null===i)return-1;if(t++,r=r[15],-1!==i.injectorIndex)return i.injectorIndex|t<<16}return-1}function jl(n,e,t){!function $p(n,e,t){let i;"string"==typeof t?i=t.charCodeAt(0)||0:t.hasOwnProperty(Pl)&&(i=t[Pl]),null==i&&(i=t[Pl]=Bh++);const r=255&i;e.data[n+(r>>5)]|=1<<r}(n,e,t)}function zh(n,e,t){if(t&_n.Optional||void 0!==n)return n;el()}function Vd(n,e,t,i){if(t&_n.Optional&&void 0===i&&(i=null),0==(t&(_n.Self|_n.Host))){const r=n[9],s=Wi(void 0);try{return r?r.get(e,i,t&_n.Optional):Sh(e,i,t&_n.Optional)}finally{Wi(s)}}return zh(i,0,t)}function Ud(n,e,t,i=_n.Default,r){if(null!==n){if(1024&e[2]){const a=function Gf(n,e,t,i,r){let s=n,a=e;for(;null!==s&&null!==a&&1024&a[2]&&!(256&a[2]);){const u=qp(s,a,t,i|_n.Self,Ul);if(u!==Ul)return u;let f=s.parent;if(!f){const g=a[21];if(g){const E=g.get(t,Ul,i);if(E!==Ul)return E}f=Wf(a),a=a[15]}s=f}return r}(n,e,t,i,Ul);if(a!==Ul)return a}const s=qp(n,e,t,i,Ul);if(s!==Ul)return s}return Vd(e,t,i,r)}function qp(n,e,t,i,r){const s=function Xp(n){if("string"==typeof n)return n.charCodeAt(0)||0;const e=n.hasOwnProperty(Pl)?n[Pl]:void 0;return"number"==typeof e?e>=0?255&e:ey:e}(t);if("function"==typeof s){if(!Nn(e,n,i))return i&_n.Host?zh(r,0,i):Vd(e,t,i,r);try{const a=s(i);if(null!=a||i&_n.Optional)return a;el()}finally{Oa()}}else if("number"==typeof s){let a=null,u=jf(n,e),f=-1,g=i&_n.Host?e[16][6]:null;for((-1===u||i&_n.SkipSelf)&&(f=-1===u?zd(n,e):e[u+8],-1!==f&&Hf(i,!1)?(a=e[1],u=Pc(f),e=va(f,e)):u=-1);-1!==u;){const E=e[1];if(jd(s,u,E.data)){const M=Zp(u,e,t,a,i,g);if(M!==Ul)return M}f=e[u+8],-1!==f&&Hf(i,e[1].data[u+8]===g)&&jd(s,u,e)?(a=E,u=Pc(f),e=va(f,e)):u=-1}}return r}function Zp(n,e,t,i,r,s){const a=e[1],u=a.data[n+8],E=Fs(u,a,t,null==i?Ih(u)&&kc:i!=a&&0!=(3&u.type),r&_n.Host&&s===u);return null!==E?Jr(e,a,E,u):Ul}function Fs(n,e,t,i,r){const s=n.providerIndexes,a=e.data,u=1048575&s,f=n.directiveStart,E=s>>20,R=r?u+E:n.directiveEnd;for(let F=i?u:u+E;F<R;F++){const V=a[F];if(F<f&&t===V||F>=f&&V.type===t)return F}if(r){const F=a[f];if(F&&Ae(F)&&F.type===t)return f}return null}function Jr(n,e,t,i){let r=n[t];const s=e.data;if(function dc(n){return n instanceof ya}(r)){const a=r;a.resolving&&function Pa(n,e){const t=e?`. Dependency path: ${e.join(" > ")} > ${n}`:"";throw new st(-200,`Circular dependency in DI detected for ${n}${t}`)}(function ci(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():an(n)}(s[t]));const u=qu(a.canSeeViewProviders);a.resolving=!0;const f=a.injectImpl?Wi(a.injectImpl):null;Nn(n,i,_n.Default);try{r=n[t]=a.factory(void 0,s,n,i),e.firstCreatePass&&t>=i.directiveStart&&function Ko(n,e,t){const{ngOnChanges:i,ngOnInit:r,ngDoCheck:s}=e.type.prototype;if(i){const a=Cs(e);(t.preOrderHooks||(t.preOrderHooks=[])).push(n,a),(t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n,a)}r&&(t.preOrderHooks||(t.preOrderHooks=[])).push(0-n,r),s&&((t.preOrderHooks||(t.preOrderHooks=[])).push(n,s),(t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n,s))}(t,s[t],e)}finally{null!==f&&Wi(f),qu(u),a.resolving=!1,Oa()}}return r}function jd(n,e,t){return!!(t[e+(n>>5)]&1<<n)}function Hf(n,e){return!(n&_n.Self||n&_n.Host&&e)}class Ba{constructor(e,t){this._tNode=e,this._lView=t}get(e,t,i){return Ud(this._tNode,this._lView,e,i,t)}}function ey(){return new Ba(q(),L())}function Wf(n){const e=n[1],t=e.type;return 2===t?e.declTNode:1===t?n[6]:null}function Vh(n){return function mg(n,e){if("class"===e)return n.classes;if("style"===e)return n.styles;const t=n.attrs;if(t){const i=t.length;let r=0;for(;r<i;){const s=t[r];if(Uf(s))break;if(0===s)r+=2;else if("number"==typeof s)for(r++;r<i&&"string"==typeof t[r];)r++;else{if(s===e)return t[r+1];r+=2}}}return null}(q(),n)}const Zu="__parameters__";function Tn(n,e,t){return Al(()=>{const i=function Xu(n){return function(...t){if(n){const i=n(...t);for(const r in i)this[r]=i[r]}}}(e);function r(...s){if(this instanceof r)return i.apply(this,s),this;const a=new r(...s);return u.annotation=a,u;function u(f,g,E){const M=f.hasOwnProperty(Zu)?f[Zu]:Object.defineProperty(f,Zu,{value:[]})[Zu];for(;M.length<=E;)M.push(null);return(M[E]=M[E]||[]).push(a),f}}return t&&(r.prototype=Object.create(t.prototype)),r.prototype.ngMetadataName=n,r.annotationCls=r,r})}class Lt{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=lt({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function Jo(n,e){void 0===e&&(e=n);for(let t=0;t<n.length;t++){let i=n[t];Array.isArray(i)?(e===n&&(e=n.slice(0,t)),Jo(i,e)):e!==n&&e.push(i)}return e}function Qo(n,e){n.forEach(t=>Array.isArray(t)?Qo(t,e):e(t))}function qf(n,e,t){e>=n.length?n.push(t):n.splice(e,0,t)}function sr(n,e){return e>=n.length-1?n.pop():n.splice(e,1)[0]}function ea(n,e){const t=[];for(let i=0;i<n;i++)t.push(e);return t}function ho(n,e,t){let i=Fc(n,e);return i>=0?n[1|i]=t:(i=~i,function Wd(n,e,t,i){let r=n.length;if(r==e)n.push(t,i);else if(1===r)n.push(i,n[0]),n[0]=t;else{for(r--,n.push(n[r-1],n[r]);r>e;)n[r]=n[r-2],r--;n[e]=t,n[e+1]=i}}(n,i,e,t)),i}function qd(n,e){const t=Fc(n,e);if(t>=0)return n[1|t]}function Fc(n,e){return function nm(n,e,t){let i=0,r=n.length>>t;for(;r!==i;){const s=i+(r-i>>1),a=n[s<<t];if(e===a)return s<<t;a>e?r=s:i=s+1}return~(r<<t)}(n,e,1)}const Wh={},sm="__NG_DI_FLAG__",Zd="ngTempTokenPath",Xd=/\n/gm,xu="__source";let $h;function Bc(n){const e=$h;return $h=n,e}function vg(n,e=_n.Default){if(void 0===$h)throw new st(-203,!1);return null===$h?Sh(n,void 0,e):$h.get(n,e&_n.Optional?null:void 0,e)}function nt(n,e=_n.Default){return(function Ch(){return cu}()||vg)(Kt(n),e)}function Gl(n,e=_n.Default){return"number"!=typeof e&&(e=0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)),nt(n,e)}function om(n){const e=[];for(let t=0;t<n.length;t++){const i=Kt(n[t]);if(Array.isArray(i)){if(0===i.length)throw new st(900,!1);let r,s=_n.Default;for(let a=0;a<i.length;a++){const u=i[a],f=Zf(u);"number"==typeof f?-1===f?r=u.token:s|=f:r=u}e.push(nt(r,s))}else e.push(nt(i))}return e}function qh(n,e){return n[sm]=e,n.prototype[sm]=e,n}function Zf(n){return n[sm]}const wu=qh(Tn("Optional"),8),Zh=qh(Tn("SkipSelf"),4);let Jf,xa;function Uc(n){return function $s(){if(void 0===xa&&(xa=null,tr.trustedTypes))try{xa=tr.trustedTypes.createPolicy("angular",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch{}return xa}()?.createHTML(n)||n}class Qu{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}class cy extends Qu{getTypeName(){return"HTML"}}class uy extends Qu{getTypeName(){return"Style"}}class Eg extends Qu{getTypeName(){return"Script"}}class ef extends Qu{getTypeName(){return"URL"}}class ed extends Qu{getTypeName(){return"ResourceURL"}}function Ro(n){return n instanceof Qu?n.changingThisBreaksApplicationSecurity:n}function Wl(n,e){const t=function tf(n){return n instanceof Qu&&n.getTypeName()||null}(n);if(null!=t&&t!==e){if("ResourceURL"===t&&"URL"===e)return!0;throw new Error(`Required a safe ${e}, got a ${t} (see https://g.co/ng/security#xss)`)}return t===e}class hl{constructor(e){this.inertDocumentHelper=e}getInertBodyElement(e){e="<body><remove></remove>"+e;try{const t=(new window.DOMParser).parseFromString(Uc(e),"text/html").body;return null===t?this.inertDocumentHelper.getInertBodyElement(e):(t.removeChild(t.firstChild),t)}catch{return null}}}class tp{constructor(e){if(this.defaultDoc=e,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){const t=this.inertDocument.createElement("html");this.inertDocument.appendChild(t);const i=this.inertDocument.createElement("body");t.appendChild(i)}}getInertBodyElement(e){const t=this.inertDocument.createElement("template");if("content"in t)return t.innerHTML=Uc(e),t;const i=this.inertDocument.createElement("body");return i.innerHTML=Uc(e),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(i),i}stripCustomNsAttrs(e){const t=e.attributes;for(let r=t.length-1;0<r;r--){const a=t.item(r).name;("xmlns:ns1"===a||0===a.indexOf("ns1:"))&&e.removeAttribute(a)}let i=e.firstChild;for(;i;)i.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(i),i=i.nextSibling}}const hy=/^(?:(?:https?|mailto|data|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi;function af(n){return(n=String(n)).match(hy)?n:"unsafe:"+n}function gc(n){const e={};for(const t of n.split(","))e[t]=!0;return e}function lf(...n){const e={};for(const t of n)for(const i in t)t.hasOwnProperty(i)&&(e[i]=!0);return e}const mm=gc("area,br,col,hr,img,wbr"),gm=gc("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),np=gc("rp,rt"),ip=lf(mm,lf(gm,gc("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),lf(np,gc("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),lf(np,gm)),dl=gc("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),_m=lf(dl,gc("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),gc("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),Sg=gc("script,style,template");class Mg{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(e){let t=e.firstChild,i=!0;for(;t;)if(t.nodeType===Node.ELEMENT_NODE?i=this.startElement(t):t.nodeType===Node.TEXT_NODE?this.chars(t.nodeValue):this.sanitizedSomething=!0,i&&t.firstChild)t=t.firstChild;else for(;t;){t.nodeType===Node.ELEMENT_NODE&&this.endElement(t);let r=this.checkClobberedElement(t,t.nextSibling);if(r){t=r;break}t=this.checkClobberedElement(t,t.parentNode)}return this.buf.join("")}startElement(e){const t=e.nodeName.toLowerCase();if(!ip.hasOwnProperty(t))return this.sanitizedSomething=!0,!Sg.hasOwnProperty(t);this.buf.push("<"),this.buf.push(t);const i=e.attributes;for(let r=0;r<i.length;r++){const s=i.item(r),a=s.name,u=a.toLowerCase();if(!_m.hasOwnProperty(u)){this.sanitizedSomething=!0;continue}let f=s.value;dl[u]&&(f=af(f)),this.buf.push(" ",a,'="',Ag(f),'"')}return this.buf.push(">"),!0}endElement(e){const t=e.nodeName.toLowerCase();ip.hasOwnProperty(t)&&!mm.hasOwnProperty(t)&&(this.buf.push("</"),this.buf.push(t),this.buf.push(">"))}chars(e){this.buf.push(Ag(e))}checkClobberedElement(e,t){if(t&&(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${e.outerHTML}`);return t}}const ym=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,dy=/([^\#-~ |!])/g;function Ag(n){return n.replace(/&/g,"&amp;").replace(ym,function(e){return"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";"}).replace(dy,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let cf;function vm(n,e){let t=null;try{cf=cf||function ta(n){const e=new tp(n);return function sf(){try{return!!(new window.DOMParser).parseFromString(Uc(""),"text/html")}catch{return!1}}()?new hl(e):e}(n);let i=e?String(e):"";t=cf.getInertBodyElement(i);let r=5,s=i;do{if(0===r)throw new Error("Failed to sanitize html because the input is unstable");r--,i=s,s=t.innerHTML,t=cf.getInertBodyElement(i)}while(i!==s);return Uc((new Mg).sanitizeChildren(rp(t)||t))}finally{if(t){const i=rp(t)||t;for(;i.firstChild;)i.removeChild(i.firstChild)}}}function rp(n){return"content"in n&&function sp(n){return n.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===n.nodeName}(n)?n.content:null}var Gn=(()=>((Gn=Gn||{})[Gn.NONE=0]="NONE",Gn[Gn.HTML=1]="HTML",Gn[Gn.STYLE=2]="STYLE",Gn[Gn.SCRIPT=3]="SCRIPT",Gn[Gn.URL=4]="URL",Gn[Gn.RESOURCE_URL=5]="RESOURCE_URL",Gn))();const Hc=new Lt("ENVIRONMENT_INITIALIZER"),xm=new Lt("INJECTOR",-1),wm=new Lt("INJECTOR_DEF_TYPES");class Ig{get(e,t=Wh){if(t===Wh){const i=new Error(`NullInjectorError: No provider for ${Si(e)}!`);throw i.name="NullInjectorError",i}return t}}function _y(...n){return{\u0275providers:Pg(0,n)}}function Pg(n,...e){const t=[],i=new Set;let r;return Qo(e,s=>{const a=s;pf(a,t,[],i)&&(r||(r=[]),r.push(a))}),void 0!==r&&ff(r,t),t}function ff(n,e){for(let t=0;t<n.length;t++){const{providers:r}=n[t];Qo(r,s=>{e.push(s)})}}function pf(n,e,t,i){if(!(n=Kt(n)))return!1;let r=null,s=zu(n);const a=!s&&Ai(n);if(s||a){if(a&&!a.standalone)return!1;r=n}else{const f=n.ngModule;if(s=zu(f),!s)return!1;r=f}const u=i.has(r);if(a){if(u)return!1;if(i.add(r),a.dependencies){const f="function"==typeof a.dependencies?a.dependencies():a.dependencies;for(const g of f)pf(g,e,t,i)}}else{if(!s)return!1;{if(null!=s.imports&&!u){let g;i.add(r);try{Qo(s.imports,E=>{pf(E,e,t,i)&&(g||(g=[]),g.push(E))})}finally{}void 0!==g&&ff(g,e)}if(!u){const g=Gs(r)||(()=>new r);e.push({provide:r,useFactory:g,deps:An},{provide:wm,useValue:r,multi:!0},{provide:Hc,useValue:()=>nt(r),multi:!0})}const f=s.providers;null==f||u||Qo(f,E=>{e.push(E)})}}return r!==n&&void 0!==n.providers}const Em=Hn({provide:String,useValue:Hn});function mf(n){return null!==n&&"object"==typeof n&&Em in n}function Gc(n){return"function"==typeof n}const nd=new Lt("Set Injector scope."),id={},Tm={};let lp;function cp(){return void 0===lp&&(lp=new Ig),lp}class rd{}class Lg extends rd{constructor(e,t,i,r){super(),this.parent=t,this.source=i,this.scopes=r,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,sd(e,a=>this.processProvider(a)),this.records.set(xm,nh(void 0,this)),r.has("environment")&&this.records.set(rd,nh(void 0,this));const s=this.records.get(nd);null!=s&&"string"==typeof s.value&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(wm.multi,An,_n.Self))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const e of this._ngOnDestroyHooks)e.ngOnDestroy();for(const e of this._onDestroyHooks)e()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(e){this._onDestroyHooks.push(e)}runInContext(e){this.assertNotDestroyed();const t=Bc(this),i=Wi(void 0);try{return e()}finally{Bc(t),Wi(i)}}get(e,t=Wh,i=_n.Default){this.assertNotDestroyed();const r=Bc(this),s=Wi(void 0);try{if(!(i&_n.SkipSelf)){let u=this.records.get(e);if(void 0===u){const f=function gf(n){return"function"==typeof n||"object"==typeof n&&n instanceof Lt}(e)&&sc(e);u=f&&this.injectableDefInScope(f)?nh(up(e),id):null,this.records.set(e,u)}if(null!=u)return this.hydrate(e,u)}return(i&_n.Self?cp():this.parent).get(e,t=i&_n.Optional&&t===Wh?null:t)}catch(a){if("NullInjectorError"===a.name){if((a[Zd]=a[Zd]||[]).unshift(Si(e)),r)throw a;return function Xf(n,e,t,i){const r=n[Zd];throw e[xu]&&r.unshift(e[xu]),n.message=function Yu(n,e,t,i=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.slice(2):n;let r=Si(e);if(Array.isArray(e))r=e.map(Si).join(" -> ");else if("object"==typeof e){let s=[];for(let a in e)if(e.hasOwnProperty(a)){let u=e[a];s.push(a+":"+("string"==typeof u?JSON.stringify(u):Si(u)))}r=`{${s.join(", ")}}`}return`${t}${i?"("+i+")":""}[${r}]: ${n.replace(Xd,"\n  ")}`}("\n"+n.message,r,t,i),n.ngTokenPath=r,n[Zd]=null,n}(a,e,"R3InjectorError",this.source)}throw a}finally{Wi(s),Bc(r)}}resolveInjectorInitializers(){const e=Bc(this),t=Wi(void 0);try{const i=this.get(Hc.multi,An,_n.Self);for(const r of i)r()}finally{Bc(e),Wi(t)}}toString(){const e=[],t=this.records;for(const i of t.keys())e.push(Si(i));return`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new st(205,!1)}processProvider(e){let t=Gc(e=Kt(e))?e:Kt(e&&e.provide);const i=function th(n){return mf(n)?nh(void 0,n.useValue):nh(Cm(n),id)}(e);if(Gc(e)||!0!==e.multi)this.records.get(t);else{let r=this.records.get(t);r||(r=nh(void 0,id,!0),r.factory=()=>om(r.multi),this.records.set(t,r)),t=e,r.multi.push(e)}this.records.set(t,i)}hydrate(e,t){return t.value===id&&(t.value=Tm,t.value=t.factory()),"object"==typeof t.value&&t.value&&function Og(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}injectableDefInScope(e){if(!e.providedIn)return!1;const t=Kt(e.providedIn);return"string"==typeof t?"any"===t||this.scopes.has(t):this.injectorDefTypes.has(t)}}function up(n){const e=sc(n),t=null!==e?e.factory:Gs(n);if(null!==t)return t;if(n instanceof Lt)throw new st(204,!1);if(n instanceof Function)return function Or(n){const e=n.length;if(e>0)throw ea(e,"?"),new st(204,!1);const t=function ni(n){const e=n&&(n[Tc]||n[Eh]);if(e){const t=function Xi(n){if(n.hasOwnProperty("name"))return n.name;const e=(""+n).match(/^function\s*([^\s(]+)/);return null===e?"":e[1]}(n);return console.warn(`DEPRECATED: DI is instantiating a token "${t}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${t}" class.`),e}return null}(n);return null!==t?()=>t.factory(n):()=>new n}(n);throw new st(204,!1)}function Cm(n,e,t){let i;if(Gc(n)){const r=Kt(n);return Gs(r)||up(r)}if(mf(n))i=()=>Kt(n.useValue);else if(function kg(n){return!(!n||!n.useFactory)}(n))i=()=>n.useFactory(...om(n.deps||[]));else if(function eh(n){return!(!n||!n.useExisting)}(n))i=()=>nt(Kt(n.useExisting));else{const r=Kt(n&&(n.useClass||n.provide));if(!function Sm(n){return!!n.deps}(n))return Gs(r)||up(r);i=()=>new r(...om(n.deps))}return i}function nh(n,e,t=!1){return{factory:n,value:e,multi:t?[]:void 0}}function Mm(n){return!!n.\u0275providers}function sd(n,e){for(const t of n)Array.isArray(t)?sd(t,e):Mm(t)?sd(t.\u0275providers,e):e(t)}class hp{}class Bg{resolveComponentFactory(e){throw function Ng(n){const e=Error(`No component factory found for ${Si(n)}. Did you add it to @NgModule.entryComponents?`);return e.ngComponent=n,e}(e)}}let od=(()=>{class n{}return n.NULL=new Bg,n})();function zg(){return ih(q(),L())}function ih(n,e){return new us(mt(n,e))}let us=(()=>{class n{constructor(t){this.nativeElement=t}}return n.__NG_ELEMENT_ID__=zg,n})();function Vg(n){return n instanceof us?n.nativeElement:n}class rh{}let _c=(()=>{class n{}return n.__NG_ELEMENT_ID__=()=>function ad(){const n=L(),t=zi(q().index,n);return(nr(t)?t:n)[11]}(),n})(),fp=(()=>{class n{}return n.\u0275prov=lt({token:n,providedIn:"root",factory:()=>null}),n})();class ld{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const c=new ld("14.2.4"),o={};function Ke(n){return n.ngOriginalError}class Ze{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e);this._console.error("ERROR",e),t&&this._console.error("ORIGINAL ERROR",t)}_findOriginalError(e){let t=e&&Ke(e);for(;t&&Ke(t);)t=Ke(t);return t||null}}const Vt=new Map;let Ot=0;const Ss="__ngContext__";function Ui(n,e){nr(e)?(n[Ss]=e[20],function or(n){Vt.set(n[20],n)}(e)):n[Ss]=e}var ui=(()=>((ui=ui||{})[ui.Important=1]="Important",ui[ui.DashCase=2]="DashCase",ui))();function cd(n,e){return undefined(n,e)}function oh(n){const e=n[3];return ro(e)?e[3]:e}function pp(n){return mp(n[13])}function ah(n){return mp(n[4])}function mp(n){for(;null!==n&&!ro(n);)n=n[4];return n}function lh(n,e,t,i,r){if(null!=i){let s,a=!1;ro(i)?s=i:nr(i)&&(a=!0,i=i[0]);const u=Kr(i);0===n&&null!==t?null==r?b0(e,t,u):Mu(e,t,u,r||null,!0):1===n&&null!==t?Mu(e,t,u,r||null,!0):2===n?function Xg(n,e,t){const i=Wg(n,e);i&&function Cw(n,e,t,i){n.removeChild(e,t,i)}(n,i,e,t)}(e,u,a):3===n&&e.destroyNode(u),null!=s&&function ml(n,e,t,i,r){const s=t[7];s!==Kr(t)&&lh(e,n,i,s,r);for(let u=10;u<t.length;u++){const f=t[u];Im(f[1],f,n,e,i,s)}}(e,n,s,t,r)}}function hd(n,e,t){return n.createElement(e,t)}function Cn(n,e){const t=n[9],i=t.indexOf(e),r=e[3];512&e[2]&&(e[2]&=-513,ir(r,-1)),t.splice(i,1)}function Hg(n,e){if(n.length<=10)return;const t=10+e,i=n[t];if(i){const r=i[17];null!==r&&r!==n&&Cn(r,i),e>0&&(n[t-1][4]=i[4]);const s=sr(n,10+e);!function jg(n,e){Im(n,e,e[11],2,null,null),e[0]=null,e[6]=null}(i[1],i);const a=s[19];null!==a&&a.detachView(s[1]),i[3]=null,i[4]=null,i[2]&=-65}return i}function ql(n,e){if(!(128&e[2])){const t=e[11];t.destroyNode&&Im(n,e,t,3,null,null),function _f(n){let e=n[13];if(!e)return Gg(n[1],n);for(;e;){let t=null;if(nr(e))t=e[13];else{const i=e[10];i&&(t=i)}if(!t){for(;e&&!e[4]&&e!==n;)nr(e)&&Gg(e[1],e),e=e[3];null===e&&(e=n),nr(e)&&Gg(e[1],e),t=e&&e[4]}e=t}}(e)}}function Gg(n,e){if(!(128&e[2])){e[2]&=-65,e[2]|=128,function cr(n,e){let t;if(null!=n&&null!=(t=n.destroyHooks))for(let i=0;i<t.length;i+=2){const r=e[t[i]];if(!(r instanceof ya)){const s=t[i+1];if(Array.isArray(s))for(let a=0;a<s.length;a+=2){const u=r[s[a]],f=s[a+1];try{f.call(u)}finally{}}else try{s.call(r)}finally{}}}}(n,e),function Tw(n,e){const t=n.cleanup,i=e[7];let r=-1;if(null!==t)for(let s=0;s<t.length-1;s+=2)if("string"==typeof t[s]){const a=t[s+1],u="function"==typeof a?a(e):Kr(e[a]),f=i[r=t[s+2]],g=t[s+3];"boolean"==typeof g?u.removeEventListener(t[s],f,g):g>=0?i[r=g]():i[r=-g].unsubscribe(),s+=2}else{const a=i[r=t[s+1]];t[s].call(a)}if(null!==i){for(let s=r+1;s<i.length;s++)(0,i[s])();e[7]=null}}(n,e),1===e[1].type&&e[11].destroy();const t=e[17];if(null!==t&&ro(e[3])){t!==e[3]&&Cn(t,e);const i=e[19];null!==i&&i.detachView(n)}!function hs(n){Vt.delete(n[20])}(e)}}function v0(n,e,t){return function vy(n,e,t){let i=e;for(;null!==i&&40&i.type;)i=(e=i).parent;if(null===i)return t[0];if(2&i.flags){const r=n.data[i.directiveStart].encapsulation;if(r===da.None||r===da.Emulated)return null}return mt(i,t)}(n,e.parent,t)}function Mu(n,e,t,i,r){n.insertBefore(e,t,i,r)}function b0(n,e,t){n.appendChild(e,t)}function x0(n,e,t,i,r){null!==i?Mu(n,e,t,i,r):b0(n,e,t)}function Wg(n,e){return n.parentNode(e)}function w0(n,e,t){return T0(n,e,t)}let T0=function E0(n,e,t){return 40&n.type?mt(n,t):null};function $g(n,e,t,i){const r=v0(n,i,e),s=e[11],u=w0(i.parent||e[6],i,e);if(null!=r)if(Array.isArray(t))for(let f=0;f<t.length;f++)x0(s,r,t[f],u,!1);else x0(s,r,t,u,!1)}function qg(n,e){if(null!==e){const t=e.type;if(3&t)return mt(e,n);if(4&t)return xy(-1,n[e.index]);if(8&t){const i=e.child;if(null!==i)return qg(n,i);{const r=n[e.index];return ro(r)?xy(-1,r):Kr(r)}}if(32&t)return cd(e,n)()||Kr(n[e.index]);{const i=Zg(n,e);return null!==i?Array.isArray(i)?i[0]:qg(oh(n[16]),i):qg(n,e.next)}}return null}function Zg(n,e){return null!==e?n[16][6].projection[e.projection]:null}function xy(n,e){const t=10+n+1;if(t<e.length){const i=e[t],r=i[1].firstChild;if(null!==r)return qg(i,r)}return e[7]}function wy(n,e,t,i,r,s,a){for(;null!=t;){const u=i[t.index],f=t.type;if(a&&0===e&&(u&&Ui(Kr(u),i),t.flags|=4),64!=(64&t.flags))if(8&f)wy(n,e,t.child,i,r,s,!1),lh(e,n,r,u,s);else if(32&f){const g=cd(t,i);let E;for(;E=g();)lh(e,n,r,E,s);lh(e,n,r,u,s)}else 16&f?_o(n,e,i,t,r,s):lh(e,n,r,u,s);t=a?t.projectionNext:t.next}}function Im(n,e,t,i,r,s){wy(t,i,n.firstChild,e,r,s,!1)}function _o(n,e,t,i,r,s){const a=t[16],f=a[6].projection[i.projection];if(Array.isArray(f))for(let g=0;g<f.length;g++)lh(e,n,r,f[g],s);else wy(n,e,f,a[3],r,s,!0)}function S0(n,e,t){n.setAttribute(e,"style",t)}function Ey(n,e,t){""===t?n.removeAttribute(e,"class"):n.setAttribute(e,"class",t)}function Ty(n,e,t){let i=n.length;for(;;){const r=n.indexOf(e,t);if(-1===r)return r;if(0===r||n.charCodeAt(r-1)<=32){const s=e.length;if(r+s===i||n.charCodeAt(r+s)<=32)return r}t=r+1}}const M0="ng-template";function Dw(n,e,t){let i=0;for(;i<n.length;){let r=n[i++];if(t&&"class"===r){if(r=n[i],-1!==Ty(r.toLowerCase(),e,0))return!0}else if(1===r){for(;i<n.length&&"string"==typeof(r=n[i++]);)if(r.toLowerCase()===e)return!0;return!1}}return!1}function Cy(n){return 4===n.type&&n.value!==M0}function Iw(n,e,t){return e===(4!==n.type||t?n.value:M0)}function Pw(n,e,t){let i=4;const r=n.attrs||[],s=function Rw(n){for(let e=0;e<n.length;e++)if(Uf(n[e]))return e;return n.length}(r);let a=!1;for(let u=0;u<e.length;u++){const f=e[u];if("number"!=typeof f){if(!a)if(4&i){if(i=2|1&i,""!==f&&!Iw(n,f,t)||""===f&&1===e.length){if(qc(i))return!1;a=!0}}else{const g=8&i?f:e[++u];if(8&i&&null!==n.attrs){if(!Dw(n.attrs,g,t)){if(qc(i))return!1;a=!0}continue}const M=A0(8&i?"class":f,r,Cy(n),t);if(-1===M){if(qc(i))return!1;a=!0;continue}if(""!==g){let R;R=M>s?"":r[M+1].toLowerCase();const F=8&i?R:null;if(F&&-1!==Ty(F,g,0)||2&i&&g!==R){if(qc(i))return!1;a=!0}}}}else{if(!a&&!qc(i)&&!qc(f))return!1;if(a&&qc(f))continue;a=!1,i=f|1&i}}return qc(i)||a}function qc(n){return 0==(1&n)}function A0(n,e,t,i){if(null===e)return-1;let r=0;if(i||!t){let s=!1;for(;r<e.length;){const a=e[r];if(a===n)return r;if(3===a||6===a)s=!0;else{if(1===a||2===a){let u=e[++r];for(;"string"==typeof u;)u=e[++r];continue}if(4===a)break;if(0===a){r+=4;continue}}r+=s?1:2}return-1}return function Lw(n,e){let t=n.indexOf(4);if(t>-1)for(t++;t<n.length;){const i=n[t];if("number"==typeof i)return-1;if(i===e)return t;t++}return-1}(e,n)}function Sy(n,e,t=!1){for(let i=0;i<e.length;i++)if(Pw(n,e[i],t))return!0;return!1}function Ow(n,e){e:for(let t=0;t<e.length;t++){const i=e[t];if(n.length===i.length){for(let r=0;r<n.length;r++)if(n[r]!==i[r])continue e;return!0}}return!1}function yf(n,e){return n?":not("+e.trim()+")":e}function Fw(n){let e=n[0],t=1,i=2,r="",s=!1;for(;t<n.length;){let a=n[t];if("string"==typeof a)if(2&i){const u=n[++t];r+="["+a+(u.length>0?'="'+u+'"':"")+"]"}else 8&i?r+="."+a:4&i&&(r+=" "+a);else""!==r&&!qc(a)&&(e+=yf(s,r),r=""),i=a,s=s||!qc(i);t++}return""!==r&&(e+=yf(s,r)),e}const Xn={};function Li(n){My(N(),L(),wr()+n,!1)}function My(n,e,t,i){if(!i)if(3==(3&e[2])){const s=n.preOrderCheckHooks;null!==s&&Io(e,s,t)}else{const s=n.preOrderHooks;null!==s&&Fa(e,s,0,t)}_a(t)}function P0(n,e=null,t=null,i){const r=k0(n,e,t,i);return r.resolveInjectorInitializers(),r}function k0(n,e=null,t=null,i,r=new Set){const s=[t||An,_y(n)];return i=i||("object"==typeof n?void 0:Si(n)),new Lg(s,e||cp(),i||null,r)}let Zc=(()=>{class n{static create(t,i){if(Array.isArray(t))return P0({name:""},i,t,"");{const r=t.name??"";return P0({name:r},t.parent,t.providers,r)}}}return n.THROW_IF_NOT_FOUND=Wh,n.NULL=new Ig,n.\u0275prov=lt({token:n,providedIn:"any",factory:()=>nt(xm)}),n.__NG_ELEMENT_ID__=-1,n})();function Ye(n,e=_n.Default){const t=L();return null===t?nt(n,e):Ud(q(),t,Kt(n),e)}function Jg(n,e){return n<<17|e<<2}function Xc(n){return n>>17&32767}function Oy(n){return 2|n}function ch(n){return(131068&n)>>2}function Fy(n,e){return-131069&n|e<<2}function Pm(n){return 1|n}function Ms(n,e){const t=n.contentQueries;if(null!==t)for(let i=0;i<t.length;i+=2){const r=t[i],s=t[i+1];if(-1!==s){const a=n.data[s];Ei(r),a.contentQueries(2,e[s],s)}}}function km(n,e,t,i,r,s,a,u,f,g,E){const M=e.blueprint.slice();return M[0]=r,M[2]=76|i,(null!==E||n&&1024&n[2])&&(M[2]|=1024),Ji(M),M[3]=M[15]=n,M[8]=t,M[10]=a||n&&n[10],M[11]=u||n&&n[11],M[12]=f||n&&n[12]||null,M[9]=g||n&&n[9]||null,M[6]=s,M[20]=function Bn(){return Ot++}(),M[21]=E,M[16]=2==e.type?n[16]:M,M}function n_(n,e,t,i,r){let s=n.data[e];if(null===s)s=function l1(n,e,t,i,r){const s=Q(),a=he(),f=n.data[e]=function M3(n,e,t,i,r,s){return{type:t,index:i,insertBeforeIndex:null,injectorIndex:e?e.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:r,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,a?s:s&&s.parent,t,e,i,r);return null===n.firstChild&&(n.firstChild=f),null!==s&&(a?null==s.child&&null!==f.parent&&(s.child=f):null===s.next&&(s.next=f)),f}(n,e,t,i,r),function wt(){return hn.lFrame.inI18n}()&&(s.flags|=64);else if(64&s.type){s.type=t,s.value=i,s.attrs=r;const a=function ce(){const n=hn.lFrame,e=n.currentTNode;return n.isParent?e:e.parent}();s.injectorIndex=null===a?-1:a.injectorIndex}return ue(s,!0),s}function i_(n,e,t,i){if(0===t)return-1;const r=e.length;for(let s=0;s<t;s++)e.push(i),n.blueprint.push(i),n.data.push(null);return r}function c1(n,e,t){Ii(e);try{const i=n.viewQuery;null!==i&&_1(1,i,t);const r=n.template;null!==r&&OM(n,e,r,1,t),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&Ms(n,e),n.staticViewQueries&&_1(2,n.viewQuery,t);const s=n.components;null!==s&&function uh(n,e){for(let t=0;t<e.length;t++)H3(n,e[t])}(e,s)}catch(i){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),i}finally{e[2]&=-5,ol()}}function W0(n,e,t,i){const r=e[2];if(128!=(128&r)){Ii(e);try{Ji(e),function $e(n){return hn.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==t&&OM(n,e,t,2,i);const a=3==(3&r);if(a){const g=n.preOrderCheckHooks;null!==g&&Io(e,g,null)}else{const g=n.preOrderHooks;null!==g&&Fa(e,g,0,null),ll(e,0)}if(function U3(n){for(let e=pp(n);null!==e;e=ah(e)){if(!e[2])continue;const t=e[9];for(let i=0;i<t.length;i++){const r=t[i],s=r[3];0==(512&r[2])&&ir(s,1),r[2]|=512}}}(e),function V3(n){for(let e=pp(n);null!==e;e=ah(e))for(let t=10;t<e.length;t++){const i=e[t],r=i[1];ao(i)&&W0(r,i,r.template,i[8])}}(e),null!==n.contentQueries&&Ms(n,e),a){const g=n.contentCheckHooks;null!==g&&Io(e,g)}else{const g=n.contentHooks;null!==g&&Fa(e,g,1),ll(e,1)}!function Zl(n,e){const t=n.hostBindingOpCodes;if(null!==t)try{for(let i=0;i<t.length;i++){const r=t[i];if(r<0)_a(~r);else{const s=r,a=t[++i],u=t[++i];St(a,s),u(2,e[s])}}}finally{_a(-1)}}(n,e);const u=n.components;null!==u&&function Yc(n,e){for(let t=0;t<e.length;t++)j3(n,e[t])}(e,u);const f=n.viewQuery;if(null!==f&&_1(2,f,i),a){const g=n.viewCheckHooks;null!==g&&Io(e,g)}else{const g=n.viewHooks;null!==g&&Fa(e,g,2),ll(e,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),e[2]&=-41,512&e[2]&&(e[2]&=-513,ir(e[3],-1))}finally{ol()}}}function OM(n,e,t,i,r){const s=wr(),a=2&i;try{_a(-1),a&&e.length>22&&My(n,e,22,!1),t(i,r)}finally{_a(s)}}function u1(n,e,t){!x()||(function k3(n,e,t,i){const r=t.directiveStart,s=t.directiveEnd;n.firstCreatePass||Bd(t,e),Ui(i,e);const a=t.initialInputs;for(let u=r;u<s;u++){const f=n.data[u],g=Ae(f);g&&N3(e,t,f);const E=Jr(e,n,u,t);Ui(E,e),null!==a&&B3(0,u-r,E,f,0,a),g&&(zi(t.index,e)[8]=E)}}(n,e,t,mt(t,e)),128==(128&t.flags)&&function R3(n,e,t){const i=t.directiveStart,r=t.directiveEnd,s=t.index,a=function rn(){return hn.lFrame.currentDirectiveIndex}();try{_a(s);for(let u=i;u<r;u++){const f=n.data[u],g=e[u];Pn(u),(null!==f.hostBindings||0!==f.hostVars||null!==f.hostAttrs)&&HM(f,g)}}finally{_a(-1),Pn(a)}}(n,e,t))}function h1(n,e,t=mt){const i=e.localNames;if(null!==i){let r=e.index+1;for(let s=0;s<i.length;s+=2){const a=i[s+1],u=-1===a?t(e,n):n[a];n[r++]=u}}}function NM(n){const e=n.tView;return null===e||e.incompleteFirstPass?n.tView=d1(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts):e}function d1(n,e,t,i,r,s,a,u,f,g){const E=22+i,M=E+r,R=function C3(n,e){const t=[];for(let i=0;i<e;i++)t.push(i<n?null:Xn);return t}(E,M),F="function"==typeof g?g():g;return R[1]={type:n,blueprint:R,template:t,queries:null,viewQuery:u,declTNode:e,data:R.slice().fill(null,E),bindingStartIndex:E,expandoStartIndex:M,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof a?a():a,firstChild:null,schemas:f,consts:F,incompleteFirstPass:!1}}function BM(n,e,t,i){const r=ZM(e);null===t?r.push(i):(r.push(t),n.firstCreatePass&&XM(n).push(i,r.length-1))}function zM(n,e,t){for(let i in n)if(n.hasOwnProperty(i)){const r=n[i];(t=null===t?{}:t).hasOwnProperty(i)?t[i].push(e,r):t[i]=[e,r]}return t}function VM(n,e){const i=e.directiveEnd,r=n.data,s=e.attrs,a=[];let u=null,f=null;for(let g=e.directiveStart;g<i;g++){const E=r[g],M=E.inputs,R=null===s||Cy(e)?null:z3(M,s);a.push(R),u=zM(M,g,u),f=zM(E.outputs,g,f)}null!==u&&(u.hasOwnProperty("class")&&(e.flags|=16),u.hasOwnProperty("style")&&(e.flags|=32)),e.initialInputs=a,e.inputs=u,e.outputs=f}function Kc(n,e,t,i,r,s,a,u){const f=mt(e,t);let E,g=e.inputs;!u&&null!=g&&(E=g[i])?(y1(n,t,E,i,r),Ih(e)&&UM(t,e.index)):3&e.type&&(i=function A3(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(i),r=null!=a?a(r,e.value||"",i):r,s.setProperty(f,i,r))}function UM(n,e){const t=zi(e,n);16&t[2]||(t[2]|=32)}function f1(n,e,t,i){let r=!1;if(x()){const s=function L3(n,e,t){const i=n.directiveRegistry;let r=null;if(i)for(let s=0;s<i.length;s++){const a=i[s];Sy(t,a.selectors,!1)&&(r||(r=[]),jl(Bd(t,e),n,a.type),Ae(a)?(GM(n,t),r.unshift(a)):r.push(a))}return r}(n,e,t),a=null===i?null:{"":-1};if(null!==s){r=!0,WM(t,n.data.length,s.length);for(let E=0;E<s.length;E++){const M=s[E];M.providersResolver&&M.providersResolver(M)}let u=!1,f=!1,g=i_(n,e,s.length,null);for(let E=0;E<s.length;E++){const M=s[E];t.mergedAttrs=Fh(t.mergedAttrs,M.hostAttrs),$M(n,t,e,g,M),F3(g,M,a),null!==M.contentQueries&&(t.flags|=8),(null!==M.hostBindings||null!==M.hostAttrs||0!==M.hostVars)&&(t.flags|=128);const R=M.type.prototype;!u&&(R.ngOnChanges||R.ngOnInit||R.ngDoCheck)&&((n.preOrderHooks||(n.preOrderHooks=[])).push(t.index),u=!0),!f&&(R.ngOnChanges||R.ngDoCheck)&&((n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(t.index),f=!0),g++}VM(n,t)}a&&function O3(n,e,t){if(e){const i=n.localNames=[];for(let r=0;r<e.length;r+=2){const s=t[e[r+1]];if(null==s)throw new st(-301,!1);i.push(e[r],s)}}}(t,i,a)}return t.mergedAttrs=Fh(t.mergedAttrs,t.attrs),r}function jM(n,e,t,i,r,s){const a=s.hostBindings;if(a){let u=n.hostBindingOpCodes;null===u&&(u=n.hostBindingOpCodes=[]);const f=~e.index;(function P3(n){let e=n.length;for(;e>0;){const t=n[--e];if("number"==typeof t&&t<0)return t}return 0})(u)!=f&&u.push(f),u.push(i,r,a)}}function HM(n,e){null!==n.hostBindings&&n.hostBindings(1,e)}function GM(n,e){e.flags|=2,(n.components||(n.components=[])).push(e.index)}function F3(n,e,t){if(t){if(e.exportAs)for(let i=0;i<e.exportAs.length;i++)t[e.exportAs[i]]=n;Ae(e)&&(t[""]=n)}}function WM(n,e,t){n.flags|=1,n.directiveStart=e,n.directiveEnd=e+t,n.providerIndexes=e}function $M(n,e,t,i,r){n.data[i]=r;const s=r.factory||(r.factory=Gs(r.type)),a=new ya(s,Ae(r),Ye);n.blueprint[i]=a,t[i]=a,jM(n,e,0,i,i_(n,t,r.hostVars,Xn),r)}function N3(n,e,t){const i=mt(e,n),r=NM(t),s=n[10],a=$0(n,km(n,r,null,t.onPush?32:16,i,e,s,s.createRenderer(i,t),null,null,null));n[e.index]=a}function fd(n,e,t,i,r,s){const a=mt(n,e);!function p1(n,e,t,i,r,s,a){if(null==s)n.removeAttribute(e,r,t);else{const u=null==a?an(s):a(s,i||"",r);n.setAttribute(e,r,u,t)}}(e[11],a,s,n.value,t,i,r)}function B3(n,e,t,i,r,s){const a=s[e];if(null!==a){const u=i.setInput;for(let f=0;f<a.length;){const g=a[f++],E=a[f++],M=a[f++];null!==u?i.setInput(t,M,g,E):t[E]=M}}}function z3(n,e){let t=null,i=0;for(;i<e.length;){const r=e[i];if(0!==r)if(5!==r){if("number"==typeof r)break;n.hasOwnProperty(r)&&(null===t&&(t=[]),t.push(r,n[r],e[i+1])),i+=2}else i+=2;else i+=4}return t}function qM(n,e,t,i){return new Array(n,!0,!1,e,null,0,i,t,null,null)}function j3(n,e){const t=zi(e,n);if(ao(t)){const i=t[1];48&t[2]?W0(i,t,i.template,t[8]):t[5]>0&&m1(t)}}function m1(n){for(let i=pp(n);null!==i;i=ah(i))for(let r=10;r<i.length;r++){const s=i[r];if(ao(s))if(512&s[2]){const a=s[1];W0(a,s,a.template,s[8])}else s[5]>0&&m1(s)}const t=n[1].components;if(null!==t)for(let i=0;i<t.length;i++){const r=zi(t[i],n);ao(r)&&r[5]>0&&m1(r)}}function H3(n,e){const t=zi(e,n),i=t[1];(function G3(n,e){for(let t=e.length;t<n.blueprint.length;t++)e.push(n.blueprint[t])})(i,t),c1(i,t,t[8])}function $0(n,e){return n[13]?n[14][4]=e:n[13]=e,n[14]=e,e}function g1(n){for(;n;){n[2]|=32;const e=oh(n);if(Xe(n)&&!e)return n;n=e}return null}function q0(n,e,t,i=!0){const r=e[10];r.begin&&r.begin();try{W0(n,e,n.template,t)}catch(a){throw i&&KM(e,a),a}finally{r.end&&r.end()}}function _1(n,e,t){Ei(0),e(n,t)}function ZM(n){return n[7]||(n[7]=[])}function XM(n){return n.cleanup||(n.cleanup=[])}function KM(n,e){const t=n[9],i=t?t.get(Ze,null):null;i&&i.handleError(e)}function y1(n,e,t,i,r){for(let s=0;s<t.length;){const a=t[s++],u=t[s++],f=e[a],g=n.data[a];null!==g.setInput?g.setInput(f,r,i,u):f[u]=r}}function Z0(n,e,t){let i=t?n.styles:null,r=t?n.classes:null,s=0;if(null!==e)for(let a=0;a<e.length;a++){const u=e[a];"number"==typeof u?s=u:1==s?r=Da(r,u):2==s&&(i=Da(i,u+": "+e[++a]+";"))}t?n.styles=i:n.stylesWithoutHost=i,t?n.classes=r:n.classesWithoutHost=r}function X0(n,e,t,i,r=!1){for(;null!==t;){const s=e[t.index];if(null!==s&&i.push(Kr(s)),ro(s))for(let u=10;u<s.length;u++){const f=s[u],g=f[1].firstChild;null!==g&&X0(f[1],f,g,i)}const a=t.type;if(8&a)X0(n,e,t.child,i);else if(32&a){const u=cd(t,e);let f;for(;f=u();)i.push(f)}else if(16&a){const u=Zg(e,t);if(Array.isArray(u))i.push(...u);else{const f=oh(e[16]);X0(f[1],f,u,i,!0)}}t=r?t.projectionNext:t.next}return i}class Uy{constructor(e,t){this._lView=e,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const e=this._lView,t=e[1];return X0(t,e,t.firstChild,[])}get context(){return this._lView[8]}set context(e){this._lView[8]=e}get destroyed(){return 128==(128&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[3];if(ro(e)){const t=e[8],i=t?t.indexOf(this):-1;i>-1&&(Hg(e,i),sr(t,i))}this._attachedToViewContainer=!1}ql(this._lView[1],this._lView)}onDestroy(e){BM(this._lView[1],this._lView,null,e)}markForCheck(){g1(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-65}reattach(){this._lView[2]|=64}detectChanges(){q0(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new st(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function yc(n,e){Im(n,e,e[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new st(902,!1);this._appRef=e}}class W3 extends Uy{constructor(e){super(e),this._view=e}detectChanges(){const e=this._view;q0(e[1],e,e[8],!1)}checkNoChanges(){}get context(){return null}}class v1 extends od{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=Ai(e);return new jy(t,this.ngModule)}}function JM(n){const e=[];for(let t in n)n.hasOwnProperty(t)&&e.push({propName:n[t],templateName:t});return e}class q3{constructor(e,t){this.injector=e,this.parentInjector=t}get(e,t,i){const r=this.injector.get(e,o,i);return r!==o||t===o?r:this.parentInjector.get(e,t,i)}}class jy extends hp{constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=function Nw(n){return n.map(Fw).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}get inputs(){return JM(this.componentDef.inputs)}get outputs(){return JM(this.componentDef.outputs)}create(e,t,i,r){let s=(r=r||this.ngModule)instanceof rd?r:r?.injector;s&&null!==this.componentDef.getStandaloneInjector&&(s=this.componentDef.getStandaloneInjector(s)||s);const a=s?new q3(e,s):e,u=a.get(rh,null);if(null===u)throw new st(407,!1);const f=a.get(fp,null),g=u.createRenderer(null,this.componentDef),E=this.componentDef.selectors[0][0]||"div",M=i?function S3(n,e,t){return n.selectRootElement(e,t===da.ShadowDom)}(g,i,this.componentDef.encapsulation):hd(u.createRenderer(null,this.componentDef),E,function $3(n){const e=n.toLowerCase();return"svg"===e?"svg":"math"===e?"math":null}(E)),R=this.componentDef.onPush?288:272,F=d1(0,null,null,1,0,null,null,null,null,null),V=km(null,F,null,R,null,null,u,g,f,a,null);let G,K;Ii(V);try{const se=function Y3(n,e,t,i,r,s){const a=t[1];t[22]=n;const f=n_(a,22,2,"#host",null),g=f.mergedAttrs=e.hostAttrs;null!==g&&(Z0(f,g,!0),null!==n&&(Na(r,n,g),null!==f.classes&&Ey(r,n,f.classes),null!==f.styles&&S0(r,n,f.styles)));const E=i.createRenderer(n,e),M=km(t,NM(e),null,e.onPush?32:16,t[22],f,i,E,s||null,null,null);return a.firstCreatePass&&(jl(Bd(f,t),a,e.type),GM(a,f),WM(f,t.length,1)),$0(t,M),t[22]=M}(M,this.componentDef,V,u,g);if(M)if(i)Na(g,M,["ng-version",c.full]);else{const{attrs:_e,classes:de}=function Bw(n){const e=[],t=[];let i=1,r=2;for(;i<n.length;){let s=n[i];if("string"==typeof s)2===r?""!==s&&e.push(s,n[++i]):8===r&&t.push(s);else{if(!qc(r))break;r=s}i++}return{attrs:e,classes:t}}(this.componentDef.selectors[0]);_e&&Na(g,M,_e),de&&de.length>0&&Ey(g,M,de.join(" "))}if(K=$u(F,22),void 0!==t){const _e=K.projection=[];for(let de=0;de<this.ngContentSelectors.length;de++){const Ie=t[de];_e.push(null!=Ie?Array.from(Ie):null)}}G=function K3(n,e,t,i){const r=t[1],s=function I3(n,e,t){const i=q();n.firstCreatePass&&(t.providersResolver&&t.providersResolver(t),$M(n,i,e,i_(n,e,1,null),t),VM(n,i));const r=Jr(e,n,i.directiveStart,i);Ui(r,e);const s=mt(i,e);return s&&Ui(s,e),r}(r,t,e);if(n[8]=t[8]=s,null!==i)for(const u of i)u(s,e);if(e.contentQueries){const u=q();e.contentQueries(1,s,u.directiveStart)}const a=q();return!r.firstCreatePass||null===e.hostBindings&&null===e.hostAttrs||(_a(a.index),jM(t[1],a,0,a.directiveStart,a.directiveEnd,e),HM(e,s)),s}(se,this.componentDef,V,[J3]),c1(F,V,null)}finally{ol()}return new X3(this.componentType,G,ih(K,V),V,K)}}class X3 extends class Fg{}{constructor(e,t,i,r,s){super(),this.location=i,this._rootLView=r,this._tNode=s,this.instance=t,this.hostView=this.changeDetectorRef=new W3(r),this.componentType=e}setInput(e,t){const i=this._tNode.inputs;let r;if(null!==i&&(r=i[e])){const s=this._rootLView;y1(s[1],s,r,e,t),UM(s,this._tNode.index)}}get injector(){return new Ba(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}function J3(){const n=q();al(L()[1],n)}function qi(n){let e=function QM(n){return Object.getPrototypeOf(n.prototype).constructor}(n.type),t=!0;const i=[n];for(;e;){let r;if(Ae(n))r=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new st(903,!1);r=e.\u0275dir}if(r){if(t){i.push(r);const a=n;a.inputs=b1(n.inputs),a.declaredInputs=b1(n.declaredInputs),a.outputs=b1(n.outputs);const u=r.hostBindings;u&&nB(n,u);const f=r.viewQuery,g=r.contentQueries;if(f&&eB(n,f),g&&tB(n,g),fi(n.inputs,r.inputs),fi(n.declaredInputs,r.declaredInputs),fi(n.outputs,r.outputs),Ae(r)&&r.data.animation){const E=n.data;E.animation=(E.animation||[]).concat(r.data.animation)}}const s=r.features;if(s)for(let a=0;a<s.length;a++){const u=s[a];u&&u.ngInherit&&u(n),u===qi&&(t=!1)}}e=Object.getPrototypeOf(e)}!function Q3(n){let e=0,t=null;for(let i=n.length-1;i>=0;i--){const r=n[i];r.hostVars=e+=r.hostVars,r.hostAttrs=Fh(r.hostAttrs,t=Fh(t,r.hostAttrs))}}(i)}function b1(n){return n===Dl?{}:n===An?[]:n}function eB(n,e){const t=n.viewQuery;n.viewQuery=t?(i,r)=>{e(i,r),t(i,r)}:e}function tB(n,e){const t=n.contentQueries;n.contentQueries=t?(i,r,s)=>{e(i,r,s),t(i,r,s)}:e}function nB(n,e){const t=n.hostBindings;n.hostBindings=t?(i,r)=>{e(i,r),t(i,r)}:e}let Y0=null;function Rm(){if(!Y0){const n=tr.Symbol;if(n&&n.iterator)Y0=n.iterator;else{const e=Object.getOwnPropertyNames(Map.prototype);for(let t=0;t<e.length;++t){const i=e[t];"entries"!==i&&"size"!==i&&Map.prototype[i]===Map.prototype.entries&&(Y0=i)}}}return Y0}function Hy(n){return!!x1(n)&&(Array.isArray(n)||!(n instanceof Map)&&Rm()in n)}function x1(n){return null!==n&&("function"==typeof n||"object"==typeof n)}function _l(n,e,t){return!Object.is(n[e],t)&&(n[e]=t,!0)}function Ha(n,e,t,i){const r=L();return _l(r,it(),e)&&(N(),fd(Zn(),r,n,e,t,i)),Ha}function f_(n,e,t,i,r,s,a,u){const f=L(),g=N(),E=n+22,M=g.firstCreatePass?function uB(n,e,t,i,r,s,a,u,f){const g=e.consts,E=n_(e,n,4,a||null,Os(g,u));f1(e,t,E,Os(g,f)),al(e,E);const M=E.tViews=d1(2,E,i,r,s,e.directiveRegistry,e.pipeRegistry,null,e.schemas,g);return null!==e.queries&&(e.queries.template(e,E),M.queries=e.queries.embeddedTView(E)),E}(E,g,f,e,t,i,r,s,a):g.data[E];ue(M,!1);const R=f[11].createComment("");$g(g,f,R,M),Ui(R,f),$0(f,f[E]=qM(R,f,R,M)),Ao(M)&&u1(g,f,M),null!=a&&h1(f,M,u)}function w1(n){return Yo(function Re(){return hn.lFrame.contextLView}(),22+n)}function ps(n,e,t){const i=L();return _l(i,it(),e)&&Kc(N(),Zn(),i,n,e,i[11],t,!1),ps}function E1(n,e,t,i,r){const a=r?"class":"style";y1(n,t,e.inputs[a],a,i)}function bn(n,e,t,i){const r=L(),s=N(),a=22+n,u=r[11],f=r[a]=hd(u,e,function mr(){return hn.lFrame.currentNamespace}()),g=s.firstCreatePass?function dB(n,e,t,i,r,s,a){const u=e.consts,g=n_(e,n,2,r,Os(u,s));return f1(e,t,g,Os(u,a)),null!==g.attrs&&Z0(g,g.attrs,!1),null!==g.mergedAttrs&&Z0(g,g.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,g),g}(a,s,r,0,e,t,i):s.data[a];ue(g,!0);const E=g.mergedAttrs;null!==E&&Na(u,f,E);const M=g.classes;null!==M&&Ey(u,f,M);const R=g.styles;return null!==R&&S0(u,f,R),64!=(64&g.flags)&&$g(s,r,f,g),0===function l(){return hn.lFrame.elementDepthCount}()&&Ui(f,r),function d(){hn.lFrame.elementDepthCount++}(),Ao(g)&&(u1(s,r,g),function FM(n,e,t){if(so(e)){const r=e.directiveEnd;for(let s=e.directiveStart;s<r;s++){const a=n.data[s];a.contentQueries&&a.contentQueries(1,t[s],s)}}}(s,g,r)),null!==i&&h1(r,g),bn}function jn(){let n=q();he()?Ee():(n=n.parent,ue(n,!1));const e=n;!function _(){hn.lFrame.elementDepthCount--}();const t=N();return t.firstCreatePass&&(al(t,n),so(n)&&t.queries.elementEnd(n)),null!=e.classesWithoutHost&&function vu(n){return 0!=(16&n.flags)}(e)&&E1(t,e,L(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function Oh(n){return 0!=(32&n.flags)}(e)&&E1(t,e,L(),e.stylesWithoutHost,!1),jn}function Ga(n,e,t,i){return bn(n,e,t,i),jn(),Ga}function J0(n){return!!n&&"function"==typeof n.then}function hA(n){return!!n&&"function"==typeof n.subscribe}const dA=hA;function Vs(n,e,t,i){const r=L(),s=N(),a=q();return function pA(n,e,t,i,r,s,a,u){const f=Ao(i),E=n.firstCreatePass&&XM(n),M=e[8],R=ZM(e);let F=!0;if(3&i.type||u){const K=mt(i,e),se=u?u(K):K,_e=R.length,de=u?qe=>u(Kr(qe[i.index])):i.index;let Ie=null;if(!u&&f&&(Ie=function pB(n,e,t,i){const r=n.cleanup;if(null!=r)for(let s=0;s<r.length-1;s+=2){const a=r[s];if(a===t&&r[s+1]===i){const u=e[7],f=r[s+2];return u.length>f?u[f]:null}"string"==typeof a&&(s+=2)}return null}(n,e,r,i.index)),null!==Ie)(Ie.__ngLastListenerFn__||Ie).__ngNextListenerFn__=s,Ie.__ngLastListenerFn__=s,F=!1;else{s=gA(i,e,M,s,!1);const qe=t.listen(se,r,s);R.push(s,qe),E&&E.push(r,de,_e,_e+1)}}else s=gA(i,e,M,s,!1);const V=i.outputs;let G;if(F&&null!==V&&(G=V[r])){const K=G.length;if(K)for(let se=0;se<K;se+=2){const Qe=e[G[se]][G[se+1]].subscribe(s),Ct=R.length;R.push(s,Qe),E&&E.push(r,i.index,Ct,-(Ct+1))}}}(s,r,r[11],a,n,e,0,i),Vs}function mA(n,e,t,i){try{return!1!==t(i)}catch(r){return KM(n,r),!1}}function gA(n,e,t,i,r){return function s(a){if(a===Function)return i;g1(2&n.flags?zi(n.index,e):e);let f=mA(e,0,i,a),g=s.__ngNextListenerFn__;for(;g;)f=mA(e,0,g,a)&&f,g=g.__ngNextListenerFn__;return r&&!1===f&&(a.preventDefault(),a.returnValue=!1),f}}function Wy(n=1){return function ga(n){return(hn.lFrame.contextLView=function Do(n,e){for(;n>0;)e=e[15],n--;return e}(n,hn.lFrame.contextLView))[8]}(n)}function mB(n,e){let t=null;const i=function kw(n){const e=n.attrs;if(null!=e){const t=e.indexOf(5);if(0==(1&t))return e[t+1]}return null}(n);for(let r=0;r<e.length;r++){const s=e[r];if("*"!==s){if(null===i?Sy(n,s,!0):Ow(i,s))return r}else t=r}return t}function p_(n){const e=L()[16][6];if(!e.projection){const i=e.projection=ea(n?n.length:1,null),r=i.slice();let s=e.child;for(;null!==s;){const a=n?mB(s,n):0;null!==a&&(r[a]?r[a].projectionNext=s:i[a]=s,r[a]=s),s=s.next}}}function bf(n,e=0,t){const i=L(),r=N(),s=n_(r,22+n,16,null,t||null);null===s.projection&&(s.projection=e),Ee(),64!=(64&s.flags)&&function Mw(n,e,t){_o(e[11],0,e,t,v0(n,t,e),w0(t.parent||e[6],t,e))}(r,i,s)}function SA(n,e,t,i,r){const s=n[t+1],a=null===e;let u=i?Xc(s):ch(s),f=!1;for(;0!==u&&(!1===f||a);){const E=n[u+1];yB(n[u],e)&&(f=!0,n[u+1]=i?Pm(E):Oy(E)),u=i?Xc(E):ch(E)}f&&(n[t+1]=i?Oy(s):Pm(s))}function yB(n,e){return null===n||null==e||(Array.isArray(n)?n[1]:n)===e||!(!Array.isArray(n)||"string"!=typeof e)&&Fc(n,e)>=0}function yp(n,e,t){return hh(n,e,t,!1),yp}function bc(n,e){return hh(n,e,null,!0),bc}function hh(n,e,t,i){const r=L(),s=N(),a=function Ue(n){const e=hn.lFrame,t=e.bindingIndex;return e.bindingIndex=e.bindingIndex+n,t}(2);s.firstUpdatePass&&function LA(n,e,t,i){const r=n.data;if(null===r[t+1]){const s=r[wr()],a=function RA(n,e){return e>=n.expandoStartIndex}(n,t);(function BA(n,e){return 0!=(n.flags&(e?16:32))})(s,i)&&null===e&&!a&&(e=!1),e=function MB(n,e,t,i){const r=function Ht(n){const e=hn.lFrame.currentDirectiveIndex;return-1===e?null:n[e]}(n);let s=i?e.residualClasses:e.residualStyles;if(null===r)0===(i?e.classBindings:e.styleBindings)&&(t=$y(t=M1(null,n,e,t,i),e.attrs,i),s=null);else{const a=e.directiveStylingLast;if(-1===a||n[a]!==r)if(t=M1(r,n,e,t,i),null===s){let f=function AB(n,e,t){const i=t?e.classBindings:e.styleBindings;if(0!==ch(i))return n[Xc(i)]}(n,e,i);void 0!==f&&Array.isArray(f)&&(f=M1(null,n,e,f[1],i),f=$y(f,e.attrs,i),function DB(n,e,t,i){n[Xc(t?e.classBindings:e.styleBindings)]=i}(n,e,i,f))}else s=function IB(n,e,t){let i;const r=e.directiveEnd;for(let s=1+e.directiveStylingLast;s<r;s++)i=$y(i,n[s].hostAttrs,t);return $y(i,e.attrs,t)}(n,e,i)}return void 0!==s&&(i?e.residualClasses=s:e.residualStyles=s),t}(r,s,e,i),function gB(n,e,t,i,r,s){let a=s?e.classBindings:e.styleBindings,u=Xc(a),f=ch(a);n[i]=t;let E,g=!1;if(Array.isArray(t)){const M=t;E=M[1],(null===E||Fc(M,E)>0)&&(g=!0)}else E=t;if(r)if(0!==f){const R=Xc(n[u+1]);n[i+1]=Jg(R,u),0!==R&&(n[R+1]=Fy(n[R+1],i)),n[u+1]=function V0(n,e){return 131071&n|e<<17}(n[u+1],i)}else n[i+1]=Jg(u,0),0!==u&&(n[u+1]=Fy(n[u+1],i)),u=i;else n[i+1]=Jg(f,0),0===u?u=i:n[f+1]=Fy(n[f+1],i),f=i;g&&(n[i+1]=Oy(n[i+1])),SA(n,E,i,!0),SA(n,E,i,!1),function _B(n,e,t,i,r){const s=r?n.residualClasses:n.residualStyles;null!=s&&"string"==typeof e&&Fc(s,e)>=0&&(t[i+1]=Pm(t[i+1]))}(e,E,n,i,s),a=Jg(u,f),s?e.classBindings=a:e.styleBindings=a}(r,s,e,t,a,i)}}(s,n,a,i),e!==Xn&&_l(r,a,e)&&function FA(n,e,t,i,r,s,a,u){if(!(3&e.type))return;const f=n.data,g=f[u+1];Q0(function Qg(n){return 1==(1&n)}(g)?NA(f,e,t,r,ch(g),a):void 0)||(Q0(s)||function z0(n){return 2==(2&n)}(g)&&(s=NA(f,null,t,r,u,a)),function Aw(n,e,t,i,r){if(e)r?n.addClass(t,i):n.removeClass(t,i);else{let s=-1===i.indexOf("-")?void 0:ui.DashCase;null==r?n.removeStyle(t,i,s):("string"==typeof r&&r.endsWith("!important")&&(r=r.slice(0,-10),s|=ui.Important),n.setStyle(t,i,r,s))}}(i,a,Pt(wr(),t),r,s))}(s,s.data[wr()],r,r[11],n,r[a+1]=function RB(n,e){return null==n||("string"==typeof e?n+=e:"object"==typeof n&&(n=Si(Ro(n)))),n}(e,t),i,a)}function M1(n,e,t,i,r){let s=null;const a=t.directiveEnd;let u=t.directiveStylingLast;for(-1===u?u=t.directiveStart:u++;u<a&&(s=e[u],i=$y(i,s.hostAttrs,r),s!==n);)u++;return null!==n&&(t.directiveStylingLast=u),i}function $y(n,e,t){const i=t?1:2;let r=-1;if(null!==e)for(let s=0;s<e.length;s++){const a=e[s];"number"==typeof a?r=a:r===i&&(Array.isArray(n)||(n=void 0===n?[]:["",n]),ho(n,a,!!t||e[++s]))}return void 0===n?null:n}function NA(n,e,t,i,r,s){const a=null===e;let u;for(;r>0;){const f=n[r],g=Array.isArray(f),E=g?f[1]:f,M=null===E;let R=t[r+1];R===Xn&&(R=M?An:void 0);let F=M?qd(R,i):E===i?R:void 0;if(g&&!Q0(F)&&(F=qd(f,i)),Q0(F)&&(u=F,a))return u;const V=n[r+1];r=a?Xc(V):ch(V)}if(null!==e){let f=s?e.residualClasses:e.residualStyles;null!=f&&(u=qd(f,i))}return u}function Q0(n){return void 0!==n}function Qi(n,e=""){const t=L(),i=N(),r=n+22,s=i.firstCreatePass?n_(i,r,1,e,null):i.data[r],a=t[r]=function ud(n,e){return n.createText(e)}(t[11],e);$g(i,t,a,s),ue(s,!1)}function Om(n){return Jc("",n,""),Om}function Jc(n,e,t){const i=L(),r=function s_(n,e,t,i){return _l(n,it(),t)?e+an(t)+i:Xn}(i,n,e,t);return r!==Xn&&function vf(n,e,t){const i=Pt(e,n);!function Ca(n,e,t){n.setValue(e,t)}(n[11],i,t)}(i,wr(),r),Jc}function A1(n,e,t){const i=L();return _l(i,it(),e)&&Kc(N(),Zn(),i,n,e,i[11],t,!0),A1}const __="en-US";let sD=__;function P1(n,e,t,i,r){if(n=Kt(n),Array.isArray(n))for(let s=0;s<n.length;s++)P1(n[s],e,t,i,r);else{const s=N(),a=L();let u=Gc(n)?n:Kt(n.provide),f=Cm(n);const g=q(),E=1048575&g.providerIndexes,M=g.directiveStart,R=g.providerIndexes>>20;if(Gc(n)||!n.multi){const F=new ya(f,r,Ye),V=R1(u,e,r?E:E+R,M);-1===V?(jl(Bd(g,a),s,u),k1(s,n,e.length),e.push(u),g.directiveStart++,g.directiveEnd++,r&&(g.providerIndexes+=1048576),t.push(F),a.push(F)):(t[V]=F,a[V]=F)}else{const F=R1(u,e,E+R,M),V=R1(u,e,E,E+R),G=F>=0&&t[F],K=V>=0&&t[V];if(r&&!K||!r&&!G){jl(Bd(g,a),s,u);const se=function Kz(n,e,t,i,r){const s=new ya(n,t,Ye);return s.multi=[],s.index=e,s.componentProviders=0,ID(s,r,i&&!t),s}(r?Yz:Xz,t.length,r,i,f);!r&&K&&(t[V].providerFactory=se),k1(s,n,e.length,0),e.push(u),g.directiveStart++,g.directiveEnd++,r&&(g.providerIndexes+=1048576),t.push(se),a.push(se)}else k1(s,n,F>-1?F:V,ID(t[r?V:F],f,!r&&i));!r&&i&&K&&t[V].componentProviders++}}}function k1(n,e,t,i){const r=Gc(e),s=function Rg(n){return!!n.useClass}(e);if(r||s){const f=(s?Kt(e.useClass):e).prototype.ngOnDestroy;if(f){const g=n.destroyHooks||(n.destroyHooks=[]);if(!r&&e.multi){const E=g.indexOf(t);-1===E?g.push(t,[i,f]):g[E+1].push(i,f)}else g.push(t,f)}}}function ID(n,e,t){return t&&n.componentProviders++,n.multi.push(e)-1}function R1(n,e,t,i){for(let r=t;r<i;r++)if(e[r]===n)return r;return-1}function Xz(n,e,t,i){return L1(this.multi,[])}function Yz(n,e,t,i){const r=this.multi;let s;if(this.providerFactory){const a=this.providerFactory.componentProviders,u=Jr(t,t[1],this.providerFactory.index,i);s=u.slice(0,a),L1(r,s);for(let f=a;f<u.length;f++)s.push(u[f])}else s=[],L1(r,s);return s}function L1(n,e){for(let t=0;t<n.length;t++)e.push((0,n[t])());return e}function ms(n,e=[]){return t=>{t.providersResolver=(i,r)=>function Zz(n,e,t){const i=N();if(i.firstCreatePass){const r=Ae(n);P1(t,i.data,i.blueprint,r,!0),P1(e,i.data,i.blueprint,r,!1)}}(i,r?r(n):n,e)}}class y_{}class PD extends y_{constructor(e,t){super(),this._parent=t,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new v1(this);const i=function xs(n,e){const t=n[uu]||null;if(!t&&!0===e)throw new Error(`Type ${Si(n)} does not have '\u0275mod' property.`);return t}(e);this._bootstrapComponents=function zs(n){return n instanceof Function?n():n}(i.bootstrap),this._r3Injector=k0(e,t,[{provide:y_,useValue:this},{provide:od,useValue:this.componentFactoryResolver}],Si(e),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(e)}get injector(){return this._r3Injector}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class O1 extends class Jz{}{constructor(e){super(),this.moduleType=e}create(e){return new PD(this.moduleType,e)}}function zD(n,e,t,i,r,s){const a=e+t;return _l(n,a,r)?function pd(n,e,t){return n[e]=t}(n,a+1,s?i.call(s,r):i(r)):function Jy(n,e){const t=n[e];return t===Xn?void 0:t}(n,a+1)}function Nm(n,e){const t=N();let i;const r=n+22;t.firstCreatePass?(i=function xV(n,e){if(e)for(let t=e.length-1;t>=0;t--){const i=e[t];if(n===i.name)return i}}(e,t.pipeRegistry),t.data[r]=i,i.onDestroy&&(t.destroyHooks||(t.destroyHooks=[])).push(r,i.onDestroy)):i=t.data[r];const s=i.factory||(i.factory=Gs(i.type)),a=Wi(Ye);try{const u=qu(!1),f=s();return qu(u),function hB(n,e,t,i){t>=n.data.length&&(n.data[t]=null,n.blueprint[t]=null),e[t]=i}(t,L(),r,f),f}finally{Wi(a)}}function Bm(n,e,t){const i=n+22,r=L(),s=Yo(r,i);return function Qy(n,e){return n[1].data[e].pure}(r,i)?zD(r,function ke(){const n=hn.lFrame;let e=n.bindingRootIndex;return-1===e&&(e=n.bindingRootIndex=n.tView.bindingStartIndex),e}(),e,s.transform,t,s):s.transform(t)}function N1(n){return e=>{setTimeout(n,void 0,e)}}const yo=class SV extends Fi{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,i){let r=e,s=t||(()=>null),a=i;if(e&&"object"==typeof e){const f=e;r=f.next?.bind(f),s=f.error?.bind(f),a=f.complete?.bind(f)}this.__isAsync&&(s=N1(s),r&&(r=N1(r)),a&&(a=N1(a)));const u=super.subscribe({next:r,error:s,complete:a});return e instanceof Gt&&e.add(u),u}};function MV(){return this._results[Rm()]()}class B1{constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=Rm(),i=B1.prototype;i[t]||(i[t]=MV)}get changes(){return this._changes||(this._changes=new yo)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){const i=this;i.dirty=!1;const r=Jo(e);(this._changesDetected=!function $f(n,e,t){if(n.length!==e.length)return!1;for(let i=0;i<n.length;i++){let r=n[i],s=e[i];if(t&&(r=t(r),s=t(s)),s!==r)return!1}return!0}(i._results,r,t))&&(i._results=r,i.length=r.length,i.last=r[this.length-1],i.first=r[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let xf=(()=>{class n{}return n.__NG_ELEMENT_ID__=IV,n})();const AV=xf,DV=class extends AV{constructor(e,t,i){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=i}createEmbeddedView(e,t){const i=this._declarationTContainer.tViews,r=km(this._declarationLView,i,e,16,null,i.declTNode,null,null,null,null,t||null);r[17]=this._declarationLView[this._declarationTContainer.index];const a=this._declarationLView[19];return null!==a&&(r[19]=a.createEmbeddedView(i)),c1(i,r,e),new Uy(r)}};function IV(){return rb(q(),L())}function rb(n,e){return 4&n.type?new DV(e,n,ih(n,e)):null}let fh=(()=>{class n{}return n.__NG_ELEMENT_ID__=PV,n})();function PV(){return $D(q(),L())}const kV=fh,GD=class extends kV{constructor(e,t,i){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=i}get element(){return ih(this._hostTNode,this._hostLView)}get injector(){return new Ba(this._hostTNode,this._hostLView)}get parentInjector(){const e=zd(this._hostTNode,this._hostLView);if(rr(e)){const t=va(e,this._hostLView),i=Pc(e);return new Ba(t[1].data[i+8],t)}return new Ba(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=WD(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-10}createEmbeddedView(e,t,i){let r,s;"number"==typeof i?r=i:null!=i&&(r=i.index,s=i.injector);const a=e.createEmbeddedView(t||{},s);return this.insert(a,r),a}createComponent(e,t,i,r,s){const a=e&&!function Hh(n){return"function"==typeof n}(e);let u;if(a)u=t;else{const M=t||{};u=M.index,i=M.injector,r=M.projectableNodes,s=M.environmentInjector||M.ngModuleRef}const f=a?e:new jy(Ai(e)),g=i||this.parentInjector;if(!s&&null==f.ngModule){const R=(a?g:this.parentInjector).get(rd,null);R&&(s=R)}const E=f.create(g,r,void 0,s);return this.insert(E.hostView,u),E}insert(e,t){const i=e._lView,r=i[1];if(function yu(n){return ro(n[3])}(i)){const E=this.indexOf(e);if(-1!==E)this.detach(E);else{const M=i[3],R=new GD(M,M[6],M[3]);R.detach(R.indexOf(e))}}const s=this._adjustIndex(t),a=this._lContainer;!function dd(n,e,t,i){const r=10+i,s=t.length;i>0&&(t[r-1][4]=e),i<s-10?(e[4]=t[r],qf(t,10+i,e)):(t.push(e),e[4]=null),e[3]=t;const a=e[17];null!==a&&t!==a&&function vc(n,e){const t=n[9];e[16]!==e[3][3][16]&&(n[2]=!0),null===t?n[9]=[e]:t.push(e)}(a,e);const u=e[19];null!==u&&u.insertView(n),e[2]|=64}(r,i,a,s);const u=xy(s,a),f=i[11],g=Wg(f,a[7]);return null!==g&&function na(n,e,t,i,r,s){i[0]=r,i[6]=e,Im(n,i,t,1,r,s)}(r,a[6],f,i,g,u),e.attachToViewContainerRef(),qf(z1(a),s,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=WD(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),i=Hg(this._lContainer,t);i&&(sr(z1(this._lContainer),t),ql(i[1],i))}detach(e){const t=this._adjustIndex(e,-1),i=Hg(this._lContainer,t);return i&&null!=sr(z1(this._lContainer),t)?new Uy(i):null}_adjustIndex(e,t=0){return e??this.length+t}};function WD(n){return n[8]}function z1(n){return n[8]||(n[8]=[])}function $D(n,e){let t;const i=e[n.index];if(ro(i))t=i;else{let r;if(8&n.type)r=Kr(i);else{const s=e[11];r=s.createComment("");const a=mt(n,e);Mu(s,Wg(s,a),r,function Sw(n,e){return n.nextSibling(e)}(s,a),!1)}e[n.index]=t=qM(i,e,r,n),$0(e,t)}return new GD(t,n,e)}class V1{constructor(e){this.queryList=e,this.matches=null}clone(){return new V1(this.queryList)}setDirty(){this.queryList.setDirty()}}class U1{constructor(e=[]){this.queries=e}createEmbeddedView(e){const t=e.queries;if(null!==t){const i=null!==e.contentQueries?e.contentQueries[0]:t.length,r=[];for(let s=0;s<i;s++){const a=t.getByIndex(s);r.push(this.queries[a.indexInDeclarationView].clone())}return new U1(r)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)null!==KD(e,t).matches&&this.queries[t].setDirty()}}class qD{constructor(e,t,i=null){this.predicate=e,this.flags=t,this.read=i}}class j1{constructor(e=[]){this.queries=e}elementStart(e,t){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let i=0;i<this.length;i++){const r=null!==t?t.length:0,s=this.getByIndex(i).embeddedTView(e,r);s&&(s.indexInDeclarationView=i,null!==t?t.push(s):t=[s])}return null!==t?new j1(t):null}template(e,t){for(let i=0;i<this.queries.length;i++)this.queries[i].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class H1{constructor(e,t=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new H1(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let i=e.parent;for(;null!==i&&8&i.type&&i.index!==t;)i=i.parent;return t===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(e,t){const i=this.metadata.predicate;if(Array.isArray(i))for(let r=0;r<i.length;r++){const s=i[r];this.matchTNodeWithReadOption(e,t,OV(t,s)),this.matchTNodeWithReadOption(e,t,Fs(t,e,s,!1,!1))}else i===xf?4&t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,Fs(t,e,i,!1,!1))}matchTNodeWithReadOption(e,t,i){if(null!==i){const r=this.metadata.read;if(null!==r)if(r===us||r===fh||r===xf&&4&t.type)this.addMatch(t.index,-2);else{const s=Fs(t,e,r,!1,!1);null!==s&&this.addMatch(t.index,s)}else this.addMatch(t.index,i)}}addMatch(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}function OV(n,e){const t=n.localNames;if(null!==t)for(let i=0;i<t.length;i+=2)if(t[i]===e)return t[i+1];return null}function NV(n,e,t,i){return-1===t?function FV(n,e){return 11&n.type?ih(n,e):4&n.type?rb(n,e):null}(e,n):-2===t?function BV(n,e,t){return t===us?ih(e,n):t===xf?rb(e,n):t===fh?$D(e,n):void 0}(n,e,i):Jr(n,n[1],t,e)}function ZD(n,e,t,i){const r=e[19].queries[i];if(null===r.matches){const s=n.data,a=t.matches,u=[];for(let f=0;f<a.length;f+=2){const g=a[f];u.push(g<0?null:NV(e,s[g],a[f+1],t.metadata.read))}r.matches=u}return r.matches}function G1(n,e,t,i){const r=n.queries.getByIndex(t),s=r.matches;if(null!==s){const a=ZD(n,e,r,t);for(let u=0;u<s.length;u+=2){const f=s[u];if(f>0)i.push(a[u/2]);else{const g=s[u+1],E=e[-f];for(let M=10;M<E.length;M++){const R=E[M];R[17]===R[3]&&G1(R[1],R,g,i)}if(null!==E[9]){const M=E[9];for(let R=0;R<M.length;R++){const F=M[R];G1(F[1],F,g,i)}}}}}return i}function ev(n){const e=L(),t=N(),i=Di();Ei(i+1);const r=KD(t,i);if(n.dirty&&function uc(n){return 4==(4&n[2])}(e)===(2==(2&r.metadata.flags))){if(null===r.matches)n.reset([]);else{const s=r.crossesNgTemplate?G1(t,e,i,[]):ZD(t,e,r,i);n.reset(s,Vg),n.notifyOnChanges()}return!0}return!1}function tv(n,e,t){const i=N();i.firstCreatePass&&(function YD(n,e,t){null===n.queries&&(n.queries=new j1),n.queries.track(new H1(e,t))}(i,new qD(n,e,t),-1),2==(2&e)&&(i.staticViewQueries=!0)),function XD(n,e,t){const i=new B1(4==(4&t));BM(n,e,i,i.destroy),null===e[19]&&(e[19]=new U1),e[19].queries.push(new V1(i))}(i,L(),e)}function nv(){return function VV(n,e){return n[19].queries[e].queryList}(L(),Di())}function KD(n,e){return n.queries.getByIndex(e)}function ob(...n){}const gI=new Lt("Application Initializer");let ab=(()=>{class n{constructor(t){this.appInits=t,this.resolve=ob,this.reject=ob,this.initialized=!1,this.done=!1,this.donePromise=new Promise((i,r)=>{this.resolve=i,this.reject=r})}runInitializers(){if(this.initialized)return;const t=[],i=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let r=0;r<this.appInits.length;r++){const s=this.appInits[r]();if(J0(s))t.push(s);else if(dA(s)){const a=new Promise((u,f)=>{s.subscribe({complete:u,error:f})});t.push(a)}}Promise.all(t).then(()=>{i()}).catch(r=>{this.reject(r)}),0===t.length&&i(),this.initialized=!0}}return n.\u0275fac=function(t){return new(t||n)(nt(gI,8))},n.\u0275prov=lt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const x_=new Lt("AppId",{providedIn:"root",factory:function _I(){return`${X1()}${X1()}${X1()}`}});function X1(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const yI=new Lt("Platform Initializer"),Y1=new Lt("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),l4=new Lt("appBootstrapListener"),_d=new Lt("AnimationModuleType"),yd=new Lt("LocaleId",{providedIn:"root",factory:()=>Gl(yd,_n.Optional|_n.SkipSelf)||function c4(){return typeof $localize<"u"&&$localize.locale||__}()}),p4=(()=>Promise.resolve(0))();function K1(n){typeof Zone>"u"?p4.then(()=>{n&&n.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",n)}class gr{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new yo(!1),this.onMicrotaskEmpty=new yo(!1),this.onStable=new yo(!1),this.onError=new yo(!1),typeof Zone>"u")throw new st(908,!1);Zone.assertZonePatched();const r=this;if(r._nesting=0,r._outer=r._inner=Zone.current,Zone.AsyncStackTaggingZoneSpec){const s=Zone.AsyncStackTaggingZoneSpec;r._inner=r._inner.fork(new s("Angular"))}Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!i&&t,r.shouldCoalesceRunChangeDetection=i,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=function m4(){let n=tr.requestAnimationFrame,e=tr.cancelAnimationFrame;if(typeof Zone<"u"&&n&&e){const t=n[Zone.__symbol__("OriginalDelegate")];t&&(n=t);const i=e[Zone.__symbol__("OriginalDelegate")];i&&(e=i)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function y4(n){const e=()=>{!function _4(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(tr,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,Q1(n),n.isCheckStableRunning=!0,J1(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),Q1(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,i,r,s,a,u)=>{try{return xI(n),t.invokeTask(r,s,a,u)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||n.shouldCoalesceRunChangeDetection)&&e(),wI(n)}},onInvoke:(t,i,r,s,a,u,f)=>{try{return xI(n),t.invoke(r,s,a,u,f)}finally{n.shouldCoalesceRunChangeDetection&&e(),wI(n)}},onHasTask:(t,i,r,s)=>{t.hasTask(r,s),i===r&&("microTask"==s.change?(n._hasPendingMicrotasks=s.microTask,Q1(n),J1(n)):"macroTask"==s.change&&(n.hasPendingMacrotasks=s.macroTask))},onHandleError:(t,i,r,s)=>(t.handleError(r,s),n.runOutsideAngular(()=>n.onError.emit(s)),!1)})}(r)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!gr.isInAngularZone())throw new st(909,!1)}static assertNotInAngularZone(){if(gr.isInAngularZone())throw new st(909,!1)}run(e,t,i){return this._inner.run(e,t,i)}runTask(e,t,i,r){const s=this._inner,a=s.scheduleEventTask("NgZoneEvent: "+r,e,g4,ob,ob);try{return s.runTask(a,t,i)}finally{s.cancelTask(a)}}runGuarded(e,t,i){return this._inner.runGuarded(e,t,i)}runOutsideAngular(e){return this._outer.run(e)}}const g4={};function J1(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function Q1(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function xI(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function wI(n){n._nesting--,J1(n)}class v4{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new yo,this.onMicrotaskEmpty=new yo,this.onStable=new yo,this.onError=new yo}run(e,t,i){return e.apply(t,i)}runGuarded(e,t,i){return e.apply(t,i)}runOutsideAngular(e){return e()}runTask(e,t,i,r){return e.apply(t,i)}}const EI=new Lt(""),lb=new Lt("");let nE,eE=(()=>{class n{constructor(t,i,r){this._ngZone=t,this.registry=i,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,nE||(function b4(n){nE=n}(r),r.addToWindow(i)),this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{gr.assertNotInAngularZone(),K1(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())K1(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(t)||(clearTimeout(i.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,i,r){let s=-1;i&&i>0&&(s=setTimeout(()=>{this._callbacks=this._callbacks.filter(a=>a.timeoutId!==s),t(this._didWork,this.getPendingTasks())},i)),this._callbacks.push({doneCb:t,timeoutId:s,updateCb:r})}whenStable(t,i,r){if(r&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,i,r),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(t){this.registry.registerApplication(t,this)}unregisterApplication(t){this.registry.unregisterApplication(t)}findProviders(t,i,r){return[]}}return n.\u0275fac=function(t){return new(t||n)(nt(gr),nt(tE),nt(lb))},n.\u0275prov=lt({token:n,factory:n.\u0275fac}),n})(),tE=(()=>{class n{constructor(){this._applications=new Map}registerApplication(t,i){this._applications.set(t,i)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,i=!0){return nE?.findTestabilityInTree(this,t,i)??null}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=lt({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})(),vp=null;const TI=new Lt("AllowMultipleToken"),iE=new Lt("PlatformDestroyListeners");function SI(n,e,t=[]){const i=`Platform: ${e}`,r=new Lt(i);return(s=[])=>{let a=rE();if(!a||a.injector.get(TI,!1)){const u=[...t,...s,{provide:r,useValue:!0}];n?n(u):function E4(n){if(vp&&!vp.get(TI,!1))throw new st(400,!1);vp=n;const e=n.get(AI);(function CI(n){const e=n.get(yI,null);e&&e.forEach(t=>t())})(n)}(function MI(n=[],e){return Zc.create({name:e,providers:[{provide:nd,useValue:"platform"},{provide:iE,useValue:new Set([()=>vp=null])},...n]})}(u,i))}return function C4(n){const e=rE();if(!e)throw new st(401,!1);return e}()}}function rE(){return vp?.get(AI)??null}let AI=(()=>{class n{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,i){const r=function II(n,e){let t;return t="noop"===n?new v4:("zone.js"===n?void 0:n)||new gr(e),t}(i?.ngZone,function DI(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!n||!n.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!n||!n.ngZoneRunCoalescing)||!1}}(i)),s=[{provide:gr,useValue:r}];return r.run(()=>{const a=Zc.create({providers:s,parent:this.injector,name:t.moduleType.name}),u=t.create(a),f=u.injector.get(Ze,null);if(!f)throw new st(402,!1);return r.runOutsideAngular(()=>{const g=r.onError.subscribe({next:E=>{f.handleError(E)}});u.onDestroy(()=>{cb(this._modules,u),g.unsubscribe()})}),function PI(n,e,t){try{const i=t();return J0(i)?i.catch(r=>{throw e.runOutsideAngular(()=>n.handleError(r)),r}):i}catch(i){throw e.runOutsideAngular(()=>n.handleError(i)),i}}(f,r,()=>{const g=u.injector.get(ab);return g.runInitializers(),g.donePromise.then(()=>(function oD(n){Co(n,"Expected localeId to be defined"),"string"==typeof n&&(sD=n.toLowerCase().replace(/_/g,"-"))}(u.injector.get(yd,__)||__),this._moduleDoBootstrap(u),u))})})}bootstrapModule(t,i=[]){const r=kI({},i);return function x4(n,e,t){const i=new O1(t);return Promise.resolve(i)}(0,0,t).then(s=>this.bootstrapModuleFactory(s,r))}_moduleDoBootstrap(t){const i=t.injector.get(rv);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(r=>i.bootstrap(r));else{if(!t.instance.ngDoBootstrap)throw new st(403,!1);t.instance.ngDoBootstrap(i)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new st(404,!1);this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i());const t=this._injector.get(iE,null);t&&(t.forEach(i=>i()),t.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return n.\u0275fac=function(t){return new(t||n)(nt(Zc))},n.\u0275prov=lt({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();function kI(n,e){return Array.isArray(e)?e.reduce(kI,n):{...n,...e}}let rv=(()=>{class n{constructor(t,i,r){this._zone=t,this._injector=i,this._exceptionHandler=r,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const s=new Yn(u=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{u.next(this._stable),u.complete()})}),a=new Yn(u=>{let f;this._zone.runOutsideAngular(()=>{f=this._zone.onStable.subscribe(()=>{gr.assertNotInAngularZone(),K1(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,u.next(!0))})})});const g=this._zone.onUnstable.subscribe(()=>{gr.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{u.next(!1)}))});return()=>{f.unsubscribe(),g.unsubscribe()}});this.isStable=ti(s,a.pipe(br()))}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(t,i){const r=t instanceof hp;if(!this._injector.get(ab).done)throw!r&&function Rl(n){const e=Ai(n)||Ur(n)||no(n);return null!==e&&e.standalone}(t),new st(405,false);let a;a=r?t:this._injector.get(od).resolveComponentFactory(t),this.componentTypes.push(a.componentType);const u=function w4(n){return n.isBoundToModule}(a)?void 0:this._injector.get(y_),g=a.create(Zc.NULL,[],i||a.selector,u),E=g.location.nativeElement,M=g.injector.get(EI,null);return M?.registerApplication(E),g.onDestroy(()=>{this.detachView(g.hostView),cb(this.components,g),M?.unregisterApplication(E)}),this._loadComponent(g),g}tick(){if(this._runningTick)throw new st(101,!1);try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(t))}finally{this._runningTick=!1}}attachView(t){const i=t;this._views.push(i),i.attachToAppRef(this)}detachView(t){const i=t;cb(this._views,i),i.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t),this._injector.get(l4,[]).concat(this._bootstrapListeners).forEach(r=>r(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>cb(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new st(406,!1);const t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return n.\u0275fac=function(t){return new(t||n)(nt(gr),nt(rd),nt(Ze))},n.\u0275prov=lt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function cb(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}let w_=(()=>{class n{}return n.__NG_ELEMENT_ID__=A4,n})();function A4(n){return function D4(n,e,t){if(Ih(n)&&!t){const i=zi(n.index,e);return new Uy(i,i)}return 47&n.type?new Uy(e[16],e):null}(q(),L(),16==(16&n))}class zI{constructor(){}supports(e){return Hy(e)}create(e){return new O4(e)}}const L4=(n,e)=>e;class O4{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||L4}forEachItem(e){let t;for(t=this._itHead;null!==t;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,i=this._removalsHead,r=0,s=null;for(;t||i;){const a=!i||t&&t.currentIndex<UI(i,r,s)?t:i,u=UI(a,r,s),f=a.currentIndex;if(a===i)r--,i=i._nextRemoved;else if(t=t._next,null==a.previousIndex)r++;else{s||(s=[]);const g=u-r,E=f-r;if(g!=E){for(let R=0;R<g;R++){const F=R<s.length?s[R]:s[R]=0,V=F+R;E<=V&&V<g&&(s[R]=F+1)}s[a.previousIndex]=E-g}}u!==f&&e(a,u,f)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}diff(e){if(null==e&&(e=[]),!Hy(e))throw new st(900,!1);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let r,s,a,t=this._itHead,i=!1;if(Array.isArray(e)){this.length=e.length;for(let u=0;u<this.length;u++)s=e[u],a=this._trackByFn(u,s),null!==t&&Object.is(t.trackById,a)?(i&&(t=this._verifyReinsertion(t,s,a,u)),Object.is(t.item,s)||this._addIdentityChange(t,s)):(t=this._mismatch(t,s,a,u),i=!0),t=t._next}else r=0,function aB(n,e){if(Array.isArray(n))for(let t=0;t<n.length;t++)e(n[t]);else{const t=n[Rm()]();let i;for(;!(i=t.next()).done;)e(i.value)}}(e,u=>{a=this._trackByFn(r,u),null!==t&&Object.is(t.trackById,a)?(i&&(t=this._verifyReinsertion(t,u,a,r)),Object.is(t.item,u)||this._addIdentityChange(t,u)):(t=this._mismatch(t,u,a,r),i=!0),t=t._next,r++}),this.length=r;return this._truncate(t),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,i,r){let s;return null===e?s=this._itTail:(s=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,s,r)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(i,r))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,s,r)):e=this._addAfter(new F4(t,i),s,r),e}_verifyReinsertion(e,t,i,r){let s=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==s?e=this._reinsertAfter(s,e._prev,r):e.currentIndex!=r&&(e.currentIndex=r,this._addToMoves(e,r)),e}_truncate(e){for(;null!==e;){const t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const r=e._prevRemoved,s=e._nextRemoved;return null===r?this._removalsHead=s:r._nextRemoved=s,null===s?this._removalsTail=r:s._prevRemoved=r,this._insertAfter(e,t,i),this._addToMoves(e,i),e}_moveAfter(e,t,i){return this._unlink(e),this._insertAfter(e,t,i),this._addToMoves(e,i),e}_addAfter(e,t,i){return this._insertAfter(e,t,i),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,t,i){const r=null===t?this._itHead:t._next;return e._next=r,e._prev=t,null===r?this._itTail=e:r._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new VI),this._linkedRecords.put(e),e.currentIndex=i,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const t=e._prev,i=e._next;return null===t?this._itHead=i:t._next=i,null===i?this._itTail=t:i._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new VI),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class F4{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class N4{constructor(){this._head=null,this._tail=null}add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let i;for(i=this._head;null!==i;i=i._nextDup)if((null===t||t<=i.currentIndex)&&Object.is(i.trackById,e))return i;return null}remove(e){const t=e._prevDup,i=e._nextDup;return null===t?this._head=i:t._nextDup=i,null===i?this._tail=t:i._prevDup=t,null===this._head}}class VI{constructor(){this.map=new Map}put(e){const t=e.trackById;let i=this.map.get(t);i||(i=new N4,this.map.set(t,i)),i.add(e)}get(e,t){const r=this.map.get(e);return r?r.get(e,t):null}remove(e){const t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function UI(n,e,t){const i=n.previousIndex;if(null===i)return i;let r=0;return t&&i<t.length&&(r=t[i]),i+e+r}class jI{constructor(){}supports(e){return e instanceof Map||x1(e)}create(){return new B4}}class B4{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(e){let t;for(t=this._mapHead;null!==t;t=t._next)e(t)}forEachPreviousItem(e){let t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)e(t)}forEachChangedItem(e){let t;for(t=this._changesHead;null!==t;t=t._nextChanged)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}diff(e){if(e){if(!(e instanceof Map||x1(e)))throw new st(900,!1)}else e=new Map;return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._mapHead;if(this._appendAfter=null,this._forEach(e,(i,r)=>{if(t&&t.key===r)this._maybeAddToChanges(t,i),this._appendAfter=t,t=t._next;else{const s=this._getOrCreateRecordForKey(r,i);t=this._insertBeforeOrAppend(t,s)}}),t){t._prev&&(t._prev._next=null),this._removalsHead=t;for(let i=t;null!==i;i=i._nextRemoved)i===this._mapHead&&(this._mapHead=null),this._records.delete(i.key),i._nextRemoved=i._next,i.previousValue=i.currentValue,i.currentValue=null,i._prev=null,i._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(e,t){if(e){const i=e._prev;return t._next=e,t._prev=i,e._prev=t,i&&(i._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}_getOrCreateRecordForKey(e,t){if(this._records.has(e)){const r=this._records.get(e);this._maybeAddToChanges(r,t);const s=r._prev,a=r._next;return s&&(s._next=a),a&&(a._prev=s),r._next=null,r._prev=null,r}const i=new z4(e);return this._records.set(e,i),i.currentValue=t,this._addToAdditions(i),i}_reset(){if(this.isDirty){let e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(e,t){Object.is(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))}_addToAdditions(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}_addToChanges(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}_forEach(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach(i=>t(e[i],i))}}class z4{constructor(e){this.key=e,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function HI(){return new db([new zI])}let db=(()=>{class n{constructor(t){this.factories=t}static create(t,i){if(null!=i){const r=i.factories.slice();t=t.concat(r)}return new n(t)}static extend(t){return{provide:n,useFactory:i=>n.create(t,i||HI()),deps:[[n,new Zh,new wu]]}}find(t){const i=this.factories.find(r=>r.supports(t));if(null!=i)return i;throw new st(901,!1)}}return n.\u0275prov=lt({token:n,providedIn:"root",factory:HI}),n})();function GI(){return new sv([new jI])}let sv=(()=>{class n{constructor(t){this.factories=t}static create(t,i){if(i){const r=i.factories.slice();t=t.concat(r)}return new n(t)}static extend(t){return{provide:n,useFactory:i=>n.create(t,i||GI()),deps:[[n,new Zh,new wu]]}}find(t){const i=this.factories.find(r=>r.supports(t));if(i)return i;throw new st(901,!1)}}return n.\u0275prov=lt({token:n,providedIn:"root",factory:GI}),n})();const j4=SI(null,"core",[]);let H4=(()=>{class n{constructor(t){}}return n.\u0275fac=function(t){return new(t||n)(nt(rv))},n.\u0275mod=un({type:n}),n.\u0275inj=xr({}),n})(),fb=null;function vd(){return fb}const ji=new Lt("DocumentToken");let WI=(()=>{class n{historyGo(t){throw new Error("Not implemented")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=lt({token:n,factory:function(){return function q4(){return nt($I)}()},providedIn:"platform"}),n})(),$I=(()=>{class n extends WI{constructor(t){super(),this._doc=t,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return vd().getBaseHref(this._doc)}onPopState(t){const i=vd().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",t,!1),()=>i.removeEventListener("popstate",t)}onHashChange(t){const i=vd().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",t,!1),()=>i.removeEventListener("hashchange",t)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(t){this.location.pathname=t}pushState(t,i,r){qI()?this._history.pushState(t,i,r):this.location.hash=r}replaceState(t,i,r){qI()?this._history.replaceState(t,i,r):this.location.hash=r}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}}return n.\u0275fac=function(t){return new(t||n)(nt(ji))},n.\u0275prov=lt({token:n,factory:function(){return function Z4(){return new $I(nt(ji))}()},providedIn:"platform"}),n})();function qI(){return!!window.history.pushState}function ZI(n,e){if(0==n.length)return e;if(0==e.length)return n;let t=0;return n.endsWith("/")&&t++,e.startsWith("/")&&t++,2==t?n+e.substring(1):1==t?n+e:n+"/"+e}function XI(n){const e=n.match(/#|\?|$/),t=e&&e.index||n.length;return n.slice(0,t-("/"===n[t-1]?1:0))+n.slice(t)}function Vm(n){return n&&"?"!==n[0]?"?"+n:n}let uE=(()=>{class n{historyGo(t){throw new Error("Not implemented")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=lt({token:n,factory:function(){return Gl(Y4)},providedIn:"root"}),n})();const X4=new Lt("appBaseHref");let Y4=(()=>{class n extends uE{constructor(t,i){super(),this._platformLocation=t,this._removeListenerFns=[],this._baseHref=i??this._platformLocation.getBaseHrefFromDOM()??Gl(ji).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return ZI(this._baseHref,t)}path(t=!1){const i=this._platformLocation.pathname+Vm(this._platformLocation.search),r=this._platformLocation.hash;return r&&t?`${i}${r}`:i}pushState(t,i,r,s){const a=this.prepareExternalUrl(r+Vm(s));this._platformLocation.pushState(t,i,a)}replaceState(t,i,r,s){const a=this.prepareExternalUrl(r+Vm(s));this._platformLocation.replaceState(t,i,a)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}}return n.\u0275fac=function(t){return new(t||n)(nt(WI),nt(X4,8))},n.\u0275prov=lt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),YI=(()=>{class n{constructor(t){this._subject=new yo,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=t;const i=this._locationStrategy.getBaseHref();this._baseHref=XI(KI(i)),this._locationStrategy.onPopState(r=>{this._subject.emit({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,i=""){return this.path()==this.normalize(t+Vm(i))}normalize(t){return n.stripTrailingSlash(function J4(n,e){return n&&e.startsWith(n)?e.substring(n.length):e}(this._baseHref,KI(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,i="",r=null){this._locationStrategy.pushState(r,"",t,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Vm(i)),r)}replaceState(t,i="",r=null){this._locationStrategy.replaceState(r,"",t,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Vm(i)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)})),()=>{const i=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(i,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",i){this._urlChangeListeners.forEach(r=>r(t,i))}subscribe(t,i,r){return this._subject.subscribe({next:t,error:i,complete:r})}}return n.normalizeQueryParams=Vm,n.joinWithSlash=ZI,n.stripTrailingSlash=XI,n.\u0275fac=function(t){return new(t||n)(nt(uE))},n.\u0275prov=lt({token:n,factory:function(){return function K4(){return new YI(nt(uE))}()},providedIn:"root"}),n})();function KI(n){return n.replace(/\/index.html$/,"")}let oP=(()=>{class n{constructor(t,i,r,s){this._iterableDiffers=t,this._keyValueDiffers=i,this._ngEl=r,this._renderer=s,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(t){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof t?t.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(t){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof t?t.split(/\s+/):t,this._rawClass&&(Hy(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const t=this._iterableDiffer.diff(this._rawClass);t&&this._applyIterableChanges(t)}else if(this._keyValueDiffer){const t=this._keyValueDiffer.diff(this._rawClass);t&&this._applyKeyValueChanges(t)}}_applyKeyValueChanges(t){t.forEachAddedItem(i=>this._toggleClass(i.key,i.currentValue)),t.forEachChangedItem(i=>this._toggleClass(i.key,i.currentValue)),t.forEachRemovedItem(i=>{i.previousValue&&this._toggleClass(i.key,!1)})}_applyIterableChanges(t){t.forEachAddedItem(i=>{if("string"!=typeof i.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${Si(i.item)}`);this._toggleClass(i.item,!0)}),t.forEachRemovedItem(i=>this._toggleClass(i.item,!1))}_applyClasses(t){t&&(Array.isArray(t)||t instanceof Set?t.forEach(i=>this._toggleClass(i,!0)):Object.keys(t).forEach(i=>this._toggleClass(i,!!t[i])))}_removeClasses(t){t&&(Array.isArray(t)||t instanceof Set?t.forEach(i=>this._toggleClass(i,!1)):Object.keys(t).forEach(i=>this._toggleClass(i,!1)))}_toggleClass(t,i){(t=t.trim())&&t.split(/\s+/g).forEach(r=>{i?this._renderer.addClass(this._ngEl.nativeElement,r):this._renderer.removeClass(this._ngEl.nativeElement,r)})}}return n.\u0275fac=function(t){return new(t||n)(Ye(db),Ye(sv),Ye(us),Ye(_c))},n.\u0275dir=Jt({type:n,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0}),n})(),Eb=(()=>{class n{constructor(t,i){this._viewContainer=t,this._context=new U5,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=i}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){uP("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){uP("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,i){return!0}}return n.\u0275fac=function(t){return new(t||n)(Ye(fh),Ye(xf))},n.\u0275dir=Jt({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),n})();class U5{constructor(){this.$implicit=null,this.ngIf=null}}function uP(n,e){if(e&&!e.createEmbeddedView)throw new Error(`${n} must be a TemplateRef, but received '${Si(e)}'.`)}class bE{constructor(e,t){this._viewContainerRef=e,this._templateRef=t,this._created=!1}create(){this._created=!0,this._viewContainerRef.createEmbeddedView(this._templateRef)}destroy(){this._created=!1,this._viewContainerRef.clear()}enforceState(e){e&&!this._created?this.create():!e&&this._created&&this.destroy()}}let Tb=(()=>{class n{constructor(){this._defaultUsed=!1,this._caseCount=0,this._lastCaseCheckIndex=0,this._lastCasesMatched=!1}set ngSwitch(t){this._ngSwitch=t,0===this._caseCount&&this._updateDefaultCases(!0)}_addCase(){return this._caseCount++}_addDefault(t){this._defaultViews||(this._defaultViews=[]),this._defaultViews.push(t)}_matchCase(t){const i=t==this._ngSwitch;return this._lastCasesMatched=this._lastCasesMatched||i,this._lastCaseCheckIndex++,this._lastCaseCheckIndex===this._caseCount&&(this._updateDefaultCases(!this._lastCasesMatched),this._lastCaseCheckIndex=0,this._lastCasesMatched=!1),i}_updateDefaultCases(t){if(this._defaultViews&&t!==this._defaultUsed){this._defaultUsed=t;for(let i=0;i<this._defaultViews.length;i++)this._defaultViews[i].enforceState(t)}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=Jt({type:n,selectors:[["","ngSwitch",""]],inputs:{ngSwitch:"ngSwitch"},standalone:!0}),n})(),hP=(()=>{class n{constructor(t,i,r){this.ngSwitch=r,r._addCase(),this._view=new bE(t,i)}ngDoCheck(){this._view.enforceState(this.ngSwitch._matchCase(this.ngSwitchCase))}}return n.\u0275fac=function(t){return new(t||n)(Ye(fh),Ye(xf),Ye(Tb,9))},n.\u0275dir=Jt({type:n,selectors:[["","ngSwitchCase",""]],inputs:{ngSwitchCase:"ngSwitchCase"},standalone:!0}),n})(),fP=(()=>{class n{constructor(t,i,r){this._ngEl=t,this._differs=i,this._renderer=r,this._ngStyle=null,this._differ=null}set ngStyle(t){this._ngStyle=t,!this._differ&&t&&(this._differ=this._differs.find(t).create())}ngDoCheck(){if(this._differ){const t=this._differ.diff(this._ngStyle);t&&this._applyChanges(t)}}_setStyle(t,i){const[r,s]=t.split("."),a=-1===r.indexOf("-")?void 0:ui.DashCase;null!=i?this._renderer.setStyle(this._ngEl.nativeElement,r,s?`${i}${s}`:i,a):this._renderer.removeStyle(this._ngEl.nativeElement,r,a)}_applyChanges(t){t.forEachRemovedItem(i=>this._setStyle(i.key,null)),t.forEachAddedItem(i=>this._setStyle(i.key,i.currentValue)),t.forEachChangedItem(i=>this._setStyle(i.key,i.currentValue))}}return n.\u0275fac=function(t){return new(t||n)(Ye(us),Ye(sv),Ye(_c))},n.\u0275dir=Jt({type:n,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0}),n})();class W5{createSubscription(e,t){return e.subscribe({next:t,error:i=>{throw i}})}dispose(e){e.unsubscribe()}}class $5{createSubscription(e,t){return e.then(t,i=>{throw i})}dispose(e){}}const q5=new $5,Z5=new W5;let xE=(()=>{class n{constructor(t){this._latestValue=null,this._subscription=null,this._obj=null,this._strategy=null,this._ref=t}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(t){return this._obj?t!==this._obj?(this._dispose(),this.transform(t)):this._latestValue:(t&&this._subscribe(t),this._latestValue)}_subscribe(t){this._obj=t,this._strategy=this._selectStrategy(t),this._subscription=this._strategy.createSubscription(t,i=>this._updateLatestValue(t,i))}_selectStrategy(t){if(J0(t))return q5;if(hA(t))return Z5;throw function gh(n,e){return new st(2100,!1)}()}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(t,i){t===this._obj&&(this._latestValue=i,this._ref.markForCheck())}}return n.\u0275fac=function(t){return new(t||n)(Ye(w_,16))},n.\u0275pipe=to({name:"async",type:n,pure:!1,standalone:!0}),n})(),Cb=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=un({type:n}),n.\u0275inj=xr({}),n})();const mP="browser";class SE extends class LU extends class $4{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function W4(n){fb||(fb=n)}(new SE)}onAndCancel(e,t,i){return e.addEventListener(t,i,!1),()=>{e.removeEventListener(t,i,!1)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=function OU(){return cv=cv||document.querySelector("base"),cv?cv.getAttribute("href"):null}();return null==t?null:function FU(n){Mb=Mb||document.createElement("a"),Mb.setAttribute("href",n);const e=Mb.pathname;return"/"===e.charAt(0)?e:`/${e}`}(t)}resetBaseElement(){cv=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return function F5(n,e){e=encodeURIComponent(e);for(const t of n.split(";")){const i=t.indexOf("="),[r,s]=-1==i?[t,""]:[t.slice(0,i),t.slice(i+1)];if(r.trim()===e)return decodeURIComponent(s)}return null}(document.cookie,e)}}let Mb,cv=null;const bP=new Lt("TRANSITION_ID"),BU=[{provide:gI,useFactory:function NU(n,e,t){return()=>{t.get(ab).donePromise.then(()=>{const i=vd(),r=e.querySelectorAll(`style[ng-transition="${n}"]`);for(let s=0;s<r.length;s++)i.remove(r[s])})}},deps:[bP,ji,Zc],multi:!0}];let VU=(()=>{class n{build(){return new XMLHttpRequest}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=lt({token:n,factory:n.\u0275fac}),n})();const Ab=new Lt("EventManagerPlugins");let Db=(()=>{class n{constructor(t,i){this._zone=i,this._eventNameToPlugin=new Map,t.forEach(r=>r.manager=this),this._plugins=t.slice().reverse()}addEventListener(t,i,r){return this._findPluginFor(i).addEventListener(t,i,r)}addGlobalEventListener(t,i,r){return this._findPluginFor(i).addGlobalEventListener(t,i,r)}getZone(){return this._zone}_findPluginFor(t){const i=this._eventNameToPlugin.get(t);if(i)return i;const r=this._plugins;for(let s=0;s<r.length;s++){const a=r[s];if(a.supports(t))return this._eventNameToPlugin.set(t,a),a}throw new Error(`No event manager plugin found for event ${t}`)}}return n.\u0275fac=function(t){return new(t||n)(nt(Ab),nt(gr))},n.\u0275prov=lt({token:n,factory:n.\u0275fac}),n})();class xP{constructor(e){this._doc=e}addGlobalEventListener(e,t,i){const r=vd().getGlobalEventTarget(this._doc,e);if(!r)throw new Error(`Unsupported event target ${r} for event ${t}`);return this.addEventListener(r,t,i)}}let wP=(()=>{class n{constructor(){this._stylesSet=new Set}addStyles(t){const i=new Set;t.forEach(r=>{this._stylesSet.has(r)||(this._stylesSet.add(r),i.add(r))}),this.onStylesAdded(i)}onStylesAdded(t){}getAllStyles(){return Array.from(this._stylesSet)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=lt({token:n,factory:n.\u0275fac}),n})(),uv=(()=>{class n extends wP{constructor(t){super(),this._doc=t,this._hostNodes=new Map,this._hostNodes.set(t.head,[])}_addStylesToHost(t,i,r){t.forEach(s=>{const a=this._doc.createElement("style");a.textContent=s,r.push(i.appendChild(a))})}addHost(t){const i=[];this._addStylesToHost(this._stylesSet,t,i),this._hostNodes.set(t,i)}removeHost(t){const i=this._hostNodes.get(t);i&&i.forEach(EP),this._hostNodes.delete(t)}onStylesAdded(t){this._hostNodes.forEach((i,r)=>{this._addStylesToHost(t,r,i)})}ngOnDestroy(){this._hostNodes.forEach(t=>t.forEach(EP))}}return n.\u0275fac=function(t){return new(t||n)(nt(ji))},n.\u0275prov=lt({token:n,factory:n.\u0275fac}),n})();function EP(n){vd().remove(n)}const ME={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},AE=/%COMP%/g;function Ib(n,e,t){for(let i=0;i<e.length;i++){let r=e[i];Array.isArray(r)?Ib(n,r,t):(r=r.replace(AE,n),t.push(r))}return t}function SP(n){return e=>{if("__ngUnwrap__"===e)return n;!1===n(e)&&(e.preventDefault(),e.returnValue=!1)}}let Pb=(()=>{class n{constructor(t,i,r){this.eventManager=t,this.sharedStylesHost=i,this.appId=r,this.rendererByCompId=new Map,this.defaultRenderer=new DE(t)}createRenderer(t,i){if(!t||!i)return this.defaultRenderer;switch(i.encapsulation){case da.Emulated:{let r=this.rendererByCompId.get(i.id);return r||(r=new $U(this.eventManager,this.sharedStylesHost,i,this.appId),this.rendererByCompId.set(i.id,r)),r.applyToHost(t),r}case 1:case da.ShadowDom:return new qU(this.eventManager,this.sharedStylesHost,t,i);default:if(!this.rendererByCompId.has(i.id)){const r=Ib(i.id,i.styles,[]);this.sharedStylesHost.addStyles(r),this.rendererByCompId.set(i.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return n.\u0275fac=function(t){return new(t||n)(nt(Db),nt(uv),nt(x_))},n.\u0275prov=lt({token:n,factory:n.\u0275fac}),n})();class DE{constructor(e){this.eventManager=e,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(e,t){return t?document.createElementNS(ME[t]||t,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,t){(AP(e)?e.content:e).appendChild(t)}insertBefore(e,t,i){e&&(AP(e)?e.content:e).insertBefore(t,i)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let i="string"==typeof e?document.querySelector(e):e;if(!i)throw new Error(`The selector "${e}" did not match any elements`);return t||(i.textContent=""),i}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,i,r){if(r){t=r+":"+t;const s=ME[r];s?e.setAttributeNS(s,t,i):e.setAttribute(t,i)}else e.setAttribute(t,i)}removeAttribute(e,t,i){if(i){const r=ME[i];r?e.removeAttributeNS(r,t):e.removeAttribute(`${i}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,i,r){r&(ui.DashCase|ui.Important)?e.style.setProperty(t,i,r&ui.Important?"important":""):e.style[t]=i}removeStyle(e,t,i){i&ui.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,i){e[t]=i}setValue(e,t){e.nodeValue=t}listen(e,t,i){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,SP(i)):this.eventManager.addEventListener(e,t,SP(i))}}function AP(n){return"TEMPLATE"===n.tagName&&void 0!==n.content}class $U extends DE{constructor(e,t,i,r){super(e),this.component=i;const s=Ib(r+"-"+i.id,i.styles,[]);t.addStyles(s),this.contentAttr=function HU(n){return"_ngcontent-%COMP%".replace(AE,n)}(r+"-"+i.id),this.hostAttr=function GU(n){return"_nghost-%COMP%".replace(AE,n)}(r+"-"+i.id)}applyToHost(e){super.setAttribute(e,this.hostAttr,"")}createElement(e,t){const i=super.createElement(e,t);return super.setAttribute(i,this.contentAttr,""),i}}class qU extends DE{constructor(e,t,i,r){super(e),this.sharedStylesHost=t,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const s=Ib(r.id,r.styles,[]);for(let a=0;a<s.length;a++){const u=document.createElement("style");u.textContent=s[a],this.shadowRoot.appendChild(u)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,i){return super.insertBefore(this.nodeOrShadowRoot(e),t,i)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}}let ZU=(()=>{class n extends xP{constructor(t){super(t)}supports(t){return!0}addEventListener(t,i,r){return t.addEventListener(i,r,!1),()=>this.removeEventListener(t,i,r)}removeEventListener(t,i,r){return t.removeEventListener(i,r)}}return n.\u0275fac=function(t){return new(t||n)(nt(ji))},n.\u0275prov=lt({token:n,factory:n.\u0275fac}),n})();const DP=["alt","control","meta","shift"],XU={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},YU={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let KU=(()=>{class n extends xP{constructor(t){super(t)}supports(t){return null!=n.parseEventName(t)}addEventListener(t,i,r){const s=n.parseEventName(i),a=n.eventCallback(s.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>vd().onAndCancel(t,s.domEventName,a))}static parseEventName(t){const i=t.toLowerCase().split("."),r=i.shift();if(0===i.length||"keydown"!==r&&"keyup"!==r)return null;const s=n._normalizeKey(i.pop());let a="",u=i.indexOf("code");if(u>-1&&(i.splice(u,1),a="code."),DP.forEach(g=>{const E=i.indexOf(g);E>-1&&(i.splice(E,1),a+=g+".")}),a+=s,0!=i.length||0===s.length)return null;const f={};return f.domEventName=r,f.fullKey=a,f}static matchEventFullKeyCode(t,i){let r=XU[t.key]||t.key,s="";return i.indexOf("code.")>-1&&(r=t.code,s="code."),!(null==r||!r)&&(r=r.toLowerCase()," "===r?r="space":"."===r&&(r="dot"),DP.forEach(a=>{a!==r&&(0,YU[a])(t)&&(s+=a+".")}),s+=r,s===i)}static eventCallback(t,i,r){return s=>{n.matchEventFullKeyCode(s,t)&&r.runGuarded(()=>i(s))}}static _normalizeKey(t){return"esc"===t?"escape":t}}return n.\u0275fac=function(t){return new(t||n)(nt(ji))},n.\u0275prov=lt({token:n,factory:n.\u0275fac}),n})();const PP=[{provide:Y1,useValue:mP},{provide:yI,useValue:function JU(){SE.makeCurrent()},multi:!0},{provide:ji,useFactory:function e6(){return function $i(n){Jf=n}(document),document},deps:[]}],t6=SI(j4,"browser",PP),kP=new Lt(""),RP=[{provide:lb,useClass:class zU{addToWindow(e){tr.getAngularTestability=(i,r=!0)=>{const s=e.findTestabilityInTree(i,r);if(null==s)throw new Error("Could not find testability for element.");return s},tr.getAllAngularTestabilities=()=>e.getAllTestabilities(),tr.getAllAngularRootElements=()=>e.getAllRootElements(),tr.frameworkStabilizers||(tr.frameworkStabilizers=[]),tr.frameworkStabilizers.push(i=>{const r=tr.getAllAngularTestabilities();let s=r.length,a=!1;const u=function(f){a=a||f,s--,0==s&&i(a)};r.forEach(function(f){f.whenStable(u)})})}findTestabilityInTree(e,t,i){return null==t?null:e.getTestability(t)??(i?vd().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null)}},deps:[]},{provide:EI,useClass:eE,deps:[gr,tE,lb]},{provide:eE,useClass:eE,deps:[gr,tE,lb]}],LP=[{provide:nd,useValue:"root"},{provide:Ze,useFactory:function QU(){return new Ze},deps:[]},{provide:Ab,useClass:ZU,multi:!0,deps:[ji,gr,Y1]},{provide:Ab,useClass:KU,multi:!0,deps:[ji]},{provide:Pb,useClass:Pb,deps:[Db,uv,x_]},{provide:rh,useExisting:Pb},{provide:wP,useExisting:uv},{provide:uv,useClass:uv,deps:[ji]},{provide:Db,useClass:Db,deps:[Ab,gr]},{provide:class gU{},useClass:VU,deps:[]},[]];let OP=(()=>{class n{constructor(t){}static withServerTransition(t){return{ngModule:n,providers:[{provide:x_,useValue:t.appId},{provide:bP,useExisting:x_},BU]}}}return n.\u0275fac=function(t){return new(t||n)(nt(kP,12))},n.\u0275mod=un({type:n}),n.\u0275inj=xr({providers:[...LP,...RP],imports:[Cb,H4]}),n})();typeof window<"u"&&window;let RE,kE=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=lt({token:n,factory:function(t){let i=null;return i=t?new(t||n):nt(BP),i},providedIn:"root"}),n})(),BP=(()=>{class n extends kE{constructor(t){super(),this._doc=t}sanitize(t,i){if(null==i)return null;switch(t){case Gn.NONE:return i;case Gn.HTML:return Wl(i,"HTML")?Ro(i):vm(this._doc,String(i)).toString();case Gn.STYLE:return Wl(i,"Style")?Ro(i):i;case Gn.SCRIPT:if(Wl(i,"Script"))return Ro(i);throw new Error("unsafe value used in a script context");case Gn.URL:return Wl(i,"URL")?Ro(i):af(String(i));case Gn.RESOURCE_URL:if(Wl(i,"ResourceURL"))return Ro(i);throw new Error("unsafe value used in a resource URL context (see https://g.co/ng/security#xss)");default:throw new Error(`Unexpected SecurityContext ${t} (see https://g.co/ng/security#xss)`)}}bypassSecurityTrustHtml(t){return function fm(n){return new cy(n)}(t)}bypassSecurityTrustStyle(t){return function pm(n){return new uy(n)}(t)}bypassSecurityTrustScript(t){return function ep(n){return new Eg(n)}(t)}bypassSecurityTrustUrl(t){return function nf(n){return new ef(n)}(t)}bypassSecurityTrustResourceUrl(t){return function rf(n){return new ed(n)}(t)}}return n.\u0275fac=function(t){return new(t||n)(nt(ji))},n.\u0275prov=lt({token:n,factory:function(t){let i=null;return i=t?new t:function u6(n){return new BP(n.get(ji))}(nt(Zc)),i},providedIn:"root"}),n})();try{RE=typeof Intl<"u"&&Intl.v8BreakIterator}catch{RE=!1}let hv,Um,LE,Qc=(()=>{class n{constructor(t){this._platformId=t,this.isBrowser=this._platformId?function pU(n){return n===mP}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!RE)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return n.\u0275fac=function(t){return new(t||n)(nt(Y1))},n.\u0275prov=lt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function dv(n){return function h6(){if(null==hv&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>hv=!0}))}finally{hv=hv||!1}return hv}()?n:!!n.capture}function d6(){if(null==Um){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return Um=!1,Um;if("scrollBehavior"in document.documentElement.style)Um=!0;else{const n=Element.prototype.scrollTo;Um=!!n&&!/\{\s*\[native code\]\s*\}/.test(n.toString())}}return Um}function VP(n){if(function f6(){if(null==LE){const n=typeof document<"u"?document.head:null;LE=!(!n||!n.createShadowRoot&&!n.attachShadow)}return LE}()){const e=n.getRootNode?n.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&e instanceof ShadowRoot)return e}return null}function jm(n){return n.composedPath?n.composedPath()[0]:n.target}function OE(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}class UP extends Fi{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){const{hasError:e,thrownError:t,_value:i}=this;if(e)throw t;return this._throwIfClosed(),i}next(e){super.next(this._value=e)}}function xp(...n){return wi(n,Ve(n))}function jP(n,...e){return e.length?e.some(t=>n[t]):n.altKey||n.shiftKey||n.ctrlKey||n.metaKey}function FE(n,e){return ki((t,i)=>{let r=0;t.subscribe(vi(i,s=>n.call(e,s,r++)&&i.next(s)))})}function HP(n){return FE((e,t)=>n<=t)}function D6(n,e){return n===e}function _h(n){return ki((e,t)=>{os(n).subscribe(vi(t,()=>t.complete(),vt)),!t.closed&&e.subscribe(t)})}function Tf(n){return null!=n&&"false"!=`${n}`}function yh(n,e=0){return function I6(n){return!isNaN(parseFloat(n))&&!isNaN(Number(n))}(n)?Number(n):e}function Rb(n){return Array.isArray(n)?n:[n]}function Bo(n){return null==n?"":"string"==typeof n?n:`${n}px`}function T_(n){return n instanceof us?n.nativeElement:n}let P6=(()=>{class n{create(t){return typeof MutationObserver>"u"?null:new MutationObserver(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=lt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),k6=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=un({type:n}),n.\u0275inj=xr({providers:[P6]}),n})();const{isArray:R6}=Array,{getPrototypeOf:L6,prototype:O6,keys:F6}=Object;function GP(n){if(1===n.length){const e=n[0];if(R6(e))return{args:e,keys:null};if(function N6(n){return n&&"object"==typeof n&&L6(n)===O6}(e)){const t=F6(e);return{args:t.map(i=>e[i]),keys:t}}}return{args:n,keys:null}}const{isArray:B6}=Array;function NE(n){return Kn(e=>function z6(n,e){return B6(e)?n(...e):n(e)}(n,e))}function WP(n,e){return n.reduce((t,i,r)=>(t[i]=e[r],t),{})}function $P(n,e,t){n?$(t,n,e):e()}function BE(...n){return function j6(){return ye(1)}()(wi(n,Ve(n)))}function Lb(n){return n<=0?()=>Te:ki((e,t)=>{let i=0;e.subscribe(vi(t,r=>{++i<=n&&(t.next(r),n<=i&&t.complete())}))})}class H6 extends Gt{constructor(e,t){super()}schedule(e,t=0){return this}}const Ob={setInterval(n,e,...t){const{delegate:i}=Ob;return i?.setInterval?i.setInterval(n,e,...t):setInterval(n,e,...t)},clearInterval(n){const{delegate:e}=Ob;return(e?.clearInterval||clearInterval)(n)},delegate:void 0};class zE extends H6{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){var i;if(this.closed)return this;this.state=e;const r=this.id,s=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(s,r,t)),this.pending=!0,this.delay=t,this.id=null!==(i=this.id)&&void 0!==i?i:this.requestAsyncId(s,this.id,t),this}requestAsyncId(e,t,i=0){return Ob.setInterval(e.flush.bind(e,this),i)}recycleAsyncId(e,t,i=0){if(null!=i&&this.delay===i&&!1===this.pending)return t;null!=t&&Ob.clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(e,t);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let r,i=!1;try{this.work(e)}catch(s){i=!0,r=s||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),r}unsubscribe(){if(!this.closed){const{id:e,scheduler:t}=this,{actions:i}=t;this.work=this.state=this.scheduler=null,this.pending=!1,w(i,this),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null,super.unsubscribe()}}}const qP={now:()=>(qP.delegate||Date).now(),delegate:void 0};class fv{constructor(e,t=fv.now){this.schedulerActionCtor=e,this.now=t}schedule(e,t=0,i){return new this.schedulerActionCtor(this,e).schedule(i,t)}}fv.now=qP.now;class VE extends fv{constructor(e,t=fv.now){super(e,t),this.actions=[],this._active=!1}flush(e){const{actions:t}=this;if(this._active)return void t.push(e);let i;this._active=!0;do{if(i=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,i){for(;e=t.shift();)e.unsubscribe();throw i}}}const UE=new VE(zE),G6=UE;function $6(...n){const e=Ve(n);return ki((t,i)=>{(e?BE(n,t,e):BE(n,t)).subscribe(i)})}const ZP=new Set;let C_,q6=(()=>{class n{constructor(t){this._platform=t,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):X6}matchMedia(t){return(this._platform.WEBKIT||this._platform.BLINK)&&function Z6(n){if(!ZP.has(n))try{C_||(C_=document.createElement("style"),C_.setAttribute("type","text/css"),document.head.appendChild(C_)),C_.sheet&&(C_.sheet.insertRule(`@media ${n} {body{ }}`,0),ZP.add(n))}catch(e){console.error(e)}}(t),this._matchMedia(t)}}return n.\u0275fac=function(t){return new(t||n)(nt(Qc))},n.\u0275prov=lt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function X6(n){return{matches:"all"===n||""===n,media:n,addListener:()=>{},removeListener:()=>{}}}let XP=(()=>{class n{constructor(t,i){this._mediaMatcher=t,this._zone=i,this._queries=new Map,this._destroySubject=new Fi}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(t){return YP(Rb(t)).some(r=>this._registerQuery(r).mql.matches)}observe(t){let s=function V6(...n){const e=Ve(n),t=et(n),{args:i,keys:r}=GP(n);if(0===i.length)return wi([],e);const s=new Yn(function U6(n,e,t=ys){return i=>{$P(e,()=>{const{length:r}=n,s=new Array(r);let a=r,u=r;for(let f=0;f<r;f++)$P(e,()=>{const g=wi(n[f],e);let E=!1;g.subscribe(vi(i,M=>{s[f]=M,E||(E=!0,u--),u||i.next(t(s.slice()))},()=>{--a||i.complete()}))},i)},i)}}(i,e,r?a=>WP(r,a):ys));return t?s.pipe(NE(t)):s}(YP(Rb(t)).map(a=>this._registerQuery(a).observable));return s=BE(s.pipe(Lb(1)),s.pipe(HP(1),function W6(n,e=UE){return ki((t,i)=>{let r=null,s=null,a=null;const u=()=>{if(r){r.unsubscribe(),r=null;const g=s;s=null,i.next(g)}};function f(){const g=a+n,E=e.now();if(E<g)return r=this.schedule(void 0,g-E),void i.add(r);u()}t.subscribe(vi(i,g=>{s=g,a=e.now(),r||(r=e.schedule(f,n),i.add(r))},()=>{u(),i.complete()},void 0,()=>{s=r=null}))})}(0))),s.pipe(Kn(a=>{const u={matches:!1,breakpoints:{}};return a.forEach(({matches:f,query:g})=>{u.matches=u.matches||f,u.breakpoints[g]=f}),u}))}_registerQuery(t){if(this._queries.has(t))return this._queries.get(t);const i=this._mediaMatcher.matchMedia(t),s={observable:new Yn(a=>{const u=f=>this._zone.run(()=>a.next(f));return i.addListener(u),()=>{i.removeListener(u)}}).pipe($6(i),Kn(({matches:a})=>({query:t,matches:a})),_h(this._destroySubject)),mql:i};return this._queries.set(t,s),s}}return n.\u0275fac=function(t){return new(t||n)(nt(q6),nt(gr))},n.\u0275prov=lt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function YP(n){return n.map(e=>e.split(",")).reduce((e,t)=>e.concat(t)).map(e=>e.trim())}function Fb(n,e){return(n.getAttribute(e)||"").match(/\S+/g)||[]}const JP="cdk-describedby-message",Nb="cdk-describedby-host";let jE=0,Q6=(()=>{class n{constructor(t,i){this._platform=i,this._messageRegistry=new Map,this._messagesContainer=null,this._id=""+jE++,this._document=t,this._id=Gl(x_)+"-"+jE++}describe(t,i,r){if(!this._canBeDescribed(t,i))return;const s=HE(i,r);"string"!=typeof i?(QP(i,this._id),this._messageRegistry.set(s,{messageElement:i,referenceCount:0})):this._messageRegistry.has(s)||this._createMessageElement(i,r),this._isElementDescribedByMessage(t,s)||this._addMessageReference(t,s)}removeDescription(t,i,r){if(!i||!this._isElementNode(t))return;const s=HE(i,r);if(this._isElementDescribedByMessage(t,s)&&this._removeMessageReference(t,s),"string"==typeof i){const a=this._messageRegistry.get(s);a&&0===a.referenceCount&&this._deleteMessageElement(s)}0===this._messagesContainer?.childNodes.length&&(this._messagesContainer.remove(),this._messagesContainer=null)}ngOnDestroy(){const t=this._document.querySelectorAll(`[${Nb}="${this._id}"]`);for(let i=0;i<t.length;i++)this._removeCdkDescribedByReferenceIds(t[i]),t[i].removeAttribute(Nb);this._messagesContainer?.remove(),this._messagesContainer=null,this._messageRegistry.clear()}_createMessageElement(t,i){const r=this._document.createElement("div");QP(r,this._id),r.textContent=t,i&&r.setAttribute("role",i),this._createMessagesContainer(),this._messagesContainer.appendChild(r),this._messageRegistry.set(HE(t,i),{messageElement:r,referenceCount:0})}_deleteMessageElement(t){this._messageRegistry.get(t)?.messageElement?.remove(),this._messageRegistry.delete(t)}_createMessagesContainer(){if(this._messagesContainer)return;const t="cdk-describedby-message-container",i=this._document.querySelectorAll(`.${t}[platform="server"]`);for(let s=0;s<i.length;s++)i[s].remove();const r=this._document.createElement("div");r.style.visibility="hidden",r.classList.add(t),r.classList.add("cdk-visually-hidden"),this._platform&&!this._platform.isBrowser&&r.setAttribute("platform","server"),this._document.body.appendChild(r),this._messagesContainer=r}_removeCdkDescribedByReferenceIds(t){const i=Fb(t,"aria-describedby").filter(r=>0!=r.indexOf(JP));t.setAttribute("aria-describedby",i.join(" "))}_addMessageReference(t,i){const r=this._messageRegistry.get(i);(function K6(n,e,t){const i=Fb(n,e);i.some(r=>r.trim()==t.trim())||(i.push(t.trim()),n.setAttribute(e,i.join(" ")))})(t,"aria-describedby",r.messageElement.id),t.setAttribute(Nb,this._id),r.referenceCount++}_removeMessageReference(t,i){const r=this._messageRegistry.get(i);r.referenceCount--,function J6(n,e,t){const r=Fb(n,e).filter(s=>s!=t.trim());r.length?n.setAttribute(e,r.join(" ")):n.removeAttribute(e)}(t,"aria-describedby",r.messageElement.id),t.removeAttribute(Nb)}_isElementDescribedByMessage(t,i){const r=Fb(t,"aria-describedby"),s=this._messageRegistry.get(i),a=s&&s.messageElement.id;return!!a&&-1!=r.indexOf(a)}_canBeDescribed(t,i){if(!this._isElementNode(t))return!1;if(i&&"object"==typeof i)return!0;const r=null==i?"":`${i}`.trim(),s=t.getAttribute("aria-label");return!(!r||s&&s.trim()===r)}_isElementNode(t){return t.nodeType===this._document.ELEMENT_NODE}}return n.\u0275fac=function(t){return new(t||n)(nt(ji),nt(Qc))},n.\u0275prov=lt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function HE(n,e){return"string"==typeof n?`${e||""}/${n}`:n}function QP(n,e){n.id||(n.id=`${JP}-${e}-${jE++}`)}function t2(n){return 0===n.buttons||0===n.offsetX&&0===n.offsetY}function n2(n){const e=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0];return!(!e||-1!==e.identifier||null!=e.radiusX&&1!==e.radiusX||null!=e.radiusY&&1!==e.radiusY)}const sj=new Lt("cdk-input-modality-detector-options"),oj={ignoreKeys:[18,17,224,91,16]},S_=dv({passive:!0,capture:!0});let aj=(()=>{class n{constructor(t,i,r,s){this._platform=t,this._mostRecentTarget=null,this._modality=new UP(null),this._lastTouchMs=0,this._onKeydown=a=>{this._options?.ignoreKeys?.some(u=>u===a.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=jm(a))},this._onMousedown=a=>{Date.now()-this._lastTouchMs<650||(this._modality.next(t2(a)?"keyboard":"mouse"),this._mostRecentTarget=jm(a))},this._onTouchstart=a=>{n2(a)?this._modality.next("keyboard"):(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=jm(a))},this._options={...oj,...s},this.modalityDetected=this._modality.pipe(HP(1)),this.modalityChanged=this.modalityDetected.pipe(function A6(n,e=ys){return n=n??D6,ki((t,i)=>{let r,s=!0;t.subscribe(vi(i,a=>{const u=e(a);(s||!n(r,u))&&(s=!1,r=u,i.next(a))}))})}()),t.isBrowser&&i.runOutsideAngular(()=>{r.addEventListener("keydown",this._onKeydown,S_),r.addEventListener("mousedown",this._onMousedown,S_),r.addEventListener("touchstart",this._onTouchstart,S_)})}get mostRecentModality(){return this._modality.value}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,S_),document.removeEventListener("mousedown",this._onMousedown,S_),document.removeEventListener("touchstart",this._onTouchstart,S_))}}return n.\u0275fac=function(t){return new(t||n)(nt(Qc),nt(gr),nt(ji),nt(sj,8))},n.\u0275prov=lt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const cj=new Lt("cdk-focus-monitor-default-options"),Bb=dv({passive:!0,capture:!0});let GE=(()=>{class n{constructor(t,i,r,s,a){this._ngZone=t,this._platform=i,this._inputModalityDetector=r,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new Fi,this._rootNodeFocusAndBlurListener=u=>{for(let g=jm(u);g;g=g.parentElement)"focus"===u.type?this._onFocus(u,g):this._onBlur(u,g)},this._document=s,this._detectionMode=a?.detectionMode||0}monitor(t,i=!1){const r=T_(t);if(!this._platform.isBrowser||1!==r.nodeType)return xp(null);const s=VP(r)||this._getDocument(),a=this._elementInfo.get(r);if(a)return i&&(a.checkChildren=!0),a.subject;const u={checkChildren:i,subject:new Fi,rootNode:s};return this._elementInfo.set(r,u),this._registerGlobalListeners(u),u.subject}stopMonitoring(t){const i=T_(t),r=this._elementInfo.get(i);r&&(r.subject.complete(),this._setClasses(i),this._elementInfo.delete(i),this._removeGlobalListeners(r))}focusVia(t,i,r){const s=T_(t);s===this._getDocument().activeElement?this._getClosestElementsInfo(s).forEach(([u,f])=>this._originChanged(u,i,f)):(this._setOrigin(i),"function"==typeof s.focus&&s.focus(r))}ngOnDestroy(){this._elementInfo.forEach((t,i)=>this.stopMonitoring(i))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(t){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(t)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:t&&this._isLastInteractionFromInputLabel(t)?"mouse":"program"}_shouldBeAttributedToTouch(t){return 1===this._detectionMode||!!t?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(t,i){t.classList.toggle("cdk-focused",!!i),t.classList.toggle("cdk-touch-focused","touch"===i),t.classList.toggle("cdk-keyboard-focused","keyboard"===i),t.classList.toggle("cdk-mouse-focused","mouse"===i),t.classList.toggle("cdk-program-focused","program"===i)}_setOrigin(t,i=!1){this._ngZone.runOutsideAngular(()=>{this._origin=t,this._originFromTouchInteraction="touch"===t&&i,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(t,i){const r=this._elementInfo.get(i),s=jm(t);!r||!r.checkChildren&&i!==s||this._originChanged(i,this._getFocusOrigin(s),r)}_onBlur(t,i){const r=this._elementInfo.get(i);!r||r.checkChildren&&t.relatedTarget instanceof Node&&i.contains(t.relatedTarget)||(this._setClasses(i),this._emitOrigin(r,null))}_emitOrigin(t,i){t.subject.observers.length&&this._ngZone.run(()=>t.subject.next(i))}_registerGlobalListeners(t){if(!this._platform.isBrowser)return;const i=t.rootNode,r=this._rootNodeFocusListenerCount.get(i)||0;r||this._ngZone.runOutsideAngular(()=>{i.addEventListener("focus",this._rootNodeFocusAndBlurListener,Bb),i.addEventListener("blur",this._rootNodeFocusAndBlurListener,Bb)}),this._rootNodeFocusListenerCount.set(i,r+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(_h(this._stopInputModalityDetector)).subscribe(s=>{this._setOrigin(s,!0)}))}_removeGlobalListeners(t){const i=t.rootNode;if(this._rootNodeFocusListenerCount.has(i)){const r=this._rootNodeFocusListenerCount.get(i);r>1?this._rootNodeFocusListenerCount.set(i,r-1):(i.removeEventListener("focus",this._rootNodeFocusAndBlurListener,Bb),i.removeEventListener("blur",this._rootNodeFocusAndBlurListener,Bb),this._rootNodeFocusListenerCount.delete(i))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(t,i,r){this._setClasses(t,i),this._emitOrigin(r,i),this._lastFocusOrigin=i}_getClosestElementsInfo(t){const i=[];return this._elementInfo.forEach((r,s)=>{(s===t||r.checkChildren&&s.contains(t))&&i.push([s,r])}),i}_isLastInteractionFromInputLabel(t){const{_mostRecentTarget:i,mostRecentModality:r}=this._inputModalityDetector;if("mouse"!==r||!i||i===t||"INPUT"!==t.nodeName&&"TEXTAREA"!==t.nodeName||t.disabled)return!1;const s=t.labels;if(s)for(let a=0;a<s.length;a++)if(s[a].contains(i))return!0;return!1}}return n.\u0275fac=function(t){return new(t||n)(nt(gr),nt(Qc),nt(aj),nt(ji,8),nt(cj,8))},n.\u0275prov=lt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const s2="cdk-high-contrast-black-on-white",o2="cdk-high-contrast-white-on-black",WE="cdk-high-contrast-active";let a2=(()=>{class n{constructor(t,i){this._platform=t,this._document=i,this._breakpointSubscription=Gl(XP).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const t=this._document.createElement("div");t.style.backgroundColor="rgb(1,2,3)",t.style.position="absolute",this._document.body.appendChild(t);const i=this._document.defaultView||window,r=i&&i.getComputedStyle?i.getComputedStyle(t):null,s=(r&&r.backgroundColor||"").replace(/ /g,"");switch(t.remove(),s){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return 2;case"rgb(255,255,255)":case"rgb(255,250,239)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const t=this._document.body.classList;t.remove(WE,s2,o2),this._hasCheckedHighContrastMode=!0;const i=this.getHighContrastMode();1===i?t.add(WE,s2):2===i&&t.add(WE,o2)}}}return n.\u0275fac=function(t){return new(t||n)(nt(Qc),nt(ji))},n.\u0275prov=lt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),uj=(()=>{class n{constructor(t){t._applyBodyHighContrastModeCssClasses()}}return n.\u0275fac=function(t){return new(t||n)(nt(a2))},n.\u0275mod=un({type:n}),n.\u0275inj=xr({imports:[k6]}),n})();const hj=new Lt("cdk-dir-doc",{providedIn:"root",factory:function dj(){return Gl(ji)}}),fj=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let $E=(()=>{class n{constructor(t){if(this.value="ltr",this.change=new yo,t){const r=t.documentElement?t.documentElement.dir:null;this.value=function pj(n){const e=n?.toLowerCase()||"";return"auto"===e&&typeof navigator<"u"&&navigator?.language?fj.test(navigator.language)?"rtl":"ltr":"rtl"===e?"rtl":"ltr"}((t.body?t.body.dir:null)||r||"ltr")}}ngOnDestroy(){this.change.complete()}}return n.\u0275fac=function(t){return new(t||n)(nt(hj,8))},n.\u0275prov=lt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),pv=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=un({type:n}),n.\u0275inj=xr({}),n})();const gj=new Lt("mat-sanity-checks",{providedIn:"root",factory:function mj(){return!0}});let vl=(()=>{class n{constructor(t,i,r){this._sanityChecks=i,this._document=r,this._hasDoneGlobalChecks=!1,t._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(t){return!OE()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[t])}}return n.\u0275fac=function(t){return new(t||n)(nt(a2),nt(gj,8),nt(ji))},n.\u0275mod=un({type:n}),n.\u0275inj=xr({imports:[pv,pv]}),n})();function u2(n){return class extends n{constructor(...e){super(...e),this._disabled=!1}get disabled(){return this._disabled}set disabled(e){this._disabled=Tf(e)}}}function zb(n,e){return class extends n{constructor(...t){super(...t),this.defaultColor=e,this.color=e}get color(){return this._color}set color(t){const i=t||this.defaultColor;i!==this._color&&(this._color&&this._elementRef.nativeElement.classList.remove(`mat-${this._color}`),i&&this._elementRef.nativeElement.classList.add(`mat-${i}`),this._color=i)}}}function _j(n){return class extends n{constructor(...e){super(...e),this._disableRipple=!1}get disableRipple(){return this._disableRipple}set disableRipple(e){this._disableRipple=Tf(e)}}}function yj(n,e=0){return class extends n{constructor(...t){super(...t),this._tabIndex=e,this.defaultTabIndex=e}get tabIndex(){return this.disabled?-1:this._tabIndex}set tabIndex(t){this._tabIndex=null!=t?yh(t):this.defaultTabIndex}}}class bj{constructor(e,t,i,r=!1){this._renderer=e,this.element=t,this.config=i,this._animationForciblyDisabledThroughCss=r,this.state=3}fadeOut(){this._renderer.fadeOutRipple(this)}}const h2={enterDuration:225,exitDuration:150},qE=dv({passive:!0}),d2=["mousedown","touchstart"],f2=["mouseup","mouseleave","touchend","touchcancel"];class wj{constructor(e,t,i,r){this._target=e,this._ngZone=t,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,r.isBrowser&&(this._containerElement=T_(i))}fadeInRipple(e,t,i={}){const r=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),s={...h2,...i.animation};i.centered&&(e=r.left+r.width/2,t=r.top+r.height/2);const a=i.radius||function Ej(n,e,t){const i=Math.max(Math.abs(n-t.left),Math.abs(n-t.right)),r=Math.max(Math.abs(e-t.top),Math.abs(e-t.bottom));return Math.sqrt(i*i+r*r)}(e,t,r),u=e-r.left,f=t-r.top,g=s.enterDuration,E=document.createElement("div");E.classList.add("mat-ripple-element"),E.style.left=u-a+"px",E.style.top=f-a+"px",E.style.height=2*a+"px",E.style.width=2*a+"px",null!=i.color&&(E.style.backgroundColor=i.color),E.style.transitionDuration=`${g}ms`,this._containerElement.appendChild(E);const M=window.getComputedStyle(E),F=M.transitionDuration,V="none"===M.transitionProperty||"0s"===F||"0s, 0s"===F,G=new bj(this,E,i,V);E.style.transform="scale3d(1, 1, 1)",G.state=0,i.persistent||(this._mostRecentTransientRipple=G);let K=null;return!V&&(g||s.exitDuration)&&this._ngZone.runOutsideAngular(()=>{const se=()=>this._finishRippleTransition(G),_e=()=>this._destroyRipple(G);E.addEventListener("transitionend",se),E.addEventListener("transitioncancel",_e),K={onTransitionEnd:se,onTransitionCancel:_e}}),this._activeRipples.set(G,K),(V||!g)&&this._finishRippleTransition(G),G}fadeOutRipple(e){if(2===e.state||3===e.state)return;const t=e.element,i={...h2,...e.config.animation};t.style.transitionDuration=`${i.exitDuration}ms`,t.style.opacity="0",e.state=2,(e._animationForciblyDisabledThroughCss||!i.exitDuration)&&this._finishRippleTransition(e)}fadeOutAll(){this._getActiveRipples().forEach(e=>e.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(e=>{e.config.persistent||e.fadeOut()})}setupTriggerEvents(e){const t=T_(e);!t||t===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=t,this._registerEvents(d2))}handleEvent(e){"mousedown"===e.type?this._onMousedown(e):"touchstart"===e.type?this._onTouchStart(e):this._onPointerUp(),this._pointerUpEventsRegistered||(this._registerEvents(f2),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(e){0===e.state?this._startFadeOutTransition(e):2===e.state&&this._destroyRipple(e)}_startFadeOutTransition(e){const t=e===this._mostRecentTransientRipple,{persistent:i}=e.config;e.state=1,!i&&(!t||!this._isPointerDown)&&e.fadeOut()}_destroyRipple(e){const t=this._activeRipples.get(e)??null;this._activeRipples.delete(e),this._activeRipples.size||(this._containerRect=null),e===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),e.state=3,null!==t&&(e.element.removeEventListener("transitionend",t.onTransitionEnd),e.element.removeEventListener("transitioncancel",t.onTransitionCancel)),e.element.remove()}_onMousedown(e){const t=t2(e),i=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!t&&!i&&(this._isPointerDown=!0,this.fadeInRipple(e.clientX,e.clientY,this._target.rippleConfig))}_onTouchStart(e){if(!this._target.rippleDisabled&&!n2(e)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const t=e.changedTouches;for(let i=0;i<t.length;i++)this.fadeInRipple(t[i].clientX,t[i].clientY,this._target.rippleConfig)}}_onPointerUp(){!this._isPointerDown||(this._isPointerDown=!1,this._getActiveRipples().forEach(e=>{!e.config.persistent&&(1===e.state||e.config.terminateOnPointerUp&&0===e.state)&&e.fadeOut()}))}_registerEvents(e){this._ngZone.runOutsideAngular(()=>{e.forEach(t=>{this._triggerElement.addEventListener(t,this,qE)})})}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){this._triggerElement&&(d2.forEach(e=>{this._triggerElement.removeEventListener(e,this,qE)}),this._pointerUpEventsRegistered&&f2.forEach(e=>{this._triggerElement.removeEventListener(e,this,qE)}))}}const Tj=new Lt("mat-ripple-global-options");let p2=(()=>{class n{constructor(t,i,r,s,a){this._elementRef=t,this._animationMode=a,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=s||{},this._rippleRenderer=new wj(this,i,t,r)}get disabled(){return this._disabled}set disabled(t){t&&this.fadeOutAllNonPersistent(),this._disabled=t,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(t){this._trigger=t,this._setupTriggerEventsIfEnabled()}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:{...this._globalOptions.animation,..."NoopAnimations"===this._animationMode?{enterDuration:0,exitDuration:0}:{},...this.animation},terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(t,i=0,r){return"number"==typeof t?this._rippleRenderer.fadeInRipple(t,i,{...this.rippleConfig,...r}):this._rippleRenderer.fadeInRipple(0,0,{...this.rippleConfig,...t})}}return n.\u0275fac=function(t){return new(t||n)(Ye(us),Ye(gr),Ye(Qc),Ye(Tj,8),Ye(_d,8))},n.\u0275dir=Jt({type:n,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(t,i){2&t&&bc("mat-ripple-unbounded",i.unbounded)},inputs:{color:["matRippleColor","color"],unbounded:["matRippleUnbounded","unbounded"],centered:["matRippleCentered","centered"],radius:["matRippleRadius","radius"],animation:["matRippleAnimation","animation"],disabled:["matRippleDisabled","disabled"],trigger:["matRippleTrigger","trigger"]},exportAs:["matRipple"]}),n})(),Cj=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=un({type:n}),n.\u0275inj=xr({imports:[vl,vl]}),n})();const Sj=["*",[["mat-card-footer"]]],Mj=["*","mat-card-footer"],Aj=[[["mat-card-title"],["mat-card-subtitle"],["","mat-card-title",""],["","mat-card-subtitle",""],["","matCardTitle",""],["","matCardSubtitle",""]],[["img"]],"*"],Dj=["mat-card-title, mat-card-subtitle,\n      [mat-card-title], [mat-card-subtitle],\n      [matCardTitle], [matCardSubtitle]","img","*"];let m2=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=Jt({type:n,selectors:[["mat-card-content"],["","mat-card-content",""],["","matCardContent",""]],hostAttrs:[1,"mat-card-content"]}),n})(),Ij=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=Jt({type:n,selectors:[["mat-card-title"],["","mat-card-title",""],["","matCardTitle",""]],hostAttrs:[1,"mat-card-title"]}),n})(),Pj=(()=>{class n{constructor(){this.align="start"}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=Jt({type:n,selectors:[["mat-card-actions"]],hostAttrs:[1,"mat-card-actions"],hostVars:2,hostBindings:function(t,i){2&t&&bc("mat-card-actions-align-end","end"===i.align)},inputs:{align:"align"},exportAs:["matCardActions"]}),n})(),kj=(()=>{class n{constructor(t){this._animationMode=t}}return n.\u0275fac=function(t){return new(t||n)(Ye(_d,8))},n.\u0275cmp=jt({type:n,selectors:[["mat-card"]],hostAttrs:[1,"mat-card","mat-focus-indicator"],hostVars:2,hostBindings:function(t,i){2&t&&bc("_mat-animation-noopable","NoopAnimations"===i._animationMode)},exportAs:["matCard"],ngContentSelectors:Mj,decls:2,vars:0,template:function(t,i){1&t&&(p_(Sj),bf(0),bf(1,1))},styles:[".mat-card{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);display:block;position:relative;padding:16px;border-radius:4px}.mat-card._mat-animation-noopable{transition:none !important;animation:none !important}.mat-card>.mat-divider-horizontal{position:absolute;left:0;width:100%}[dir=rtl] .mat-card>.mat-divider-horizontal{left:auto;right:0}.mat-card>.mat-divider-horizontal.mat-divider-inset{position:static;margin:0}[dir=rtl] .mat-card>.mat-divider-horizontal.mat-divider-inset{margin-right:0}.cdk-high-contrast-active .mat-card{outline:solid 1px}.mat-card-actions,.mat-card-subtitle,.mat-card-content{display:block;margin-bottom:16px}.mat-card-title{display:block;margin-bottom:8px}.mat-card-actions{margin-left:-8px;margin-right:-8px;padding:8px 0}.mat-card-actions-align-end{display:flex;justify-content:flex-end}.mat-card-image{width:calc(100% + 32px);margin:0 -16px 16px -16px;display:block;overflow:hidden}.mat-card-image img{width:100%}.mat-card-footer{display:block;margin:0 -16px -16px -16px}.mat-card-actions .mat-button,.mat-card-actions .mat-raised-button,.mat-card-actions .mat-stroked-button{margin:0 8px}.mat-card-header{display:flex;flex-direction:row}.mat-card-header .mat-card-title{margin-bottom:12px}.mat-card-header-text{margin:0 16px}.mat-card-avatar{height:40px;width:40px;border-radius:50%;flex-shrink:0;object-fit:cover}.mat-card-title-group{display:flex;justify-content:space-between}.mat-card-sm-image{width:80px;height:80px}.mat-card-md-image{width:112px;height:112px}.mat-card-lg-image{width:152px;height:152px}.mat-card-xl-image{width:240px;height:240px;margin:-8px}.mat-card-title-group>.mat-card-xl-image{margin:-8px 0 8px}@media(max-width: 599px){.mat-card-title-group{margin:0}.mat-card-xl-image{margin-left:0;margin-right:0}}.mat-card>:first-child,.mat-card-content>:first-child{margin-top:0}.mat-card>:last-child:not(.mat-card-footer),.mat-card-content>:last-child:not(.mat-card-footer){margin-bottom:0}.mat-card-image:first-child{margin-top:-16px;border-top-left-radius:inherit;border-top-right-radius:inherit}.mat-card>.mat-card-actions:last-child{margin-bottom:-8px;padding-bottom:0}.mat-card-actions:not(.mat-card-actions-align-end) .mat-button:first-child,.mat-card-actions:not(.mat-card-actions-align-end) .mat-raised-button:first-child,.mat-card-actions:not(.mat-card-actions-align-end) .mat-stroked-button:first-child{margin-left:0;margin-right:0}.mat-card-actions-align-end .mat-button:last-child,.mat-card-actions-align-end .mat-raised-button:last-child,.mat-card-actions-align-end .mat-stroked-button:last-child{margin-left:0;margin-right:0}.mat-card-title:not(:first-child),.mat-card-subtitle:not(:first-child){margin-top:-4px}.mat-card-header .mat-card-subtitle:not(:first-child){margin-top:-8px}.mat-card>.mat-card-xl-image:first-child{margin-top:-8px}.mat-card>.mat-card-xl-image:last-child{margin-bottom:-8px}"],encapsulation:2,changeDetection:0}),n})(),Rj=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=jt({type:n,selectors:[["mat-card-title-group"]],hostAttrs:[1,"mat-card-title-group"],ngContentSelectors:Dj,decls:4,vars:0,template:function(t,i){1&t&&(p_(Aj),bn(0,"div"),bf(1),jn(),bf(2,1),bf(3,2))},encapsulation:2,changeDetection:0}),n})(),Lj=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=un({type:n}),n.\u0275inj=xr({imports:[vl,vl]}),n})();const vh=new Lt("NgValueAccessor"),O8=["sliderWrapper"],Pu=dv({passive:!1}),V8={provide:vh,useExisting:pi(()=>Ek),multi:!0};class U8{}const j8=yj(zb(u2(class{constructor(n){this._elementRef=n}}),"accent"));let Ek=(()=>{class n extends j8{constructor(t,i,r,s,a,u,f,g){super(t),this._focusMonitor=i,this._changeDetectorRef=r,this._dir=s,this._ngZone=u,this._animationMode=g,this._invert=!1,this._max=100,this._min=0,this._step=1,this._thumbLabel=!1,this._tickInterval=0,this._value=null,this._vertical=!1,this.change=new yo,this.input=new yo,this.valueChange=new yo,this.onTouched=()=>{},this._percent=0,this._isSliding=null,this._isActive=!1,this._tickIntervalPercent=0,this._sliderDimensions=null,this._controlValueAccessorChangeFn=()=>{},this._dirChangeSubscription=Gt.EMPTY,this._pointerDown=E=>{this.disabled||this._isSliding||!bv(E)&&0!==E.button||this._ngZone.run(()=>{this._touchId=bv(E)?function H8(n,e){for(let t=0;t<n.touches.length;t++){const i=n.touches[t].target;if(e===i||e.contains(i))return n.touches[t].identifier}}(E,this._elementRef.nativeElement):void 0;const M=Ck(E,this._touchId);if(M){const R=this.value;this._isSliding="pointer",this._lastPointerEvent=E,this._focusHostElement(),this._onMouseenter(),this._bindGlobalEvents(E),this._focusHostElement(),this._updateValueFromPosition(M),this._valueOnSlideStart=R,E.cancelable&&E.preventDefault(),R!=this.value&&this._emitInputEvent()}})},this._pointerMove=E=>{if("pointer"===this._isSliding){const M=Ck(E,this._touchId);if(M){E.cancelable&&E.preventDefault();const R=this.value;this._lastPointerEvent=E,this._updateValueFromPosition(M),R!=this.value&&this._emitInputEvent()}}},this._pointerUp=E=>{"pointer"===this._isSliding&&(!bv(E)||"number"!=typeof this._touchId||pT(E.changedTouches,this._touchId))&&(E.cancelable&&E.preventDefault(),this._removeGlobalEvents(),this._isSliding=null,this._touchId=void 0,this._valueOnSlideStart!=this.value&&!this.disabled&&this._emitChangeEvent(),this._valueOnSlideStart=this._lastPointerEvent=null)},this._windowBlur=()=>{this._lastPointerEvent&&this._pointerUp(this._lastPointerEvent)},this._document=f,this.tabIndex=parseInt(a)||0,u.runOutsideAngular(()=>{const E=t.nativeElement;E.addEventListener("mousedown",this._pointerDown,Pu),E.addEventListener("touchstart",this._pointerDown,Pu)})}get invert(){return this._invert}set invert(t){this._invert=Tf(t)}get max(){return this._max}set max(t){this._max=yh(t,this._max),this._percent=this._calculatePercentage(this._value),this._changeDetectorRef.markForCheck()}get min(){return this._min}set min(t){this._min=yh(t,this._min),this._percent=this._calculatePercentage(this._value),this._changeDetectorRef.markForCheck()}get step(){return this._step}set step(t){this._step=yh(t,this._step),this._step%1!=0&&(this._roundToDecimal=this._step.toString().split(".").pop().length),this._changeDetectorRef.markForCheck()}get thumbLabel(){return this._thumbLabel}set thumbLabel(t){this._thumbLabel=Tf(t)}get tickInterval(){return this._tickInterval}set tickInterval(t){this._tickInterval="auto"===t?"auto":"number"==typeof t||"string"==typeof t?yh(t,this._tickInterval):0}get value(){return null===this._value&&(this.value=this._min),this._value}set value(t){if(t!==this._value){let i=yh(t,0);this._roundToDecimal&&i!==this.min&&i!==this.max&&(i=parseFloat(i.toFixed(this._roundToDecimal))),this._value=i,this._percent=this._calculatePercentage(this._value),this._changeDetectorRef.markForCheck()}}get vertical(){return this._vertical}set vertical(t){this._vertical=Tf(t)}get displayValue(){return this.displayWith?this.displayWith(this.value):this._roundToDecimal&&this.value&&this.value%1!=0?this.value.toFixed(this._roundToDecimal):this.value||0}focus(t){this._focusHostElement(t)}blur(){this._blurHostElement()}get percent(){return this._clamp(this._percent)}_shouldInvertAxis(){return this.vertical?!this.invert:this.invert}_isMinValue(){return 0===this.percent}_getThumbGap(){return this.disabled?7:this._isMinValue()&&!this.thumbLabel?this._isActive?10:7:0}_getTrackBackgroundStyles(){const i=this.vertical?`1, ${1-this.percent}, 1`:1-this.percent+", 1, 1";return{transform:`translate${this.vertical?"Y":"X"}(${this._shouldInvertMouseCoords()?"-":""}${this._getThumbGap()}px) scale3d(${i})`}}_getTrackFillStyles(){const t=this.percent,r=this.vertical?`1, ${t}, 1`:`${t}, 1, 1`;return{transform:`translate${this.vertical?"Y":"X"}(${this._shouldInvertMouseCoords()?"":"-"}${this._getThumbGap()}px) scale3d(${r})`,display:0===t?"none":""}}_getTicksContainerStyles(){return{transform:`translate${this.vertical?"Y":"X"}(${this.vertical||"rtl"!=this._getDirection()?"-":""}${this._tickIntervalPercent/2*100}%)`}}_getTicksStyles(){let t=100*this._tickIntervalPercent,u={backgroundSize:this.vertical?`2px ${t}%`:`${t}% 2px`,transform:`translateZ(0) translate${this.vertical?"Y":"X"}(${this.vertical||"rtl"!=this._getDirection()?"":"-"}${t/2}%)${this.vertical||"rtl"!=this._getDirection()?"":" rotate(180deg)"}`};if(this._isMinValue()&&this._getThumbGap()){const f=this._shouldInvertAxis();let g;g=this.vertical?f?"Bottom":"Top":f?"Right":"Left",u[`padding${g}`]=`${this._getThumbGap()}px`}return u}_getThumbContainerStyles(){const t=this._shouldInvertAxis();return{transform:`translate${this.vertical?"Y":"X"}(-${100*(("rtl"!=this._getDirection()||this.vertical?t:!t)?this.percent:1-this.percent)}%)`}}_shouldInvertMouseCoords(){const t=this._shouldInvertAxis();return"rtl"!=this._getDirection()||this.vertical?t:!t}_getDirection(){return this._dir&&"rtl"==this._dir.value?"rtl":"ltr"}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(t=>{this._isActive=!!t&&"keyboard"!==t,this._changeDetectorRef.detectChanges()}),this._dir&&(this._dirChangeSubscription=this._dir.change.subscribe(()=>{this._changeDetectorRef.markForCheck()}))}ngOnDestroy(){const t=this._elementRef.nativeElement;t.removeEventListener("mousedown",this._pointerDown,Pu),t.removeEventListener("touchstart",this._pointerDown,Pu),this._lastPointerEvent=null,this._removeGlobalEvents(),this._focusMonitor.stopMonitoring(this._elementRef),this._dirChangeSubscription.unsubscribe()}_onMouseenter(){this.disabled||(this._sliderDimensions=this._getSliderDimensions(),this._updateTickIntervalPercent())}_onFocus(){this._sliderDimensions=this._getSliderDimensions(),this._updateTickIntervalPercent()}_onBlur(){this.onTouched()}_onKeydown(t){if(this.disabled||jP(t)||this._isSliding&&"keyboard"!==this._isSliding)return;const i=this.value;switch(t.keyCode){case 33:this._increment(10);break;case 34:this._increment(-10);break;case 35:this.value=this.max;break;case 36:this.value=this.min;break;case 37:this._increment("rtl"==this._getDirection()?1:-1);break;case 38:this._increment(1);break;case 39:this._increment("rtl"==this._getDirection()?-1:1);break;case 40:this._increment(-1);break;default:return}i!=this.value&&(this._emitInputEvent(),this._emitChangeEvent()),this._isSliding="keyboard",t.preventDefault()}_onKeyup(){"keyboard"===this._isSliding&&(this._isSliding=null)}_getWindow(){return this._document.defaultView||window}_bindGlobalEvents(t){const i=this._document,r=bv(t),a=r?"touchend":"mouseup";i.addEventListener(r?"touchmove":"mousemove",this._pointerMove,Pu),i.addEventListener(a,this._pointerUp,Pu),r&&i.addEventListener("touchcancel",this._pointerUp,Pu);const u=this._getWindow();typeof u<"u"&&u&&u.addEventListener("blur",this._windowBlur)}_removeGlobalEvents(){const t=this._document;t.removeEventListener("mousemove",this._pointerMove,Pu),t.removeEventListener("mouseup",this._pointerUp,Pu),t.removeEventListener("touchmove",this._pointerMove,Pu),t.removeEventListener("touchend",this._pointerUp,Pu),t.removeEventListener("touchcancel",this._pointerUp,Pu);const i=this._getWindow();typeof i<"u"&&i&&i.removeEventListener("blur",this._windowBlur)}_increment(t){const i=this._clamp(this.value||0,this.min,this.max);this.value=this._clamp(i+this.step*t,this.min,this.max)}_updateValueFromPosition(t){if(!this._sliderDimensions)return;let a=this._clamp(((this.vertical?t.y:t.x)-(this.vertical?this._sliderDimensions.top:this._sliderDimensions.left))/(this.vertical?this._sliderDimensions.height:this._sliderDimensions.width));if(this._shouldInvertMouseCoords()&&(a=1-a),0===a)this.value=this.min;else if(1===a)this.value=this.max;else{const u=this._calculateValue(a),f=Math.round((u-this.min)/this.step)*this.step+this.min;this.value=this._clamp(f,this.min,this.max)}}_emitChangeEvent(){this._controlValueAccessorChangeFn(this.value),this.valueChange.emit(this.value),this.change.emit(this._createChangeEvent())}_emitInputEvent(){this.input.emit(this._createChangeEvent())}_updateTickIntervalPercent(){if(!this.tickInterval||!this._sliderDimensions)return;let t;if("auto"==this.tickInterval){let i=this.vertical?this._sliderDimensions.height:this._sliderDimensions.width;t=Math.ceil(30/(i*this.step/(this.max-this.min)))*this.step/i}else t=this.tickInterval*this.step/(this.max-this.min);this._tickIntervalPercent=Tk(t)?t:0}_createChangeEvent(t=this.value){let i=new U8;return i.source=this,i.value=t,i}_calculatePercentage(t){const i=((t||0)-this.min)/(this.max-this.min);return Tk(i)?i:0}_calculateValue(t){return this.min+t*(this.max-this.min)}_clamp(t,i=0,r=1){return Math.max(i,Math.min(t,r))}_getSliderDimensions(){return this._sliderWrapper?this._sliderWrapper.nativeElement.getBoundingClientRect():null}_focusHostElement(t){this._elementRef.nativeElement.focus(t)}_blurHostElement(){this._elementRef.nativeElement.blur()}writeValue(t){this.value=t}registerOnChange(t){this._controlValueAccessorChangeFn=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this.disabled=t}}return n.\u0275fac=function(t){return new(t||n)(Ye(us),Ye(GE),Ye(w_),Ye($E,8),Vh("tabindex"),Ye(gr),Ye(ji),Ye(_d,8))},n.\u0275cmp=jt({type:n,selectors:[["mat-slider"]],viewQuery:function(t,i){if(1&t&&tv(O8,5),2&t){let r;ev(r=nv())&&(i._sliderWrapper=r.first)}},hostAttrs:["role","slider",1,"mat-slider","mat-focus-indicator"],hostVars:29,hostBindings:function(t,i){1&t&&Vs("focus",function(){return i._onFocus()})("blur",function(){return i._onBlur()})("keydown",function(s){return i._onKeydown(s)})("keyup",function(){return i._onKeyup()})("mouseenter",function(){return i._onMouseenter()})("selectstart",function(s){return s.preventDefault()}),2&t&&(A1("tabIndex",i.tabIndex),Ha("aria-disabled",i.disabled)("aria-valuemax",i.max)("aria-valuemin",i.min)("aria-valuenow",i.value)("aria-valuetext",i.valueText??i.displayValue)("aria-orientation",i.vertical?"vertical":"horizontal"),bc("mat-slider-disabled",i.disabled)("mat-slider-has-ticks",i.tickInterval)("mat-slider-horizontal",!i.vertical)("mat-slider-axis-inverted",i._shouldInvertAxis())("mat-slider-invert-mouse-coords",i._shouldInvertMouseCoords())("mat-slider-sliding",i._isSliding)("mat-slider-thumb-label-showing",i.thumbLabel)("mat-slider-vertical",i.vertical)("mat-slider-min-value",i._isMinValue())("mat-slider-hide-last-tick",i.disabled||i._isMinValue()&&i._getThumbGap()&&i._shouldInvertAxis())("_mat-animation-noopable","NoopAnimations"===i._animationMode))},inputs:{disabled:"disabled",color:"color",tabIndex:"tabIndex",invert:"invert",max:"max",min:"min",step:"step",thumbLabel:"thumbLabel",tickInterval:"tickInterval",value:"value",displayWith:"displayWith",valueText:"valueText",vertical:"vertical"},outputs:{change:"change",input:"input",valueChange:"valueChange"},exportAs:["matSlider"],features:[ms([V8]),qi],decls:13,vars:6,consts:[[1,"mat-slider-wrapper"],["sliderWrapper",""],[1,"mat-slider-track-wrapper"],[1,"mat-slider-track-background",3,"ngStyle"],[1,"mat-slider-track-fill",3,"ngStyle"],[1,"mat-slider-ticks-container",3,"ngStyle"],[1,"mat-slider-ticks",3,"ngStyle"],[1,"mat-slider-thumb-container",3,"ngStyle"],[1,"mat-slider-focus-ring"],[1,"mat-slider-thumb"],[1,"mat-slider-thumb-label"],[1,"mat-slider-thumb-label-text"]],template:function(t,i){1&t&&(bn(0,"div",0,1)(2,"div",2),Ga(3,"div",3)(4,"div",4),jn(),bn(5,"div",5),Ga(6,"div",6),jn(),bn(7,"div",7),Ga(8,"div",8)(9,"div",9),bn(10,"div",10)(11,"span",11),Qi(12),jn()()()()),2&t&&(Li(3),ps("ngStyle",i._getTrackBackgroundStyles()),Li(1),ps("ngStyle",i._getTrackFillStyles()),Li(1),ps("ngStyle",i._getTicksContainerStyles()),Li(1),ps("ngStyle",i._getTicksStyles()),Li(1),ps("ngStyle",i._getThumbContainerStyles()),Li(5),Om(i.displayValue))},dependencies:[fP],styles:['.mat-slider{display:inline-block;position:relative;box-sizing:border-box;padding:8px;outline:none;vertical-align:middle}.mat-slider:not(.mat-slider-disabled):active,.mat-slider.mat-slider-sliding:not(.mat-slider-disabled){cursor:grabbing}.mat-slider-wrapper{-webkit-print-color-adjust:exact;color-adjust:exact;position:absolute}.mat-slider-track-wrapper{position:absolute;top:0;left:0;overflow:hidden}.mat-slider-track-fill{position:absolute;transform-origin:0 0;transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1),background-color 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider-track-background{position:absolute;transform-origin:100% 100%;transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1),background-color 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider-ticks-container{position:absolute;left:0;top:0;overflow:hidden}.mat-slider-ticks{-webkit-background-clip:content-box;background-clip:content-box;background-repeat:repeat;box-sizing:border-box;opacity:0;transition:opacity 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider-thumb-container{position:absolute;z-index:1;transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider-focus-ring{position:absolute;width:30px;height:30px;border-radius:50%;transform:scale(0);opacity:0;transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1),background-color 400ms cubic-bezier(0.25, 0.8, 0.25, 1),opacity 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider.cdk-keyboard-focused .mat-slider-focus-ring,.mat-slider.cdk-program-focused .mat-slider-focus-ring{transform:scale(1);opacity:1}.mat-slider:not(.mat-slider-disabled):not(.mat-slider-sliding) .mat-slider-thumb-label,.mat-slider:not(.mat-slider-disabled):not(.mat-slider-sliding) .mat-slider-thumb{cursor:grab}.mat-slider-thumb{position:absolute;right:-10px;bottom:-10px;box-sizing:border-box;width:20px;height:20px;border:3px solid rgba(0,0,0,0);border-radius:50%;transform:scale(0.7);transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1),background-color 400ms cubic-bezier(0.25, 0.8, 0.25, 1),border-color 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider-thumb-label{display:none;align-items:center;justify-content:center;position:absolute;width:28px;height:28px;border-radius:50%;transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1),border-radius 400ms cubic-bezier(0.25, 0.8, 0.25, 1),background-color 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.cdk-high-contrast-active .mat-slider-thumb-label{outline:solid 1px}.mat-slider-thumb-label-text{z-index:1;opacity:0;transition:opacity 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider-sliding .mat-slider-track-fill,.mat-slider-sliding .mat-slider-track-background,.mat-slider-sliding .mat-slider-thumb-container{transition-duration:0ms}.mat-slider-has-ticks .mat-slider-wrapper::after{content:"";position:absolute;border-width:0;border-style:solid;opacity:0;transition:opacity 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider-has-ticks.cdk-focused:not(.mat-slider-hide-last-tick) .mat-slider-wrapper::after,.mat-slider-has-ticks:hover:not(.mat-slider-hide-last-tick) .mat-slider-wrapper::after{opacity:1}.mat-slider-has-ticks.cdk-focused:not(.mat-slider-disabled) .mat-slider-ticks,.mat-slider-has-ticks:hover:not(.mat-slider-disabled) .mat-slider-ticks{opacity:1}.mat-slider-thumb-label-showing .mat-slider-focus-ring{display:none}.mat-slider-thumb-label-showing .mat-slider-thumb-label{display:flex}.mat-slider-axis-inverted .mat-slider-track-fill{transform-origin:100% 100%}.mat-slider-axis-inverted .mat-slider-track-background{transform-origin:0 0}.mat-slider:not(.mat-slider-disabled).cdk-focused.mat-slider-thumb-label-showing .mat-slider-thumb{transform:scale(0)}.mat-slider:not(.mat-slider-disabled).cdk-focused .mat-slider-thumb-label{border-radius:50% 50% 0}.mat-slider:not(.mat-slider-disabled).cdk-focused .mat-slider-thumb-label-text{opacity:1}.mat-slider:not(.mat-slider-disabled).cdk-mouse-focused .mat-slider-thumb,.mat-slider:not(.mat-slider-disabled).cdk-touch-focused .mat-slider-thumb,.mat-slider:not(.mat-slider-disabled).cdk-program-focused .mat-slider-thumb{border-width:2px;transform:scale(1)}.mat-slider-disabled .mat-slider-focus-ring{transform:scale(0);opacity:0}.mat-slider-disabled .mat-slider-thumb{border-width:4px;transform:scale(0.5)}.mat-slider-disabled .mat-slider-thumb-label{display:none}.mat-slider-horizontal{height:48px;min-width:128px}.mat-slider-horizontal .mat-slider-wrapper{height:2px;top:23px;left:8px;right:8px}.mat-slider-horizontal .mat-slider-wrapper::after{height:2px;border-left-width:2px;right:0;top:0}.mat-slider-horizontal .mat-slider-track-wrapper{height:2px;width:100%}.mat-slider-horizontal .mat-slider-track-fill{height:2px;width:100%;transform:scaleX(0)}.mat-slider-horizontal .mat-slider-track-background{height:2px;width:100%;transform:scaleX(1)}.mat-slider-horizontal .mat-slider-ticks-container{height:2px;width:100%}.cdk-high-contrast-active .mat-slider-horizontal .mat-slider-ticks-container{height:0;outline:solid 2px;top:1px}.mat-slider-horizontal .mat-slider-ticks{height:2px;width:100%}.mat-slider-horizontal .mat-slider-thumb-container{width:100%;height:0;top:50%}.mat-slider-horizontal .mat-slider-focus-ring{top:-15px;right:-15px}.mat-slider-horizontal .mat-slider-thumb-label{right:-14px;top:-40px;transform:translateY(26px) scale(0.01) rotate(45deg)}.mat-slider-horizontal .mat-slider-thumb-label-text{transform:rotate(-45deg)}.mat-slider-horizontal.cdk-focused .mat-slider-thumb-label{transform:rotate(45deg)}.cdk-high-contrast-active .mat-slider-horizontal.cdk-focused .mat-slider-thumb-label,.cdk-high-contrast-active .mat-slider-horizontal.cdk-focused .mat-slider-thumb-label-text{transform:none}.mat-slider-vertical{width:48px;min-height:128px}.mat-slider-vertical .mat-slider-wrapper{width:2px;top:8px;bottom:8px;left:23px}.mat-slider-vertical .mat-slider-wrapper::after{width:2px;border-top-width:2px;bottom:0;left:0}.mat-slider-vertical .mat-slider-track-wrapper{height:100%;width:2px}.mat-slider-vertical .mat-slider-track-fill{height:100%;width:2px;transform:scaleY(0)}.mat-slider-vertical .mat-slider-track-background{height:100%;width:2px;transform:scaleY(1)}.mat-slider-vertical .mat-slider-ticks-container{width:2px;height:100%}.cdk-high-contrast-active .mat-slider-vertical .mat-slider-ticks-container{width:0;outline:solid 2px;left:1px}.mat-slider-vertical .mat-slider-focus-ring{bottom:-15px;left:-15px}.mat-slider-vertical .mat-slider-ticks{width:2px;height:100%}.mat-slider-vertical .mat-slider-thumb-container{height:100%;width:0;left:50%}.mat-slider-vertical .mat-slider-thumb{-webkit-backface-visibility:hidden;backface-visibility:hidden}.mat-slider-vertical .mat-slider-thumb-label{bottom:-14px;left:-40px;transform:translateX(26px) scale(0.01) rotate(-45deg)}.mat-slider-vertical .mat-slider-thumb-label-text{transform:rotate(45deg)}.mat-slider-vertical.cdk-focused .mat-slider-thumb-label{transform:rotate(-45deg)}[dir=rtl] .mat-slider-wrapper::after{left:0;right:auto}[dir=rtl] .mat-slider-horizontal .mat-slider-track-fill{transform-origin:100% 100%}[dir=rtl] .mat-slider-horizontal .mat-slider-track-background{transform-origin:0 0}[dir=rtl] .mat-slider-horizontal.mat-slider-axis-inverted .mat-slider-track-fill{transform-origin:0 0}[dir=rtl] .mat-slider-horizontal.mat-slider-axis-inverted .mat-slider-track-background{transform-origin:100% 100%}.mat-slider._mat-animation-noopable .mat-slider-track-fill,.mat-slider._mat-animation-noopable .mat-slider-track-background,.mat-slider._mat-animation-noopable .mat-slider-ticks,.mat-slider._mat-animation-noopable .mat-slider-thumb-container,.mat-slider._mat-animation-noopable .mat-slider-focus-ring,.mat-slider._mat-animation-noopable .mat-slider-thumb,.mat-slider._mat-animation-noopable .mat-slider-thumb-label,.mat-slider._mat-animation-noopable .mat-slider-thumb-label-text,.mat-slider._mat-animation-noopable .mat-slider-has-ticks .mat-slider-wrapper::after{transition:none}'],encapsulation:2,changeDetection:0}),n})();function Tk(n){return!isNaN(n)&&isFinite(n)}function bv(n){return"t"===n.type[0]}function Ck(n,e){let t;return t=bv(n)?"number"==typeof e?pT(n.touches,e)||pT(n.changedTouches,e):n.touches[0]||n.changedTouches[0]:n,t?{x:t.clientX,y:t.clientY}:void 0}function pT(n,e){for(let t=0;t<n.length;t++)if(n[t].identifier===e)return n[t]}let G8=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=un({type:n}),n.\u0275inj=xr({imports:[Cb,vl,vl]}),n})();const W8=["mat-button",""],$8=["*"],Z8=["mat-button","mat-flat-button","mat-icon-button","mat-raised-button","mat-stroked-button","mat-mini-fab","mat-fab"],X8=zb(u2(_j(class{constructor(n){this._elementRef=n}})));let Sk=(()=>{class n extends X8{constructor(t,i,r){super(t),this._focusMonitor=i,this._animationMode=r,this.isRoundButton=this._hasHostAttributes("mat-fab","mat-mini-fab"),this.isIconButton=this._hasHostAttributes("mat-icon-button");for(const s of Z8)this._hasHostAttributes(s)&&this._getHostElement().classList.add(s);t.nativeElement.classList.add("mat-button-base"),this.isRoundButton&&(this.color="accent")}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}focus(t,i){t?this._focusMonitor.focusVia(this._getHostElement(),t,i):this._getHostElement().focus(i)}_getHostElement(){return this._elementRef.nativeElement}_isRippleDisabled(){return this.disableRipple||this.disabled}_hasHostAttributes(...t){return t.some(i=>this._getHostElement().hasAttribute(i))}}return n.\u0275fac=function(t){return new(t||n)(Ye(us),Ye(GE),Ye(_d,8))},n.\u0275cmp=jt({type:n,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-icon-button",""],["button","mat-fab",""],["button","mat-mini-fab",""],["button","mat-stroked-button",""],["button","mat-flat-button",""]],viewQuery:function(t,i){if(1&t&&tv(p2,5),2&t){let r;ev(r=nv())&&(i.ripple=r.first)}},hostAttrs:[1,"mat-focus-indicator"],hostVars:5,hostBindings:function(t,i){2&t&&(Ha("disabled",i.disabled||null),bc("_mat-animation-noopable","NoopAnimations"===i._animationMode)("mat-button-disabled",i.disabled))},inputs:{disabled:"disabled",disableRipple:"disableRipple",color:"color"},exportAs:["matButton"],features:[qi],attrs:W8,ngContentSelectors:$8,decls:4,vars:5,consts:[[1,"mat-button-wrapper"],["matRipple","",1,"mat-button-ripple",3,"matRippleDisabled","matRippleCentered","matRippleTrigger"],[1,"mat-button-focus-overlay"]],template:function(t,i){1&t&&(p_(),bn(0,"span",0),bf(1),jn(),Ga(2,"span",1)(3,"span",2)),2&t&&(Li(2),bc("mat-button-ripple-round",i.isRoundButton||i.isIconButton),ps("matRippleDisabled",i._isRippleDisabled())("matRippleCentered",i.isIconButton)("matRippleTrigger",i._getHostElement()))},dependencies:[p2],styles:[".mat-button .mat-button-focus-overlay,.mat-icon-button .mat-button-focus-overlay{opacity:0}.mat-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay,.mat-stroked-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay{opacity:.04}@media(hover: none){.mat-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay,.mat-stroked-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay{opacity:0}}.mat-button,.mat-icon-button,.mat-stroked-button,.mat-flat-button{box-sizing:border-box;position:relative;-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:rgba(0,0,0,0);display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible}.mat-button::-moz-focus-inner,.mat-icon-button::-moz-focus-inner,.mat-stroked-button::-moz-focus-inner,.mat-flat-button::-moz-focus-inner{border:0}.mat-button.mat-button-disabled,.mat-icon-button.mat-button-disabled,.mat-stroked-button.mat-button-disabled,.mat-flat-button.mat-button-disabled{cursor:default}.mat-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-button.cdk-program-focused .mat-button-focus-overlay,.mat-icon-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-icon-button.cdk-program-focused .mat-button-focus-overlay,.mat-stroked-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-stroked-button.cdk-program-focused .mat-button-focus-overlay,.mat-flat-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-flat-button.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-button::-moz-focus-inner,.mat-icon-button::-moz-focus-inner,.mat-stroked-button::-moz-focus-inner,.mat-flat-button::-moz-focus-inner{border:0}.mat-raised-button{box-sizing:border-box;position:relative;-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:rgba(0,0,0,0);display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-raised-button::-moz-focus-inner{border:0}.mat-raised-button.mat-button-disabled{cursor:default}.mat-raised-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-raised-button.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-raised-button::-moz-focus-inner{border:0}.mat-raised-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-stroked-button{border:1px solid currentColor;padding:0 15px;line-height:34px}.mat-stroked-button .mat-button-ripple.mat-ripple,.mat-stroked-button .mat-button-focus-overlay{top:-1px;left:-1px;right:-1px;bottom:-1px}.mat-fab{box-sizing:border-box;position:relative;-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:rgba(0,0,0,0);display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);min-width:0;border-radius:50%;width:56px;height:56px;padding:0;flex-shrink:0}.mat-fab::-moz-focus-inner{border:0}.mat-fab.mat-button-disabled{cursor:default}.mat-fab.cdk-keyboard-focused .mat-button-focus-overlay,.mat-fab.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-fab::-moz-focus-inner{border:0}.mat-fab._mat-animation-noopable{transition:none !important;animation:none !important}.mat-fab .mat-button-wrapper{padding:16px 0;display:inline-block;line-height:24px}.mat-mini-fab{box-sizing:border-box;position:relative;-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:rgba(0,0,0,0);display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);min-width:0;border-radius:50%;width:40px;height:40px;padding:0;flex-shrink:0}.mat-mini-fab::-moz-focus-inner{border:0}.mat-mini-fab.mat-button-disabled{cursor:default}.mat-mini-fab.cdk-keyboard-focused .mat-button-focus-overlay,.mat-mini-fab.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-mini-fab::-moz-focus-inner{border:0}.mat-mini-fab._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mini-fab .mat-button-wrapper{padding:8px 0;display:inline-block;line-height:24px}.mat-icon-button{padding:0;min-width:0;width:40px;height:40px;flex-shrink:0;line-height:40px;border-radius:50%}.mat-icon-button i,.mat-icon-button .mat-icon{line-height:24px}.mat-button-ripple.mat-ripple,.mat-button-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-button-ripple.mat-ripple:not(:empty){transform:translateZ(0)}.mat-button-focus-overlay{opacity:0;transition:opacity 200ms cubic-bezier(0.35, 0, 0.25, 1),background-color 200ms cubic-bezier(0.35, 0, 0.25, 1)}._mat-animation-noopable .mat-button-focus-overlay{transition:none}.mat-button-ripple-round{border-radius:50%;z-index:1}.mat-button .mat-button-wrapper>*,.mat-flat-button .mat-button-wrapper>*,.mat-stroked-button .mat-button-wrapper>*,.mat-raised-button .mat-button-wrapper>*,.mat-icon-button .mat-button-wrapper>*,.mat-fab .mat-button-wrapper>*,.mat-mini-fab .mat-button-wrapper>*{vertical-align:middle}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button{display:inline-flex;justify-content:center;align-items:center;font-size:inherit;width:2.5em;height:2.5em}.mat-flat-button::before,.mat-raised-button::before,.mat-fab::before,.mat-mini-fab::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 2px) * -1)}.mat-stroked-button::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 3px) * -1)}.cdk-high-contrast-active .mat-button,.cdk-high-contrast-active .mat-flat-button,.cdk-high-contrast-active .mat-raised-button,.cdk-high-contrast-active .mat-icon-button,.cdk-high-contrast-active .mat-fab,.cdk-high-contrast-active .mat-mini-fab{outline:solid 1px}"],encapsulation:2,changeDetection:0}),n})(),Y8=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=un({type:n}),n.\u0275inj=xr({imports:[Cj,vl,vl]}),n})(),Mk=(()=>{class n{constructor(){this._vertical=!1,this._inset=!1}get vertical(){return this._vertical}set vertical(t){this._vertical=Tf(t)}get inset(){return this._inset}set inset(t){this._inset=Tf(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=jt({type:n,selectors:[["mat-divider"]],hostAttrs:["role","separator",1,"mat-divider"],hostVars:7,hostBindings:function(t,i){2&t&&(Ha("aria-orientation",i.vertical?"vertical":"horizontal"),bc("mat-divider-vertical",i.vertical)("mat-divider-horizontal",!i.vertical)("mat-divider-inset",i.inset))},inputs:{vertical:"vertical",inset:"inset"},decls:0,vars:0,template:function(t,i){},styles:[".mat-divider{display:block;margin:0;border-top-width:1px;border-top-style:solid}.mat-divider.mat-divider-vertical{border-top:0;border-right-width:1px;border-right-style:solid}.mat-divider.mat-divider-inset{margin-left:80px}[dir=rtl] .mat-divider.mat-divider-inset{margin-left:auto;margin-right:80px}"],encapsulation:2,changeDetection:0}),n})(),K8=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=un({type:n}),n.\u0275inj=xr({imports:[vl,vl]}),n})();const J8=["addListener","removeListener"],Q8=["addEventListener","removeEventListener"],eH=["on","off"];function mT(n,e,t,i){if(Wn(t)&&(i=t,t=void 0),i)return mT(n,e,t).pipe(NE(i));const[r,s]=function iH(n){return Wn(n.addEventListener)&&Wn(n.removeEventListener)}(n)?Q8.map(a=>u=>n[a](e,u,t)):function tH(n){return Wn(n.addListener)&&Wn(n.removeListener)}(n)?J8.map(Ak(n,e)):function nH(n){return Wn(n.on)&&Wn(n.off)}(n)?eH.map(Ak(n,e)):[];if(!r&&on(n))return re(a=>mT(a,e,t))(os(n));if(!r)throw new TypeError("Invalid event target");return new Yn(a=>{const u=(...f)=>a.next(1<f.length?f:f[0]);return r(u),()=>s(u)})}function Ak(n,e){return t=>i=>n[t](e,i)}const xv={schedule(n){let e=requestAnimationFrame,t=cancelAnimationFrame;const{delegate:i}=xv;i&&(e=i.requestAnimationFrame,t=i.cancelAnimationFrame);const r=e(s=>{t=void 0,n(s)});return new Gt(()=>t?.(r))},requestAnimationFrame(...n){const{delegate:e}=xv;return(e?.requestAnimationFrame||requestAnimationFrame)(...n)},cancelAnimationFrame(...n){const{delegate:e}=xv;return(e?.cancelAnimationFrame||cancelAnimationFrame)(...n)},delegate:void 0};new class sH extends VE{flush(e){this._active=!0;const t=this._scheduled;this._scheduled=void 0;const{actions:i}=this;let r;e=e||i.shift();do{if(r=e.execute(e.state,e.delay))break}while((e=i[0])&&e.id===t&&i.shift());if(this._active=!1,r){for(;(e=i[0])&&e.id===t&&i.shift();)e.unsubscribe();throw r}}}(class rH extends zE{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}requestAsyncId(e,t,i=0){return null!==i&&i>0?super.requestAsyncId(e,t,i):(e.actions.push(this),e._scheduled||(e._scheduled=xv.requestAnimationFrame(()=>e.flush(void 0))))}recycleAsyncId(e,t,i=0){var r;if(null!=i?i>0:this.delay>0)return super.recycleAsyncId(e,t,i);const{actions:s}=e;null!=t&&(null===(r=s[s.length-1])||void 0===r?void 0:r.id)!==t&&(xv.cancelAnimationFrame(t),e._scheduled=void 0)}});let gT,aH=1;const Xb={};function Dk(n){return n in Xb&&(delete Xb[n],!0)}const lH={setImmediate(n){const e=aH++;return Xb[e]=!0,gT||(gT=Promise.resolve()),gT.then(()=>Dk(e)&&n()),e},clearImmediate(n){Dk(n)}},{setImmediate:cH,clearImmediate:uH}=lH,Yb={setImmediate(...n){const{delegate:e}=Yb;return(e?.setImmediate||cH)(...n)},clearImmediate(n){const{delegate:e}=Yb;return(e?.clearImmediate||uH)(n)},delegate:void 0};new class dH extends VE{flush(e){this._active=!0;const t=this._scheduled;this._scheduled=void 0;const{actions:i}=this;let r;e=e||i.shift();do{if(r=e.execute(e.state,e.delay))break}while((e=i[0])&&e.id===t&&i.shift());if(this._active=!1,r){for(;(e=i[0])&&e.id===t&&i.shift();)e.unsubscribe();throw r}}}(class hH extends zE{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}requestAsyncId(e,t,i=0){return null!==i&&i>0?super.requestAsyncId(e,t,i):(e.actions.push(this),e._scheduled||(e._scheduled=Yb.setImmediate(e.flush.bind(e,void 0))))}recycleAsyncId(e,t,i=0){var r;if(null!=i?i>0:this.delay>0)return super.recycleAsyncId(e,t,i);const{actions:s}=e;null!=t&&(null===(r=s[s.length-1])||void 0===r?void 0:r.id)!==t&&(Yb.clearImmediate(t),e._scheduled=void 0)}});function Ik(n,e=UE){return function pH(n){return ki((e,t)=>{let i=!1,r=null,s=null,a=!1;const u=()=>{if(s?.unsubscribe(),s=null,i){i=!1;const g=r;r=null,t.next(g)}a&&t.complete()},f=()=>{s=null,a&&t.complete()};e.subscribe(vi(t,g=>{i=!0,r=g,s||os(n(g)).subscribe(s=vi(t,u,f))},()=>{a=!0,(!i||!s||s.closed)&&t.complete()}))})}(()=>function gH(n=0,e,t=G6){let i=-1;return null!=e&&(Ce(e)?t=e:i=e),new Yn(r=>{let s=function mH(n){return n instanceof Date&&!isNaN(n)}(n)?+n-t.now():n;s<0&&(s=0);let a=0;return t.schedule(function(){r.closed||(r.next(a++),0<=i?this.schedule(void 0,i):r.complete())},s)})}(n,e))}let Pk=(()=>{class n{constructor(t,i,r){this._ngZone=t,this._platform=i,this._scrolled=new Fi,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=r}register(t){this.scrollContainers.has(t)||this.scrollContainers.set(t,t.elementScrolled().subscribe(()=>this._scrolled.next(t)))}deregister(t){const i=this.scrollContainers.get(t);i&&(i.unsubscribe(),this.scrollContainers.delete(t))}scrolled(t=20){return this._platform.isBrowser?new Yn(i=>{this._globalSubscription||this._addGlobalListener();const r=t>0?this._scrolled.pipe(Ik(t)).subscribe(i):this._scrolled.subscribe(i);return this._scrolledCount++,()=>{r.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):xp()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((t,i)=>this.deregister(i)),this._scrolled.complete()}ancestorScrolled(t,i){const r=this.getAncestorScrollContainers(t);return this.scrolled(i).pipe(FE(s=>!s||r.indexOf(s)>-1))}getAncestorScrollContainers(t){const i=[];return this.scrollContainers.forEach((r,s)=>{this._scrollableContainsElement(s,t)&&i.push(s)}),i}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(t,i){let r=T_(i),s=t.getElementRef().nativeElement;do{if(r==s)return!0}while(r=r.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>mT(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}}return n.\u0275fac=function(t){return new(t||n)(nt(gr),nt(Qc),nt(ji,8))},n.\u0275prov=lt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),_T=(()=>{class n{constructor(t,i,r){this._platform=t,this._change=new Fi,this._changeListener=s=>{this._change.next(s)},this._document=r,i.runOutsideAngular(()=>{if(t.isBrowser){const s=this._getWindow();s.addEventListener("resize",this._changeListener),s.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const t=this._getWindow();t.removeEventListener("resize",this._changeListener),t.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const t={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),t}getViewportRect(){const t=this.getViewportScrollPosition(),{width:i,height:r}=this.getViewportSize();return{top:t.top,left:t.left,bottom:t.top+r,right:t.left+i,height:r,width:i}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const t=this._document,i=this._getWindow(),r=t.documentElement,s=r.getBoundingClientRect();return{top:-s.top||t.body.scrollTop||i.scrollY||r.scrollTop||0,left:-s.left||t.body.scrollLeft||i.scrollX||r.scrollLeft||0}}change(t=20){return t>0?this._change.pipe(Ik(t)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const t=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:t.innerWidth,height:t.innerHeight}:{width:0,height:0}}}return n.\u0275fac=function(t){return new(t||n)(nt(Qc),nt(gr),nt(ji,8))},n.\u0275prov=lt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),yT=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=un({type:n}),n.\u0275inj=xr({}),n})(),kk=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=un({type:n}),n.\u0275inj=xr({imports:[pv,yT,pv,yT]}),n})();function vH(n,e){if(1&n&&(On(),Ga(0,"circle",4)),2&n){const t=Wy(),i=w1(1);yp("animation-name","mat-progress-spinner-stroke-rotate-"+t._spinnerAnimationLabel)("stroke-dashoffset",t._getStrokeDashOffset(),"px")("stroke-dasharray",t._getStrokeCircumference(),"px")("stroke-width",t._getCircleStrokeWidth(),"%")("transform-origin",t._getCircleTransformOrigin(i)),Ha("r",t._getCircleRadius())}}function bH(n,e){if(1&n&&(On(),Ga(0,"circle",4)),2&n){const t=Wy(),i=w1(1);yp("stroke-dashoffset",t._getStrokeDashOffset(),"px")("stroke-dasharray",t._getStrokeCircumference(),"px")("stroke-width",t._getCircleStrokeWidth(),"%")("transform-origin",t._getCircleTransformOrigin(i)),Ha("r",t._getCircleRadius())}}const wH=zb(class{constructor(n){this._elementRef=n}},"primary"),EH=new Lt("mat-progress-spinner-default-options",{providedIn:"root",factory:function TH(){return{diameter:100}}});class Cf extends wH{constructor(e,t,i,r,s,a,u,f){super(e),this._document=i,this._diameter=100,this._value=0,this._resizeSubscription=Gt.EMPTY,this.mode="determinate";const g=Cf._diameters;this._spinnerAnimationLabel=this._getSpinnerAnimationLabel(),g.has(i.head)||g.set(i.head,new Set([100])),this._noopAnimations="NoopAnimations"===r&&!!s&&!s._forceAnimations,"mat-spinner"===e.nativeElement.nodeName.toLowerCase()&&(this.mode="indeterminate"),s&&(s.color&&(this.color=this.defaultColor=s.color),s.diameter&&(this.diameter=s.diameter),s.strokeWidth&&(this.strokeWidth=s.strokeWidth)),t.isBrowser&&t.SAFARI&&u&&a&&f&&(this._resizeSubscription=u.change(150).subscribe(()=>{"indeterminate"===this.mode&&f.run(()=>a.markForCheck())}))}get diameter(){return this._diameter}set diameter(e){this._diameter=yh(e),this._spinnerAnimationLabel=this._getSpinnerAnimationLabel(),this._styleRoot&&this._attachStyleNode()}get strokeWidth(){return this._strokeWidth||this.diameter/10}set strokeWidth(e){this._strokeWidth=yh(e)}get value(){return"determinate"===this.mode?this._value:0}set value(e){this._value=Math.max(0,Math.min(100,yh(e)))}ngOnInit(){const e=this._elementRef.nativeElement;this._styleRoot=VP(e)||this._document.head,this._attachStyleNode(),e.classList.add("mat-progress-spinner-indeterminate-animation")}ngOnDestroy(){this._resizeSubscription.unsubscribe()}_getCircleRadius(){return(this.diameter-10)/2}_getViewBox(){const e=2*this._getCircleRadius()+this.strokeWidth;return`0 0 ${e} ${e}`}_getStrokeCircumference(){return 2*Math.PI*this._getCircleRadius()}_getStrokeDashOffset(){return"determinate"===this.mode?this._getStrokeCircumference()*(100-this._value)/100:null}_getCircleStrokeWidth(){return this.strokeWidth/this.diameter*100}_getCircleTransformOrigin(e){const t=50*(e.currentScale??1);return`${t}% ${t}%`}_attachStyleNode(){const e=this._styleRoot,t=this._diameter,i=Cf._diameters;let r=i.get(e);if(!r||!r.has(t)){const s=this._document.createElement("style");s.setAttribute("mat-spinner-animation",this._spinnerAnimationLabel),s.textContent=this._getAnimationText(),e.appendChild(s),r||(r=new Set,i.set(e,r)),r.add(t)}}_getAnimationText(){const e=this._getStrokeCircumference();return"\n @keyframes mat-progress-spinner-stroke-rotate-DIAMETER {\n    0%      { stroke-dashoffset: START_VALUE;  transform: rotate(0); }\n    12.5%   { stroke-dashoffset: END_VALUE;    transform: rotate(0); }\n    12.5001%  { stroke-dashoffset: END_VALUE;    transform: rotateX(180deg) rotate(72.5deg); }\n    25%     { stroke-dashoffset: START_VALUE;  transform: rotateX(180deg) rotate(72.5deg); }\n\n    25.0001%   { stroke-dashoffset: START_VALUE;  transform: rotate(270deg); }\n    37.5%   { stroke-dashoffset: END_VALUE;    transform: rotate(270deg); }\n    37.5001%  { stroke-dashoffset: END_VALUE;    transform: rotateX(180deg) rotate(161.5deg); }\n    50%     { stroke-dashoffset: START_VALUE;  transform: rotateX(180deg) rotate(161.5deg); }\n\n    50.0001%  { stroke-dashoffset: START_VALUE;  transform: rotate(180deg); }\n    62.5%   { stroke-dashoffset: END_VALUE;    transform: rotate(180deg); }\n    62.5001%  { stroke-dashoffset: END_VALUE;    transform: rotateX(180deg) rotate(251.5deg); }\n    75%     { stroke-dashoffset: START_VALUE;  transform: rotateX(180deg) rotate(251.5deg); }\n\n    75.0001%  { stroke-dashoffset: START_VALUE;  transform: rotate(90deg); }\n    87.5%   { stroke-dashoffset: END_VALUE;    transform: rotate(90deg); }\n    87.5001%  { stroke-dashoffset: END_VALUE;    transform: rotateX(180deg) rotate(341.5deg); }\n    100%    { stroke-dashoffset: START_VALUE;  transform: rotateX(180deg) rotate(341.5deg); }\n  }\n".replace(/START_VALUE/g,""+.95*e).replace(/END_VALUE/g,""+.2*e).replace(/DIAMETER/g,`${this._spinnerAnimationLabel}`)}_getSpinnerAnimationLabel(){return this.diameter.toString().replace(".","_")}}Cf._diameters=new WeakMap,Cf.\u0275fac=function(e){return new(e||Cf)(Ye(us),Ye(Qc),Ye(ji,8),Ye(_d,8),Ye(EH),Ye(w_),Ye(_T),Ye(gr))},Cf.\u0275cmp=jt({type:Cf,selectors:[["mat-progress-spinner"],["mat-spinner"]],hostAttrs:["role","progressbar","tabindex","-1",1,"mat-progress-spinner","mat-spinner"],hostVars:10,hostBindings:function(e,t){2&e&&(Ha("aria-valuemin","determinate"===t.mode?0:null)("aria-valuemax","determinate"===t.mode?100:null)("aria-valuenow","determinate"===t.mode?t.value:null)("mode",t.mode),yp("width",t.diameter,"px")("height",t.diameter,"px"),bc("_mat-animation-noopable",t._noopAnimations))},inputs:{color:"color",diameter:"diameter",strokeWidth:"strokeWidth",mode:"mode",value:"value"},exportAs:["matProgressSpinner"],features:[qi],decls:4,vars:8,consts:[["preserveAspectRatio","xMidYMid meet","focusable","false","aria-hidden","true",3,"ngSwitch"],["svg",""],["cx","50%","cy","50%",3,"animation-name","stroke-dashoffset","stroke-dasharray","stroke-width","transform-origin",4,"ngSwitchCase"],["cx","50%","cy","50%",3,"stroke-dashoffset","stroke-dasharray","stroke-width","transform-origin",4,"ngSwitchCase"],["cx","50%","cy","50%"]],template:function(e,t){1&e&&(On(),bn(0,"svg",0,1),f_(2,vH,1,11,"circle",2),f_(3,bH,1,9,"circle",3),jn()),2&e&&(yp("width",t.diameter,"px")("height",t.diameter,"px"),ps("ngSwitch","indeterminate"===t.mode),Ha("viewBox",t._getViewBox()),Li(2),ps("ngSwitchCase",!0),Li(1),ps("ngSwitchCase",!1))},dependencies:[Tb,hP],styles:[".mat-progress-spinner{display:block;position:relative;overflow:hidden}.mat-progress-spinner svg{position:absolute;transform:rotate(-90deg);top:0;left:0;transform-origin:center;overflow:visible}.mat-progress-spinner circle{fill:rgba(0,0,0,0);transition:stroke-dashoffset 225ms linear}.cdk-high-contrast-active .mat-progress-spinner circle{stroke:CanvasText}.mat-progress-spinner[mode=indeterminate] svg{animation:mat-progress-spinner-linear-rotate 2000ms linear infinite}.mat-progress-spinner[mode=indeterminate] circle{transition-property:stroke;animation-duration:4000ms;animation-timing-function:cubic-bezier(0.35, 0, 0.25, 1);animation-iteration-count:infinite}.mat-progress-spinner._mat-animation-noopable svg,.mat-progress-spinner._mat-animation-noopable circle{animation:none;transition:none}@keyframes mat-progress-spinner-linear-rotate{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes mat-progress-spinner-stroke-rotate-100{0%{stroke-dashoffset:268.606171575px;transform:rotate(0)}12.5%{stroke-dashoffset:56.5486677px;transform:rotate(0)}12.5001%{stroke-dashoffset:56.5486677px;transform:rotateX(180deg) rotate(72.5deg)}25%{stroke-dashoffset:268.606171575px;transform:rotateX(180deg) rotate(72.5deg)}25.0001%{stroke-dashoffset:268.606171575px;transform:rotate(270deg)}37.5%{stroke-dashoffset:56.5486677px;transform:rotate(270deg)}37.5001%{stroke-dashoffset:56.5486677px;transform:rotateX(180deg) rotate(161.5deg)}50%{stroke-dashoffset:268.606171575px;transform:rotateX(180deg) rotate(161.5deg)}50.0001%{stroke-dashoffset:268.606171575px;transform:rotate(180deg)}62.5%{stroke-dashoffset:56.5486677px;transform:rotate(180deg)}62.5001%{stroke-dashoffset:56.5486677px;transform:rotateX(180deg) rotate(251.5deg)}75%{stroke-dashoffset:268.606171575px;transform:rotateX(180deg) rotate(251.5deg)}75.0001%{stroke-dashoffset:268.606171575px;transform:rotate(90deg)}87.5%{stroke-dashoffset:56.5486677px;transform:rotate(90deg)}87.5001%{stroke-dashoffset:56.5486677px;transform:rotateX(180deg) rotate(341.5deg)}100%{stroke-dashoffset:268.606171575px;transform:rotateX(180deg) rotate(341.5deg)}}"],encapsulation:2,changeDetection:0});let SH=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=un({type:n}),n.\u0275inj=xr({imports:[vl,Cb,vl]}),n})();function bT(n,e,t){const i=Wn(n)||e||t?{next:n,error:e,complete:t}:n;return i?ki((r,s)=>{var a;null===(a=i.subscribe)||void 0===a||a.call(i);let u=!0;r.subscribe(vi(s,f=>{var g;null===(g=i.next)||void 0===g||g.call(i,f),s.next(f)},()=>{var f;u=!1,null===(f=i.complete)||void 0===f||f.call(i),s.complete()},f=>{var g;u=!1,null===(g=i.error)||void 0===g||g.call(i,f),s.error(f)},()=>{var f,g;u&&(null===(f=i.unsubscribe)||void 0===f||f.call(i)),null===(g=i.finalize)||void 0===g||g.call(i)}))}):ys}function Rk(n){return ki((e,t)=>{let s,i=null,r=!1;i=e.subscribe(vi(t,void 0,void 0,a=>{s=os(n(a,Rk(n)(e))),i?(i.unsubscribe(),i=null,s.subscribe(t)):r=!0})),r&&(i.unsubscribe(),i=null,s.subscribe(t))})}class IH{}class Cp{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?this.lazyInit="string"==typeof e?()=>{this.headers=new Map,e.split("\n").forEach(t=>{const i=t.indexOf(":");if(i>0){const r=t.slice(0,i),s=r.toLowerCase(),a=t.slice(i+1).trim();this.maybeSetNormalizedName(r,s),this.headers.has(s)?this.headers.get(s).push(a):this.headers.set(s,[a])}})}:()=>{this.headers=new Map,Object.keys(e).forEach(t=>{let i=e[t];const r=t.toLowerCase();"string"==typeof i&&(i=[i]),i.length>0&&(this.headers.set(r,i),this.maybeSetNormalizedName(t,r))})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();const t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof Cp?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){const t=new Cp;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof Cp?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){const t=e.name.toLowerCase();switch(e.op){case"a":case"s":let i=e.value;if("string"==typeof i&&(i=[i]),0===i.length)return;this.maybeSetNormalizedName(e.name,t);const r=("a"===e.op?this.headers.get(t):void 0)||[];r.push(...i),this.headers.set(t,r);break;case"d":const s=e.value;if(s){let a=this.headers.get(t);if(!a)return;a=a.filter(u=>-1===s.indexOf(u)),0===a.length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,a)}else this.headers.delete(t),this.normalizedNames.delete(t)}}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}}class PH{encodeKey(e){return Lk(e)}encodeValue(e){return Lk(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}}const RH=/%(\d[a-f0-9])/gi,LH={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function Lk(n){return encodeURIComponent(n).replace(RH,(e,t)=>LH[t]??e)}function Kb(n){return`${n}`}class Sp{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new PH,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function kH(n,e){const t=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(r=>{const s=r.indexOf("="),[a,u]=-1==s?[e.decodeKey(r),""]:[e.decodeKey(r.slice(0,s)),e.decodeValue(r.slice(s+1))],f=t.get(a)||[];f.push(u),t.set(a,f)}),t}(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(t=>{const i=e.fromObject[t],r=Array.isArray(i)?i.map(Kb):[Kb(i)];this.map.set(t,r)})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();const t=this.map.get(e);return t?t[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:"a"})}appendAll(e){const t=[];return Object.keys(e).forEach(i=>{const r=e[i];Array.isArray(r)?r.forEach(s=>{t.push({param:i,value:s,op:"a"})}):t.push({param:i,value:r,op:"a"})}),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:"s"})}delete(e,t){return this.clone({param:e,value:t,op:"d"})}toString(){return this.init(),this.keys().map(e=>{const t=this.encoder.encodeKey(e);return this.map.get(e).map(i=>t+"="+this.encoder.encodeValue(i)).join("&")}).filter(e=>""!==e).join("&")}clone(e){const t=new Sp({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(e),t}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":const t=("a"===e.op?this.map.get(e.param):void 0)||[];t.push(Kb(e.value)),this.map.set(e.param,t);break;case"d":if(void 0===e.value){this.map.delete(e.param);break}{let i=this.map.get(e.param)||[];const r=i.indexOf(Kb(e.value));-1!==r&&i.splice(r,1),i.length>0?this.map.set(e.param,i):this.map.delete(e.param)}}}),this.cloneFrom=this.updates=null)}}class OH{constructor(){this.map=new Map}set(e,t){return this.map.set(e,t),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}has(e){return this.map.has(e)}keys(){return this.map.keys()}}function Ok(n){return typeof ArrayBuffer<"u"&&n instanceof ArrayBuffer}function Fk(n){return typeof Blob<"u"&&n instanceof Blob}function Nk(n){return typeof FormData<"u"&&n instanceof FormData}class wv{constructor(e,t,i,r){let s;if(this.url=t,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase(),function FH(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||r?(this.body=void 0!==i?i:null,s=r):s=i,s&&(this.reportProgress=!!s.reportProgress,this.withCredentials=!!s.withCredentials,s.responseType&&(this.responseType=s.responseType),s.headers&&(this.headers=s.headers),s.context&&(this.context=s.context),s.params&&(this.params=s.params)),this.headers||(this.headers=new Cp),this.context||(this.context=new OH),this.params){const a=this.params.toString();if(0===a.length)this.urlWithParams=t;else{const u=t.indexOf("?");this.urlWithParams=t+(-1===u?"?":u<t.length-1?"&":"")+a}}else this.params=new Sp,this.urlWithParams=t}serializeBody(){return null===this.body?null:Ok(this.body)||Fk(this.body)||Nk(this.body)||function NH(n){return typeof URLSearchParams<"u"&&n instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Sp?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||Nk(this.body)?null:Fk(this.body)?this.body.type||null:Ok(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Sp?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(e={}){const t=e.method||this.method,i=e.url||this.url,r=e.responseType||this.responseType,s=void 0!==e.body?e.body:this.body,a=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,u=void 0!==e.reportProgress?e.reportProgress:this.reportProgress;let f=e.headers||this.headers,g=e.params||this.params;const E=e.context??this.context;return void 0!==e.setHeaders&&(f=Object.keys(e.setHeaders).reduce((M,R)=>M.set(R,e.setHeaders[R]),f)),e.setParams&&(g=Object.keys(e.setParams).reduce((M,R)=>M.set(R,e.setParams[R]),g)),new wv(t,i,s,{params:g,headers:f,context:E,reportProgress:u,responseType:r,withCredentials:a})}}var Wa=(()=>((Wa=Wa||{})[Wa.Sent=0]="Sent",Wa[Wa.UploadProgress=1]="UploadProgress",Wa[Wa.ResponseHeader=2]="ResponseHeader",Wa[Wa.DownloadProgress=3]="DownloadProgress",Wa[Wa.Response=4]="Response",Wa[Wa.User=5]="User",Wa))();class xT extends class BH{constructor(e,t=200,i="OK"){this.headers=e.headers||new Cp,this.status=void 0!==e.status?e.status:t,this.statusText=e.statusText||i,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}}{constructor(e={}){super(e),this.type=Wa.Response,this.body=void 0!==e.body?e.body:null}clone(e={}){return new xT({body:void 0!==e.body?e.body:this.body,headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}function wT(n,e){return{body:e,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials}}let zk=(()=>{class n{constructor(t){this.handler=t}request(t,i,r={}){let s;if(t instanceof wv)s=t;else{let f,g;f=r.headers instanceof Cp?r.headers:new Cp(r.headers),r.params&&(g=r.params instanceof Sp?r.params:new Sp({fromObject:r.params})),s=new wv(t,i,void 0!==r.body?r.body:null,{headers:f,context:r.context,params:g,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials})}const a=xp(s).pipe(function DH(n,e){return Wn(e)?re(n,e,1):re(n,1)}(f=>this.handler.handle(f)));if(t instanceof wv||"events"===r.observe)return a;const u=a.pipe(FE(f=>f instanceof xT));switch(r.observe||"body"){case"body":switch(s.responseType){case"arraybuffer":return u.pipe(Kn(f=>{if(null!==f.body&&!(f.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return f.body}));case"blob":return u.pipe(Kn(f=>{if(null!==f.body&&!(f.body instanceof Blob))throw new Error("Response is not a Blob.");return f.body}));case"text":return u.pipe(Kn(f=>{if(null!==f.body&&"string"!=typeof f.body)throw new Error("Response is not a string.");return f.body}));default:return u.pipe(Kn(f=>f.body))}case"response":return u;default:throw new Error(`Unreachable: unhandled observe type ${r.observe}}`)}}delete(t,i={}){return this.request("DELETE",t,i)}get(t,i={}){return this.request("GET",t,i)}head(t,i={}){return this.request("HEAD",t,i)}jsonp(t,i){return this.request("JSONP",t,{params:(new Sp).append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,i={}){return this.request("OPTIONS",t,i)}patch(t,i,r={}){return this.request("PATCH",t,wT(r,i))}post(t,i,r={}){return this.request("POST",t,wT(r,i))}put(t,i,r={}){return this.request("PUT",t,wT(r,i))}}return n.\u0275fac=function(t){return new(t||n)(nt(IH))},n.\u0275prov=lt({token:n,factory:n.\u0275fac}),n})();const VH=["*"];let Jb;function Ev(n){return function UH(){if(void 0===Jb&&(Jb=null,typeof window<"u")){const n=window;void 0!==n.trustedTypes&&(Jb=n.trustedTypes.createPolicy("angular#components",{createHTML:e=>e}))}return Jb}()?.createHTML(n)||n}function Vk(n){return Error(`Unable to find icon with the name "${n}"`)}function Uk(n){return Error(`The URL provided to MatIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was "${n}".`)}function jk(n){return Error(`The literal provided to MatIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was "${n}".`)}class Wm{constructor(e,t,i){this.url=e,this.svgText=t,this.options=i}}let Qb=(()=>{class n{constructor(t,i,r,s){this._httpClient=t,this._sanitizer=i,this._errorHandler=s,this._svgIconConfigs=new Map,this._iconSetConfigs=new Map,this._cachedIconsByUrl=new Map,this._inProgressUrlFetches=new Map,this._fontCssClassesByAlias=new Map,this._resolvers=[],this._defaultFontSetClass=["material-icons","mat-ligature-font"],this._document=r}addSvgIcon(t,i,r){return this.addSvgIconInNamespace("",t,i,r)}addSvgIconLiteral(t,i,r){return this.addSvgIconLiteralInNamespace("",t,i,r)}addSvgIconInNamespace(t,i,r,s){return this._addSvgIconConfig(t,i,new Wm(r,null,s))}addSvgIconResolver(t){return this._resolvers.push(t),this}addSvgIconLiteralInNamespace(t,i,r,s){const a=this._sanitizer.sanitize(Gn.HTML,r);if(!a)throw jk(r);const u=Ev(a);return this._addSvgIconConfig(t,i,new Wm("",u,s))}addSvgIconSet(t,i){return this.addSvgIconSetInNamespace("",t,i)}addSvgIconSetLiteral(t,i){return this.addSvgIconSetLiteralInNamespace("",t,i)}addSvgIconSetInNamespace(t,i,r){return this._addSvgIconSetConfig(t,new Wm(i,null,r))}addSvgIconSetLiteralInNamespace(t,i,r){const s=this._sanitizer.sanitize(Gn.HTML,i);if(!s)throw jk(i);const a=Ev(s);return this._addSvgIconSetConfig(t,new Wm("",a,r))}registerFontClassAlias(t,i=t){return this._fontCssClassesByAlias.set(t,i),this}classNameForFontAlias(t){return this._fontCssClassesByAlias.get(t)||t}setDefaultFontSetClass(...t){return this._defaultFontSetClass=t,this}getDefaultFontSetClass(){return this._defaultFontSetClass}getSvgIconFromUrl(t){const i=this._sanitizer.sanitize(Gn.RESOURCE_URL,t);if(!i)throw Uk(t);const r=this._cachedIconsByUrl.get(i);return r?xp(ex(r)):this._loadSvgIconFromConfig(new Wm(t,null)).pipe(bT(s=>this._cachedIconsByUrl.set(i,s)),Kn(s=>ex(s)))}getNamedSvgIcon(t,i=""){const r=Hk(i,t);let s=this._svgIconConfigs.get(r);if(s)return this._getSvgFromConfig(s);if(s=this._getIconConfigFromResolvers(i,t),s)return this._svgIconConfigs.set(r,s),this._getSvgFromConfig(s);const a=this._iconSetConfigs.get(i);return a?this._getSvgFromIconSetConfigs(t,a):function MH(n,e){const t=Wn(n)?n:()=>n,i=r=>r.error(t());return new Yn(e?r=>e.schedule(i,0,r):i)}(Vk(r))}ngOnDestroy(){this._resolvers=[],this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}_getSvgFromConfig(t){return t.svgText?xp(ex(this._svgElementFromConfig(t))):this._loadSvgIconFromConfig(t).pipe(Kn(i=>ex(i)))}_getSvgFromIconSetConfigs(t,i){const r=this._extractIconWithNameFromAnySet(t,i);return r?xp(r):function g2(...n){const e=et(n),{args:t,keys:i}=GP(n),r=new Yn(s=>{const{length:a}=t;if(!a)return void s.complete();const u=new Array(a);let f=a,g=a;for(let E=0;E<a;E++){let M=!1;os(t[E]).subscribe(vi(s,R=>{M||(M=!0,g--),u[E]=R},()=>f--,void 0,()=>{(!f||!M)&&(g||s.next(i?WP(i,u):u),s.complete())}))}});return e?r.pipe(NE(e)):r}(i.filter(a=>!a.svgText).map(a=>this._loadSvgIconSetFromConfig(a).pipe(Rk(u=>{const g=`Loading icon set URL: ${this._sanitizer.sanitize(Gn.RESOURCE_URL,a.url)} failed: ${u.message}`;return this._errorHandler.handleError(new Error(g)),xp(null)})))).pipe(Kn(()=>{const a=this._extractIconWithNameFromAnySet(t,i);if(!a)throw Vk(t);return a}))}_extractIconWithNameFromAnySet(t,i){for(let r=i.length-1;r>=0;r--){const s=i[r];if(s.svgText&&s.svgText.toString().indexOf(t)>-1){const a=this._svgElementFromConfig(s),u=this._extractSvgIconFromSet(a,t,s.options);if(u)return u}}return null}_loadSvgIconFromConfig(t){return this._fetchIcon(t).pipe(bT(i=>t.svgText=i),Kn(()=>this._svgElementFromConfig(t)))}_loadSvgIconSetFromConfig(t){return t.svgText?xp(null):this._fetchIcon(t).pipe(bT(i=>t.svgText=i))}_extractSvgIconFromSet(t,i,r){const s=t.querySelector(`[id="${i}"]`);if(!s)return null;const a=s.cloneNode(!0);if(a.removeAttribute("id"),"svg"===a.nodeName.toLowerCase())return this._setSvgAttributes(a,r);if("symbol"===a.nodeName.toLowerCase())return this._setSvgAttributes(this._toSvgElement(a),r);const u=this._svgElementFromString(Ev("<svg></svg>"));return u.appendChild(a),this._setSvgAttributes(u,r)}_svgElementFromString(t){const i=this._document.createElement("DIV");i.innerHTML=t;const r=i.querySelector("svg");if(!r)throw Error("<svg> tag not found");return r}_toSvgElement(t){const i=this._svgElementFromString(Ev("<svg></svg>")),r=t.attributes;for(let s=0;s<r.length;s++){const{name:a,value:u}=r[s];"id"!==a&&i.setAttribute(a,u)}for(let s=0;s<t.childNodes.length;s++)t.childNodes[s].nodeType===this._document.ELEMENT_NODE&&i.appendChild(t.childNodes[s].cloneNode(!0));return i}_setSvgAttributes(t,i){return t.setAttribute("fit",""),t.setAttribute("height","100%"),t.setAttribute("width","100%"),t.setAttribute("preserveAspectRatio","xMidYMid meet"),t.setAttribute("focusable","false"),i&&i.viewBox&&t.setAttribute("viewBox",i.viewBox),t}_fetchIcon(t){const{url:i,options:r}=t,s=r?.withCredentials??!1;if(!this._httpClient)throw function jH(){return Error("Could not find HttpClient provider for use with Angular Material icons. Please include the HttpClientModule from @angular/common/http in your app imports.")}();if(null==i)throw Error(`Cannot fetch icon from URL "${i}".`);const a=this._sanitizer.sanitize(Gn.RESOURCE_URL,i);if(!a)throw Uk(i);const u=this._inProgressUrlFetches.get(a);if(u)return u;const f=this._httpClient.get(a,{responseType:"text",withCredentials:s}).pipe(Kn(g=>Ev(g)),function AH(n){return ki((e,t)=>{try{e.subscribe(t)}finally{t.add(n)}})}(()=>this._inProgressUrlFetches.delete(a)),br());return this._inProgressUrlFetches.set(a,f),f}_addSvgIconConfig(t,i,r){return this._svgIconConfigs.set(Hk(t,i),r),this}_addSvgIconSetConfig(t,i){const r=this._iconSetConfigs.get(t);return r?r.push(i):this._iconSetConfigs.set(t,[i]),this}_svgElementFromConfig(t){if(!t.svgElement){const i=this._svgElementFromString(t.svgText);this._setSvgAttributes(i,t.options),t.svgElement=i}return t.svgElement}_getIconConfigFromResolvers(t,i){for(let r=0;r<this._resolvers.length;r++){const s=this._resolvers[r](i,t);if(s)return GH(s)?new Wm(s.url,null,s.options):new Wm(s,null)}}}return n.\u0275fac=function(t){return new(t||n)(nt(zk,8),nt(kE),nt(ji,8),nt(Ze))},n.\u0275prov=lt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function ex(n){return n.cloneNode(!0)}function Hk(n,e){return n+":"+e}function GH(n){return!(!n.url||!n.options)}const WH=zb(class{constructor(n){this._elementRef=n}}),$H=new Lt("MAT_ICON_DEFAULT_OPTIONS"),qH=new Lt("mat-icon-location",{providedIn:"root",factory:function ZH(){const n=Gl(ji),e=n?n.location:null;return{getPathname:()=>e?e.pathname+e.search:""}}}),Gk=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],XH=Gk.map(n=>`[${n}]`).join(", "),YH=/^url\(['"]?#(.*?)['"]?\)$/;let KH=(()=>{class n extends WH{constructor(t,i,r,s,a,u){super(t),this._iconRegistry=i,this._location=s,this._errorHandler=a,this._inline=!1,this._previousFontSetClass=[],this._currentIconFetch=Gt.EMPTY,u&&(u.color&&(this.color=this.defaultColor=u.color),u.fontSet&&(this.fontSet=u.fontSet)),r||t.nativeElement.setAttribute("aria-hidden","true")}get inline(){return this._inline}set inline(t){this._inline=Tf(t)}get svgIcon(){return this._svgIcon}set svgIcon(t){t!==this._svgIcon&&(t?this._updateSvgIcon(t):this._svgIcon&&this._clearSvgElement(),this._svgIcon=t)}get fontSet(){return this._fontSet}set fontSet(t){const i=this._cleanupFontValue(t);i!==this._fontSet&&(this._fontSet=i,this._updateFontIconClasses())}get fontIcon(){return this._fontIcon}set fontIcon(t){const i=this._cleanupFontValue(t);i!==this._fontIcon&&(this._fontIcon=i,this._updateFontIconClasses())}_splitIconName(t){if(!t)return["",""];const i=t.split(":");switch(i.length){case 1:return["",i[0]];case 2:return i;default:throw Error(`Invalid icon name: "${t}"`)}}ngOnInit(){this._updateFontIconClasses()}ngAfterViewChecked(){const t=this._elementsWithExternalReferences;if(t&&t.size){const i=this._location.getPathname();i!==this._previousPath&&(this._previousPath=i,this._prependPathToReferences(i))}}ngOnDestroy(){this._currentIconFetch.unsubscribe(),this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}_usingFontIcon(){return!this.svgIcon}_setSvgElement(t){this._clearSvgElement();const i=this._location.getPathname();this._previousPath=i,this._cacheChildrenWithExternalReferences(t),this._prependPathToReferences(i),this._elementRef.nativeElement.appendChild(t)}_clearSvgElement(){const t=this._elementRef.nativeElement;let i=t.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();i--;){const r=t.childNodes[i];(1!==r.nodeType||"svg"===r.nodeName.toLowerCase())&&r.remove()}}_updateFontIconClasses(){if(!this._usingFontIcon())return;const t=this._elementRef.nativeElement,i=(this.fontSet?this._iconRegistry.classNameForFontAlias(this.fontSet).split(/ +/):this._iconRegistry.getDefaultFontSetClass()).filter(r=>r.length>0);this._previousFontSetClass.forEach(r=>t.classList.remove(r)),i.forEach(r=>t.classList.add(r)),this._previousFontSetClass=i,this.fontIcon!==this._previousFontIconClass&&!i.includes("mat-ligature-font")&&(this._previousFontIconClass&&t.classList.remove(this._previousFontIconClass),this.fontIcon&&t.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}_cleanupFontValue(t){return"string"==typeof t?t.trim().split(" ")[0]:t}_prependPathToReferences(t){const i=this._elementsWithExternalReferences;i&&i.forEach((r,s)=>{r.forEach(a=>{s.setAttribute(a.name,`url('${t}#${a.value}')`)})})}_cacheChildrenWithExternalReferences(t){const i=t.querySelectorAll(XH),r=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map;for(let s=0;s<i.length;s++)Gk.forEach(a=>{const u=i[s],f=u.getAttribute(a),g=f?f.match(YH):null;if(g){let E=r.get(u);E||(E=[],r.set(u,E)),E.push({name:a,value:g[1]})}})}_updateSvgIcon(t){if(this._svgNamespace=null,this._svgName=null,this._currentIconFetch.unsubscribe(),t){const[i,r]=this._splitIconName(t);i&&(this._svgNamespace=i),r&&(this._svgName=r),this._currentIconFetch=this._iconRegistry.getNamedSvgIcon(r,i).pipe(Lb(1)).subscribe(s=>this._setSvgElement(s),s=>{this._errorHandler.handleError(new Error(`Error retrieving icon ${i}:${r}! ${s.message}`))})}}}return n.\u0275fac=function(t){return new(t||n)(Ye(us),Ye(Qb),Vh("aria-hidden"),Ye(qH),Ye(Ze),Ye($H,8))},n.\u0275cmp=jt({type:n,selectors:[["mat-icon"]],hostAttrs:["role","img",1,"mat-icon","notranslate"],hostVars:7,hostBindings:function(t,i){2&t&&(Ha("data-mat-icon-type",i._usingFontIcon()?"font":"svg")("data-mat-icon-name",i._svgName||i.fontIcon)("data-mat-icon-namespace",i._svgNamespace||i.fontSet),bc("mat-icon-inline",i.inline)("mat-icon-no-color","primary"!==i.color&&"accent"!==i.color&&"warn"!==i.color))},inputs:{color:"color",inline:"inline",svgIcon:"svgIcon",fontSet:"fontSet",fontIcon:"fontIcon"},exportAs:["matIcon"],features:[qi],ngContentSelectors:VH,decls:1,vars:0,template:function(t,i){1&t&&(p_(),bf(0))},styles:[".mat-icon{-webkit-user-select:none;user-select:none;background-repeat:no-repeat;display:inline-block;fill:currentColor;height:24px;width:24px;overflow:hidden}.mat-icon.mat-icon-inline{font-size:inherit;height:inherit;line-height:inherit;width:inherit}.mat-icon.mat-ligature-font[fontIcon]::before{content:attr(fontIcon)}[dir=rtl] .mat-icon-rtl-mirror{transform:scale(-1, 1)}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon{display:block}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button .mat-icon{margin:auto}"],encapsulation:2,changeDetection:0}),n})(),JH=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=un({type:n}),n.\u0275inj=xr({imports:[vl,vl]}),n})();class ET{attach(e){return this._attachedHost=e,e.attach(this)}detach(){let e=this._attachedHost;null!=e&&(this._attachedHost=null,e.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(e){this._attachedHost=e}}class Wk extends ET{constructor(e,t,i,r){super(),this.component=e,this.viewContainerRef=t,this.injector=i,this.componentFactoryResolver=r}}class QH extends ET{constructor(e,t,i,r){super(),this.templateRef=e,this.viewContainerRef=t,this.context=i,this.injector=r}get origin(){return this.templateRef.elementRef}attach(e,t=this.context){return this.context=t,super.attach(e)}detach(){return this.context=void 0,super.detach()}}class eG extends ET{constructor(e){super(),this.element=e instanceof us?e.nativeElement:e}}class nG extends class tG{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(e){return e instanceof Wk?(this._attachedPortal=e,this.attachComponentPortal(e)):e instanceof QH?(this._attachedPortal=e,this.attachTemplatePortal(e)):this.attachDomPortal&&e instanceof eG?(this._attachedPortal=e,this.attachDomPortal(e)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(e){this._disposeFn=e}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}{constructor(e,t,i,r,s){super(),this.outletElement=e,this._componentFactoryResolver=t,this._appRef=i,this._defaultInjector=r,this.attachDomPortal=a=>{const u=a.element,f=this._document.createComment("dom-portal");u.parentNode.insertBefore(f,u),this.outletElement.appendChild(u),this._attachedPortal=a,super.setDisposeFn(()=>{f.parentNode&&f.parentNode.replaceChild(u,f)})},this._document=s}attachComponentPortal(e){const i=(e.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(e.component);let r;return e.viewContainerRef?(r=e.viewContainerRef.createComponent(i,e.viewContainerRef.length,e.injector||e.viewContainerRef.injector),this.setDisposeFn(()=>r.destroy())):(r=i.create(e.injector||this._defaultInjector||Zc.NULL),this._appRef.attachView(r.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(r.hostView),r.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(r)),this._attachedPortal=e,r}attachTemplatePortal(e){let t=e.viewContainerRef,i=t.createEmbeddedView(e.templateRef,e.context,{injector:e.injector});return i.rootNodes.forEach(r=>this.outletElement.appendChild(r)),i.detectChanges(),this.setDisposeFn(()=>{let r=t.indexOf(i);-1!==r&&t.remove(r)}),this._attachedPortal=e,i}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(e){return e.hostView.rootNodes[0]}}let iG=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=un({type:n}),n.\u0275inj=xr({}),n})();const $k=d6();class rG{constructor(e,t){this._viewportRuler=e,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=t}attach(){}enable(){if(this._canBeEnabled()){const e=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=e.style.left||"",this._previousHTMLStyles.top=e.style.top||"",e.style.left=Bo(-this._previousScrollPosition.left),e.style.top=Bo(-this._previousScrollPosition.top),e.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const e=this._document.documentElement,i=e.style,r=this._document.body.style,s=i.scrollBehavior||"",a=r.scrollBehavior||"";this._isEnabled=!1,i.left=this._previousHTMLStyles.left,i.top=this._previousHTMLStyles.top,e.classList.remove("cdk-global-scrollblock"),$k&&(i.scrollBehavior=r.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),$k&&(i.scrollBehavior=s,r.scrollBehavior=a)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const t=this._document.body,i=this._viewportRuler.getViewportSize();return t.scrollHeight>i.height||t.scrollWidth>i.width}}class sG{constructor(e,t,i,r){this._scrollDispatcher=e,this._ngZone=t,this._viewportRuler=i,this._config=r,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(e){this._overlayRef=e}enable(){if(this._scrollSubscription)return;const e=this._scrollDispatcher.scrolled(0);this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=e.subscribe(()=>{const t=this._viewportRuler.getViewportScrollPosition().top;Math.abs(t-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=e.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class qk{enable(){}disable(){}attach(){}}function TT(n,e){return e.some(t=>n.bottom<t.top||n.top>t.bottom||n.right<t.left||n.left>t.right)}function Zk(n,e){return e.some(t=>n.top<t.top||n.bottom>t.bottom||n.left<t.left||n.right>t.right)}class oG{constructor(e,t,i,r){this._scrollDispatcher=e,this._viewportRuler=t,this._ngZone=i,this._config=r,this._scrollSubscription=null}attach(e){this._overlayRef=e}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const t=this._overlayRef.overlayElement.getBoundingClientRect(),{width:i,height:r}=this._viewportRuler.getViewportSize();TT(t,[{width:i,height:r,bottom:r,right:i,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let aG=(()=>{class n{constructor(t,i,r,s){this._scrollDispatcher=t,this._viewportRuler=i,this._ngZone=r,this.noop=()=>new qk,this.close=a=>new sG(this._scrollDispatcher,this._ngZone,this._viewportRuler,a),this.block=()=>new rG(this._viewportRuler,this._document),this.reposition=a=>new oG(this._scrollDispatcher,this._viewportRuler,this._ngZone,a),this._document=s}}return n.\u0275fac=function(t){return new(t||n)(nt(Pk),nt(_T),nt(gr),nt(ji))},n.\u0275prov=lt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class lG{constructor(e){if(this.scrollStrategy=new qk,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,e){const t=Object.keys(e);for(const i of t)void 0!==e[i]&&(this[i]=e[i])}}}class cG{constructor(e,t){this.connectionPair=e,this.scrollableViewProperties=t}}let Xk=(()=>{class n{constructor(t){this._attachedOverlays=[],this._document=t}ngOnDestroy(){this.detach()}add(t){this.remove(t),this._attachedOverlays.push(t)}remove(t){const i=this._attachedOverlays.indexOf(t);i>-1&&this._attachedOverlays.splice(i,1),0===this._attachedOverlays.length&&this.detach()}}return n.\u0275fac=function(t){return new(t||n)(nt(ji))},n.\u0275prov=lt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),uG=(()=>{class n extends Xk{constructor(t,i){super(t),this._ngZone=i,this._keydownListener=r=>{const s=this._attachedOverlays;for(let a=s.length-1;a>-1;a--)if(s[a]._keydownEvents.observers.length>0){const u=s[a]._keydownEvents;this._ngZone?this._ngZone.run(()=>u.next(r)):u.next(r);break}}}add(t){super.add(t),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}return n.\u0275fac=function(t){return new(t||n)(nt(ji),nt(gr,8))},n.\u0275prov=lt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),hG=(()=>{class n extends Xk{constructor(t,i,r){super(t),this._platform=i,this._ngZone=r,this._cursorStyleIsSet=!1,this._pointerDownListener=s=>{this._pointerDownEventTarget=jm(s)},this._clickListener=s=>{const a=jm(s),u="click"===s.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:a;this._pointerDownEventTarget=null;const f=this._attachedOverlays.slice();for(let g=f.length-1;g>-1;g--){const E=f[g];if(E._outsidePointerEvents.observers.length<1||!E.hasAttached())continue;if(E.overlayElement.contains(a)||E.overlayElement.contains(u))break;const M=E._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>M.next(s)):M.next(s)}}}add(t){if(super.add(t),!this._isAttached){const i=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(i)):this._addEventListeners(i),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=i.style.cursor,i.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const t=this._document.body;t.removeEventListener("pointerdown",this._pointerDownListener,!0),t.removeEventListener("click",this._clickListener,!0),t.removeEventListener("auxclick",this._clickListener,!0),t.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(t.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(t){t.addEventListener("pointerdown",this._pointerDownListener,!0),t.addEventListener("click",this._clickListener,!0),t.addEventListener("auxclick",this._clickListener,!0),t.addEventListener("contextmenu",this._clickListener,!0)}}return n.\u0275fac=function(t){return new(t||n)(nt(ji),nt(Qc),nt(gr,8))},n.\u0275prov=lt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Yk=(()=>{class n{constructor(t,i){this._platform=i,this._document=t}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const t="cdk-overlay-container";if(this._platform.isBrowser||OE()){const r=this._document.querySelectorAll(`.${t}[platform="server"], .${t}[platform="test"]`);for(let s=0;s<r.length;s++)r[s].remove()}const i=this._document.createElement("div");i.classList.add(t),OE()?i.setAttribute("platform","test"):this._platform.isBrowser||i.setAttribute("platform","server"),this._document.body.appendChild(i),this._containerElement=i}}return n.\u0275fac=function(t){return new(t||n)(nt(ji),nt(Qc))},n.\u0275prov=lt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class dG{constructor(e,t,i,r,s,a,u,f,g,E=!1){this._portalOutlet=e,this._host=t,this._pane=i,this._config=r,this._ngZone=s,this._keyboardDispatcher=a,this._document=u,this._location=f,this._outsideClickDispatcher=g,this._animationsDisabled=E,this._backdropElement=null,this._backdropClick=new Fi,this._attachments=new Fi,this._detachments=new Fi,this._locationChanges=Gt.EMPTY,this._backdropClickHandler=M=>this._backdropClick.next(M),this._backdropTransitionendHandler=M=>{this._disposeBackdrop(M.target)},this._keydownEvents=new Fi,this._outsidePointerEvents=new Fi,r.scrollStrategy&&(this._scrollStrategy=r.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=r.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(e){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const t=this._portalOutlet.attach(e);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(Lb(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof t?.onDestroy&&t.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),t}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const e=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),e}dispose(){const e=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,e&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(e){e!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=e,this.hasAttached()&&(e.attach(this),this.updatePosition()))}updateSize(e){this._config={...this._config,...e},this._updateElementSize()}setDirection(e){this._config={...this._config,direction:e},this._updateElementDirection()}addPanelClass(e){this._pane&&this._toggleClasses(this._pane,e,!0)}removePanelClass(e){this._pane&&this._toggleClasses(this._pane,e,!1)}getDirection(){const e=this._config.direction;return e?"string"==typeof e?e:e.value:"ltr"}updateScrollStrategy(e){e!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=e,this.hasAttached()&&(e.attach(this),e.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const e=this._pane.style;e.width=Bo(this._config.width),e.height=Bo(this._config.height),e.minWidth=Bo(this._config.minWidth),e.minHeight=Bo(this._config.minHeight),e.maxWidth=Bo(this._config.maxWidth),e.maxHeight=Bo(this._config.maxHeight)}_togglePointerEvents(e){this._pane.style.pointerEvents=e?"":"none"}_attachBackdrop(){const e="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(e)})}):this._backdropElement.classList.add(e)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const e=this._backdropElement;if(e){if(this._animationsDisabled)return void this._disposeBackdrop(e);e.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{e.addEventListener("transitionend",this._backdropTransitionendHandler)}),e.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(e)},500))}}_toggleClasses(e,t,i){const r=Rb(t||[]).filter(s=>!!s);r.length&&(i?e.classList.add(...r):e.classList.remove(...r))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const e=this._ngZone.onStable.pipe(_h(ti(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),e.unsubscribe())})})}_disposeScrollStrategy(){const e=this._scrollStrategy;e&&(e.disable(),e.detach&&e.detach())}_disposeBackdrop(e){e&&(e.removeEventListener("click",this._backdropClickHandler),e.removeEventListener("transitionend",this._backdropTransitionendHandler),e.remove(),this._backdropElement===e&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}const Kk="cdk-overlay-connected-position-bounding-box",fG=/([A-Za-z%]+)$/;class pG{constructor(e,t,i,r,s){this._viewportRuler=t,this._document=i,this._platform=r,this._overlayContainer=s,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new Fi,this._resizeSubscription=Gt.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(e)}get positions(){return this._preferredPositions}attach(e){this._validatePositions(),e.hostElement.classList.add(Kk),this._overlayRef=e,this._boundingBox=e.hostElement,this._pane=e.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const e=this._originRect,t=this._overlayRect,i=this._viewportRect,r=this._containerRect,s=[];let a;for(let u of this._preferredPositions){let f=this._getOriginPoint(e,r,u),g=this._getOverlayPoint(f,t,u),E=this._getOverlayFit(g,t,i,u);if(E.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(u,f);this._canFitWithFlexibleDimensions(E,g,i)?s.push({position:u,origin:f,overlayRect:t,boundingBoxRect:this._calculateBoundingBoxRect(f,u)}):(!a||a.overlayFit.visibleArea<E.visibleArea)&&(a={overlayFit:E,overlayPoint:g,originPoint:f,position:u,overlayRect:t})}if(s.length){let u=null,f=-1;for(const g of s){const E=g.boundingBoxRect.width*g.boundingBoxRect.height*(g.position.weight||1);E>f&&(f=E,u=g)}return this._isPushed=!1,void this._applyPosition(u.position,u.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(a.position,a.originPoint);this._applyPosition(a.position,a.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&$m(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(Kk),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const e=this._lastPosition;if(e){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const t=this._getOriginPoint(this._originRect,this._containerRect,e);this._applyPosition(e,t)}else this.apply()}withScrollableContainers(e){return this._scrollables=e,this}withPositions(e){return this._preferredPositions=e,-1===e.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(e){return this._viewportMargin=e,this}withFlexibleDimensions(e=!0){return this._hasFlexibleDimensions=e,this}withGrowAfterOpen(e=!0){return this._growAfterOpen=e,this}withPush(e=!0){return this._canPush=e,this}withLockedPosition(e=!0){return this._positionLocked=e,this}setOrigin(e){return this._origin=e,this}withDefaultOffsetX(e){return this._offsetX=e,this}withDefaultOffsetY(e){return this._offsetY=e,this}withTransformOriginOn(e){return this._transformOriginSelector=e,this}_getOriginPoint(e,t,i){let r,s;if("center"==i.originX)r=e.left+e.width/2;else{const a=this._isRtl()?e.right:e.left,u=this._isRtl()?e.left:e.right;r="start"==i.originX?a:u}return t.left<0&&(r-=t.left),s="center"==i.originY?e.top+e.height/2:"top"==i.originY?e.top:e.bottom,t.top<0&&(s-=t.top),{x:r,y:s}}_getOverlayPoint(e,t,i){let r,s;return r="center"==i.overlayX?-t.width/2:"start"===i.overlayX?this._isRtl()?-t.width:0:this._isRtl()?0:-t.width,s="center"==i.overlayY?-t.height/2:"top"==i.overlayY?0:-t.height,{x:e.x+r,y:e.y+s}}_getOverlayFit(e,t,i,r){const s=Qk(t);let{x:a,y:u}=e,f=this._getOffset(r,"x"),g=this._getOffset(r,"y");f&&(a+=f),g&&(u+=g);let R=0-u,F=u+s.height-i.height,V=this._subtractOverflows(s.width,0-a,a+s.width-i.width),G=this._subtractOverflows(s.height,R,F),K=V*G;return{visibleArea:K,isCompletelyWithinViewport:s.width*s.height===K,fitsInViewportVertically:G===s.height,fitsInViewportHorizontally:V==s.width}}_canFitWithFlexibleDimensions(e,t,i){if(this._hasFlexibleDimensions){const r=i.bottom-t.y,s=i.right-t.x,a=Jk(this._overlayRef.getConfig().minHeight),u=Jk(this._overlayRef.getConfig().minWidth),g=e.fitsInViewportHorizontally||null!=u&&u<=s;return(e.fitsInViewportVertically||null!=a&&a<=r)&&g}return!1}_pushOverlayOnScreen(e,t,i){if(this._previousPushAmount&&this._positionLocked)return{x:e.x+this._previousPushAmount.x,y:e.y+this._previousPushAmount.y};const r=Qk(t),s=this._viewportRect,a=Math.max(e.x+r.width-s.width,0),u=Math.max(e.y+r.height-s.height,0),f=Math.max(s.top-i.top-e.y,0),g=Math.max(s.left-i.left-e.x,0);let E=0,M=0;return E=r.width<=s.width?g||-a:e.x<this._viewportMargin?s.left-i.left-e.x:0,M=r.height<=s.height?f||-u:e.y<this._viewportMargin?s.top-i.top-e.y:0,this._previousPushAmount={x:E,y:M},{x:e.x+E,y:e.y+M}}_applyPosition(e,t){if(this._setTransformOrigin(e),this._setOverlayElementStyles(t,e),this._setBoundingBoxStyles(t,e),e.panelClass&&this._addPanelClasses(e.panelClass),this._lastPosition=e,this._positionChanges.observers.length){const i=this._getScrollVisibility(),r=new cG(e,i);this._positionChanges.next(r)}this._isInitialRender=!1}_setTransformOrigin(e){if(!this._transformOriginSelector)return;const t=this._boundingBox.querySelectorAll(this._transformOriginSelector);let i,r=e.overlayY;i="center"===e.overlayX?"center":this._isRtl()?"start"===e.overlayX?"right":"left":"start"===e.overlayX?"left":"right";for(let s=0;s<t.length;s++)t[s].style.transformOrigin=`${i} ${r}`}_calculateBoundingBoxRect(e,t){const i=this._viewportRect,r=this._isRtl();let s,a,u,E,M,R;if("top"===t.overlayY)a=e.y,s=i.height-a+this._viewportMargin;else if("bottom"===t.overlayY)u=i.height-e.y+2*this._viewportMargin,s=i.height-u+this._viewportMargin;else{const F=Math.min(i.bottom-e.y+i.top,e.y),V=this._lastBoundingBoxSize.height;s=2*F,a=e.y-F,s>V&&!this._isInitialRender&&!this._growAfterOpen&&(a=e.y-V/2)}if("end"===t.overlayX&&!r||"start"===t.overlayX&&r)R=i.width-e.x+this._viewportMargin,E=e.x-this._viewportMargin;else if("start"===t.overlayX&&!r||"end"===t.overlayX&&r)M=e.x,E=i.right-e.x;else{const F=Math.min(i.right-e.x+i.left,e.x),V=this._lastBoundingBoxSize.width;E=2*F,M=e.x-F,E>V&&!this._isInitialRender&&!this._growAfterOpen&&(M=e.x-V/2)}return{top:a,left:M,bottom:u,right:R,width:E,height:s}}_setBoundingBoxStyles(e,t){const i=this._calculateBoundingBoxRect(e,t);!this._isInitialRender&&!this._growAfterOpen&&(i.height=Math.min(i.height,this._lastBoundingBoxSize.height),i.width=Math.min(i.width,this._lastBoundingBoxSize.width));const r={};if(this._hasExactPosition())r.top=r.left="0",r.bottom=r.right=r.maxHeight=r.maxWidth="",r.width=r.height="100%";else{const s=this._overlayRef.getConfig().maxHeight,a=this._overlayRef.getConfig().maxWidth;r.height=Bo(i.height),r.top=Bo(i.top),r.bottom=Bo(i.bottom),r.width=Bo(i.width),r.left=Bo(i.left),r.right=Bo(i.right),r.alignItems="center"===t.overlayX?"center":"end"===t.overlayX?"flex-end":"flex-start",r.justifyContent="center"===t.overlayY?"center":"bottom"===t.overlayY?"flex-end":"flex-start",s&&(r.maxHeight=Bo(s)),a&&(r.maxWidth=Bo(a))}this._lastBoundingBoxSize=i,$m(this._boundingBox.style,r)}_resetBoundingBoxStyles(){$m(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){$m(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(e,t){const i={},r=this._hasExactPosition(),s=this._hasFlexibleDimensions,a=this._overlayRef.getConfig();if(r){const E=this._viewportRuler.getViewportScrollPosition();$m(i,this._getExactOverlayY(t,e,E)),$m(i,this._getExactOverlayX(t,e,E))}else i.position="static";let u="",f=this._getOffset(t,"x"),g=this._getOffset(t,"y");f&&(u+=`translateX(${f}px) `),g&&(u+=`translateY(${g}px)`),i.transform=u.trim(),a.maxHeight&&(r?i.maxHeight=Bo(a.maxHeight):s&&(i.maxHeight="")),a.maxWidth&&(r?i.maxWidth=Bo(a.maxWidth):s&&(i.maxWidth="")),$m(this._pane.style,i)}_getExactOverlayY(e,t,i){let r={top:"",bottom:""},s=this._getOverlayPoint(t,this._overlayRect,e);return this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,i)),"bottom"===e.overlayY?r.bottom=this._document.documentElement.clientHeight-(s.y+this._overlayRect.height)+"px":r.top=Bo(s.y),r}_getExactOverlayX(e,t,i){let a,r={left:"",right:""},s=this._getOverlayPoint(t,this._overlayRect,e);return this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,i)),a=this._isRtl()?"end"===e.overlayX?"left":"right":"end"===e.overlayX?"right":"left","right"===a?r.right=this._document.documentElement.clientWidth-(s.x+this._overlayRect.width)+"px":r.left=Bo(s.x),r}_getScrollVisibility(){const e=this._getOriginRect(),t=this._pane.getBoundingClientRect(),i=this._scrollables.map(r=>r.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:Zk(e,i),isOriginOutsideView:TT(e,i),isOverlayClipped:Zk(t,i),isOverlayOutsideView:TT(t,i)}}_subtractOverflows(e,...t){return t.reduce((i,r)=>i-Math.max(r,0),e)}_getNarrowedViewportRect(){const e=this._document.documentElement.clientWidth,t=this._document.documentElement.clientHeight,i=this._viewportRuler.getViewportScrollPosition();return{top:i.top+this._viewportMargin,left:i.left+this._viewportMargin,right:i.left+e-this._viewportMargin,bottom:i.top+t-this._viewportMargin,width:e-2*this._viewportMargin,height:t-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(e,t){return"x"===t?e.offsetX??this._offsetX:e.offsetY??this._offsetY}_validatePositions(){}_addPanelClasses(e){this._pane&&Rb(e).forEach(t=>{""!==t&&-1===this._appliedPanelClasses.indexOf(t)&&(this._appliedPanelClasses.push(t),this._pane.classList.add(t))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(e=>{this._pane.classList.remove(e)}),this._appliedPanelClasses=[])}_getOriginRect(){const e=this._origin;if(e instanceof us)return e.nativeElement.getBoundingClientRect();if(e instanceof Element)return e.getBoundingClientRect();const t=e.width||0,i=e.height||0;return{top:e.y,bottom:e.y+i,left:e.x,right:e.x+t,height:i,width:t}}}function $m(n,e){for(let t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n}function Jk(n){if("number"!=typeof n&&null!=n){const[e,t]=n.split(fG);return t&&"px"!==t?null:parseFloat(e)}return n||null}function Qk(n){return{top:Math.floor(n.top),right:Math.floor(n.right),bottom:Math.floor(n.bottom),left:Math.floor(n.left),width:Math.floor(n.width),height:Math.floor(n.height)}}const eR="cdk-global-overlay-wrapper";class mG{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(e){const t=e.getConfig();this._overlayRef=e,this._width&&!t.width&&e.updateSize({width:this._width}),this._height&&!t.height&&e.updateSize({height:this._height}),e.hostElement.classList.add(eR),this._isDisposed=!1}top(e=""){return this._bottomOffset="",this._topOffset=e,this._alignItems="flex-start",this}left(e=""){return this._xOffset=e,this._xPosition="left",this}bottom(e=""){return this._topOffset="",this._bottomOffset=e,this._alignItems="flex-end",this}right(e=""){return this._xOffset=e,this._xPosition="right",this}start(e=""){return this._xOffset=e,this._xPosition="start",this}end(e=""){return this._xOffset=e,this._xPosition="end",this}width(e=""){return this._overlayRef?this._overlayRef.updateSize({width:e}):this._width=e,this}height(e=""){return this._overlayRef?this._overlayRef.updateSize({height:e}):this._height=e,this}centerHorizontally(e=""){return this.left(e),this._xPosition="center",this}centerVertically(e=""){return this.top(e),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const e=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement.style,i=this._overlayRef.getConfig(),{width:r,height:s,maxWidth:a,maxHeight:u}=i,f=!("100%"!==r&&"100vw"!==r||a&&"100%"!==a&&"100vw"!==a),g=!("100%"!==s&&"100vh"!==s||u&&"100%"!==u&&"100vh"!==u),E=this._xPosition,M=this._xOffset,R="rtl"===this._overlayRef.getConfig().direction;let F="",V="",G="";f?G="flex-start":"center"===E?(G="center",R?V=M:F=M):R?"left"===E||"end"===E?(G="flex-end",F=M):("right"===E||"start"===E)&&(G="flex-start",V=M):"left"===E||"start"===E?(G="flex-start",F=M):("right"===E||"end"===E)&&(G="flex-end",V=M),e.position=this._cssPosition,e.marginLeft=f?"0":F,e.marginTop=g?"0":this._topOffset,e.marginBottom=this._bottomOffset,e.marginRight=f?"0":V,t.justifyContent=G,t.alignItems=g?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const e=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement,i=t.style;t.classList.remove(eR),i.justifyContent=i.alignItems=e.marginTop=e.marginBottom=e.marginLeft=e.marginRight=e.position="",this._overlayRef=null,this._isDisposed=!0}}let gG=(()=>{class n{constructor(t,i,r,s){this._viewportRuler=t,this._document=i,this._platform=r,this._overlayContainer=s}global(){return new mG}flexibleConnectedTo(t){return new pG(t,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}return n.\u0275fac=function(t){return new(t||n)(nt(_T),nt(ji),nt(Qc),nt(Yk))},n.\u0275prov=lt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),_G=0,tx=(()=>{class n{constructor(t,i,r,s,a,u,f,g,E,M,R,F){this.scrollStrategies=t,this._overlayContainer=i,this._componentFactoryResolver=r,this._positionBuilder=s,this._keyboardDispatcher=a,this._injector=u,this._ngZone=f,this._document=g,this._directionality=E,this._location=M,this._outsideClickDispatcher=R,this._animationsModuleType=F}create(t){const i=this._createHostElement(),r=this._createPaneElement(i),s=this._createPortalOutlet(r),a=new lG(t);return a.direction=a.direction||this._directionality.value,new dG(s,i,r,a,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(t){const i=this._document.createElement("div");return i.id="cdk-overlay-"+_G++,i.classList.add("cdk-overlay-pane"),t.appendChild(i),i}_createHostElement(){const t=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(t),t}_createPortalOutlet(t){return this._appRef||(this._appRef=this._injector.get(rv)),new nG(t,this._componentFactoryResolver,this._appRef,this._injector,this._document)}}return n.\u0275fac=function(t){return new(t||n)(nt(aG),nt(Yk),nt(od),nt(gG),nt(uG),nt(Zc),nt(gr),nt(ji),nt($E),nt(YI),nt(hG),nt(_d,8))},n.\u0275prov=lt({token:n,factory:n.\u0275fac}),n})();const bG={provide:new Lt("cdk-connected-overlay-scroll-strategy"),deps:[tx],useFactory:function vG(n){return()=>n.scrollStrategies.reposition()}};let xG=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=un({type:n}),n.\u0275inj=xr({providers:[tx,bG],imports:[pv,iG,kk,kk]}),n})();class tR{}const Sf="*";function iR(n,e=null){return{type:2,steps:n,options:e}}function Mp(n){return{type:6,styles:n,offset:null}}function oR(n){Promise.resolve().then(n)}class Tv{constructor(e=0,t=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=e+t}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){oR(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(e){this._position=this.totalTime?e*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(i=>i()),t.length=0}}class aR{constructor(e){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=e;let t=0,i=0,r=0;const s=this.players.length;0==s?oR(()=>this._onFinish()):this.players.forEach(a=>{a.onDone(()=>{++t==s&&this._onFinish()}),a.onDestroy(()=>{++i==s&&this._onDestroy()}),a.onStart(()=>{++r==s&&this._onStart()})}),this.totalTime=this.players.reduce((a,u)=>Math.max(a,u.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this.players.forEach(e=>e.init())}onStart(e){this._onStartFns.push(e)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(e=>e()),this._onStartFns=[])}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(e=>e.play())}pause(){this.players.forEach(e=>e.pause())}restart(){this.players.forEach(e=>e.restart())}finish(){this._onFinish(),this.players.forEach(e=>e.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(e=>e.destroy()),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this.players.forEach(e=>e.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(e){const t=e*this.totalTime;this.players.forEach(i=>{const r=i.totalTime?Math.min(1,t/i.totalTime):1;i.setPosition(r)})}getPosition(){const e=this.players.reduce((t,i)=>null===t||i.totalTime>t.totalTime?i:t,null);return null!=e?e.getPosition():0}beforeDestroy(){this.players.forEach(e=>{e.beforeDestroy&&e.beforeDestroy()})}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(i=>i()),t.length=0}}const CG=["tooltip"],lR="tooltip-panel",cR=dv({passive:!0}),uR=new Lt("mat-tooltip-scroll-strategy"),DG={provide:uR,deps:[tx],useFactory:function AG(n){return()=>n.scrollStrategies.reposition({scrollThrottle:20})}},IG=new Lt("mat-tooltip-default-options",{providedIn:"root",factory:function PG(){return{showDelay:0,hideDelay:0,touchendHideDelay:1500}}});let kG=(()=>{class n{constructor(t,i,r,s,a,u,f,g,E,M,R,F){this._overlay=t,this._elementRef=i,this._scrollDispatcher=r,this._viewContainerRef=s,this._ngZone=a,this._platform=u,this._ariaDescriber=f,this._focusMonitor=g,this._dir=M,this._defaultOptions=R,this._position="below",this._disabled=!1,this._viewInitialized=!1,this._pointerExitEventsInitialized=!1,this._viewportMargin=8,this._cssClassPrefix="mat",this._showDelay=this._defaultOptions.showDelay,this._hideDelay=this._defaultOptions.hideDelay,this.touchGestures="auto",this._message="",this._passiveListeners=[],this._destroyed=new Fi,this._scrollStrategy=E,this._document=F,R&&(R.position&&(this.position=R.position),R.touchGestures&&(this.touchGestures=R.touchGestures)),M.change.pipe(_h(this._destroyed)).subscribe(()=>{this._overlayRef&&this._updatePosition(this._overlayRef)})}get position(){return this._position}set position(t){t!==this._position&&(this._position=t,this._overlayRef&&(this._updatePosition(this._overlayRef),this._tooltipInstance?.show(0),this._overlayRef.updatePosition()))}get disabled(){return this._disabled}set disabled(t){this._disabled=Tf(t),this._disabled?this.hide(0):this._setupPointerEnterEventsIfNeeded()}get showDelay(){return this._showDelay}set showDelay(t){this._showDelay=yh(t)}get hideDelay(){return this._hideDelay}set hideDelay(t){this._hideDelay=yh(t),this._tooltipInstance&&(this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay)}get message(){return this._message}set message(t){this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._message,"tooltip"),this._message=null!=t?String(t).trim():"",!this._message&&this._isTooltipVisible()?this.hide(0):(this._setupPointerEnterEventsIfNeeded(),this._updateTooltipMessage(),this._ngZone.runOutsideAngular(()=>{Promise.resolve().then(()=>{this._ariaDescriber.describe(this._elementRef.nativeElement,this.message,"tooltip")})}))}get tooltipClass(){return this._tooltipClass}set tooltipClass(t){this._tooltipClass=t,this._tooltipInstance&&this._setTooltipClass(this._tooltipClass)}ngAfterViewInit(){this._viewInitialized=!0,this._setupPointerEnterEventsIfNeeded(),this._focusMonitor.monitor(this._elementRef).pipe(_h(this._destroyed)).subscribe(t=>{t?"keyboard"===t&&this._ngZone.run(()=>this.show()):this._ngZone.run(()=>this.hide(0))})}ngOnDestroy(){const t=this._elementRef.nativeElement;clearTimeout(this._touchstartTimeout),this._overlayRef&&(this._overlayRef.dispose(),this._tooltipInstance=null),this._passiveListeners.forEach(([i,r])=>{t.removeEventListener(i,r,cR)}),this._passiveListeners.length=0,this._destroyed.next(),this._destroyed.complete(),this._ariaDescriber.removeDescription(t,this.message,"tooltip"),this._focusMonitor.stopMonitoring(t)}show(t=this.showDelay){if(this.disabled||!this.message||this._isTooltipVisible())return void this._tooltipInstance?._cancelPendingAnimations();const i=this._createOverlay();this._detach(),this._portal=this._portal||new Wk(this._tooltipComponent,this._viewContainerRef);const r=this._tooltipInstance=i.attach(this._portal).instance;r._triggerElement=this._elementRef.nativeElement,r._mouseLeaveHideDelay=this._hideDelay,r.afterHidden().pipe(_h(this._destroyed)).subscribe(()=>this._detach()),this._setTooltipClass(this._tooltipClass),this._updateTooltipMessage(),r.show(t)}hide(t=this.hideDelay){const i=this._tooltipInstance;i&&(i.isVisible()?i.hide(t):(i._cancelPendingAnimations(),this._detach()))}toggle(){this._isTooltipVisible()?this.hide():this.show()}_isTooltipVisible(){return!!this._tooltipInstance&&this._tooltipInstance.isVisible()}_createOverlay(){if(this._overlayRef)return this._overlayRef;const t=this._scrollDispatcher.getAncestorScrollContainers(this._elementRef),i=this._overlay.position().flexibleConnectedTo(this._elementRef).withTransformOriginOn(`.${this._cssClassPrefix}-tooltip`).withFlexibleDimensions(!1).withViewportMargin(this._viewportMargin).withScrollableContainers(t);return i.positionChanges.pipe(_h(this._destroyed)).subscribe(r=>{this._updateCurrentPositionClass(r.connectionPair),this._tooltipInstance&&r.scrollableViewProperties.isOverlayClipped&&this._tooltipInstance.isVisible()&&this._ngZone.run(()=>this.hide(0))}),this._overlayRef=this._overlay.create({direction:this._dir,positionStrategy:i,panelClass:`${this._cssClassPrefix}-${lR}`,scrollStrategy:this._scrollStrategy()}),this._updatePosition(this._overlayRef),this._overlayRef.detachments().pipe(_h(this._destroyed)).subscribe(()=>this._detach()),this._overlayRef.outsidePointerEvents().pipe(_h(this._destroyed)).subscribe(()=>this._tooltipInstance?._handleBodyInteraction()),this._overlayRef.keydownEvents().pipe(_h(this._destroyed)).subscribe(r=>{this._isTooltipVisible()&&27===r.keyCode&&!jP(r)&&(r.preventDefault(),r.stopPropagation(),this._ngZone.run(()=>this.hide(0)))}),this._defaultOptions?.disableTooltipInteractivity&&this._overlayRef.addPanelClass(`${this._cssClassPrefix}-tooltip-panel-non-interactive`),this._overlayRef}_detach(){this._overlayRef&&this._overlayRef.hasAttached()&&this._overlayRef.detach(),this._tooltipInstance=null}_updatePosition(t){const i=t.getConfig().positionStrategy,r=this._getOrigin(),s=this._getOverlayPosition();i.withPositions([this._addOffset({...r.main,...s.main}),this._addOffset({...r.fallback,...s.fallback})])}_addOffset(t){return t}_getOrigin(){const t=!this._dir||"ltr"==this._dir.value,i=this.position;let r;"above"==i||"below"==i?r={originX:"center",originY:"above"==i?"top":"bottom"}:"before"==i||"left"==i&&t||"right"==i&&!t?r={originX:"start",originY:"center"}:("after"==i||"right"==i&&t||"left"==i&&!t)&&(r={originX:"end",originY:"center"});const{x:s,y:a}=this._invertPosition(r.originX,r.originY);return{main:r,fallback:{originX:s,originY:a}}}_getOverlayPosition(){const t=!this._dir||"ltr"==this._dir.value,i=this.position;let r;"above"==i?r={overlayX:"center",overlayY:"bottom"}:"below"==i?r={overlayX:"center",overlayY:"top"}:"before"==i||"left"==i&&t||"right"==i&&!t?r={overlayX:"end",overlayY:"center"}:("after"==i||"right"==i&&t||"left"==i&&!t)&&(r={overlayX:"start",overlayY:"center"});const{x:s,y:a}=this._invertPosition(r.overlayX,r.overlayY);return{main:r,fallback:{overlayX:s,overlayY:a}}}_updateTooltipMessage(){this._tooltipInstance&&(this._tooltipInstance.message=this.message,this._tooltipInstance._markForCheck(),this._ngZone.onMicrotaskEmpty.pipe(Lb(1),_h(this._destroyed)).subscribe(()=>{this._tooltipInstance&&this._overlayRef.updatePosition()}))}_setTooltipClass(t){this._tooltipInstance&&(this._tooltipInstance.tooltipClass=t,this._tooltipInstance._markForCheck())}_invertPosition(t,i){return"above"===this.position||"below"===this.position?"top"===i?i="bottom":"bottom"===i&&(i="top"):"end"===t?t="start":"start"===t&&(t="end"),{x:t,y:i}}_updateCurrentPositionClass(t){const{overlayY:i,originX:r,originY:s}=t;let a;if(a="center"===i?this._dir&&"rtl"===this._dir.value?"end"===r?"left":"right":"start"===r?"left":"right":"bottom"===i&&"top"===s?"above":"below",a!==this._currentPosition){const u=this._overlayRef;if(u){const f=`${this._cssClassPrefix}-${lR}-`;u.removePanelClass(f+this._currentPosition),u.addPanelClass(f+a)}this._currentPosition=a}}_setupPointerEnterEventsIfNeeded(){this._disabled||!this.message||!this._viewInitialized||this._passiveListeners.length||(this._platformSupportsMouseEvents()?this._passiveListeners.push(["mouseenter",()=>{this._setupPointerExitEventsIfNeeded(),this.show()}]):"off"!==this.touchGestures&&(this._disableNativeGesturesIfNecessary(),this._passiveListeners.push(["touchstart",()=>{this._setupPointerExitEventsIfNeeded(),clearTimeout(this._touchstartTimeout),this._touchstartTimeout=setTimeout(()=>this.show(),500)}])),this._addListeners(this._passiveListeners))}_setupPointerExitEventsIfNeeded(){if(this._pointerExitEventsInitialized)return;this._pointerExitEventsInitialized=!0;const t=[];if(this._platformSupportsMouseEvents())t.push(["mouseleave",i=>{const r=i.relatedTarget;(!r||!this._overlayRef?.overlayElement.contains(r))&&this.hide()}],["wheel",i=>this._wheelListener(i)]);else if("off"!==this.touchGestures){this._disableNativeGesturesIfNecessary();const i=()=>{clearTimeout(this._touchstartTimeout),this.hide(this._defaultOptions.touchendHideDelay)};t.push(["touchend",i],["touchcancel",i])}this._addListeners(t),this._passiveListeners.push(...t)}_addListeners(t){t.forEach(([i,r])=>{this._elementRef.nativeElement.addEventListener(i,r,cR)})}_platformSupportsMouseEvents(){return!this._platform.IOS&&!this._platform.ANDROID}_wheelListener(t){if(this._isTooltipVisible()){const i=this._document.elementFromPoint(t.clientX,t.clientY),r=this._elementRef.nativeElement;i!==r&&!r.contains(i)&&this.hide()}}_disableNativeGesturesIfNecessary(){const t=this.touchGestures;if("off"!==t){const i=this._elementRef.nativeElement,r=i.style;("on"===t||"INPUT"!==i.nodeName&&"TEXTAREA"!==i.nodeName)&&(r.userSelect=r.msUserSelect=r.webkitUserSelect=r.MozUserSelect="none"),("on"===t||!i.draggable)&&(r.webkitUserDrag="none"),r.touchAction="none",r.webkitTapHighlightColor="transparent"}}}return n.\u0275fac=function(t){!function Kg(){throw new Error("invalid")}()},n.\u0275dir=Jt({type:n,inputs:{position:["matTooltipPosition","position"],disabled:["matTooltipDisabled","disabled"],showDelay:["matTooltipShowDelay","showDelay"],hideDelay:["matTooltipHideDelay","hideDelay"],touchGestures:["matTooltipTouchGestures","touchGestures"],message:["matTooltip","message"],tooltipClass:["matTooltipClass","tooltipClass"]}}),n})(),RG=(()=>{class n extends kG{constructor(t,i,r,s,a,u,f,g,E,M,R,F){super(t,i,r,s,a,u,f,g,E,M,R,F),this._tooltipComponent=OG}}return n.\u0275fac=function(t){return new(t||n)(Ye(tx),Ye(us),Ye(Pk),Ye(fh),Ye(gr),Ye(Qc),Ye(Q6),Ye(GE),Ye(uR),Ye($E,8),Ye(IG,8),Ye(ji))},n.\u0275dir=Jt({type:n,selectors:[["","matTooltip",""]],hostAttrs:[1,"mat-tooltip-trigger"],exportAs:["matTooltip"],features:[qi]}),n})(),LG=(()=>{class n{constructor(t,i){this._changeDetectorRef=t,this._closeOnInteraction=!1,this._isVisible=!1,this._onHide=new Fi,this._animationsDisabled="NoopAnimations"===i}show(t){clearTimeout(this._hideTimeoutId),this._showTimeoutId=setTimeout(()=>{this._toggleVisibility(!0),this._showTimeoutId=void 0},t)}hide(t){clearTimeout(this._showTimeoutId),this._hideTimeoutId=setTimeout(()=>{this._toggleVisibility(!1),this._hideTimeoutId=void 0},t)}afterHidden(){return this._onHide}isVisible(){return this._isVisible}ngOnDestroy(){this._cancelPendingAnimations(),this._onHide.complete(),this._triggerElement=null}_handleBodyInteraction(){this._closeOnInteraction&&this.hide(0)}_markForCheck(){this._changeDetectorRef.markForCheck()}_handleMouseLeave({relatedTarget:t}){(!t||!this._triggerElement.contains(t))&&(this.isVisible()?this.hide(this._mouseLeaveHideDelay):this._finalizeAnimation(!1))}_onShow(){}_handleAnimationEnd({animationName:t}){(t===this._showAnimation||t===this._hideAnimation)&&this._finalizeAnimation(t===this._showAnimation)}_cancelPendingAnimations(){clearTimeout(this._showTimeoutId),clearTimeout(this._hideTimeoutId),this._showTimeoutId=this._hideTimeoutId=void 0}_finalizeAnimation(t){t?this._closeOnInteraction=!0:this.isVisible()||this._onHide.next()}_toggleVisibility(t){const i=this._tooltip.nativeElement,r=this._showAnimation,s=this._hideAnimation;if(i.classList.remove(t?s:r),i.classList.add(t?r:s),this._isVisible=t,t&&!this._animationsDisabled&&"function"==typeof getComputedStyle){const a=getComputedStyle(i);("0s"===a.getPropertyValue("animation-duration")||"none"===a.getPropertyValue("animation-name"))&&(this._animationsDisabled=!0)}t&&this._onShow(),this._animationsDisabled&&(i.classList.add("_mat-animation-noopable"),this._finalizeAnimation(t))}}return n.\u0275fac=function(t){return new(t||n)(Ye(w_),Ye(_d,8))},n.\u0275dir=Jt({type:n}),n})(),OG=(()=>{class n extends LG{constructor(t,i,r){super(t,r),this._breakpointObserver=i,this._isHandset=this._breakpointObserver.observe("(max-width: 599.98px) and (orientation: portrait), (max-width: 959.98px) and (orientation: landscape)"),this._showAnimation="mat-tooltip-show",this._hideAnimation="mat-tooltip-hide"}}return n.\u0275fac=function(t){return new(t||n)(Ye(w_),Ye(XP),Ye(_d,8))},n.\u0275cmp=jt({type:n,selectors:[["mat-tooltip-component"]],viewQuery:function(t,i){if(1&t&&tv(CG,7),2&t){let r;ev(r=nv())&&(i._tooltip=r.first)}},hostAttrs:["aria-hidden","true"],hostVars:2,hostBindings:function(t,i){1&t&&Vs("mouseleave",function(s){return i._handleMouseLeave(s)}),2&t&&yp("zoom",i.isVisible()?1:null)},features:[qi],decls:4,vars:6,consts:[[1,"mat-tooltip",3,"ngClass","animationend"],["tooltip",""]],template:function(t,i){if(1&t&&(bn(0,"div",0,1),Vs("animationend",function(s){return i._handleAnimationEnd(s)}),Nm(2,"async"),Qi(3),jn()),2&t){let r;bc("mat-tooltip-handset",null==(r=Bm(2,4,i._isHandset))?null:r.matches),ps("ngClass",i.tooltipClass),Li(3),Om(i.message)}},dependencies:[oP,xE],styles:[".mat-tooltip{color:#fff;border-radius:4px;margin:14px;max-width:250px;padding-left:8px;padding-right:8px;overflow:hidden;text-overflow:ellipsis;transform:scale(0)}.mat-tooltip._mat-animation-noopable{animation:none;transform:scale(1)}.cdk-high-contrast-active .mat-tooltip{outline:solid 1px}.mat-tooltip-handset{margin:24px;padding-left:16px;padding-right:16px}.mat-tooltip-panel-non-interactive{pointer-events:none}@keyframes mat-tooltip-show{0%{opacity:0;transform:scale(0)}50%{opacity:.5;transform:scale(0.99)}100%{opacity:1;transform:scale(1)}}@keyframes mat-tooltip-hide{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(1)}}.mat-tooltip-show{animation:mat-tooltip-show 200ms cubic-bezier(0, 0, 0.2, 1) forwards}.mat-tooltip-hide{animation:mat-tooltip-hide 100ms cubic-bezier(0, 0, 0.2, 1) forwards}"],encapsulation:2,changeDetection:0}),n})(),FG=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=un({type:n}),n.\u0275inj=xr({providers:[DG],imports:[uj,Cb,xG,vl,vl,yT]}),n})();var NG=ns(943);function Y(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}let BG=1,zG=1;class hR{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:t=0,duration:i=Number.POSITIVE_INFINITY,rate:r=1,repeat:s=1}=e,a=BG++,u={time:0,delay:t,duration:i,rate:r,repeat:s};return this._setChannelTime(u,this.time),this.channels.set(a,u),a}removeChannel(e){this.channels.delete(e);for(const[t,i]of this.animations)i.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return void 0!==t&&this.time>=t.delay+t.duration*t.repeat}getTime(e){if(void 0===e)return this.time;const t=this.channels.get(e);return void 0===t?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const r of t)this._setChannelTime(r,this.time);const i=this.animations.values();for(const r of i){const{animation:s,channel:a}=r;s.setTime(this.getTime(a))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const i=zG++;return this.animations.set(i,{animation:e,channel:t}),e.setTime(this.getTime(t)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(-1===this.lastEngineTime&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const i=t-e.delay;i>=e.duration*e.repeat?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}const nx=Symbol.for("component"),D_=Symbol.for("asyncPropDefaults"),qm=Symbol.for("asyncPropOriginal"),Ap=Symbol.for("asyncPropResolved");function dR(n){if(typeof window<"u"&&"object"==typeof window.process&&"renderer"===window.process.type||typeof process<"u"&&"object"==typeof process.versions&&Boolean(process.versions.electron))return!0;const e="object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent,t=n||e;return!!(t&&t.indexOf("Electron")>=0)}function bd(){return!("object"==typeof process&&"[object process]"===String(process)&&!process.browser)||dR()}const fR=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";bd();class UG{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";Y(this,"storage",void 0),Y(this,"id",void 0),Y(this,"config",{}),this.storage=function VG(n){try{const e=window[n],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}(i),this.id=e,this.config={},Object.assign(this.config,t),this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){return this.config={},this.updateConfiguration(e)}updateConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}return this}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function ST(n,e,t){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600;const r=n.src.replace(/\(/g,"%28").replace(/\)/g,"%29");n.width>i&&(t=Math.min(t,i/n.width));const s=n.width*t,a=n.height*t,u=["font-size:1px;","padding:".concat(Math.floor(a/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(a,"px;"),"background:url(".concat(r,");"),"background-size:".concat(s,"px ").concat(a,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),u]}let ix;var n;function pR(n){return"string"==typeof n?ix[n.toUpperCase()]||ix.WHITE:n}function rx(n,e){if(!n)throw new Error(e||"Assertion failed")}(n=ix||(ix={}))[n.BLACK=30]="BLACK",n[n.RED=31]="RED",n[n.GREEN=32]="GREEN",n[n.YELLOW=33]="YELLOW",n[n.BLUE=34]="BLUE",n[n.MAGENTA=35]="MAGENTA",n[n.CYAN=36]="CYAN",n[n.WHITE=37]="WHITE",n[n.BRIGHT_BLACK=90]="BRIGHT_BLACK",n[n.BRIGHT_RED=91]="BRIGHT_RED",n[n.BRIGHT_GREEN=92]="BRIGHT_GREEN",n[n.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",n[n.BRIGHT_BLUE=94]="BRIGHT_BLUE",n[n.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",n[n.BRIGHT_CYAN=96]="BRIGHT_CYAN",n[n.BRIGHT_WHITE=97]="BRIGHT_WHITE";const Dp={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:"object"==typeof process&&process},sx=(globalThis,Dp.window||Dp.self||Dp.global),Cv=Dp.process||{};function I_(){let n;var e,t;if(bd&&"performance"in sx)n=null==sx||null===(e=sx.performance)||void 0===e||null===(t=e.now)||void 0===t?void 0:t.call(e);else if("hrtime"in Cv){var i;const r=null==Cv||null===(i=Cv.hrtime)||void 0===i?void 0:i.call(Cv);n=1e3*r[0]+r[1]/1e6}else n=Date.now();return n}console;var ZG=ns(249);const P_={debug:bd&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},XG={enabled:!0,level:0};function ku(){}const mR={},gR={once:!0};class Sv{constructor(){let{id:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:""};Y(this,"id",void 0),Y(this,"VERSION",fR),Y(this,"_startTs",I_()),Y(this,"_deltaTs",I_()),Y(this,"_storage",void 0),Y(this,"userData",{}),Y(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this._storage=new UG("__probe-".concat(this.id,"__"),XG),this.userData={},this.timeStamp("".concat(this.id," started")),function qG(n){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"];const t=Object.getPrototypeOf(n),i=Object.getOwnPropertyNames(t);for(const r of i)"function"==typeof n[r]&&(e.find(s=>r===s)||(n[r]=n[r].bind(n)))}(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((I_()-this._startTs).toPrecision(10))}getDelta(){return Number((I_()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){return this._storage.updateConfiguration({enabled:!(arguments.length>0&&void 0!==arguments[0])||arguments[0]}),this}setLevel(e){return this._storage.updateConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.updateConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){rx(e,t)}warn(e){return this._getLogFunction(0,e,P_.warn,arguments,gR)}error(e){return this._getLogFunction(0,e,P_.error,arguments)}deprecated(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}removed(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}probe(e,t){return this._getLogFunction(e,t,P_.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,P_.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){for(var i=arguments.length,r=new Array(i>2?i-2:0),s=2;s<i;s++)r[s-2]=arguments[s];return this._getLogFunction(e,t,P_.debug||P_.info,arguments,gR)}table(e,t,i){return t?this._getLogFunction(e,t,console.table||ku,i&&[i],{tag:QG(t)}):ku}image(e){let{logLevel:t,priority:i,image:r,message:s="",scale:a=1}=e;return this._shouldLog(t||i)?bd?function JG(n){let{image:e,message:t="",scale:i=1}=n;if("string"==typeof e){const s=new Image;return s.onload=()=>{const a=ST(s,t,i);console.log(...a)},s.src=e,ku}const r=e.nodeName||"";if("img"===r.toLowerCase())return console.log(...ST(e,t,i)),ku;if("canvas"===r.toLowerCase()){const s=new Image;return s.onload=()=>console.log(...ST(s,t,i)),s.src=e.toDataURL(),ku}return ku}({image:r,message:s,scale:a}):function KG(n){let{image:e,message:t="",scale:i=1}=n;return ZG.nodeAsciifyImage({image:e,message:t,scale:i}),ku}({image:r,message:s,scale:a}):ku}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||ku)}group(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1};const r=yR({logLevel:e,message:t,opts:i}),{collapsed:s}=i;return r.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(e,t){return this.group(e,t,Object.assign({},arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||ku)}withGroup(e,t,i){this.group(e,t)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=_R(e)}_getLogFunction(e,t,i,r,s){if(this._shouldLog(e)){s=yR({logLevel:e,message:t,args:r,opts:s}),rx(i=i||s.method),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=I_();const a=s.tag||s.message;if(s.once){if(mR[a])return ku;mR[a]=I_()}return t=function YG(n,e,t){if("string"==typeof e){const i=t.time?function HG(n){const t=Math.max((arguments.length>1&&void 0!==arguments[1]?arguments[1]:8)-n.length,0);return"".concat(" ".repeat(t)).concat(n)}(function jG(n){let e;return e=n<10?"".concat(n.toFixed(2),"ms"):n<100?"".concat(n.toFixed(1),"ms"):n<1e3?"".concat(n.toFixed(0),"ms"):"".concat((n/1e3).toFixed(2),"s"),e}(t.total)):"";e=t.time?"".concat(n,": ").concat(i,"  ").concat(e):"".concat(n,": ").concat(e),e=function $G(n,e,t){return!bd&&"string"==typeof n&&(e&&(e=pR(e),n="\x1b[".concat(e,"m").concat(n,"\x1b[39m")),t&&(e=pR(t),n="\x1b[".concat(t+10,"m").concat(n,"\x1b[49m"))),n}(e,t.color,t.background)}return e}(this.id,s.message,s),i.bind(console,t,...s.args)}return ku}}function _R(n){if(!n)return 0;let e;switch(typeof n){case"number":e=n;break;case"object":e=n.logLevel||n.priority||0;break;default:return 0}return rx(Number.isFinite(e)&&e>=0),e}function yR(n){const{logLevel:e,message:t}=n;n.logLevel=_R(e);const i=n.args?Array.from(n.args):[];for(;i.length&&i.shift()!==t;);switch(typeof e){case"string":case"function":void 0!==t&&i.unshift(t),n.message=e;break;case"object":Object.assign(n,e)}"function"==typeof n.message&&(n.message=n.message());const r=typeof n.message;return rx("string"===r||"object"===r),Object.assign(n,{args:i},n.opts)}function QG(n){for(const e in n)for(const t in n[e])return t||"untitled";return"empty"}Y(Sv,"VERSION",fR);const ur=new Sv({id:"deck"});let MT={};function xl(n,e,t,i){ur.level>0&&MT[n]&&MT[n].call(null,e,t,i)}function k_(n,e=(()=>!0)){return Array.isArray(n)?vR(n,e,[]):e(n)?[n]:[]}function vR(n,e,t){let i=-1;for(;++i<n.length;){const r=n[i];Array.isArray(r)?vR(r,e,t):e(r)&&t.push(r)}return t}function tW({target:n,source:e,start:t=0,count:i=1}){const r=e.length,s=i*r;let a=0;for(let u=t;a<r;a++)n[u++]=e[a];for(;a<s;)a<s-a?(n.copyWithin(t+a,t,t+a),a*=2):(n.copyWithin(t+a,t,t+s-a),a=s);return n}function bR(){let n;if(typeof window<"u"&&window.performance)n=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();n=1e3*e[0]+e[1]/1e6}else n=Date.now();return n}class xR{constructor(e,t){Y(this,"name",void 0),Y(this,"type",void 0),Y(this,"sampleSize",1),Y(this,"time",void 0),Y(this,"count",void 0),Y(this,"samples",void 0),Y(this,"lastTiming",void 0),Y(this,"lastSampleTime",void 0),Y(this,"lastSampleCount",void 0),Y(this,"_count",0),Y(this,"_time",0),Y(this,"_samples",0),Y(this,"_startTime",0),Y(this,"_timerPending",!1),this.name=e,this.type=t,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=bR(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(bR()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class AT{constructor(e){Y(this,"id",void 0),Y(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){return this._getOrCreate({name:e,type:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"count"})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const t in this.stats)e(this.stats[t])}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach(t=>this._getOrCreate(t))}_getOrCreate(e){if(!e||!e.name)return null;const{name:t,type:i}=e;return this.stats[t]||(this.stats[t]=e instanceof xR?e:new xR(t,i)),this.stats[t]}}function wR(n,e,t,i,r,s,a){try{var u=n[s](a),f=u.value}catch(g){return void t(g)}u.done?e(f):Promise.resolve(f).then(i,r)}function As(n){return function(){var e=this,t=arguments;return new Promise(function(i,r){var s=n.apply(e,t);function a(f){wR(s,i,r,a,u,"next",f)}function u(f){wR(s,i,r,a,u,"throw",f)}a(void 0)})}}const bh=n=>"function"==typeof n,Ip=n=>null!==n&&"object"==typeof n,TR=n=>Ip(n)&&n.constructor==={}.constructor,nW=n=>n&&"function"==typeof n[Symbol.iterator],iW=n=>n&&"function"==typeof n[Symbol.asyncIterator],R_=n=>typeof Response<"u"&&n instanceof Response||n&&n.arrayBuffer&&n.text&&n.json,L_=n=>typeof Blob<"u"&&n instanceof Blob,CR=n=>(n=>typeof ReadableStream<"u"&&n instanceof ReadableStream||Ip(n)&&bh(n.tee)&&bh(n.cancel)&&bh(n.getReader))(n)||(n=>Ip(n)&&bh(n.read)&&bh(n.pipe)&&(n=>"boolean"==typeof n)(n.readable))(n);function ox(n,e){if(!n)throw new Error(e||"loader assertion failed.")}function DT(n){var e;return!!n&&(Array.isArray(n)&&(n=n[0]),Array.isArray(null===(e=n)||void 0===e?void 0:e.extensions))}function IT(n){var e,t;let i;return ox(n,"null loader"),ox(DT(n),"invalid loader"),Array.isArray(n)&&(i=n[1],n=n[0],n={...n,options:{...n.options,...i}}),(null!==(e=n)&&void 0!==e&&e.parseTextSync||null!==(t=n)&&void 0!==t&&t.parseText)&&(n.text=!0),n.text||(n.binary=!0),n}const kT={};function cW(n){for(const e in kT)n.startsWith(e)&&(n=n.replace(e,kT[e]));return!n.startsWith("http://")&&!n.startsWith("https://")&&(n="".concat("").concat(n)),n}const uW=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,hW=/^([-\w.]+\/[-\w.+]+)/;function dW(n){const e=hW.exec(n);return e?e[1]:n}function SR(n){const e=uW.exec(n);return e?e[1]:""}const fW=/\?.*/;function ax(n){if(R_(n)){const e=RT(n.url||"");return{url:e,type:dW(n.headers.get("content-type")||"")||SR(e)}}return L_(n)?{url:RT(n.name||""),type:n.type||""}:"string"==typeof n?{url:RT(n),type:SR(n)}:{url:"",type:""}}function pW(n){return R_(n)?n.headers["content-length"]||-1:L_(n)?n.size:"string"==typeof n?n.length:n instanceof ArrayBuffer||ArrayBuffer.isView(n)?n.byteLength:-1}function RT(n){return n.replace(fW,"")}function MR(n){return LT.apply(this,arguments)}function LT(){return LT=As(function*(n){if(R_(n))return n;const e={},t=pW(n);t>=0&&(e["content-length"]=String(t));const{url:i,type:r}=ax(n);r&&(e["content-type"]=r);const s=yield _W(n);s&&(e["x-first-bytes"]=s),"string"==typeof n&&(n=(new TextEncoder).encode(n));const a=new Response(n,{headers:e});return Object.defineProperty(a,"url",{value:i}),a}),LT.apply(this,arguments)}function mW(n){return OT.apply(this,arguments)}function OT(){return OT=As(function*(n){if(!n.ok){const e=yield gW(n);throw new Error(e)}}),OT.apply(this,arguments)}function gW(n){return FT.apply(this,arguments)}function FT(){return FT=As(function*(n){let e="Failed to fetch resource ".concat(n.url," (").concat(n.status,"): ");try{const t=n.headers.get("Content-Type");let i=n.statusText;t.includes("application/json")&&(i+=" ".concat(yield n.text())),e+=i,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}),FT.apply(this,arguments)}function _W(n){return NT.apply(this,arguments)}function NT(){return NT=As(function*(n){if("string"==typeof n)return"data:,".concat(n.slice(0,5));if(n instanceof Blob){const t=n.slice(0,5);return yield new Promise(i=>{const r=new FileReader;r.onload=s=>{var a;return i(null==s||null===(a=s.target)||void 0===a?void 0:a.result)},r.readAsDataURL(t)})}if(n instanceof ArrayBuffer){const i=yW(n.slice(0,5));return"data:base64,".concat(i)}return null}),NT.apply(this,arguments)}function yW(n){let e="";const t=new Uint8Array(n);for(let i=0;i<t.byteLength;i++)e+=String.fromCharCode(t[i]);return btoa(e)}function AR(n,e){return BT.apply(this,arguments)}function BT(){return BT=As(function*(n,e){if("string"==typeof n){n=cW(n);let t=e;return null!=e&&e.fetch&&"function"!=typeof e?.fetch&&(t=e.fetch),yield fetch(n,t)}return yield MR(n)}),BT.apply(this,arguments)}const DR=new Sv({id:"loaders.gl"});class vW{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}typeof self<"u"&&self,typeof window<"u"&&window,typeof global<"u"&&global,typeof document<"u"&&document;const zT=Boolean("object"!=typeof process||"[object process]"!==String(process)||process.browser),IR=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version),PR=(IR&&parseFloat(IR[1]),{fetch:null,mimeType:void 0,nothrow:!1,log:new class bW{constructor(){Y(this,"console",void 0),this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}},CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:zT,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]}),xW={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function VT(){globalThis.loaders=globalThis.loaders||{};const{loaders:n}=globalThis;return n._state=n._state||{},n._state}const UT=()=>{const n=VT();return n.globalOptions=n.globalOptions||{...PR},n.globalOptions};function wW(n,e,t,i){return t=t||[],function EW(n,e){RR(n,null,PR,xW,e);for(const t of e)RR(n&&n[t.id]||{},t.id,t.options&&t.options[t.id]||{},t.deprecatedOptions&&t.deprecatedOptions[t.id]||{},e)}(n,t=Array.isArray(t)?t:[t]),function LR(n,e,t){const r={...n.options||{}};return function CW(n,e){e&&!("baseUri"in n)&&(n.baseUri=e)}(r,t),null===r.log&&(r.log=new vW),OR(r,UT()),OR(r,e),r}(e,n,i)}function kR(n,e){const t=UT(),i=n||t;return"function"==typeof i.fetch?i.fetch:Ip(i.fetch)?r=>AR(r,i):null!=e&&e.fetch?e?.fetch:AR}function RR(n,e,t,i,r){const s=e||"Top level",a=e?"".concat(e,"."):"";for(const u in n){const f=!e&&Ip(n[u]),g="baseUri"===u&&!e,E="workerUrl"===u&&e;if(!(u in t)&&!g&&!E)if(u in i)DR.warn("".concat(s," loader option '").concat(a).concat(u,"' no longer supported, use '").concat(i[u],"'"))();else if(!f){const M=TW(u,r);DR.warn("".concat(s," loader option '").concat(a).concat(u,"' not recognized. ").concat(M))()}}}function TW(n,e){const t=n.toLowerCase();let i="";for(const r of e)for(const s in r.options){if(n===s)return"Did you mean '".concat(r.id,".").concat(s,"'?");const a=s.toLowerCase();(t.startsWith(a)||a.startsWith(t))&&(i=i||"Did you mean '".concat(r.id,".").concat(s,"'?"))}return i}function OR(n,e){for(const t in e)t in e&&(n[t]=TR(e[t])&&TR(n[t])?{...n[t],...e[t]}:e[t])}function Mf(n,e){if(!n)throw new Error(e||"loaders.gl assertion failed.")}function MW(n,e="3.2.9"){return Mf(n,"no worker provided"),!(!e||!n.version)}typeof self<"u"&&self,typeof window<"u"&&window,typeof global<"u"&&global,typeof document<"u"&&document;const lx="object"!=typeof process||"[object process]"!==String(process)||process.browser,AW=typeof window<"u"&&typeof window.orientation<"u",FR=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);FR&&parseFloat(FR[1]);class jT{}const HT=new Map;function NR(n){const e=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(e)}function BR(n,e=!0,t){const i=t||new Set;if(n)if(zR(n))i.add(n);else if(zR(n.buffer))i.add(n.buffer);else if(!ArrayBuffer.isView(n)&&e&&"object"==typeof n)for(const r in n)BR(n[r],e,i);return void 0===t?Array.from(i):[]}function zR(n){return!!n&&(n instanceof ArrayBuffer||typeof MessagePort<"u"&&n instanceof MessagePort||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas)}const GT=()=>{};class WT{static isSupported(){return typeof Worker<"u"&&lx||typeof jT<"u"&&!lx}constructor(e){Y(this,"name",void 0),Y(this,"source",void 0),Y(this,"url",void 0),Y(this,"terminated",!1),Y(this,"worker",void 0),Y(this,"onMessage",void 0),Y(this,"onError",void 0),Y(this,"_loadableURL","");const{name:t,source:i,url:r}=e;Mf(i||r),this.name=t,this.source=i,this.url=r,this.onMessage=GT,this.onError=s=>console.log(s),this.worker=lx?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=GT,this.onError=GT,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,t){t=t||BR(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(t+="".concat(e.message," in ")),e.lineno&&(t+=":".concat(e.lineno,":").concat(e.colno)),new Error(t)}_createBrowserWorker(){this._loadableURL=function DW(n){Mf(n.source&&!n.url||!n.source&&n.url);let e=HT.get(n.source||n.url);return e||(n.url&&(e=function IW(n){return n.startsWith("http")?NR(function PW(n){return"try {\n  importScripts('".concat(n,"');\n} catch (error) {\n  console.error(error);\n  throw error;\n}")}(n)):n}(n.url),HT.set(n.url,e)),n.source&&(e=NR(n.source),HT.set(n.source,e))),Mf(e),e}({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new jT(i,{eval:!1})}else{if(!this.source)throw new Error("no worker");e=new jT(this.source,{eval:!0})}return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class RW{constructor(e,t){Y(this,"name",void 0),Y(this,"workerThread",void 0),Y(this,"isRunning",!0),Y(this,"result",void 0),Y(this,"_resolve",()=>{}),Y(this,"_reject",()=>{}),this.name=e,this.workerThread=t,this.result=new Promise((i,r)=>{this._resolve=i,this._reject=r})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){Mf(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Mf(this.isRunning),this.isRunning=!1,this._reject(e)}}class LW{static isSupported(){return WT.isSupported()}constructor(e){Y(this,"name","unnamed"),Y(this,"source",void 0),Y(this,"url",void 0),Y(this,"maxConcurrency",1),Y(this,"maxMobileConcurrency",1),Y(this,"onDebug",()=>{}),Y(this,"reuseWorkers",!0),Y(this,"props",{}),Y(this,"jobQueue",[]),Y(this,"idleQueue",[]),Y(this,"count",0),Y(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)}startJob(e,t=((r,s,a)=>r.done(a)),i=((r,s)=>r.error(s))){var r=this;return As(function*(){const s=new Promise(a=>(r.jobQueue.push({name:e,onMessage:t,onError:i,onStart:a}),r));return r._startQueuedJob(),yield s})()}_startQueuedJob(){var e=this;return As(function*(){if(!e.jobQueue.length)return;const t=e._getAvailableWorker();if(!t)return;const i=e.jobQueue.shift();if(i){e.onDebug({message:"Starting job",name:i.name,workerThread:t,backlog:e.jobQueue.length});const r=new RW(i.name,t);t.onMessage=s=>i.onMessage(r,s.type,s.payload),t.onError=s=>i.onError(r,s),i.onStart(r);try{yield r.result}finally{e.returnWorkerToQueue(t)}}})()}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new WT({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return AW?this.maxMobileConcurrency:this.maxConcurrency}}const OW={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Af{static isSupported(){return WT.isSupported()}static getWorkerFarm(e={}){return Af._workerFarm=Af._workerFarm||new Af({}),Af._workerFarm.setProps(e),Af._workerFarm}constructor(e){Y(this,"props",void 0),Y(this,"workerPools",new Map),this.props={...OW},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:i,url:r}=e;let s=this.workerPools.get(t);return s||(s=new LW({name:t,source:i,url:r}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}function NW(n,e={}){const t=e[n.id]||{},i="".concat(n.id,"-worker.js");let r=t.workerUrl;if(!r&&"compression"===n.id&&(r=e.workerUrl),"test"===e._workerType&&(r="modules/".concat(n.module,"/dist/").concat(i)),!r){let s=n.version;"latest"===s&&(s="latest");const a=s?"@".concat(s):"";r="https://unpkg.com/@loaders.gl/".concat(n.module).concat(a,"/dist/").concat(i)}return Mf(r),r}function BW(n,e){return!(!Af.isSupported()||!(lx||null!=e&&e._nodeWorkers))&&n.worker&&e?.worker}function zW(n,e,t,i,r){return $T.apply(this,arguments)}function $T(){return $T=As(function*(n,e,t,i,r){const s=n.id,a=NW(n,t),f=Af.getWorkerFarm(t).getWorkerPool({name:s,url:a});t=JSON.parse(JSON.stringify(t)),i=JSON.parse(JSON.stringify(i||{}));const g=yield f.startJob("process-on-worker",VW.bind(null,r));return g.postMessage("process",{input:e,options:t,context:i}),yield(yield g.result).result}),$T.apply(this,arguments)}function VW(n,e,t,i){return qT.apply(this,arguments)}function qT(){return qT=As(function*(n,e,t,i){switch(t){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:r,input:s,options:a}=i;try{const u=yield n(s,a);e.postMessage("done",{id:r,result:u})}catch(u){const f=u instanceof Error?u.message:"unknown error";e.postMessage("error",{id:r,error:f})}break;default:console.warn("parse-with-worker unknown message ".concat(t))}}),qT.apply(this,arguments)}function ZT(n){var e,t,i,r=2;for(typeof Symbol<"u"&&(t=Symbol.asyncIterator,i=Symbol.iterator);r--;){if(t&&null!=(e=n[t]))return e.call(n);if(i&&null!=(e=n[i]))return new cx(e.call(n));t="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function cx(n){function e(t){if(Object(t)!==t)return Promise.reject(new TypeError(t+" is not an object."));var i=t.done;return Promise.resolve(t.value).then(function(r){return{value:r,done:i}})}return(cx=function(i){this.s=i,this.n=i.next}).prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(i){var r=this.s.return;return void 0===r?Promise.resolve({value:i,done:!0}):e(r.apply(this.s,arguments))},throw:function(i){var r=this.s.return;return void 0===r?Promise.reject(i):e(r.apply(this.s,arguments))}},new cx(n)}function UR(n){return n&&"object"==typeof n&&n.isBuffer}function jR(n){if(UR(n))return function UW(n){return UR(n)?new Uint8Array(n.buffer,n.byteOffset,n.length).slice().buffer:n}(n);if(n instanceof ArrayBuffer)return n;if(ArrayBuffer.isView(n))return 0===n.byteOffset&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength);if("string"==typeof n){const e=n;return(new TextEncoder).encode(e).buffer}if(n&&"object"==typeof n&&n._toArrayBuffer)return n._toArrayBuffer();throw new Error("toArrayBuffer")}function HW(...n){const e=n.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),t=e.reduce((s,a)=>s+a.byteLength,0),i=new Uint8Array(t);let r=0;for(const s of e)i.set(s,r),r+=s.byteLength;return i.buffer}function GW(n){return YT.apply(this,arguments)}function YT(){return YT=As(function*(n){const e=[];var r,t=!1,i=!1;try{for(var a,s=ZT(n);t=!(a=yield s.next()).done;t=!1)e.push(a.value)}catch(u){i=!0,r=u}finally{try{t&&null!=s.return&&(yield s.return())}finally{if(i)throw r}}return HW(...e)}),YT.apply(this,arguments)}Y(Af,"_workerFarm",void 0),ns(521);const qW=262144;function HR(n){this.wrapped=n}function ux(n){return new HR(n)}function Mv(n){var e,t;function r(a,u){try{var f=n[a](u),g=f.value,E=g instanceof HR;Promise.resolve(E?g.wrapped:g).then(function(M){E?r("return"===a?"return":"next",M):s(f.done?"return":"normal",M)},function(M){r("throw",M)})}catch(M){s("throw",M)}}function s(a,u){switch(a){case"return":e.resolve({value:u,done:!0});break;case"throw":e.reject(u);break;default:e.resolve({value:u,done:!1})}(e=e.next)?r(e.key,e.arg):t=null}this._invoke=function i(a,u){return new Promise(function(f,g){var E={key:a,arg:u,resolve:f,reject:g,next:null};t?t=t.next=E:(e=t=E,r(a,u))})},"function"!=typeof n.return&&(this.return=void 0)}function JT(n){return function(){return new Mv(n.apply(this,arguments))}}function QT(){return QT=JT(function*(n,e){const t=e?.chunkSize||1048576;let i=0;for(;i<n.size;){const r=i+t,s=yield ux(n.slice(i,r).arrayBuffer());i=r,yield s}}),QT.apply(this,arguments)}function GR(n,e){return zT?function KW(n,e){return eC.apply(this,arguments)}(n,e):function JW(n,e){return tC.apply(this,arguments)}(n,e)}function eC(){return eC=JT(function*(n,e){const t=n.getReader();let i;try{for(;;){const r=i||t.read();null!=e&&e._streamReadAhead&&(i=t.read());const{done:s,value:a}=yield ux(r);if(s)return;yield jR(a)}}catch{t.releaseLock()}}),eC.apply(this,arguments)}function tC(){return tC=JT(function*(n,e){var r,t=!1,i=!1;try{for(var a,s=ZT(n);t=!(a=yield ux(s.next())).done;t=!1){const u=a.value;yield jR(u)}}catch(u){i=!0,r=u}finally{try{t&&null!=s.return&&(yield ux(s.return()))}finally{if(i)throw r}}}),tC.apply(this,arguments)}function QW(n,e){if("string"==typeof n)return function*$W(n,e){const t=e?.chunkSize||262144;let i=0;const r=new TextEncoder;for(;i<n.length;){const s=Math.min(n.length-i,t),a=n.slice(i,i+s);i+=s,yield r.encode(a)}}(n,e);if(n instanceof ArrayBuffer)return function*ZW(n,e={}){const{chunkSize:t=qW}=e;let i=0;for(;i<n.byteLength;){const r=Math.min(n.byteLength-i,t),s=new ArrayBuffer(r),a=new Uint8Array(n,i,r);new Uint8Array(s).set(a),i+=r,yield s}}(n,e);if(L_(n))return function YW(n,e){return QT.apply(this,arguments)}(n,e);if(CR(n))return GR(n,e);if(R_(n))return GR(n.body,e);throw new Error("makeIterator")}Mv.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},Mv.prototype.next=function(n){return this._invoke("next",n)},Mv.prototype.throw=function(n){return this._invoke("throw",n)},Mv.prototype.return=function(n){return this._invoke("return",n)};const nC="Cannot convert supplied data type";function e$(n,e,t){if(e.text&&"string"==typeof n)return n;if((n=>n&&"object"==typeof n&&n.isBuffer)(n)&&(n=n.buffer),n instanceof ArrayBuffer){const i=n;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(n)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(n);let i=n.buffer;const r=n.byteLength||n.length;return(0!==n.byteOffset||r!==i.byteLength)&&(i=i.slice(n.byteOffset,n.byteOffset+r)),i}throw new Error(nC)}function t$(n,e,t){return iC.apply(this,arguments)}function iC(){return iC=As(function*(n,e,t){const i=n instanceof ArrayBuffer||ArrayBuffer.isView(n);if("string"==typeof n||i)return e$(n,e);if(L_(n)&&(n=yield MR(n)),R_(n)){const r=n;return yield mW(r),e.binary?yield r.arrayBuffer():yield r.text()}if(CR(n)&&(n=QW(n,t)),nW(n)||iW(n))return GW(n);throw new Error(nC)}),iC.apply(this,arguments)}function i$(n,e,t=null){if(t)return t;const i={fetch:kR(e,n),...n};return Array.isArray(i.loaders)||(i.loaders=null),i}function r$(n,e){if(!e&&n&&!Array.isArray(n))return n;let t;if(n&&(t=Array.isArray(n)?n:[n]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...i]:i}return t&&t.length?t:null}const o$=new Sv({id:"loaders.gl"}),WR=()=>{const n=VT();return n.loaderRegistry=n.loaderRegistry||[],n.loaderRegistry},c$=/\.([^.]+)$/;function u$(n){return oC.apply(this,arguments)}function oC(){return oC=As(function*(n,e=[],t,i){if(!qR(n))return null;let r=$R(n,e,{...t,nothrow:!0},i);if(r)return r;if(L_(n)&&(r=$R(n=yield n.slice(0,10).arrayBuffer(),e,t,i)),!(r||null!=t&&t.nothrow))throw new Error(ZR(n));return r}),oC.apply(this,arguments)}function $R(n,e=[],t,i){if(!qR(n))return null;if(e&&!Array.isArray(e))return IT(e);let r=[];e&&(r=r.concat(e)),null!=t&&t.ignoreRegisteredLoaders||r.push(...function l$(){return WR()}()),function d$(n){for(const e of n)IT(e)}(r);const s=function h$(n,e,t,i){const{url:r,type:s}=ax(n),a=r||i?.url;let u=null,f="";var g;return null!=t&&t.mimeType&&(u=aC(e,t?.mimeType),f="match forced by supplied MIME type ".concat(t?.mimeType)),u=u||function f$(n,e){const t=e&&c$.exec(e),i=t&&t[1];return i?function p$(n,e){e=e.toLowerCase();for(const t of n)for(const i of t.extensions)if(i.toLowerCase()===e)return t;return null}(n,i):null}(e,a),f=f||(u?"matched url ".concat(a):""),u=u||aC(e,s),f=f||(u?"matched MIME type ".concat(s):""),u=u||function m$(n,e){if(!e)return null;for(const t of n)if("string"==typeof e){if(g$(e,t))return t}else if(ArrayBuffer.isView(e)){if(XR(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&XR(e,0,t))return t;return null}(e,n),f=f||(u?"matched initial data ".concat(YR(n)):""),u=u||aC(e,t?.fallbackMimeType),f=f||(u?"matched fallback MIME type ".concat(s):""),f&&o$.log(1,"selectLoader selected ".concat(null===(g=u)||void 0===g?void 0:g.name,": ").concat(f,".")),u}(n,r,t,i);if(!(s||null!=t&&t.nothrow))throw new Error(ZR(n));return s}function qR(n){return!(n instanceof Response&&204===n.status)}function ZR(n){const{url:e,type:t}=ax(n);let i="No valid loader found (";i+=e?"".concat(function s$(n){const e=n&&n.lastIndexOf("/");return e>=0?n.substr(e+1):""}(e),", "):"no url provided, ",i+="MIME type: ".concat(t?'"'.concat(t,'"'):"not provided",", ");const r=n?YR(n):"";return i+=r?' first bytes: "'.concat(r,'"'):"first bytes: not available",i+=")",i}function aC(n,e){for(const t of n)if(t.mimeTypes&&t.mimeTypes.includes(e)||e==="application/x.".concat(t.id))return t;return null}function g$(n,e){return e.testText?e.testText(n):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>n.startsWith(i))}function XR(n,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(r=>function _$(n,e,t,i){if(i instanceof ArrayBuffer)return function jW(n,e,t){if(n.byteLength<(t=t||n.byteLength)||e.byteLength<t)return!1;const i=new Uint8Array(n),r=new Uint8Array(e);for(let s=0;s<i.length;++s)if(i[s]!==r[s])return!1;return!0}(i,n,i.byteLength);switch(typeof i){case"function":return i(n,t);case"string":return i===lC(n,e,i.length);default:return!1}}(n,e,t,r))}function YR(n,e=5){return"string"==typeof n?n.slice(0,e):ArrayBuffer.isView(n)?lC(n.buffer,n.byteOffset,e):n instanceof ArrayBuffer?lC(n,0,e):""}function lC(n,e,t){if(n.byteLength<e+t)return"";const i=new DataView(n);let r="";for(let s=0;s<t;s++)r+=String.fromCharCode(i.getUint8(e+s));return r}function cC(n,e,t,i){return uC.apply(this,arguments)}function uC(){return uC=As(function*(n,e,t,i){Mf(!i||"object"==typeof i),e&&!Array.isArray(e)&&!DT(e)&&(i=void 0,t=e,e=void 0),n=yield n,t=t||{};const{url:r}=ax(n),a=r$(e,i),u=yield u$(n,a,t);return u?(i=i$({url:r,parse:cC,loaders:a},t=wW(t,u,a,r),i),yield y$(u,n,t,i)):null}),uC.apply(this,arguments)}function y$(n,e,t,i){return hC.apply(this,arguments)}function hC(){return hC=As(function*(n,e,t,i){if(MW(n),R_(e)){const r=e,{ok:s,redirected:a,status:u,statusText:f,type:g,url:E}=r,M=Object.fromEntries(r.headers.entries());i.response={headers:M,ok:s,redirected:a,status:u,statusText:f,type:g,url:E}}if(e=yield t$(e,n,t),n.parseTextSync&&"string"==typeof e)return t.dataType="text",n.parseTextSync(e,t,i,n);if(BW(n,t))return yield zW(n,e,t,i,cC);if(n.parseText&&"string"==typeof e)return yield n.parseText(e,t,i,n);if(n.parse)return yield n.parse(e,t,i,n);throw Mf(!n.parseSync),new Error("".concat(n.id," loader - no parser found and worker is disabled"))}),hC.apply(this,arguments)}function hx(n,e,t,i){return dC.apply(this,arguments)}function dC(){return dC=As(function*(n,e,t,i){!Array.isArray(e)&&!DT(e)&&(t=e,e=void 0);const r=kR(t);let s=n;return"string"==typeof n&&(s=yield r(n)),L_(n)&&(s=yield r(n)),yield cC(s,e,t)}),dC.apply(this,arguments)}class v${constructor(e,t,i){Y(this,"id",void 0),Y(this,"context",void 0),Y(this,"isLoaded",void 0),Y(this,"persistent",void 0),Y(this,"_loadCount",0),Y(this,"_subscribers",new Set),Y(this,"_data",void 0),Y(this,"_loader",void 0),Y(this,"_error",void 0),Y(this,"_content",void 0),this.id=e,this.context=i,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const i=++this._loadCount;let r=e;"string"==typeof e&&(r=hx(e)),r instanceof Promise?(this.isLoaded=!1,this._loader=r.then(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class b${constructor({gl:e,protocol:t}){Y(this,"protocol",void 0),Y(this,"_context",void 0),Y(this,"_resources",void 0),Y(this,"_consumers",void 0),Y(this,"_pruneRequest",void 0),this.protocol=t||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return!!e.startsWith(this.protocol)||e in this._resources}add({resourceId:e,data:t,forceUpdate:i=!1,persistent:r=!0}){let s=this._resources[e];s?s.setData(t,i):(s=new v$(e,t,this._context),this._resources[e]=s),s.persistent=r}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const i in t){const r=t[i],s=this._resources[r.resourceId];s&&s.unsubscribe(r)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:i,requestId:r="default"}){const{_resources:s,protocol:a}=this;e.startsWith(a)&&(s[e=e.replace(a,"")]||this.add({resourceId:e,data:null,persistent:!1}));const u=s[e];if(this._track(i,r,u,t),u)return u.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,i,r){const s=this._consumers,a=s[e]=s[e]||{},u=a[t]||{},f=u.resourceId&&this._resources[u.resourceId];f&&(f.unsubscribe(u),this.prune()),i&&(a[t]=u,u.onChange=r,u.resourceId=i.id,i.subscribe(u))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const O_=new class x${constructor(e={}){Y(this,"_pool",[]),Y(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:i=1,type:r,padding:s=0,copy:a=!1,initialize:u=!1,maxCount:f}){const g=r||e&&e.constructor||Float32Array,E=t*i+s;if(ArrayBuffer.isView(e)){if(E<=e.length)return e;if(E*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new g(e.buffer,0,E)}let M=1/0;f&&(M=f*i+s);const R=this._allocate(g,E,u,M);return e&&a?R.set(e):u||R.fill(0,0,4),this._release(e),R}release(e){this._release(e)}_allocate(e,t,i,r){let s=Math.max(Math.ceil(t*this.opts.overAlloc),1);s>r&&(s=r);const a=this._pool,u=e.BYTES_PER_ELEMENT*s,f=a.findIndex(g=>g.byteLength>=u);if(f>=0){const g=new e(a.splice(f,1)[0],0,s);return i&&g.fill(0),g}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:i}=e,{byteLength:r}=i,s=t.findIndex(a=>a.byteLength>=r);s<0?t.push(i):(s>0||t.length<this.opts.poolSize)&&t.splice(s,0,i),t.length>this.opts.poolSize&&t.shift()}},sa=(Math,Math,{EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0});function T$(n,{precision:e=sa.precision}={}){return n=function A$(n){return Math.round(n/sa.EPSILON)*sa.EPSILON}(n),"".concat(parseFloat(n.toPrecision(e)))}function Pp(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}function $a(n,e,t){return function Df(n,e,t){if(Pp(n)){const i=n;t=t||function D$(n){return n.clone?n.clone():new Array(n.length)}(i);for(let r=0;r<t.length&&r<i.length;++r)t[r]=e(n[r],r,t);return t}return e(n)}(n,i=>Math.max(e,Math.min(t,i)))}function dx(n,e,t){return Pp(n)?n.map((i,r)=>dx(i,e[r],t)):t*e+(1-t)*n}function F_(n,e,t){const i=sa.EPSILON;t&&(sa.EPSILON=t);try{if(n===e)return!0;if(Pp(n)&&Pp(e)){if(n.length!==e.length)return!1;for(let r=0;r<n.length;++r)if(!F_(n[r],e[r]))return!1;return!0}return n&&n.equals?n.equals(e):e&&e.equals?e.equals(n):"number"==typeof n&&"number"==typeof e&&Math.abs(n-e)<=sa.EPSILON*Math.max(1,Math.abs(n),Math.abs(e))}finally{sa.EPSILON=i}}class KR extends(function I$(n){function e(){var t=Reflect.construct(n,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return e.prototype=Object.create(n.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n,e}(Array)){clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+t];return this.check()}toArray(e=[],t=0){for(let i=0;i<this.ELEMENTS;++i)e[t+i]=this[i];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Pp(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(sa)}formatString(e){let t="";for(let i=0;i<this.ELEMENTS;++i)t+=(i>0?", ":"")+T$(this[i],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(t,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!F_(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,i){if(void 0===i)return this.lerp(this,e,t);for(let r=0;r<this.ELEMENTS;++r){const s=e[r];this[r]=s+i*(t[r]-s)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),t[i]);return this.check()}add(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=t[i];return this.check()}subtract(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=t[i];return this.check()}scale(e){if("number"==typeof e)for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(sa.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),t);return this.check()}get elements(){return this}}function eu(n){if(!Number.isFinite(n))throw new Error("Invalid number ".concat(n));return n}function fC(n,e,t=""){if(sa.debug&&!function P$(n,e){if(n.length!==e)return!1;for(let t=0;t<n.length;++t)if(!Number.isFinite(n[t]))return!1;return!0}(n,e))throw new Error("math.gl: ".concat(t," some fields set to invalid numbers'"));return n}function QR(n,e){if(!n)throw new Error("math.gl assertion ".concat(e))}class k$ extends KR{get x(){return this[0]}set x(e){this[0]=eu(e)}get y(){return this[1]}set y(e){this[1]=eu(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let i=0;i<this.ELEMENTS;++i){const r=this[i]-e[i];t+=r*r}return eu(t)}dot(e){let t=0;for(let i=0;i<this.ELEMENTS;++i)t+=this[i]*e[i];return eu(t)}normalize(){const e=this.magnitude();if(0!==e)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=t[i];return this.check()}divide(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=t[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return QR(e>=0&&e<this.ELEMENTS,"index is out of range"),eu(this[e])}setComponent(e,t){return QR(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}var Av=1e-6,Zm=typeof Float32Array<"u"?Float32Array:Array;function eL(n,e,t){var i=e[0],r=e[1],s=e[2],a=t[3]*i+t[7]*r+t[11]*s+t[15];return n[0]=(t[0]*i+t[4]*r+t[8]*s+t[12])/(a=a||1),n[1]=(t[1]*i+t[5]*r+t[9]*s+t[13])/a,n[2]=(t[2]*i+t[6]*r+t[10]*s+t[14])/a,n}Math,Math,Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});function tL(n,e,t){const i=e[0],r=e[1],s=e[2],a=t[3]*i+t[7]*r+t[11]*s||1;return n[0]=(t[0]*i+t[4]*r+t[8]*s)/a,n[1]=(t[1]*i+t[5]*r+t[9]*s)/a,n[2]=(t[2]*i+t[6]*r+t[10]*s)/a,n}!function L$(){var n=new Zm(3);Zm!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0)}();const pC=[0,0,0];let fx;class Ed extends k${static get ZERO(){return fx||(fx=new Ed(0,0,0),Object.freeze(fx)),fx}constructor(e=0,t=0,i=0){super(-0,-0,-0),1===arguments.length&&Pp(e)?this.copy(e):(sa.debug&&(eu(e),eu(t),eu(i)),this[0]=e,this[1]=t,this[2]=i)}set(e,t,i){return this[0]=e,this[1]=t,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return sa.debug&&(eu(e.x),eu(e.y),eu(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=eu(e)}angle(e){return function G$(n,e){var t=n[0],i=n[1],r=n[2],s=e[0],a=e[1],u=e[2],E=Math.sqrt(t*t+i*i+r*r)*Math.sqrt(s*s+a*a+u*u),M=E&&function N$(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}(n,e)/E;return Math.acos(Math.min(Math.max(M,-1),1))}(this,e)}cross(e){return function B$(n,e,t){var i=e[0],r=e[1],s=e[2],a=t[0],u=t[1],f=t[2];n[0]=r*f-s*u,n[1]=s*a-i*f,n[2]=i*u-r*a}(this,this,e),this.check()}rotateX({radians:e,origin:t=pC}){return function U$(n,e,t,i){var r=[],s=[];r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],s[0]=r[0],s[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),s[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),n[0]=s[0]+t[0],n[1]=s[1]+t[1],n[2]=s[2]+t[2]}(this,this,t,e),this.check()}rotateY({radians:e,origin:t=pC}){return function j$(n,e,t,i){var r=[],s=[];r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],s[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),s[1]=r[1],s[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),n[0]=s[0]+t[0],n[1]=s[1]+t[1],n[2]=s[2]+t[2]}(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=pC}){return function H$(n,e,t,i){var r=[],s=[];r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],s[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),s[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),s[2]=r[2],n[0]=s[0]+t[0],n[1]=s[1]+t[1],n[2]=s[2]+t[2]}(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return eL(this,this,e),this.check()}transformAsVector(e){return tL(this,this,e),this.check()}transformByMatrix3(e){return function z$(n,e,t){var i=e[0],r=e[1],s=e[2];n[0]=i*t[0]+r*t[3]+s*t[6],n[1]=i*t[1]+r*t[4]+s*t[7],n[2]=i*t[2]+r*t[5]+s*t[8]}(this,this,e),this.check()}transformByMatrix2(e){return function q$(n,e,t){const i=e[0],r=e[1];n[0]=t[0]*i+t[2]*r,n[1]=t[1]*i+t[3]*r,n[2]=e[2]}(this,this,e),this.check()}transformByQuaternion(e){return function V$(n,e,t){var i=t[0],r=t[1],s=t[2],u=e[0],f=e[1],g=e[2],E=r*g-s*f,M=s*u-i*g,R=i*f-r*u,F=r*R-s*M,V=s*E-i*R,G=i*M-r*E,K=2*t[3];M*=K,R*=K,V*=2,G*=2,n[0]=u+(E*=K)+(F*=2),n[1]=f+M+V,n[2]=g+R+G}(this,this,e),this.check()}}const nL=new Ed;function N_(n,e,t,i){nL.set(n,e,t);const r=nL.len();return{distance:i/r,normal:new Ed(-n/r,-e/r,-t/r)}}function K$(n){return n-Math.fround(n)}let Iv;function mC(n,e){const{size:t=1,startIndex:i=0}=e,r=void 0!==e.endIndex?e.endIndex:n.length,s=(r-i)/t;Iv=O_.allocate(Iv,s,{type:Float32Array,size:2*t});let a=i,u=0;for(;a<r;){for(let f=0;f<t;f++){const g=n[a++];Iv[u+f]=g,Iv[u+f+t]=K$(g)}u+=2*t}return Iv.subarray(0,s*t*2)}class J$ extends KR{toString(){let e="[";if(sa.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let i=0;i<this.RANK;++i)e+=" ".concat(this[i*this.RANK+t])}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=" ".concat(this[t])}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,i){return this[t*this.RANK+e]=eu(i),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let r=0;r<this.RANK;++r)t[r]=this[i+r];return t}setColumn(e,t){const i=e*this.RANK;for(let r=0;r<this.RANK;++r)this[i+r]=t[r];return this}}function gC(n,e){var t=e[0],i=e[1],r=e[2],s=e[3],a=e[4],u=e[5],f=e[6],g=e[7],E=e[8],M=e[9],R=e[10],F=e[11],V=e[12],G=e[13],K=e[14],se=e[15],_e=t*u-i*a,de=t*f-r*a,Ie=t*g-s*a,qe=i*f-r*u,Qe=i*g-s*u,Ct=r*g-s*f,Xt=E*G-M*V,Ft=E*K-R*V,Ut=E*se-F*V,mn=M*K-R*G,Rn=M*se-F*G,gn=R*se-F*K,_i=_e*gn-de*Rn+Ie*mn+qe*Ut-Qe*Ft+Ct*Xt;return _i?(n[0]=(u*gn-f*Rn+g*mn)*(_i=1/_i),n[1]=(r*Rn-i*gn-s*mn)*_i,n[2]=(G*Ct-K*Qe+se*qe)*_i,n[3]=(R*Qe-M*Ct-F*qe)*_i,n[4]=(f*Ut-a*gn-g*Ft)*_i,n[5]=(t*gn-r*Ut+s*Ft)*_i,n[6]=(K*Ie-V*Ct-se*de)*_i,n[7]=(E*Ct-R*Ie+F*de)*_i,n[8]=(a*Rn-u*Ut+g*Xt)*_i,n[9]=(i*Ut-t*Rn-s*Xt)*_i,n[10]=(V*Qe-G*Ie+se*_e)*_i,n[11]=(M*Ie-E*Qe-F*_e)*_i,n[12]=(u*Ft-a*mn-f*Xt)*_i,n[13]=(t*mn-i*Ft+r*Xt)*_i,n[14]=(G*de-V*qe-K*_e)*_i,n[15]=(E*qe-M*de+R*_e)*_i,n):null}function Xm(n,e,t){var i=e[0],r=e[1],s=e[2],a=e[3],u=e[4],f=e[5],g=e[6],E=e[7],M=e[8],R=e[9],F=e[10],V=e[11],G=e[12],K=e[13],se=e[14],_e=e[15],de=t[0],Ie=t[1],qe=t[2],Qe=t[3];return n[0]=de*i+Ie*u+qe*M+Qe*G,n[1]=de*r+Ie*f+qe*R+Qe*K,n[2]=de*s+Ie*g+qe*F+Qe*se,n[3]=de*a+Ie*E+qe*V+Qe*_e,n[4]=(de=t[4])*i+(Ie=t[5])*u+(qe=t[6])*M+(Qe=t[7])*G,n[5]=de*r+Ie*f+qe*R+Qe*K,n[6]=de*s+Ie*g+qe*F+Qe*se,n[7]=de*a+Ie*E+qe*V+Qe*_e,n[8]=(de=t[8])*i+(Ie=t[9])*u+(qe=t[10])*M+(Qe=t[11])*G,n[9]=de*r+Ie*f+qe*R+Qe*K,n[10]=de*s+Ie*g+qe*F+Qe*se,n[11]=de*a+Ie*E+qe*V+Qe*_e,n[12]=(de=t[12])*i+(Ie=t[13])*u+(qe=t[14])*M+(Qe=t[15])*G,n[13]=de*r+Ie*f+qe*R+Qe*K,n[14]=de*s+Ie*g+qe*F+Qe*se,n[15]=de*a+Ie*E+qe*V+Qe*_e,n}function px(n,e,t){var a,u,f,g,E,M,R,F,V,G,K,se,i=t[0],r=t[1],s=t[2];return e===n?(n[12]=e[0]*i+e[4]*r+e[8]*s+e[12],n[13]=e[1]*i+e[5]*r+e[9]*s+e[13],n[14]=e[2]*i+e[6]*r+e[10]*s+e[14],n[15]=e[3]*i+e[7]*r+e[11]*s+e[15]):(u=e[1],f=e[2],g=e[3],E=e[4],M=e[5],R=e[6],F=e[7],V=e[8],G=e[9],K=e[10],se=e[11],n[0]=a=e[0],n[1]=u,n[2]=f,n[3]=g,n[4]=E,n[5]=M,n[6]=R,n[7]=F,n[8]=V,n[9]=G,n[10]=K,n[11]=se,n[12]=a*i+E*r+V*s+e[12],n[13]=u*i+M*r+G*s+e[13],n[14]=f*i+R*r+K*s+e[14],n[15]=g*i+F*r+se*s+e[15]),n}function _C(n,e,t){var i=t[0],r=t[1],s=t[2];return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n[4]=e[4]*r,n[5]=e[5]*r,n[6]=e[6]*r,n[7]=e[7]*r,n[8]=e[8]*s,n[9]=e[9]*s,n[10]=e[10]*s,n[11]=e[11]*s,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function iL(n,e,t){var i=Math.sin(t),r=Math.cos(t),s=e[4],a=e[5],u=e[6],f=e[7],g=e[8],E=e[9],M=e[10],R=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=s*r+g*i,n[5]=a*r+E*i,n[6]=u*r+M*i,n[7]=f*r+R*i,n[8]=g*r-s*i,n[9]=E*r-a*i,n[10]=M*r-u*i,n[11]=R*r-f*i,n}function rL(n,e,t){var i=Math.sin(t),r=Math.cos(t),s=e[0],a=e[1],u=e[2],f=e[3],g=e[4],E=e[5],M=e[6],R=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=s*r+g*i,n[1]=a*r+E*i,n[2]=u*r+M*i,n[3]=f*r+R*i,n[4]=g*r-s*i,n[5]=E*r-a*i,n[6]=M*r-u*i,n[7]=R*r-f*i,n}function mx(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n}function sL(n,e){return n[0]=-e[0],n[1]=-e[1],n}function oL(n,e,t,i){var r=e[0],s=e[1];return n[0]=r+i*(t[0]-r),n[1]=s+i*(t[1]-s),n}function Pv(n,e,t){var i=e[0],r=e[1],s=e[2],a=e[3];return n[0]=t[0]*i+t[4]*r+t[8]*s+t[12]*a,n[1]=t[1]*i+t[5]*r+t[9]*s+t[13]*a,n[2]=t[2]*i+t[6]*r+t[10]*s+t[14]*a,n[3]=t[3]*i+t[7]*r+t[11]*s+t[15]*a,n}!function f9(){var n=new Zm(2);Zm!=Float32Array&&(n[0]=0,n[1]=0)}(),function m9(){var n=new Zm(4);Zm!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0)}();var gx=(()=>(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL0ROW3=3]="COL0ROW3",n[n.COL1ROW0=4]="COL1ROW0",n[n.COL1ROW1=5]="COL1ROW1",n[n.COL1ROW2=6]="COL1ROW2",n[n.COL1ROW3=7]="COL1ROW3",n[n.COL2ROW0=8]="COL2ROW0",n[n.COL2ROW1=9]="COL2ROW1",n[n.COL2ROW2=10]="COL2ROW2",n[n.COL2ROW3=11]="COL2ROW3",n[n.COL3ROW0=12]="COL3ROW0",n[n.COL3ROW1=13]="COL3ROW1",n[n.COL3ROW2=14]="COL3ROW2",n[n.COL3ROW3=15]="COL3ROW3"}(gx||(gx={})),gx))();const _9=45*Math.PI/180,y9=1,yC=.1,vC=500,v9=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Ru extends J${static get IDENTITY(){return function x9(){return yx||(yx=new Ru,Object.freeze(yx)),yx}()}static get ZERO(){return function b9(){return _x||(_x=new Ru([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(_x)),_x}()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return gx}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,i,r,s,a,u,f,g,E,M,R,F,V,G,K){return this[0]=e,this[1]=t,this[2]=i,this[3]=r,this[4]=s,this[5]=a,this[6]=u,this[7]=f,this[8]=g,this[9]=E,this[10]=M,this[11]=R,this[12]=F,this[13]=V,this[14]=G,this[15]=K,this.check()}setRowMajor(e,t,i,r,s,a,u,f,g,E,M,R,F,V,G,K){return this[0]=e,this[1]=s,this[2]=g,this[3]=F,this[4]=t,this[5]=a,this[6]=E,this[7]=V,this[8]=i,this[9]=u,this[10]=M,this[11]=G,this[12]=r,this[13]=f,this[14]=R,this[15]=K,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(v9)}fromObject(e){return this.check()}fromQuaternion(e){return function o9(n,e){var t=e[0],i=e[1],r=e[2],s=e[3],a=t+t,u=i+i,f=r+r,g=t*a,E=i*a,M=i*u,R=r*a,F=r*u,V=r*f,G=s*a,K=s*u,se=s*f;n[0]=1-M-V,n[1]=E+se,n[2]=R-K,n[3]=0,n[4]=E-se,n[5]=1-g-V,n[6]=F+G,n[7]=0,n[8]=R+K,n[9]=F-G,n[10]=1-g-M,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1}(this,e),this.check()}frustum(e){const{left:t,right:i,bottom:r,top:s,near:a=yC,far:u=vC}=e;return u===1/0?function w9(n,e,t,i,r,s){const u=2*s/(r-i),f=(t+e)/(t-e),g=(r+i)/(r-i),R=-2*s;n[0]=2*s/(t-e),n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=u,n[6]=0,n[7]=0,n[8]=f,n[9]=g,n[10]=-1,n[11]=-1,n[12]=0,n[13]=0,n[14]=R,n[15]=0}(this,t,i,r,s,a):function a9(n,e,t,i,r,s,a){var u=1/(t-e),f=1/(r-i),g=1/(s-a);n[0]=2*s*u,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=2*s*f,n[6]=0,n[7]=0,n[8]=(t+e)*u,n[9]=(r+i)*f,n[10]=(a+s)*g,n[11]=-1,n[12]=0,n[13]=0,n[14]=a*s*2*g,n[15]=0}(this,t,i,r,s,a,u),this.check()}lookAt(e){const{eye:t,center:i=[0,0,0],up:r=[0,1,0]}=e;return function d9(n,e,t,i){var r,s,a,u,f,g,E,M,R,F,V=e[0],G=e[1],K=e[2],se=i[0],_e=i[1],de=i[2],Ie=t[0],qe=t[1],Qe=t[2];Math.abs(V-Ie)<Av&&Math.abs(G-qe)<Av&&Math.abs(K-Qe)<Av?function Q$(n){n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1}(n):(E=V-Ie,M=G-qe,R=K-Qe,r=_e*(R*=F=1/Math.hypot(E,M,R))-de*(M*=F),s=de*(E*=F)-se*R,a=se*M-_e*E,(F=Math.hypot(r,s,a))?(r*=F=1/F,s*=F,a*=F):(r=0,s=0,a=0),u=M*a-R*s,f=R*r-E*a,g=E*s-M*r,(F=Math.hypot(u,f,g))?(u*=F=1/F,f*=F,g*=F):(u=0,f=0,g=0),n[0]=r,n[1]=u,n[2]=E,n[3]=0,n[4]=s,n[5]=f,n[6]=M,n[7]=0,n[8]=a,n[9]=g,n[10]=R,n[11]=0,n[12]=-(r*V+s*G+a*K),n[13]=-(u*V+f*G+g*K),n[14]=-(E*V+M*G+R*K),n[15]=1)}(this,t,i,r),this.check()}ortho(e){const{left:t,right:i,bottom:r,top:s,near:a=yC,far:u=vC}=e;return function u9(n,e,t,i,r,s,a){var u=1/(e-t),f=1/(i-r),g=1/(s-a);n[0]=-2*u,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*f,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*g,n[11]=0,n[12]=(e+t)*u,n[13]=(r+i)*f,n[14]=(a+s)*g,n[15]=1}(this,t,i,r,s,a,u),this.check()}orthographic(e){const{fovy:t=_9,aspect:i=y9,focalDistance:r=1,near:s=yC,far:a=vC}=e;aL(t);const f=r*Math.tan(t/2),g=f*i;return this.ortho({left:-g,right:g,bottom:-f,top:f,near:s,far:a})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:i=1,near:r=.1,far:s=500}=e;return aL(t),function l9(n,e,t,i,r){var a,s=1/Math.tan(e/2);n[0]=s/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=s,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,null!=r&&r!==1/0?(n[10]=(r+i)*(a=1/(i-r)),n[14]=2*r*i*a):(n[10]=-1,n[14]=-2*i)}(this,t,i,r,s),this.check()}determinant(){return function t9(n){var e=n[0],t=n[1],i=n[2],r=n[3],s=n[4],a=n[5],u=n[6],f=n[7],g=n[8],E=n[9],M=n[10],R=n[11],F=n[12],V=n[13],G=n[14],K=n[15];return(e*a-t*s)*(M*K-R*G)-(e*u-i*s)*(E*K-R*V)+(e*f-r*s)*(E*G-M*V)+(t*u-i*a)*(g*K-R*F)-(t*f-r*a)*(g*G-M*F)+(i*f-r*u)*(g*V-E*F)}(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0];const i=this.getScale(t=t||[-0,-0,-0]),r=1/i[0],s=1/i[1],a=1/i[2];return e[0]=this[0]*r,e[1]=this[1]*s,e[2]=this[2]*a,e[3]=0,e[4]=this[4]*r,e[5]=this[5]*s,e[6]=this[6]*a,e[7]=0,e[8]=this[8]*r,e[9]=this[9]*s,e[10]=this[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0];const i=this.getScale(t=t||[-0,-0,-0]),r=1/i[0],s=1/i[1],a=1/i[2];return e[0]=this[0]*r,e[1]=this[1]*s,e[2]=this[2]*a,e[3]=this[4]*r,e[4]=this[5]*s,e[5]=this[6]*a,e[6]=this[8]*r,e[7]=this[9]*s,e[8]=this[10]*a,e}transpose(){return function e9(n,e){if(n===e){var t=e[1],i=e[2],r=e[3],s=e[6],a=e[7],u=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=t,n[6]=e[9],n[7]=e[13],n[8]=i,n[9]=s,n[11]=e[14],n[12]=r,n[13]=a,n[14]=u}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15]}(this,this),this.check()}invert(){return gC(this,this),this.check()}multiplyLeft(e){return Xm(this,e,this),this.check()}multiplyRight(e){return Xm(this,this,e),this.check()}rotateX(e){return iL(this,this,e),this.check()}rotateY(e){return function i9(n,e,t){var i=Math.sin(t),r=Math.cos(t),s=e[0],a=e[1],u=e[2],f=e[3],g=e[8],E=e[9],M=e[10],R=e[11];e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=s*r-g*i,n[1]=a*r-E*i,n[2]=u*r-M*i,n[3]=f*r-R*i,n[8]=s*i+g*r,n[9]=a*i+E*r,n[10]=u*i+M*r,n[11]=f*i+R*r}(this,this,e),this.check()}rotateZ(e){return rL(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return function n9(n,e,t,i){var f,g,E,M,R,F,V,G,K,se,_e,de,Ie,qe,Qe,Ct,Xt,Ft,Ut,mn,Rn,gn,_i,Vo,r=i[0],s=i[1],a=i[2],u=Math.hypot(r,s,a);u<Av||(r*=u=1/u,s*=u,a*=u,f=Math.sin(t),g=Math.cos(t),R=e[1],F=e[2],V=e[3],K=e[5],se=e[6],_e=e[7],Ie=e[9],qe=e[10],Qe=e[11],Ut=r*s*(E=1-g)-a*f,mn=s*s*E+g,Rn=a*s*E+r*f,gn=r*a*E+s*f,_i=s*a*E-r*f,Vo=a*a*E+g,n[0]=(M=e[0])*(Ct=r*r*E+g)+(G=e[4])*(Xt=s*r*E+a*f)+(de=e[8])*(Ft=a*r*E-s*f),n[1]=R*Ct+K*Xt+Ie*Ft,n[2]=F*Ct+se*Xt+qe*Ft,n[3]=V*Ct+_e*Xt+Qe*Ft,n[4]=M*Ut+G*mn+de*Rn,n[5]=R*Ut+K*mn+Ie*Rn,n[6]=F*Ut+se*mn+qe*Rn,n[7]=V*Ut+_e*mn+Qe*Rn,n[8]=M*gn+G*_i+de*Vo,n[9]=R*gn+K*_i+Ie*Vo,n[10]=F*gn+se*_i+qe*Vo,n[11]=V*gn+_e*_i+Qe*Vo,e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]))}(this,this,e,t),this.check()}scale(e){return _C(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return px(this,this,e),this.check()}transform(e,t){return 4===e.length?(fC(t=Pv(t||[-0,-0,-0,-0],e,this),4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:i}=e;let r;switch(i){case 2:r=function p9(n,e,t){var i=e[0],r=e[1];return n[0]=t[0]*i+t[4]*r+t[12],n[1]=t[1]*i+t[5]*r+t[13],n}(t||[-0,-0],e,this);break;case 3:r=eL(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return fC(r,e.length),r}transformAsVector(e,t){let i;switch(e.length){case 2:i=function $$(n,e,t){const i=e[0],r=e[1],s=t[3]*i+t[7]*r||1;return n[0]=(t[0]*i+t[4]*r)/s,n[1]=(t[1]*i+t[5]*r)/s,n}(t||[-0,-0],e,this);break;case 3:i=tL(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return fC(i,e.length),i}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,i){return this.identity().translate([e,t,i])}}let _x,yx;function aL(n){if(n>2*Math.PI)throw Error("expected radians")}function B_(n,e){const t=Pv([],e,n);return function g9(n,e,t){n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t}(t,t,1/t[3]),t}function lL(n,e){const t=n%e;return t<0?e+t:t}function bC(n,e,t){return n<e?e:n>t?t:n}const xC=Math.log2||function T9(n){return Math.log(n)*Math.LOG2E};function If(n,e){if(!n)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const xh=Math.PI,cL=xh/4,Lu=xh/180,wC=180/xh,vx=4003e4,bx=85.051129,C9=1.5;function xx(n){const[e,t]=n;return If(Number.isFinite(e)),If(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude"),[512*(e*Lu+xh)/(2*xh),512*(xh+Math.log(Math.tan(cL+t*Lu*.5)))/(2*xh)]}function V_(n){const[e,t]=n,i=e/512*(2*xh)-xh,r=2*(Math.atan(Math.exp(t/512*(2*xh)-xh))-cL);return[i*wC,r*wC]}function EC(n){const{latitude:e,longitude:t,highPrecision:i=!1}=n;If(Number.isFinite(e)&&Number.isFinite(t));const s=Math.cos(e*Lu),a=512/360,u=a/s,f=512/vx/s,g={unitsPerMeter:[f,f,f],metersPerUnit:[1/f,1/f,1/f],unitsPerDegree:[a,u,f],degreesPerUnit:[1/a,1/u,1/f]};if(i){const E=Lu*Math.tan(e*Lu)/s,R=512/vx*E,F=R/u*f;g.unitsPerDegree2=[0,a*E/2,R],g.unitsPerMeter2=[F,0,F]}return g}function uL(n,e){const[t,i,r]=n,[s,a,u]=e,{unitsPerMeter:f,unitsPerMeter2:g}=EC({longitude:t,latitude:i,highPrecision:!0}),E=xx(n);E[0]+=s*(f[0]+g[0]*a),E[1]+=a*(f[1]+g[1]*a);const M=V_(E),R=(r||0)+(u||0);return Number.isFinite(r)||Number.isFinite(u)?[M[0],M[1],R]:M}function wx(n){return 2*Math.atan(.5/n)*wC}function dL(n){return.5/Math.tan(.5*n*Lu)}function fL(n,e){const[t,i,r=0]=n;return If(Number.isFinite(t)&&Number.isFinite(i)&&Number.isFinite(r)),B_(e,[t,i,r,1])}function Ex(n,e,t=0){const[i,r,s]=n;if(If(Number.isFinite(i)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(s))return B_(e,[i,r,s,1]);const a=B_(e,[i,r,0,1]),u=B_(e,[i,r,1,1]),f=a[2],g=u[2];return oL([],a,u,f===g?0:((t||0)-f)/(g-f))}function pL(n){const{width:e,height:t,bounds:i,minExtent:r=0,maxZoom:s=24,offset:a=[0,0]}=n,[[u,f],[g,E]]=i,M=function D9(n=0){return"number"==typeof n?{top:n,bottom:n,left:n,right:n}:(If(Number.isFinite(n.top)&&Number.isFinite(n.bottom)&&Number.isFinite(n.left)&&Number.isFinite(n.right)),n)}(n.padding),R=xx([u,bC(E,-bx,bx)]),F=xx([g,bC(f,-bx,bx)]),V=[Math.max(Math.abs(F[0]-R[0]),r),Math.max(Math.abs(F[1]-R[1]),r)],G=[e-M.left-M.right-2*Math.abs(a[0]),t-M.top-M.bottom-2*Math.abs(a[1])];If(G[0]>0&&G[1]>0);const K=G[0]/V[0],se=G[1]/V[1],qe=V_([(F[0]+R[0])/2+(M.right-M.left)/2/K,(F[1]+R[1])/2+(M.top-M.bottom)/2/se]),Qe=Math.min(s,xC(Math.abs(Math.min(K,se))));return If(Number.isFinite(Qe)),{longitude:qe[0],latitude:qe[1],zoom:Qe}}const mL=Math.PI/180;function gL(n,e,t){const{pixelUnprojectionMatrix:i}=n,r=B_(i,[e,0,1,1]),s=B_(i,[e,n.height,1,1]),g=V_(oL([],r,s,(t*n.distanceScales.unitsPerMeter[2]-r[2])/(s[2]-r[2])));return g.push(t),g}const Dr={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Dr,"IDENTITY",{get:()=>(ur.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Td={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Ym={common:0,meters:1,pixels:2},xL={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},R9=Math.PI/180,L9=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],wL=[0,0,0],O9={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};class Km{constructor(e={}){Y(this,"id",void 0),Y(this,"x",void 0),Y(this,"y",void 0),Y(this,"width",void 0),Y(this,"height",void 0),Y(this,"isGeospatial",void 0),Y(this,"zoom",void 0),Y(this,"focalDistance",void 0),Y(this,"position",void 0),Y(this,"modelMatrix",void 0),Y(this,"distanceScales",void 0),Y(this,"scale",void 0),Y(this,"center",void 0),Y(this,"cameraPosition",void 0),Y(this,"projectionMatrix",void 0),Y(this,"viewMatrix",void 0),Y(this,"viewMatrixUncentered",void 0),Y(this,"viewMatrixInverse",void 0),Y(this,"viewProjectionMatrix",void 0),Y(this,"pixelProjectionMatrix",void 0),Y(this,"pixelUnprojectionMatrix",void 0),Y(this,"resolution",void 0),Y(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.distanceScales=e.distanceScales||O9,this.focalDistance=e.focalDistance||1,this.position=e.position||wL,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Td.WEB_MERCATOR:Td.WEB_MERCATOR_AUTO_OFFSET:Td.IDENTITY}equals(e){return e instanceof Km&&(this===e||e.width===this.width&&e.height===this.height&&e.scale===this.scale&&F_(e.projectionMatrix,this.projectionMatrix)&&F_(e.viewMatrix,this.viewMatrix))}project(e,{topLeft:t=!0}={}){const r=fL(this.projectPosition(e),this.pixelProjectionMatrix),[s,a]=r,u=t?a:this.height-a;return 2===e.length?[s,u]:[s,u,r[2]]}unproject(e,{topLeft:t=!0,targetZ:i}={}){const[r,s,a]=e,g=Ex([r,t?s:this.height-s,a],this.pixelUnprojectionMatrix,i&&i*this.distanceScales.unitsPerMeter[2]),[E,M,R]=this.unprojectPosition(g);return Number.isFinite(a)?[E,M,R]:Number.isFinite(i)?[E,M,i]:[E,M]}projectPosition(e){const[t,i]=this.projectFlat(e);return[t,i,(e[2]||0)*this.distanceScales.unitsPerMeter[2]]}unprojectPosition(e){const[t,i]=this.unprojectFlat(e);return[t,i,(e[2]||0)*this.distanceScales.metersPerUnit[2]]}projectFlat(e){if(this.isGeospatial){const t=xx(e);return t[1]=$a(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?V_(e):e}getBounds(e={}){const t={targetZ:e.z||0},i=this.unproject([0,0],t),r=this.unproject([this.width,0],t),s=this.unproject([0,this.height],t),a=this.unproject([this.width,this.height],t);return[Math.min(i[0],r[0],s[0],a[0]),Math.min(i[1],r[1],s[1],a[1]),Math.max(i[0],r[0],s[0],a[0]),Math.max(i[1],r[1],s[1],a[1])]}getDistanceScales(e){return e?EC({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:i=1,height:r=1}){return e<this.x+this.width&&this.x<e+i&&t<this.y+this.height&&this.y<t+r}getFrustumPlanes(){return this._frustumPlanes.near||Object.assign(this._frustumPlanes,function Y$(n){return{left:N_(n[3]+n[0],n[7]+n[4],n[11]+n[8],n[15]+n[12]),right:N_(n[3]-n[0],n[7]-n[4],n[11]-n[8],n[15]-n[12]),bottom:N_(n[3]+n[1],n[7]+n[5],n[11]+n[9],n[15]+n[13]),top:N_(n[3]-n[1],n[7]-n[5],n[11]-n[9],n[15]-n[13]),near:N_(n[3]+n[2],n[7]+n[6],n[11]+n[10],n[15]+n[14]),far:N_(n[3]-n[2],n[7]-n[6],n[11]-n[10],n[15]-n[14])}}(this.viewProjectionMatrix)),this._frustumPlanes}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=function M9(n){const{latitude:e}=n;If(Number.isFinite(e));const t=Math.cos(e*Lu);return function S9(n){return xC(n)}(vx*t)-9}({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||EC({latitude:i,longitude:t}));const r=Math.pow(2,this.zoom);this.scale=r;const{position:s,modelMatrix:a}=e;let u=wL;if(s&&(u=a?new Ru(a).transformAsVector(s,[]):s),this.isGeospatial){const f=this.projectPosition([t,i,0]);this.center=new Ed(u).scale(this.distanceScales.unitsPerMeter).add(f)}else this.center=this.projectPosition(u)}_initMatrices(e){const{viewMatrix:t=L9,projectionMatrix:i=null,orthographic:r=!1,fovyRadians:s,fovy:a=75,near:u=.1,far:f=1e3,padding:g=null,focalDistance:E=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=(new Ru).multiplyRight(t).translate(new Ed(this.center).negate()),this.projectionMatrix=i||function F9({width:n,height:e,orthographic:t,fovyRadians:i,focalDistance:r,padding:s,near:a,far:u}){const f=n/e,g=t?(new Ru).orthographic({fovy:i,aspect:f,focalDistance:r,near:a,far:u}):(new Ru).perspective({fovy:i,aspect:f,near:a,far:u});if(s){const{left:E=0,right:M=0,top:R=0,bottom:F=0}=s,V=$a((E+n-M)/2,0,n)-n/2,G=$a((R+e-F)/2,0,e)-e/2;g[8]-=2*V/n,g[9]+=2*G/e}return g}({width:this.width,height:this.height,orthographic:r,fovyRadians:s||a*R9,focalDistance:E,padding:g,near:u,far:f});const M=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Xm(M,M,this.projectionMatrix),Xm(M,M,this.viewMatrix),this.viewProjectionMatrix=M,this.viewMatrixInverse=gC([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=function X$(n){return[n[12],n[13],n[14]]}(this.viewMatrixInverse);const R=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],F=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];_C(R,R,[this.width/2,-this.height/2,1]),px(R,R,[1,-1,0]),Xm(F,R,this.viewProjectionMatrix),this.pixelProjectionMatrix=F,this.pixelUnprojectionMatrix=gC([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||ur.warn("Pixel project matrix not invertible")()}}Y(Km,"displayName","Viewport");const Rv="vs";function tu(n,e){if(!n)throw new Error(e||"shadertools: assertion failed.")}const SC={number:{validate:(n,e)=>Number.isFinite(n)&&(!("max"in e)||n<=e.max)&&(!("min"in e)||n>=e.min)},array:{validate:(n,e)=>Array.isArray(n)||ArrayBuffer.isView(n)}};function B9(n){let e=EL(n);return"object"===e?n?"type"in n?Object.assign({},n,SC[n.type]):"value"in n?(e=EL(n.value),Object.assign({type:e},n,SC[e])):{type:"object",value:n}:{type:"object",value:null}:Object.assign({type:e,value:n},SC[e])}function EL(n){return Array.isArray(n)||ArrayBuffer.isView(n)?"array":typeof n}class MC{constructor(e){let{name:t,vs:i,fs:r,dependencies:s=[],uniforms:a,getUniforms:u,deprecations:f=[],defines:g={},inject:E={},vertexShader:M,fragmentShader:R}=e;tu("string"==typeof t),this.name=t,this.vs=i||M,this.fs=r||R,this.getModuleUniforms=u,this.dependencies=s,this.deprecations=this._parseDeprecationDefinitions(f),this.defines=g,this.injections=function U9(n){const e={vs:{},fs:{}};for(const t in n){let i=n[t];const r=t.slice(0,2);"string"==typeof i&&(i={order:0,injection:i}),e[r][t]=i}return e}(E),a&&(this.uniforms=function N9(n){const e={};for(const t in n){const r=B9(n[t]);e[t]=r}return e}(a))}getModuleSource(e){let t;switch(e){case"vs":t=this.vs||"";break;case"fs":t=this.fs||"";break;default:tu(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),"\n").concat(t,"// END MODULE_").concat(this.name,"\n\n")}getUniforms(e,t){return this.getModuleUniforms?this.getModuleUniforms(e,t):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,t){this.deprecations.forEach(i=>{i.regex.test(e)&&(i.deprecated?t.deprecated(i.old,i.new)():t.removed(i.old,i.new)())})}_parseDeprecationDefinitions(e){return e.forEach(t=>{t.regex="function"===t.type?new RegExp("\\b".concat(t.old,"\\(")):new RegExp("".concat(t.type," ").concat(t.old,";"))}),e}_defaultGetUniforms(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t={},i=this.uniforms;for(const r in i){const s=i[r];r in e&&!s.private?(s.validate&&tu(s.validate(e[r],s),"".concat(this.name,": invalid ").concat(r)),t[r]=e[r]):t[r]=s.value}return t}}function j9(n){return function TL(n){const e={},t={};return AC({modules:n,level:0,moduleMap:e,moduleDepth:t}),Object.keys(t).sort((i,r)=>t[r]-t[i]).map(i=>e[i])}(CL(n))}function AC(n){let{modules:e,level:t,moduleMap:i,moduleDepth:r}=n;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const s of e)i[s.name]=s,(void 0===r[s.name]||r[s.name]<t)&&(r[s.name]=t);for(const s of e)s.dependencies&&AC({modules:s.dependencies,level:t+1,moduleMap:i,moduleDepth:r})}function CL(n,e){return n.map(t=>(t instanceof MC||(tu("string"!=typeof t,"Shader module use by name is deprecated. Import shader module '".concat(t,"' and use it directly.")),tu(t.name,"shader module has no name"),(t=new MC(t)).dependencies=CL(t.dependencies)),t))}function H9(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=typeof window<"u"&&window.navigator||{},t=n.userAgent||e.userAgent||"",i=-1!==t.indexOf("MSIE "),r=-1!==t.indexOf("Trident/");return i||r}const DC={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},Jm={};function Y9(n,e){return n.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":n.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":n.match(/AMD/i)||e.match(/AMD/i)||n.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}Object.keys(DC).forEach(n=>{Jm[n]=n});const IC={};function SL(n,e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=DC[e];if(tu(i,e),!H9(t))return!0;if(e in IC)return IC[e];const r=i[0],s=t.behavior||"enable",a="#extension GL_".concat(r," : ").concat(s,"\nvoid main(void) {}"),u=n.createShader(35633);n.shaderSource(u,a),n.compileShader(u);const f=n.getShaderParameter(u,35713);return n.deleteShader(u),IC[e]=f,f}function Tx(n,e){return(e=Array.isArray(e)?e:[e]).every(t=>function K9(n,e){const t=DC[e];tu(t,e);const i=function Z9(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext||Boolean(n&&2===n._version)}(n)&&t[1]||t[0],r="string"==typeof i?Boolean(n.getExtension(i)):i;return tu(!1===r||!0===r),r}(n,t))}const n7={[Rv]:"#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n",fs:"#ifdef MODULE_MATERIAL\n  gl_FragColor = material_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  gl_FragColor = lighting_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_FOG\n  gl_FragColor = fog_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth();\n#endif\n"},Cx="__LUMA_INJECT_DECLARATIONS__",ML=/void\s+main\s*\([^)]*\)\s*\{\n?/,AL=/}\n?[^{}]*$/,PC=[];function DL(n,e,t){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=e===Rv;for(const s in t){const a=t[s];a.sort((f,g)=>f.order-g.order),PC.length=a.length;for(let f=0,g=a.length;f<g;++f)PC[f]=a[f].injection;const u="".concat(PC.join("\n"),"\n");switch(s){case"vs:#decl":r&&(n=n.replace(Cx,u));break;case"vs:#main-start":r&&(n=n.replace(ML,f=>f+u));break;case"vs:#main-end":r&&(n=n.replace(AL,f=>u+f));break;case"fs:#decl":r||(n=n.replace(Cx,u));break;case"fs:#main-start":r||(n=n.replace(ML,f=>f+u));break;case"fs:#main-end":r||(n=n.replace(AL,f=>u+f));break;default:n=n.replace(s,f=>f+u)}}return n=n.replace(Cx,""),i&&(n=n.replace(/\}\s*$/,s=>s+n7[e])),n}function kC(n){const e={};return tu(Array.isArray(n)&&n.length>1),n.forEach(t=>{for(const i in t)e[i]=e[i]?"".concat(e[i],"\n").concat(t[i]):t[i]}),e}function U_(n){return new RegExp("\\b".concat(n,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const IL=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,"#version 300 es\n"],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],i7=[...IL,[U_("attribute"),"in $1"],[U_("varying"),"out $1"]],r7=[...IL,[U_("varying"),"in $1"]],PL=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],s7=[...PL,[U_("in"),"attribute $1"],[U_("out"),"varying $1"]],o7=[...PL,[U_("in"),"varying $1"]],RC="gl_FragColor",LC=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,a7=/void\s+main\s*\([^)]*\)\s*\{\n?/;function Sx(n,e){for(const[t,i]of e)n=n.replace(t,i);return n}const h7="\n\n".concat(Cx,"\n\n"),kL={[Rv]:"vertex",fs:"fragment"};function RL(n,e){let{id:t,source:i,type:r,modules:s,defines:a={},hookFunctions:u=[],inject:f={},transpileToGLSL100:g=!1,prologue:E=!0,log:M}=e;tu("string"==typeof i,"shader source must be a string");const R=r===Rv,F=i.split("\n");let V=100,G="",K=i;0===F[0].indexOf("#version ")?(V=300,G=F[0],K=F.slice(1).join("\n")):G="#version ".concat(V);const se={};s.forEach(Ct=>{Object.assign(se,Ct.getDefines())}),Object.assign(se,a);let _e=E?"".concat(G,"\n").concat(function g7(n){let{id:e,source:t,type:i}=n;return e&&"string"==typeof e&&-1===t.indexOf("SHADER_NAME")?"\n#define SHADER_NAME ".concat(e,"_").concat(kL[i],"\n\n"):""}({id:t,source:i,type:r}),"\n").concat(function m7(n){let{type:e}=n;return"\n#define SHADER_TYPE_".concat(kL[e].toUpperCase(),"\n")}({type:r}),"\n").concat(function J9(n){switch(function X9(n){const e=n.getExtension("WEBGL_debug_renderer_info"),t=n.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||7936),i=n.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||7937);return{gpuVendor:Y9(t,i),vendor:t,renderer:i,version:n.getParameter(7938),shadingLanguageVersion:n.getParameter(35724)}}(n).gpuVendor.toLowerCase()){case"nvidia":return"#define NVIDIA_GPU\n// Nvidia optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n";case"intel":return"#define INTEL_GPU\n// Intel optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"amd":return"#define AMD_GPU\n";default:return"#define DEFAULT_GPU\n// Prevent driver from optimizing away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"}}(n),"\n").concat(function Q9(n,e,t){let i="#if (__VERSION__ > 120)\n\n# define FEATURE_GLSL_DERIVATIVES\n# define FEATURE_GLSL_DRAW_BUFFERS\n# define FEATURE_GLSL_FRAG_DEPTH\n# define FEATURE_GLSL_TEXTURE_LOD\n\n// DEPRECATED FLAGS, remove in v9\n# define FRAG_DEPTH\n# define DERIVATIVES\n# define DRAW_BUFFERS\n# define TEXTURE_LOD\n\n#endif // __VERSION\n";return Tx(n,Jm.GLSL_FRAG_DEPTH)&&(i+="\n// FRAG_DEPTH => gl_FragDepth is available\n#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n# define FEATURE_GLSL_FRAG_DEPTH\n# define FRAG_DEPTH\n# define gl_FragDepth gl_FragDepthEXT\n#endif\n"),Tx(n,Jm.GLSL_DERIVATIVES)&&SL(n,Jm.GLSL_DERIVATIVES)&&(i+="\n// DERIVATIVES => dxdF, dxdY and fwidth are available\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n# define FEATURE_GLSL_DERIVATIVES\n# define DERIVATIVES\n#endif\n"),Tx(n,Jm.GLSL_FRAG_DATA)&&SL(n,Jm.GLSL_FRAG_DATA,{behavior:"require"})&&(i+="\n// DRAW_BUFFERS => gl_FragData[] is available\n#ifdef GL_EXT_draw_buffers\n#extension GL_EXT_draw_buffers : require\n#define FEATURE_GLSL_DRAW_BUFFERS\n#define DRAW_BUFFERS\n#endif\n"),Tx(n,Jm.GLSL_TEXTURE_LOD)&&(i+="// TEXTURE_LOD => texture2DLod etc are available\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod : enable\n\n# define FEATURE_GLSL_TEXTURE_LOD\n# define TEXTURE_LOD\n\n#endif\n"),i}(n),"\n").concat(function _7(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=0,t="";for(const i in n){0===e&&(t+="\n// APPLICATION DEFINES\n"),e++;const r=n[i];(r||Number.isFinite(r))&&(t+="#define ".concat(i.toUpperCase()," ").concat(n[i],"\n"))}return 0===e&&(t+="\n"),t}(se),"\n").concat(R?"":"precision highp float;\n\n","\n"):"".concat(G,"\n");const de=function v7(n){const e={vs:{},fs:{}};return n.forEach(t=>{let i;"string"!=typeof t?(i=t,t=i.hook):i={},t=t.trim();const[r,s]=t.split(":"),a=t.replace(/\(.+/,"");e[r][a]=Object.assign(i,{signature:s})}),e}(u),Ie={},qe={},Qe={};for(const Ct in f){const Xt="string"==typeof f[Ct]?{injection:f[Ct],order:0}:f[Ct],Ft=Ct.match(/^(v|f)s:(#)?([\w-]+)$/);if(Ft){const mn=Ft[3];Ft[2]?"decl"===mn?qe[Ct]=[Xt]:Qe[Ct]=[Xt]:Ie[Ct]=[Xt]}else Qe[Ct]=[Xt]}for(const Ct of s){M&&Ct.checkDeprecations(K,M),_e+=Ct.getModuleSource(r,V);const Ft=Ct.injections[r];for(const Ut in Ft){const mn=Ut.match(/^(v|f)s:#([\w-]+)$/);if(mn){const gn="decl"===mn[2]?qe:Qe;gn[Ut]=gn[Ut]||[],gn[Ut].push(Ft[Ut])}else Ie[Ut]=Ie[Ut]||[],Ie[Ut].push(Ft[Ut])}}return _e+=h7,_e=DL(_e,r,qe),_e+=function y7(n,e){let t="";for(const i in n){const r=n[i];if(t+="void ".concat(r.signature," {\n"),r.header&&(t+="  ".concat(r.header)),e[i]){const s=e[i];s.sort((a,u)=>a.order-u.order);for(const a of s)t+="  ".concat(a.injection,"\n")}r.footer&&(t+="  ".concat(r.footer)),t+="}\n"}return t}(de[r],Ie),_e+=K,_e=DL(_e,r,Qe),_e=function l7(n,e,t){switch(e){case 300:return t?Sx(n,i7):function c7(n){const e=(n=Sx(n,r7)).match(LC);if(e){const t=e[1];n=n.replace(new RegExp("\\b".concat(RC,"\\b"),"g"),t)}else{const t="fragmentColor";n=n.replace(a7,i=>"out vec4 ".concat(t,";\n").concat(i)).replace(new RegExp("\\b".concat(RC,"\\b"),"g"),t)}return n}(n);case 100:return t?Sx(n,s7):function u7(n){const e=(n=Sx(n,o7)).match(LC);if(e){const t=e[1];n=n.replace(LC,"").replace(new RegExp("\\b".concat(t,"\\b"),"g"),RC)}return n}(n);default:throw new Error("unknown GLSL version ".concat(e))}}(_e,g?100:V,R),_e}function p7(n){return function(t){const i={};for(const r of n){const s=r.getUniforms(t,i);Object.assign(i,s)}return i}}const cn=new Sv({id:"luma.gl"});function Jl(n,e){if(!n)throw new Error(e||"luma.gl: assertion failed.")}function Mx(n){return typeof WebGLRenderingContext<"u"&&n instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext||Boolean(n&&Number.isFinite(n._version))}function Hi(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext||Boolean(n&&2===n._version)}function Ax(n){return Jl(Mx(n),"Invalid WebGLRenderingContext"),n}function wl(n){return Jl(Hi(n),"Requires WebGL2"),n}const Lv={};const Ov=function n(e){const t=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let i=0;i<this.attribs.length;i++){const r=new n.VertexAttrib(t);this.attribs[i]=r}this.maxAttrib=0};(Ov.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()}).prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const Qm=function(e){const t=this;this.gl=e,function S7(n){const e=n.getError;n.getError=function(){let i;do{i=e.apply(n),0!==i&&(Lv[i]=!0)}while(0!==i);for(i in Lv)if(Lv[i])return delete Lv[i],parseInt(i,10);return 0}}(e);const i=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(s){return s===t.VERTEX_ARRAY_BINDING_OES?t.currentVertexArrayObject===t.defaultVertexArrayObject?null:t.currentVertexArrayObject:i.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(s){const a=t.currentVertexArrayObject;a.maxAttrib=Math.max(a.maxAttrib,s);const u=a.attribs[s];return u.enabled=!0,i.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(s){const a=t.currentVertexArrayObject;a.maxAttrib=Math.max(a.maxAttrib,s);const u=a.attribs[s];return u.enabled=!1,i.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(s,a){switch(s){case 34962:t.currentArrayBuffer=a;break;case 34963:t.currentVertexArrayObject.elementArrayBuffer=a}return i.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(s,a){const f=t.currentVertexArrayObject.attribs[s];switch(a){case 34975:return f.buffer;case 34338:return f.enabled;case 34339:return f.size;case 34340:return f.stride;case 34341:return f.type;case 34922:return f.normalized;default:return i.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(s,a,u,f,g,E){const M=t.currentVertexArrayObject;M.maxAttrib=Math.max(M.maxAttrib,s);const R=M.attribs[s];return R.buffer=t.currentArrayBuffer,R.size=a,R.type=u,R.normalized=f,R.stride=g,R.offset=E,R.recache(),i.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{(function T7(n){globalThis.console&&globalThis.console.log&&globalThis.console.log(n)})("OESVertexArrayObject emulation library context restored"),t.reset_()},!0),this.reset_()};Qm.prototype.VERTEX_ARRAY_BINDING_OES=34229,Qm.prototype.reset_=function(){if(void 0!==this.vertexArrayObjects)for(let i=0;i<this.vertexArrayObjects.length;++i)this.vertexArrayObjects.isAlive=!1;this.maxVertexAttribs=this.gl.getParameter(34921),this.defaultVertexArrayObject=new Ov(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},Qm.prototype.createVertexArrayOES=function(){const e=new Ov(this);return this.vertexArrayObjects.push(e),e},Qm.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)},Qm.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof Ov&&e.hasBeenBound&&e.ext===this)},Qm.prototype.bindVertexArrayOES=function(e){const t=this.gl;if(e&&!e.isAlive)return void function C7(n,e){Lv[n]=!0,void 0!==e&&function E7(n){globalThis.console&&globalThis.console.error&&globalThis.console.error(n)}(e)}(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");const i=this.original,r=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const s=this.currentVertexArrayObject;if(r===s)return;(!r||s.elementArrayBuffer!==r.elementArrayBuffer)&&i.bindBuffer.call(t,34963,s.elementArrayBuffer);let a=this.currentArrayBuffer;const u=Math.max(r?r.maxAttrib:0,s.maxAttrib);for(let f=0;f<=u;f++){const g=s.attribs[f],E=r?r.attribs[f]:null;if((!r||g.enabled!==E.enabled)&&(g.enabled?i.enableVertexAttribArray.call(t,f):i.disableVertexAttribArray.call(t,f)),g.enabled){let M=!1;(!r||g.buffer!==E.buffer)&&(a!==g.buffer&&(i.bindBuffer.call(t,34962,g.buffer),a=g.buffer),M=!0),(M||g.cached!==E.cached)&&i.vertexAttribPointer.call(t,f,g.size,g.type,g.normalized,g.stride,g.offset)}}this.currentArrayBuffer!==a&&i.bindBuffer.call(t,34962,this.currentArrayBuffer)};const LL="OES_element_index",OL="WEBGL_draw_buffers",FL="WEBGL_debug_renderer_info",ts=n=>Hi(n)?void 0:0,N7={3074:n=>Hi(n)?void 0:36064,35723:n=>Hi(n)?void 0:4352,35977:ts,32937:ts,36795:(n,e)=>{const t=Hi(n)?n.getExtension("EXT_disjoint_timer_query_webgl2"):n.getExtension("EXT_disjoint_timer_query");return t&&t.GPU_DISJOINT_EXT?e(t.GPU_DISJOINT_EXT):0},37445:(n,e)=>{const t=n.getExtension(FL);return e(t&&t.UNMASKED_VENDOR_WEBGL||7936)},37446:(n,e)=>{const t=n.getExtension(FL);return e(t&&t.UNMASKED_RENDERER_WEBGL||7937)},34047:(n,e)=>{const t=n.luma.extensions.EXT_texture_filter_anisotropic;return t?e(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:ts,35071:ts,37447:ts,36063:(n,e)=>{if(!Hi(n)){const t=n.getExtension(OL);return t?e(t.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:ts,35374:ts,35377:ts,34852:n=>{if(!Hi(n)){const e=n.getExtension(OL);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},36203:n=>n.getExtension(LL)?2147483647:65535,33001:n=>n.getExtension(LL)?16777216:65535,33e3:n=>16777216,37157:ts,35373:ts,35657:ts,36183:ts,37137:ts,34045:ts,35978:ts,35979:ts,35968:ts,35376:ts,35375:ts,35659:ts,37154:ts,35371:ts,35658:ts,35076:ts,35077:ts,35380:ts},NL="ANGLE_instanced_arrays",BL={OES_vertex_array_object:{meta:{suffix:"OES"},createVertexArray:()=>{Jl(!1,"VertexArray requires WebGL2 or OES_vertex_array_object extension")},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[NL]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(n,e){Jl(0===e,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},WEBGL_draw_buffers:{meta:{suffix:"WEBGL"},drawBuffers:()=>{Jl(!1)}},EXT_disjoint_timer_query:{meta:{suffix:"EXT"},createQuery:()=>{Jl(!1)},deleteQuery:()=>{Jl(!1)},beginQuery:()=>{Jl(!1)},endQuery:()=>{},getQuery(n,e){return this.getQueryObject(n,e)},getQueryParameter(n,e){return this.getQueryObject(n,e)},getQueryObject:()=>{}}},OC={readBuffer:(n,e,t)=>{Hi(n)&&e(t)},getVertexAttrib:(n,e,t,i)=>{const{webgl2:r,ext:s}=function G7(n,e){return{webgl2:Hi(n),ext:n.getExtension(e)}}(n,NL);let a;switch(i){case 35069:a=!!r&&void 0;break;case 35070:a=r||s?void 0:0}return void 0!==a?a:e(t,i)},getProgramParameter:(n,e,t,i)=>{if(!Hi(n))switch(i){case 35967:return 35981;case 35971:case 35382:return 0}return e(t,i)},getInternalformatParameter:(n,e,t,i,r)=>Hi(n)||32937!==r?n.getInternalformatParameter(t,i,r):new Int32Array([0]),getTexParameter(n,e,t,i){if(34046===i){const{extensions:r}=n.luma,s=r.EXT_texture_filter_anisotropic;i=s&&s.TEXTURE_MAX_ANISOTROPY_EXT||34046}return e(t,i)},getParameter:function B7(n,e,t){const i=N7[t],r="function"==typeof i?i(n,e,t):i;return void 0!==r?r:e(t)},hint:(n,e,t,i)=>e(t,i)};function X7(n,e){let{extension:t,target:i,target2:r}=e;const s=BL[t];Jl(s);const{meta:a={}}=s,{suffix:u=""}=a,f=n.getExtension(t);for(const g of Object.keys(s)){const E="".concat(g).concat(u);let M=null;"meta"===g||"function"==typeof n[g]||(f&&"function"==typeof f[E]?M=function(){return f[E](...arguments)}:"function"==typeof s[g]&&(M=s[g].bind(i))),M&&(i[g]=M,r[g]=M)}}globalThis.polyfillContext=function W7(n){n.luma=n.luma||{};const{luma:e}=n;return e.polyfilled||(function M7(n){if("function"==typeof n.createVertexArray)return;const e=n.getSupportedExtensions;n.getSupportedExtensions=function(){const r=e.call(this)||[];return r.indexOf("OES_vertex_array_object")<0&&r.push("OES_vertex_array_object"),r};const t=n.getExtension;n.getExtension=function(r){return t.call(this,r)||("OES_vertex_array_object"!==r?null:(n.__OESVertexArrayObject||(this.__OESVertexArrayObject=new Qm(this)),this.__OESVertexArrayObject))}}(n),function $7(n){n.luma.extensions={};const e=n.getSupportedExtensions()||[];for(const t of e)n.luma[t]=n.getExtension(t)}(n),function Z7(n,e){for(const t of Object.getOwnPropertyNames(e))"overrides"!==t&&X7(n,{extension:t,target:n.luma,target2:n})}(n,BL),function q7(n,e){let{target:t,target2:i}=e;Object.keys(OC).forEach(r=>{if("function"==typeof OC[r]){const s=n[r]?n[r].bind(n):()=>{},a=OC[r].bind(null,n,s);t[r]=a,i[r]=a}})}(n,{target:e,target2:n}),e.polyfilled=!0),n};const FC={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},kp=(n,e,t)=>e?n.enable(t):n.disable(t),zL=(n,e,t)=>n.hint(t,e),nu=(n,e,t)=>n.pixelStorei(t,e);function Fv(n){return Array.isArray(n)||ArrayBuffer.isView(n)}const J7={3042:kp,32773:(n,e)=>n.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(n,e)=>n.clearColor(...e),3107:(n,e)=>n.colorMask(...e),2884:kp,2885:(n,e)=>n.cullFace(e),2929:kp,2931:(n,e)=>n.clearDepth(e),2932:(n,e)=>n.depthFunc(e),2928:(n,e)=>n.depthRange(...e),2930:(n,e)=>n.depthMask(e),3024:kp,35723:zL,36006:(n,e)=>{const t=Hi(n)?36009:36160;return n.bindFramebuffer(t,e)},2886:(n,e)=>n.frontFace(e),33170:zL,2849:(n,e)=>n.lineWidth(e),32823:kp,32824:"polygonOffset",10752:"polygonOffset",35977:kp,32938:"sampleCoverage",32939:"sampleCoverage",3089:kp,3088:(n,e)=>n.scissor(...e),2960:kp,2961:(n,e)=>n.clearStencil(e),2968:(n,e)=>n.stencilMaskSeparate(1028,e),36005:(n,e)=>n.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(n,e)=>n.viewport(...e),3333:nu,3317:nu,37440:nu,37441:nu,37443:nu,3330:nu,3332:nu,3331:nu,36010:(n,e)=>n.bindFramebuffer(36008,e),3314:nu,32878:nu,3316:nu,3315:nu,32877:nu,framebuffer:(n,e)=>n.bindFramebuffer(36160,e&&"handle"in e?e.handle:e),blend:(n,e)=>e?n.enable(3042):n.disable(3042),blendColor:(n,e)=>n.blendColor(...e),blendEquation:(n,e)=>{e=Fv(e)?e:[e,e],n.blendEquationSeparate(...e)},blendFunc:(n,e)=>{e=Fv(e)&&2===e.length?[...e,...e]:e,n.blendFuncSeparate(...e)},clearColor:(n,e)=>n.clearColor(...e),clearDepth:(n,e)=>n.clearDepth(e),clearStencil:(n,e)=>n.clearStencil(e),colorMask:(n,e)=>n.colorMask(...e),cull:(n,e)=>e?n.enable(2884):n.disable(2884),cullFace:(n,e)=>n.cullFace(e),depthTest:(n,e)=>e?n.enable(2929):n.disable(2929),depthFunc:(n,e)=>n.depthFunc(e),depthMask:(n,e)=>n.depthMask(e),depthRange:(n,e)=>n.depthRange(...e),dither:(n,e)=>e?n.enable(3024):n.disable(3024),derivativeHint:(n,e)=>{n.hint(35723,e)},frontFace:(n,e)=>n.frontFace(e),mipmapHint:(n,e)=>n.hint(33170,e),lineWidth:(n,e)=>n.lineWidth(e),polygonOffsetFill:(n,e)=>e?n.enable(32823):n.disable(32823),polygonOffset:(n,e)=>n.polygonOffset(...e),sampleCoverage:(n,e)=>n.sampleCoverage(...e),scissorTest:(n,e)=>e?n.enable(3089):n.disable(3089),scissor:(n,e)=>n.scissor(...e),stencilTest:(n,e)=>e?n.enable(2960):n.disable(2960),stencilMask:(n,e)=>{e=Fv(e)?e:[e,e];const[t,i]=e;n.stencilMaskSeparate(1028,t),n.stencilMaskSeparate(1029,i)},stencilFunc:(n,e)=>{e=Fv(e)&&3===e.length?[...e,...e]:e;const[t,i,r,s,a,u]=e;n.stencilFuncSeparate(1028,t,i,r),n.stencilFuncSeparate(1029,s,a,u)},stencilOp:(n,e)=>{e=Fv(e)&&3===e.length?[...e,...e]:e;const[t,i,r,s,a,u]=e;n.stencilOpSeparate(1028,t,i,r),n.stencilOpSeparate(1029,s,a,u)},viewport:(n,e)=>n.viewport(...e)};function Zs(n,e,t){return void 0!==e[n]?e[n]:t[n]}const Q7={blendEquation:(n,e,t)=>n.blendEquationSeparate(Zs(32777,e,t),Zs(34877,e,t)),blendFunc:(n,e,t)=>n.blendFuncSeparate(Zs(32969,e,t),Zs(32968,e,t),Zs(32971,e,t),Zs(32970,e,t)),polygonOffset:(n,e,t)=>n.polygonOffset(Zs(32824,e,t),Zs(10752,e,t)),sampleCoverage:(n,e,t)=>n.sampleCoverage(Zs(32938,e,t),Zs(32939,e,t)),stencilFuncFront:(n,e,t)=>n.stencilFuncSeparate(1028,Zs(2962,e,t),Zs(2967,e,t),Zs(2963,e,t)),stencilFuncBack:(n,e,t)=>n.stencilFuncSeparate(1029,Zs(34816,e,t),Zs(36003,e,t),Zs(36004,e,t)),stencilOpFront:(n,e,t)=>n.stencilOpSeparate(1028,Zs(2964,e,t),Zs(2965,e,t),Zs(2966,e,t)),stencilOpBack:(n,e,t)=>n.stencilOpSeparate(1029,Zs(34817,e,t),Zs(34818,e,t),Zs(34819,e,t))},VL={enable:(n,e)=>n({[e]:!0}),disable:(n,e)=>n({[e]:!1}),pixelStorei:(n,e,t)=>n({[e]:t}),hint:(n,e,t)=>n({[e]:t}),bindFramebuffer:(n,e,t)=>{switch(e){case 36160:return n({36006:t,36010:t});case 36009:return n({36006:t});case 36008:return n({36010:t});default:return null}},blendColor:(n,e,t,i,r)=>n({32773:new Float32Array([e,t,i,r])}),blendEquation:(n,e)=>n({32777:e,34877:e}),blendEquationSeparate:(n,e,t)=>n({32777:e,34877:t}),blendFunc:(n,e,t)=>n({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(n,e,t,i,r)=>n({32969:e,32968:t,32971:i,32970:r}),clearColor:(n,e,t,i,r)=>n({3106:new Float32Array([e,t,i,r])}),clearDepth:(n,e)=>n({2931:e}),clearStencil:(n,e)=>n({2961:e}),colorMask:(n,e,t,i,r)=>n({3107:[e,t,i,r]}),cullFace:(n,e)=>n({2885:e}),depthFunc:(n,e)=>n({2932:e}),depthRange:(n,e,t)=>n({2928:new Float32Array([e,t])}),depthMask:(n,e)=>n({2930:e}),frontFace:(n,e)=>n({2886:e}),lineWidth:(n,e)=>n({2849:e}),polygonOffset:(n,e,t)=>n({32824:e,10752:t}),sampleCoverage:(n,e,t)=>n({32938:e,32939:t}),scissor:(n,e,t,i,r)=>n({3088:new Int32Array([e,t,i,r])}),stencilMask:(n,e)=>n({2968:e,36005:e}),stencilMaskSeparate:(n,e,t)=>n({[1028===e?2968:36005]:t}),stencilFunc:(n,e,t,i)=>n({2962:e,2967:t,2963:i,34816:e,36003:t,36004:i}),stencilFuncSeparate:(n,e,t,i,r)=>n({[1028===e?2962:34816]:t,[1028===e?2967:36003]:i,[1028===e?2963:36004]:r}),stencilOp:(n,e,t,i)=>n({2964:e,2965:t,2966:i,34817:e,34818:t,34819:i}),stencilOpSeparate:(n,e,t,i,r)=>n({[1028===e?2964:34817]:t,[1028===e?2965:34818]:i,[1028===e?2966:34819]:r}),viewport:(n,e,t,i,r)=>n({2978:[e,t,i,r]})},Cd=(n,e)=>n.isEnabled(e),UL={3042:Cd,2884:Cd,2929:Cd,3024:Cd,32823:Cd,32926:Cd,32928:Cd,3089:Cd,2960:Cd,35977:Cd};function jL(n){for(const e in n)return!1;return!0}function eq(n,e){if(n===e)return!0;const t=Array.isArray(n)||ArrayBuffer.isView(n),i=Array.isArray(e)||ArrayBuffer.isView(e);if(t&&i&&n.length===e.length){for(let r=0;r<n.length;++r)if(n[r]!==e[r])return!1;return!0}return!1}function HL(n,e){const t=n[e].bind(n);n[e]=function(){const r=arguments.length<=0?void 0:arguments[0];return r in n.state.cache&&n.state.enable?n.state.cache[r]:t(...arguments)},Object.defineProperty(n[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function tq(n,e,t){const i=n[e].bind(n);n[e]=function(){for(var s=arguments.length,a=new Array(s),u=0;u<s;u++)a[u]=arguments[u];const{valueChanged:f,oldValue:g}=t(n.state._updateCache,...a);return f&&i(...a),g},Object.defineProperty(n[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function nq(n){const e=n.useProgram.bind(n);n.useProgram=function(i){n.state.program!==i&&(e(i),n.state.program=i)}}class iq{constructor(e){let{copyState:t=!1,log:i=(()=>{})}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=t?function sq(n,e){if("number"==typeof(e=e||FC)){const r=e,s=UL[r];return s?s(n,r):n.getParameter(r)}const t=Array.isArray(e)?e:Object.keys(e),i={};for(const r of t){const s=UL[r];i[r]=s?s(n,Number(r)):n.getParameter(Number(r))}return i}(e):Object.assign({},FC),this.log=i,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){Jl(this.stateStack.length>0),Pf(this.gl,this.stateStack[this.stateStack.length-1]),this.stateStack.pop()}_updateCache(e){let i,t=!1;const r=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const s in e){Jl(void 0!==s);const a=e[s],u=this.cache[s];eq(a,u)||(t=!0,i=u,r&&!(s in r)&&(r[s]=u),this.cache[s]=a)}return{valueChanged:t,oldValue:i}}}function GL(n){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{enable:t=!0,copyState:i}=e;if(Jl(void 0!==i),!n.state){const{polyfillContext:r}=globalThis;r&&r(n),n.state=new iq(n,{copyState:i}),nq(n);for(const s in VL)tq(n,s,VL[s]);HL(n,"getParameter"),HL(n,"isEnabled")}return n.state.enable=t,n}function WL(n){Jl(n.state),n.state.pop()}function Pf(n,e){if(Jl(Mx(n),"setParameters requires a WebGL context"),jL(e))return;const t={};for(const r in e){const s=Number(r),a=J7[r];a&&("string"==typeof a?t[a]=!0:a(n,e[r],s))}const i=n.state&&n.state.cache;if(i)for(const r in t)(0,Q7[r])(n,e,i)}function Ou(n,e,t){if(jL(e))return t(n);const{nocatch:i=!0}=e;let r;if(function rq(n){n.state||GL(n,{copyState:!1}),n.state.push()}(n),Pf(n,e),i)r=t(n),WL(n);else try{r=t(n)}finally{WL(n)}return r}function j_(n){const{luma:e}=n;if(n.canvas&&e){const{clientWidth:t}=e.canvasSizeInfo;return t?n.drawingBufferWidth/t:1}return 1}function NC(n,e){let t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=j_(n),r=n.drawingBufferWidth,s=n.drawingBufferHeight;return lq(e,i,r,s,t)}function aq(n){const e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(n)?n<=0?1:n:n?e:1}function lq(n,e,t,i,r){const s=$L(n[0],e,t);let a=qL(n[1],e,i,r),u=$L(n[0]+1,e,t);const f=u===t-1?u:u-1;let g;return u=qL(n[1]+1,e,i,r),r?(u=0===u?u:u+1,g=a,a=u):g=u===i-1?u:u-1,{x:s,y:a,width:Math.max(f-s+1,1),height:Math.max(g-a+1,1)}}function $L(n,e,t){return Math.min(Math.round(n*e),t-1)}function qL(n,e,t,i){return i?Math.max(0,t-1-Math.round(n*e)):Math.min(Math.round(n*e),t-1)}const BC=bd(),cq=BC&&typeof document<"u",ZL={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function XL(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Jl(BC,"createGLContext only available in the browser.\nCreate your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils"),n=Object.assign({},ZL,n);const{width:e,height:t}=n;function i(u){if(n.throwOnError)throw new Error(u);return console.error(u),null}let r;n.onError=i;const{canvas:s}=n,a=fq({canvas:s,width:e,height:t,onError:i});return r=dq(a,n),r?(r=zC(r,n),pq(r),r):null}function zC(n){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!n||n._instrumented)return n;n._version=n._version||mq(n),n.luma=n.luma||{},n.luma.canvasSizeInfo=n.luma.canvasSizeInfo||{},e=Object.assign({},ZL,e);const{manageState:t,debug:i}=e;return t&&GL(n,{copyState:!1,log:function(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];return cn.log(1,...s)()}}),BC&&i&&(globalThis.makeDebugContext?(n=globalThis.makeDebugContext(n,e),cn.level=Math.max(cn.level,1)):cn.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),n._instrumented=!0,n}function dq(n,e){const{onError:t}=e;let i=null;const r=f=>i=f.statusMessage||i;n.addEventListener("webglcontextcreationerror",r,!1);const{webgl1:s=!0,webgl2:a=!0}=e;let u=null;return a&&(u=u||n.getContext("webgl2",e),u=u||n.getContext("experimental-webgl2",e)),s&&(u=u||n.getContext("webgl",e),u=u||n.getContext("experimental-webgl",e)),n.removeEventListener("webglcontextcreationerror",r,!1),u?(e.onContextLost&&n.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&n.addEventListener("webglcontextrestored",e.onContextRestored,!1),u):t("Failed to create ".concat(a&&!s?"WebGL2":"WebGL"," context: ").concat(i||"Unknown error"))}function fq(n){let s,{canvas:e,width:t=800,height:i=600,onError:r}=n;return"string"==typeof e?(cq&&"complete"===document.readyState||r("createGLContext called on canvas '".concat(e,"' before page was loaded")),s=document.getElementById(e)):e?s=e:(s=document.createElement("canvas"),s.id="lumagl-canvas",s.style.width=Number.isFinite(t)?"".concat(t,"px"):"100%",s.style.height=Number.isFinite(i)?"".concat(i,"px"):"100%",document.body.insertBefore(s,document.body.firstChild)),s}function pq(n){const e=Hi(n)?"WebGL2":"WebGL1",t=function uq(n){const e=n.getParameter(7936),t=n.getParameter(7937),i=n.getExtension("WEBGL_debug_renderer_info");return{vendor:i&&n.getParameter(i.UNMASKED_VENDOR_WEBGL||7936)||e,renderer:i&&n.getParameter(i.UNMASKED_RENDERER_WEBGL||7937)||t,vendorMasked:e,rendererMasked:t,version:n.getParameter(7938),shadingLanguageVersion:n.getParameter(35724)}}(n),i=t?"(".concat(t.vendor,",").concat(t.renderer,")"):"",r=n.debug?" debug":"";cn.info(1,"".concat(e).concat(r," context ").concat(i))()}function mq(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?2:1}function gq(n,e,t){let i="width"in t?t.width:n.canvas.clientWidth,r="height"in t?t.height:n.canvas.clientHeight;(!i||!r)&&(cn.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=n.canvas.width||1,r=n.canvas.height||1),n.luma=n.luma||{},n.luma.canvasSizeInfo=n.luma.canvasSizeInfo||{};const s=n.luma.canvasSizeInfo;if(s.clientWidth!==i||s.clientHeight!==r||s.devicePixelRatio!==e){let a=e;const u=Math.floor(i*a),f=Math.floor(r*a);n.canvas.width=u,n.canvas.height=f,(n.drawingBufferWidth!==u||n.drawingBufferHeight!==f)&&(cn.warn("Device pixel ratio clamped")(),a=Math.min(n.drawingBufferWidth/i,n.drawingBufferHeight/r),n.canvas.width=Math.floor(i*a),n.canvas.height=Math.floor(r*a)),Object.assign(n.luma.canvasSizeInfo,{clientWidth:i,clientHeight:r,devicePixelRatio:e})}}const Nv="8.5.16";class YL{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new AT({id:e})),this.stats.get(e)}}const eg=new YL;if(globalThis.luma&&globalThis.luma.VERSION!==Nv)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(Nv));function Bt(n,e){if(!n)throw new Error(e||"luma.gl: assertion failed.")}function VC(n,e){if("string"!=typeof e)return e;const t=Number(e);if(!isNaN(t))return t;const i=n[e=e.replace(/^.*\./,"")];return Bt(void 0!==i,"Accessing undefined constant GL.".concat(e)),i}function Rp(n,e){e=Number(e);for(const t in n)if(n[t]===e)return"GL.".concat(t);return String(e)}globalThis.luma||(bd()&&cn.log(1,"luma.gl ".concat(Nv," - ").concat("set luma.log.level=1 (or higher) to trace rendering"))(),globalThis.luma=globalThis.luma||{VERSION:Nv,version:Nv,log:cn,stats:eg,globals:{modules:{},nodeIO:{}}}),globalThis;const UC={};function Lp(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"id";UC[n]=UC[n]||1;const e=UC[n]++;return"".concat(n,"-").concat(e)}function KL(n){return Bt("number"==typeof n,"Input must be a number"),n&&0==(n&n-1)}function H_(n){let e=!0;for(const t in n){e=!1;break}return e}function JL(n,e,t,i){const r="See luma.gl ".concat(t," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),s=Object.getPrototypeOf(n);i.forEach(a=>{s.methodName||(s[a]=()=>{throw cn.removed("Calling removed method ".concat(e,".").concat(a,": "),r)(),new Error(a)})})}const G_="Resource subclass must define virtual methods";class kf{get[Symbol.toStringTag](){return"Resource"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Ax(e);const{id:i,userData:r={}}=t;this.gl=e,this.gl2=e,this.id=i||Lp(this[Symbol.toStringTag]),this.userData=r,this._bound=!1,this._handle=t.handle,void 0===this._handle&&(this._handle=this._createHandle()),this.byteLength=0,this._initStats(),this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,t&&e&&t.filter(Boolean).forEach(i=>i.delete()),this}bind(){let t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.handle;return"function"!=typeof e?(this._bindHandle(e),this):(this._bound?t=e():(this._bindHandle(this.handle),this._bound=!0,t=e(),this._bound=!1,this._bindHandle(null)),t)}unbind(){this.bind(null)}getParameter(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Bt(e=VC(this.gl,e));const r=(this.constructor.PARAMETERS||{})[e];if(r){const s=Hi(this.gl);if("webgl2"in r&&!s||"extension"in r&&!this.gl.getExtension(r.extension)){const u=r.webgl1,f="webgl2"in r?r.webgl2:r.webgl1;return s?f:u}}return this._getParameter(e,t)}getParameters(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{parameters:t,keys:i}=e,r=this.constructor.PARAMETERS||{},s=Hi(this.gl),a={},u=t||Object.keys(r);for(const f of u){const g=r[f];if(g&&(!("webgl2"in g)||s)&&(!("extension"in g)||this.gl.getExtension(g.extension))){const M=i?Rp(this.gl,f):f;a[M]=this.getParameter(f,e),i&&"GLenum"===g.type&&(a[M]=Rp(this.gl,a[M]))}}return a}setParameter(e,t){Bt(e=VC(this.gl,e));const r=(this.constructor.PARAMETERS||{})[e];if(r){const s=Hi(this.gl);if("webgl2"in r&&!s||"extension"in r&&!this.gl.getExtension(r.extension))throw new Error("Parameter not available on this platform");"GLenum"===r.type&&(t=VC(t))}return this._setParameter(e,t),this}setParameters(e){for(const t in e)this.setParameter(t,e[t]);return this}stubRemovedMethods(e,t,i){return JL(this,e,t,i)}initialize(e){}_createHandle(){throw new Error(G_)}_deleteHandle(){throw new Error(G_)}_bindHandle(e){throw new Error(G_)}_getOptsFromHandle(){throw new Error(G_)}_getParameter(e,t){throw new Error(G_)}_setParameter(e,t){throw new Error(G_)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_initStats(){this.gl.stats=this.gl.stats||new YL}_addStats(){const e=this[Symbol.toStringTag],t=eg.get("Resource Counts");t.get("Resources Created").incrementCount(),t.get("".concat(e,"s Created")).incrementCount(),t.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];eg.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this[Symbol.toStringTag];this._doTrackAllocatedMemory(e,t),this._doTrackAllocatedMemory(e,t,this.gl.stats.get("Memory Usage"))}_doTrackAllocatedMemory(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this[Symbol.toStringTag],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:eg.get("Memory Usage");i.get("GPU Memory").addCount(e),i.get("".concat(t," Memory")).addCount(e),this.byteLength=e}_trackDeallocatedMemory(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this[Symbol.toStringTag];this._doTrackDeallocatedMemory(e),this._doTrackDeallocatedMemory(e,this.gl.stats.get("Memory Usage"))}_doTrackDeallocatedMemory(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this[Symbol.toStringTag],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:eg.get("Memory Usage");t.get("GPU Memory").subtractCount(this.byteLength),t.get("".concat(e," Memory")).subtractCount(this.byteLength),this.byteLength=0}}function jC(n){switch(ArrayBuffer.isView(n)?n.constructor:n){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error("Failed to deduce GL constant from typed array")}}function Bv(n){let{clamped:e=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(n){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function vq(n){let{data:e,width:t,height:i,bytesPerPixel:r=4,temp:s}=n;const a=t*r;s=s||new Uint8Array(a);for(let u=0;u<i/2;++u){const f=u*a,g=(i-u-1)*a;s.set(e.subarray(f,f+a)),e.copyWithin(f,g,g+a),e.set(s,g)}}function bq(n){let{data:e,width:t,height:i}=n;const r=Math.round(t/2),s=Math.round(i/2),a=new Uint8Array(r*s*4);for(let u=0;u<s;u++)for(let f=0;f<r;f++)for(let g=0;g<4;g++)a[4*(u*r+f)+g]=e[4*(2*u*t+2*f)+g];return{data:a,width:r,height:s}}function HC(n,e,t){const{removedProps:i={},deprecatedProps:r={},replacedProps:s={}}=t;for(const u in i)if(u in e){const g=i[u]?"".concat(n,".").concat(i[u]):"N/A";cn.removed("".concat(n,".").concat(u),g)()}for(const u in r)if(u in e){const f=r[u];cn.deprecated("".concat(n,".").concat(u),"".concat(n,".").concat(f))()}let a=null;for(const u in s)if(u in e){const f=s[u];cn.deprecated("".concat(n,".").concat(u),"".concat(n,".").concat(f))(),a=a||Object.assign({},e),a[f]=e[u],delete a[u]}return a||e}const xq={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},wq={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class iu{static getBytesPerElement(e){return Bv(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return Bt(e.size),Bv(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return new iu(xq,...t)}constructor(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach(r=>this._assign(r)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return iu.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return iu.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e=HC("Accessor",e,wq),void 0!==e.type&&(this.type=e.type,(5124===e.type||5125===e.type)&&(this.integer=!0)),void 0!==e.size&&(this.size=e.size),void 0!==e.offset&&(this.offset=e.offset),void 0!==e.stride&&(this.stride=e.stride),void 0!==e.normalized&&(this.normalized=e.normalized),void 0!==e.integer&&(this.integer=e.integer),void 0!==e.divisor&&(this.divisor=e.divisor),void 0!==e.buffer&&(this.buffer=e.buffer),void 0!==e.index&&(this.index="boolean"==typeof e.index?e.index?1:0:e.index),void 0!==e.instanced&&(this.divisor=e.instanced?1:0),void 0!==e.isInstanced&&(this.divisor=e.isInstanced?1:0),this}}const eO={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},Eq={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:eO},Tq={removedProps:eO};class Nr extends kf{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,t),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=t.target||(this.gl.webgl2?36662:34962),this.initialize(t),Object.seal(this)}getElementCount(){return Math.round(this.byteLength/iu.getBytesPerElement(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.accessor))}getVertexCount(){return Math.round(this.byteLength/iu.getBytesPerVertex(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.accessor))}initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=HC("Buffer",e,Eq),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return"accessor"in(e=HC("Buffer",e,Tq))&&this.setAccessor(e.accessor),this}setAccessor(e){return delete(e=Object.assign({},e)).buffer,this.accessor=new iu(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:t,offset:i=0,srcOffset:r=0}=e,s=e.byteLength||e.length;Bt(t);const a=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(a,this.handle),0!==r||void 0!==s?(wl(this.gl),this.gl.bufferSubData(this.target,i,t,r,s)):this.gl.bufferSubData(a,i,t),this.gl.bindBuffer(a,null),this.debugData=null,this._inferType(t),this}copyData(e){let{sourceBuffer:t,readOffset:i=0,writeOffset:r=0,size:s}=e;const{gl:a}=this;return wl(a),a.bindBuffer(36662,t.handle),a.bindBuffer(36663,this.handle),a.copyBufferSubData(36662,36663,i,r,s),a.bindBuffer(36662,null),a.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:t=0,dstOffset:i=0,length:r=0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};wl(this.gl);const s=Bv(this.accessor.type||5126,{clamped:!1}),a=this._getAvailableElementCount(t),u=i;let f,g;e?(g=e.length,f=g-u):(f=Math.min(a,r||a),g=u+f);const E=Math.min(a,f);return r=r||E,Bt(r<=E),e=e||new s(g),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,e,i,r),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:t=this.accessor&&this.accessor.index,offset:i=0,size:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return 35345===e||35982===e?void 0!==r?this.gl.bindBufferRange(e,t,this.handle,i,r):(Bt(0===i),this.gl.bindBufferBase(e,t,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:t=this.accessor&&this.accessor.index}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return 35345===e||35982===e?this.gl.bindBufferBase(e,t,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(10,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.byteLength+t;Bt(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const r=this._getTarget();this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,i,this.usage),this.gl.bufferSubData(r,t,e),this.gl.bindBuffer(r,null),this.debugData=e.slice(0,10),this.bytesUsed=i,this._trackAllocatedMemory(i);const s=jC(e);return Bt(s),this.setAccessor(new iu(this.accessor,{type:s})),this}_setByteLength(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.usage;Bt(e>=0),this._trackDeallocatedMemory();let i=e;0===e&&(i=new Float32Array(0));const r=this._getTarget();return this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,i,t),this.gl.bindBuffer(r,null),this.usage=t,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const i=e/Bv(this.accessor.type||5126,{clamped:!1}).BYTES_PER_ELEMENT;return this.getElementCount()-i}_inferType(e){this.accessor.type||this.setAccessor(new iu(this.accessor,{type:jC(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const t=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),t}get type(){return cn.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return cn.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return cn.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return cn.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new iu(this.accessor,e),this}}const GC={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},tO={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},nO={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1},Mq=[9729,9728],iO=globalThis.WebGLBuffer||function(){};class tg extends kf{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{format:i,linearFiltering:r}=t;let s=!0;return i&&(s=s&&function Cq(n,e){const t=GC[e];if(!t)return!1;if(void 0===t.gl1&&void 0===t.gl2)return!0;const i=Hi(n)&&t.gl2||t.gl1;return"string"==typeof i?n.getExtension(i):i}(e,i),s=s&&(!r||function Sq(n,e){const t=GC[e];switch(t&&t.types[0]){case 5126:return n.getExtension("OES_texture_float_linear");case 5131:return n.getExtension("OES_texture_half_float_linear");default:return!0}}(e,i))),s}constructor(e,t){const{id:i=Lp("texture"),handle:r,target:s}=t;super(e,{id:i,handle:r}),this.target=s,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.data;if(t instanceof Promise)return t.then(_e=>this.initialize(Object.assign({},e,{pixels:_e,data:_e}))),this;const i=typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement;if(i&&t.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,t.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:r=null,format:s=6408,border:a=0,recreate:u=!1,parameters:f={},pixelStore:g={},textureUnit:E}=e;t||(t=r);let{width:M,height:R,dataFormat:F,type:V,compressed:G=!1,mipmaps:K=!0}=e;const{depth:se=0}=e;return({width:M,height:R,compressed:G,dataFormat:F,type:V}=this._deduceParameters({format:s,type:V,dataFormat:F,compressed:G,data:t,width:M,height:R})),this.width=M,this.height=R,this.depth=se,this.format=s,this.type=V,this.dataFormat=F,this.border=a,this.textureUnit=E,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),K&&this._isNPOT()&&(cn.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),K=!1,this._updateForNPOT(f)),this.mipmaps=K,this.setImageData({data:t,width:M,height:R,depth:se,format:s,type:V,dataFormat:F,border:a,mipmaps:K,parameters:g,compressed:G}),K&&this.generateMipmap(),this.setParameters(f),u&&(this.data=t),i&&(this._video={video:t,parameters:f,lastTime:t.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?t.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:t,lastTime:i}=this._video;if(i===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:t}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:t,width:i,mipmaps:r=!1}=e;return i!==this.width||t!==this.height?this.initialize({width:i,height:t,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:r}):this}generateMipmap(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._isNPOT()?(cn.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Ou(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:t=this.target,pixels:i=null,level:r=0,format:s=this.format,border:a=this.border,offset:u=0,parameters:f={}}=e;let{data:g=null,type:E=this.type,width:M=this.width,height:R=this.height,dataFormat:F=this.dataFormat,compressed:V=!1}=e;g||(g=i),({type:E,dataFormat:F,compressed:V,width:M,height:R}=this._deduceParameters({format:s,type:E,dataFormat:F,compressed:V,data:g,width:M,height:R}));const{gl:G}=this;G.bindTexture(this.target,this.handle);let K=null;({data:g,dataType:K}=this._getDataType({data:g,compressed:V}));let se,_e=0;return Ou(this.gl,f,()=>{switch(K){case"null":G.texImage2D(t,r,s,M,R,a,F,E,g);break;case"typed-array":G.texImage2D(t,r,s,M,R,a,F,E,g,u);break;case"buffer":se=wl(G),se.bindBuffer(35052,g.handle||g),se.texImage2D(t,r,s,M,R,a,F,E,u),se.bindBuffer(35052,null);break;case"browser-object":Hi(G)?G.texImage2D(t,r,s,M,R,a,F,E,g):G.texImage2D(t,r,s,F,E,g);break;case"compressed":for(const[de,Ie]of g.entries())G.compressedTexImage2D(t,de,Ie.format,Ie.width,Ie.height,a,Ie.data),_e+=Ie.levelSize;break;default:Bt(!1,"Unknown image data type")}}),this._trackAllocatedMemory("compressed"===K?_e:g&&g.byteLength?g.byteLength:this.width*this.height*(tO[this.dataFormat]||4)*(nO[this.type]||1),"Texture"),this.loaded=!0,this}setSubImageData(e){let{target:t=this.target,pixels:i=null,data:r=null,x:s=0,y:a=0,width:u=this.width,height:f=this.height,level:g=0,format:E=this.format,type:M=this.type,dataFormat:R=this.dataFormat,compressed:F=!1,offset:V=0,border:G=this.border,parameters:K={}}=e;if(({type:M,dataFormat:R,compressed:F,width:u,height:f}=this._deduceParameters({format:E,type:M,dataFormat:R,compressed:F,data:r,width:u,height:f})),Bt(0===this.depth,"texSubImage not supported for 3D textures"),r||(r=i),r&&r.data){const se=r;r=se.data,u=se.shape[0],f=se.shape[1]}r instanceof Nr&&(r=r.handle),this.gl.bindTexture(this.target,this.handle),Ou(this.gl,K,()=>{if(F)this.gl.compressedTexSubImage2D(t,g,s,a,u,f,E,r);else if(null===r)this.gl.texSubImage2D(t,g,s,a,u,f,R,M,null);else if(ArrayBuffer.isView(r))this.gl.texSubImage2D(t,g,s,a,u,f,R,M,r,V);else if(r instanceof iO){const se=wl(this.gl);se.bindBuffer(35052,r),se.texSubImage2D(t,g,s,a,u,f,R,M,V),se.bindBuffer(35052,null)}else Hi(this.gl)?wl(this.gl).texSubImage2D(t,g,s,a,u,f,R,M,r):this.gl.texSubImage2D(t,g,s,a,R,M,r)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return cn.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.textureUnit;const{gl:t}=this;return void 0!==e&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.textureUnit;const{gl:t}=this;return void 0!==e&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.target,null),e}_getDataType(e){let{data:t,compressed:i=!1}=e;return i?{data:t,dataType:"compressed"}:null===t?{data:t,dataType:"null"}:ArrayBuffer.isView(t)?{data:t,dataType:"typed-array"}:t instanceof Nr?{data:t.handle,dataType:"buffer"}:t instanceof iO?{data:t,dataType:"buffer"}:{data:t,dataType:"browser-object"}}_deduceParameters(e){const{format:t,data:i}=e;let{width:r,height:s,dataFormat:a,type:u,compressed:f}=e;const g=GC[t];return a=a||g&&g.dataFormat,u=u||g&&g.types[0],f=f||g&&g.compressed,({width:r,height:s}=this._deduceImageSize(i,r,s)),{dataFormat:a,type:u,compressed:f,width:r,height:s,format:t,data:i}}_deduceImageSize(e,t,i){let r;return r=typeof ImageData<"u"&&e instanceof ImageData?{width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?{width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?{width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e?{width:t,height:i}:{width:t>=0?t:1,height:i>=0?i:1},Bt(r,"Could not deduced texture size"),Bt(void 0===t||r.width===t,"Deduced texture width does not match supplied width"),Bt(void 0===i||r.height===i,"Deduced texture height does not match supplied height"),r}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const t=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),t}}_setParameter(e,t){switch(this.gl.bindTexture(this.target,this.handle),t=this._getNPOTParam(e,t),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,t);break;case 4096:case 4097:Bt(!1);break;default:this.gl.texParameteri(this.target,e,t)}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return!(Hi(this.gl)||!this.width||!this.height||KL(this.width)&&KL(this.height))}_updateForNPOT(e){void 0===e[this.gl.TEXTURE_MIN_FILTER]&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),void 0===e[this.gl.TEXTURE_WRAP_S]&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),void 0===e[this.gl.TEXTURE_WRAP_T]&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,t){if(this._isNPOT())switch(e){case 10241:-1===Mq.indexOf(t)&&(t=9729);break;case 10242:case 10243:33071!==t&&(t=33071)}return t}}function Aq(n,e){return Bt("string"==typeof n),n=""+n,new Promise((t,i)=>{try{const r=new Image;r.onload=()=>t(r),r.onerror=()=>i(new Error("Could not load image ".concat(n,"."))),r.crossOrigin=e&&e.crossOrigin||"anonymous",r.src=n}catch(r){i(r)}})}class Ql extends tg{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,t){return tg.isSupported(e,t)}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Ax(e),(t instanceof Promise||"string"==typeof t)&&(t={data:t}),"string"==typeof t.data&&(t=Object.assign({},t,{data:Aq(t.data)})),super(e,Object.assign({},t,{target:3553})),this.initialize(t),Object.seal(this)}}const ng="EXT_color_buffer_float",rO={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:ng,bpp:2},33327:{gl2:ng,bpp:4},34842:{gl2:ng,bpp:8},33326:{gl2:ng,bpp:4},33328:{gl2:ng,bpp:8},34836:{gl2:ng,bpp:16},35898:{gl2:ng,bpp:4}};class W_ extends kf{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{format:null};return!t||function Dq(n,e,t){const i=t[e];if(!i)return!1;const r=Hi(n)&&i.gl2||i.gl1;return"string"==typeof r?n.getExtension(r):r}(e,t,rO)}static getSamplesForFormat(e,t){let{format:i}=t;return e.getInternalformatParameter(36161,i,32937)}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,t),this.initialize(t),Object.seal(this)}initialize(e){let{format:t,width:i=1,height:r=1,samples:s=0}=e;return Bt(t,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),0!==s&&Hi(this.gl)?this.gl.renderbufferStorageMultisample(36161,s,t,i,r):this.gl.renderbufferStorage(36161,t,i,r),this.format=t,this.width=i,this.height=r,this.samples=s,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*rO[this.format].bpp),this}resize(e){let{width:t,height:i}=e;return t!==this.width||i!==this.height?this.initialize({width:t,height:i,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const sO=6144,lO=34041,cO="clear: bad arguments";function $C(n){let{framebuffer:e=null,color:t=null,depth:i=null,stencil:r=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s={};e&&(s.framebuffer=e);let a=0;t&&(a|=16384,!0!==t&&(s.clearColor=t)),i&&(a|=256,!0!==i&&(s.clearDepth=i)),r&&(a|=1024,!0!==i&&(s.clearStencil=i)),Bt(0!==a,cO),Ou(n,s,()=>{n.clear(a)})}const qC=[34069,34070,34071,34072,34073,34074];let Oq=(()=>{class n extends tg{get[Symbol.toStringTag](){return"TextureCube"}constructor(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Ax(t),super(t,Object.assign({},i,{target:34067})),this.initialize(i),Object.seal(this)}initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{mipmaps:i=!0,parameters:r={}}=t;return this.opts=t,this.setCubeMapImageData(t).then(()=>{this.loaded=!0,i&&this.generateMipmap(t),this.setParameters(r)}),this}subImage(t){let{face:i,data:r,x:s=0,y:a=0,mipmapLevel:u=0}=t;return this._subImage({target:i,data:r,x:s,y:a,mipmapLevel:u})}setCubeMapImageData(t){var i=this;return As(function*(){let{width:r,height:s,pixels:a,data:u,border:f=0,format:g=6408,type:E=5121}=t;const{gl:M}=i,R=a||u,F=yield Promise.all(qC.map(V=>{const G=R[V];return Promise.all(Array.isArray(G)?G:[G])}));i.bind(),qC.forEach((V,G)=>{F[G].length>1&&!1!==i.opts.mipmaps&&cn.warn("".concat(i.id," has mipmap and multiple LODs."))(),F[G].forEach((K,se)=>{r&&s?M.texImage2D(V,se,g,r,s,f,g,E,K):M.texImage2D(V,se,g,g,E,K)})}),i.unbind()})()}setImageDataForFace(t){const{face:i,width:r,height:s,pixels:a,data:u,border:f=0,format:g=6408,type:E=5121}=t,{gl:M}=this,R=a||u;return this.bind(),R instanceof Promise?R.then(F=>this.setImageDataForFace(Object.assign({},t,{face:i,data:F,pixels:F}))):this.width||this.height?M.texImage2D(i,0,g,r,s,f,g,E,R):M.texImage2D(i,0,g,g,E,R),this}}return n.FACES=qC,n})();class Fq extends tg{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return Hi(e)}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};wl(e),t=Object.assign({depth:1},t,{target:32879,unpackFlipY:!1}),super(e,t),this.initialize(t),Object.seal(this)}setImageData(e){let{level:t=0,dataFormat:i=6408,width:r,height:s,depth:a=1,border:u=0,format:f,type:g=5121,offset:E=0,data:M,parameters:R={}}=e;return this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Ou(this.gl,R,()=>{ArrayBuffer.isView(M)&&this.gl.texImage3D(this.target,t,i,r,s,a,u,f,g,M),M instanceof Nr&&(this.gl.bindBuffer(35052,M.handle),this.gl.texImage3D(this.target,t,i,r,s,a,u,f,g,E))}),this._trackAllocatedMemory(M&&M.byteLength?M.byteLength:this.width*this.height*this.depth*(tO[this.dataFormat]||4)*(nO[this.type]||1),"Texture"),this.loaded=!0,this}}function Bq(n,e){const{gl:t,width:i,height:r,id:s}=n;return new zo(t,Object.assign({},e,{id:"framebuffer-for-".concat(s),width:i,height:r,attachments:{36064:n}}))}function Dx(n){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{sourceX:t=0,sourceY:i=0,sourceFormat:r=6408}=e;let{sourceAttachment:s=36064,target:a=null,sourceWidth:u,sourceHeight:f,sourceType:g}=e;const{framebuffer:E,deleteFramebuffer:M}=zv(n);Bt(E);const{gl:R,handle:F,attachments:V}=E;u=u||E.width,f=f||E.height,36064===s&&null===F&&(s=1028),Bt(V[s]),g=g||V[s].type,a=Vq(a,g,r,u,f),g=g||jC(a);const G=R.bindFramebuffer(36160,F);return R.readPixels(t,i,u,f,r,g,a),R.bindFramebuffer(36160,G||null),M&&E.delete(),a}function ZC(n){let{sourceAttachment:e=36064,targetMaxHeight:t=Number.MAX_SAFE_INTEGER}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=Dx(n,{sourceAttachment:e}),{width:r,height:s}=n;for(;s>t;)({data:i,width:r,height:s}=bq({data:i,width:r,height:s}));vq({data:i,width:r,height:s});const a=document.createElement("canvas");a.width=r,a.height=s;const u=a.getContext("2d"),f=u.createImageData(r,s);return f.data.set(i),u.putImageData(f,0,0),a.toDataURL()}function zv(n){return n instanceof zo?{framebuffer:n,deleteFramebuffer:!1}:{framebuffer:Bq(n),deleteFramebuffer:!0}}function Vq(n,e,t,i,r){if(n)return n;const s=Bv(e=e||5121,{clamped:!1}),a=function Lq(n){switch(n){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return Bt(!1),0}}(t);return new s(i*r*a)}const uO={WEBGL2:[!1,!0],VERTEX_ARRAY_OBJECT:["OES_vertex_array_object",!0],TIMER_QUERY:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],INSTANCED_RENDERING:["ANGLE_instanced_arrays",!0],MULTIPLE_RENDER_TARGETS:["WEBGL_draw_buffers",!0],ELEMENT_INDEX_UINT32:["OES_element_index_uint",!0],BLEND_EQUATION_MINMAX:["EXT_blend_minmax",!0],FLOAT_BLEND:["EXT_float_blend"],COLOR_ENCODING_SRGB:["EXT_sRGB",!0],TEXTURE_DEPTH:["WEBGL_depth_texture",!0],TEXTURE_FLOAT:["OES_texture_float",!0],TEXTURE_HALF_FLOAT:["OES_texture_half_float",!0],TEXTURE_FILTER_LINEAR_FLOAT:["OES_texture_float_linear"],TEXTURE_FILTER_LINEAR_HALF_FLOAT:["OES_texture_half_float_linear"],TEXTURE_FILTER_ANISOTROPIC:["EXT_texture_filter_anisotropic"],COLOR_ATTACHMENT_RGBA32F:[function Uq(n){const e=new Ql(n,{format:6408,type:5126,dataFormat:6408}),t=new zo(n,{id:"test-framebuffer",check:!1,attachments:{36064:e}}),i=t.getStatus();return e.delete(),t.delete(),36053===i},"EXT_color_buffer_float"],COLOR_ATTACHMENT_FLOAT:[!1,"EXT_color_buffer_float"],COLOR_ATTACHMENT_HALF_FLOAT:["EXT_color_buffer_half_float"],GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]};function hO(n,e){return(e=Array.isArray(e)?e:[e]).every(t=>dO(n,t))}function dO(n,e){return n.luma=n.luma||{},n.luma.caps=n.luma.caps||{},void 0===n.luma.caps[e]&&(n.luma.caps[e]=function Wq(n,e){const t=uO[e];let i;Bt(t,e);const r=Hi(n)&&t[1]||t[0];if("function"==typeof r)i=r(n);else if(Array.isArray(r)){i=!0;for(const s of r)i=i&&Boolean(n.getExtension(s))}else"string"==typeof r?i=Boolean(n.getExtension(r)):"boolean"==typeof r?i=r:Bt(!1);return i}(n,e)),n.luma.caps[e]||cn.log(2,"Feature: ".concat(e," not supported"))(),n.luma.caps[e]}const fO="Multiple render targets not supported";class zo extends kf{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{colorBufferFloat:i,colorBufferHalfFloat:r}=t;let s=!0;return i&&(s=Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),r&&(s=s&&Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),s}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new zo(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=wl(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=wl(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,t),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(t),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:t=1,height:i=1,attachments:r=null,color:s=!0,depth:a=!0,stencil:u=!1,check:f=!0,readBuffer:g,drawBuffers:E}=e;if(Bt(t>=0&&i>=0,"Width and height need to be integers"),this.width=t,this.height=i,r)for(const M in r){const R=r[M];(Array.isArray(R)?R[0]:R).resize({width:t,height:i})}else r=this._createDefaultAttachments(s,a,u,t,i);this.update({clearAttachments:!0,attachments:r,readBuffer:g,drawBuffers:E}),r&&f&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:t={},readBuffer:i,drawBuffers:r,clearAttachments:s=!1,resizeAttachments:a=!0}=e;this.attach(t,{clearAttachments:s,resizeAttachments:a});const{gl:u}=this,f=u.bindFramebuffer(36160,this.handle);return i&&this._setReadBuffer(i),r&&this._setDrawBuffers(r),u.bindFramebuffer(36160,f||null),this}resize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{width:t,height:i}=e;if(null===this.handle)return Bt(void 0===t&&void 0===i),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;void 0===t&&(t=this.gl.drawingBufferWidth),void 0===i&&(i=this.gl.drawingBufferHeight),t!==this.width&&i!==this.height&&cn.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(t,"x").concat(i))();for(const r in this.attachments)this.attachments[r].resize({width:t,height:i});return this.width=t,this.height=i,this}attach(e){let{clearAttachments:t=!1,resizeAttachments:i=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r={};t&&Object.keys(this.attachments).forEach(a=>{r[a]=null}),Object.assign(r,e);const s=this.gl.bindFramebuffer(36160,this.handle);for(const a in r){Bt(void 0!==a,"Misspelled framebuffer binding point?");const u=Number(a),f=r[u];let g=f;if(g)if(g instanceof W_)this._attachRenderbuffer({attachment:u,renderbuffer:g});else if(Array.isArray(f)){const[E,M=0,R=0]=f;g=E,this._attachTexture({attachment:u,texture:E,layer:M,level:R})}else this._attachTexture({attachment:u,texture:g,layer:0,level:0});else this._unattach(u);i&&g&&g.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,s||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(a=>!this.attachments[a]).forEach(a=>{delete this.attachments[a]})}checkStatus(){const t=this.getStatus();if(36053!==t)throw new Error(function qq(n){return(zo.STATUS||{})[n]||"Framebuffer error ".concat(n)}(t));return this}getStatus(){const{gl:e}=this,t=e.bindFramebuffer(36160,this.handle),i=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,t||null),i}clear(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{color:t,depth:i,stencil:r,drawBuffers:s=[]}=e,a=this.gl.bindFramebuffer(36160,this.handle);return(t||i||r)&&$C(this.gl,{color:t,depth:i,stencil:r}),s.forEach((u,f)=>{!function Rq(n){let{framebuffer:e=null,buffer:t=sO,drawBuffer:i=0,value:r=[0,0,0,0]}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};wl(n),Ou(n,{framebuffer:e},()=>{switch(t){case sO:switch(r.constructor){case Int32Array:n.clearBufferiv(t,i,r);break;case Uint32Array:n.clearBufferuiv(t,i,r);break;case Float32Array:default:n.clearBufferfv(t,i,r)}break;case 6145:n.clearBufferfv(6145,0,[r]);break;case 6146:n.clearBufferiv(6146,0,[r]);break;case lO:const[s,a]=r;n.clearBufferfi(lO,0,s,a);break;default:Bt(!1,cO)}})}(this.gl,{drawBuffer:f,value:u})}),this.gl.bindFramebuffer(36160,a||null),this}readPixels(){return cn.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return cn.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return cn.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return cn.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return cn.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return cn.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:t=[],x:i=0,y:r=0,width:s,height:a}=e;const u=wl(this.gl),f=u.bindFramebuffer(36008,this.handle);return 0===i&&0===r&&void 0===s&&void 0===a?u.invalidateFramebuffer(36008,t):u.invalidateFramebuffer(36008,t,i,r,s,a),u.bindFramebuffer(36008,f),this}getAttachmentParameter(e,t,i){let r=this._getAttachmentParameterFallback(t);return null===r&&(this.gl.bindFramebuffer(36160,this.handle),r=this.gl.getFramebufferAttachmentParameter(36160,e,t),this.gl.bindFramebuffer(36160,null)),i&&r>1e3&&(r=Rp(this.gl,r)),r}getAttachmentParameters(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:36064,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const r={};for(const s of i)r[t?Rp(this.gl,s):s]=this.getAttachmentParameter(e,s,t);return r}getParameters(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=Object.keys(this.attachments),i={};for(const r of t){const s=Number(r);i[e?Rp(this.gl,s):s]=this.getAttachmentParameters(s,e)}return i}show(){return typeof window<"u"&&window.open(ZC(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(e>cn.level||typeof window>"u")return this;t=t||"Framebuffer ".concat(this.id);const i=ZC(this,{targetMaxHeight:100});return cn.image({logLevel:e,message:t,image:i},t)(),this}bind(){let{target:e=36160}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,t,i,r,s){let a=null;return e&&(a=a||{},a[36064]=new Ql(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:r,height:s,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(a[36064])),t&&i?(a=a||{},a[33306]=new W_(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:r,height:111}),this.ownResources.push(a[33306])):t?(a=a||{},a[36096]=new W_(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:r,height:s}),this.ownResources.push(a[36096])):i&&Bt(!1),a}_unattach(e){const t=this.attachments[e];!t||(t instanceof W_?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:t=36064,renderbuffer:i}=e;const{gl:r}=this;r.framebufferRenderbuffer(36160,t,36161,i.handle),this.attachments[t]=i}_attachTexture(e){let{attachment:t=36064,texture:i,layer:r,level:s}=e;const{gl:a}=this;switch(a.bindTexture(i.target,i.handle),i.target){case 35866:case 32879:wl(a).framebufferTextureLayer(36160,t,i.target,s,r);break;case 34067:const f=function $q(n){return n<34069?n+34069:n}(r);a.framebufferTexture2D(36160,t,f,i.handle,s);break;case 3553:a.framebufferTexture2D(36160,t,3553,i.handle,s);break;default:Bt(!1,"Illegal texture type")}a.bindTexture(i.target,null),this.attachments[t]=i}_setReadBuffer(e){const t=function w7(n){return Hi(n)?n:null}(this.gl);t?t.readBuffer(e):Bt(36064===e||1029===e,fO),this.readBuffer=e}_setDrawBuffers(e){const{gl:t}=this,i=wl(t);if(i)i.drawBuffers(e);else{const r=t.getExtension("WEBGL_draw_buffers");r?r.drawBuffersWEBGL(e):Bt(1===e.length&&(36064===e[0]||1029===e[0]),fO)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const t=function Gq(n){n.luma=n.luma||{},n.luma.caps=n.luma.caps||{};for(const e in uO)void 0===n.luma.caps[e]&&(n.luma.caps[e]=dO(n,e));return n.luma.caps}(this.gl);switch(e){case 36052:return t.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return t.WEBGL2?null:8;case 33297:return t.WEBGL2?null:5125;case 33296:return t.WEBGL2||t.EXT_sRGB?null:9729;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}zo.ATTACHMENT_PARAMETERS=[36049,36048,33296,33298,33299,33300,33301,33302,33303];const Xq={5126:gs.bind(null,"uniform1fv",ru,1,El),35664:gs.bind(null,"uniform2fv",ru,2,El),35665:gs.bind(null,"uniform3fv",ru,3,El),35666:gs.bind(null,"uniform4fv",ru,4,El),5124:gs.bind(null,"uniform1iv",Op,1,El),35667:gs.bind(null,"uniform2iv",Op,2,El),35668:gs.bind(null,"uniform3iv",Op,3,El),35669:gs.bind(null,"uniform4iv",Op,4,El),35670:gs.bind(null,"uniform1iv",Op,1,El),35671:gs.bind(null,"uniform2iv",Op,2,El),35672:gs.bind(null,"uniform3iv",Op,3,El),35673:gs.bind(null,"uniform4iv",Op,4,El),35674:gs.bind(null,"uniformMatrix2fv",ru,4,Rf),35675:gs.bind(null,"uniformMatrix3fv",ru,9,Rf),35676:gs.bind(null,"uniformMatrix4fv",ru,16,Rf),35678:qa,35680:qa,5125:gs.bind(null,"uniform1uiv",Ix,1,El),36294:gs.bind(null,"uniform2uiv",Ix,2,El),36295:gs.bind(null,"uniform3uiv",Ix,3,El),36296:gs.bind(null,"uniform4uiv",Ix,4,El),35685:gs.bind(null,"uniformMatrix2x3fv",ru,6,Rf),35686:gs.bind(null,"uniformMatrix2x4fv",ru,8,Rf),35687:gs.bind(null,"uniformMatrix3x2fv",ru,6,Rf),35688:gs.bind(null,"uniformMatrix3x4fv",ru,12,Rf),35689:gs.bind(null,"uniformMatrix4x2fv",ru,8,Rf),35690:gs.bind(null,"uniformMatrix4x3fv",ru,12,Rf),35678:qa,35680:qa,35679:qa,35682:qa,36289:qa,36292:qa,36293:qa,36298:qa,36299:qa,36300:qa,36303:qa,36306:qa,36307:qa,36308:qa,36311:qa},Yq={},Kq={},Jq={},pO=[0];function XC(n,e,t,i){1===e&&"boolean"==typeof n&&(n=n?1:0),Number.isFinite(n)&&(pO[0]=n,n=pO);const r=n.length;if(r%e&&cn.warn("Uniform size should be multiples of ".concat(e),n)(),n instanceof t)return n;let s=i[r];s||(s=new t(r),i[r]=s);for(let a=0;a<r;a++)s[a]=n[a];return s}function ru(n,e){return XC(n,e,Float32Array,Yq)}function Op(n,e){return XC(n,e,Int32Array,Kq)}function Ix(n,e){return XC(n,e,Uint32Array,Jq)}function mO(n,e,t){const i=Xq[t.type];if(!i)throw new Error("Unknown GLSL uniform type ".concat(t.type));return i().bind(null,n,e)}function Qq(n){if("]"!==n[n.length-1])return{name:n,length:1,isArray:!1};const t=n.match(/([^[]*)(\[[0-9]+\])?/);if(!t||t.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(n));return{name:t[1],length:t[2]||1,isArray:Boolean(t[2])}}function tZ(n){return Array.isArray(n)||ArrayBuffer.isView(n)?function iZ(n){if(0===n.length)return!1;const e=Math.min(n.length,16);for(let t=0;t<e;++t)if(!Number.isFinite(n[t]))return!1;return!0}(n):!!(isFinite(n)||!0===n||!1===n||n instanceof tg||n instanceof W_)||n instanceof zo&&Boolean(n.texture)}function nZ(n,e,t){if(Array.isArray(t)||ArrayBuffer.isView(t))if(n[e]){const i=n[e];for(let r=0,s=t.length;r<s;++r)i[r]=t[r]}else n[e]=t.slice();else n[e]=t}function qa(){let n=null;return(e,t,i)=>{const r=n!==i;return r&&(e.uniform1i(t,i),n=i),r}}function gs(n,e,t,i){let r=null,s=null;return(a,u,f)=>{const g=e(f,t),E=g.length;let M=!1;if(null===r)r=new Float32Array(E),s=E,M=!0;else{Bt(s===E,"Uniform length cannot change.");for(let R=0;R<E;++R)if(g[R]!==r[R]){M=!0;break}}return M&&(i(a,n,u,g),r.set(g)),M}}function El(n,e,t,i){n[e](t,i)}function Rf(n,e,t,i){n[e](t,!1,i)}function Px(n){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unnamed";const t=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,i=n.match(t);return i?i[1]:e}function _O(n,e){let t="";for(let i=0;i<e.length;i++){const r=e[i];if((n[i+3]||n[i+2]||n[i+1])&&(t+="".concat(r,"\n"),n[i+1])){const s=n[i+1],a=s.split(":",3),u=a[0],f=parseInt(a[1],10)||0,g=s.substring(a.join(":").length+1).trim();t+=yO("^^^ ".concat(u,": ").concat(g,"\n\n"),f)}}return t}function yO(n,e){let t="";for(let i=0;i<e;++i)t+=" ";return"".concat(t).concat(n)}class Vv extends kf{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return Bt(!1),"unknown"}}constructor(e,t){Ax(e),Bt("string"==typeof t.source,"Shader: GLSL source code must be a JavaScript string"),super(e,{id:Px(t.source,null)||t.id||Lp("unnamed ".concat(Vv.getTypeName(t.shaderType)))}),this.shaderType=t.shaderType,this.source=t.source,this.initialize(t)}initialize(e){let{source:t}=e;const i=Px(t,null);i&&(this.id=Lp(i)),this._compile(t)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat(Vv.getTypeName(this.shaderType),":").concat(this.id)}getName(){return Px(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.source;if(e.startsWith("#version ")||(e="#version 100\n".concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const i=this.gl.getShaderInfoLog(this.handle),{shaderName:r,errors:s,warnings:a}=function gO(n,e,t,i){const r=n.split(/\r?\n/),s={},a={},u=i||Px(e)||"(unnamed)",f="".concat(function oZ(n){switch(n){case 35632:return"fragment";case 35633:return"vertex";default:return"unknown type"}}(t)," shader ").concat(u);for(let E=0;E<r.length;E++){const M=r[E];if(M.length<=1)continue;const R=M.split(":"),F=R[0],V=parseInt(R[2],10);if(isNaN(V))throw new Error("GLSL compilation error in ".concat(f,": ").concat(n));"WARNING"!==F?s[V]=M:a[V]=M}const g=function aZ(n){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:": ";const i=n.split(/\r?\n/),r=String(i.length+e-1).length;return i.map((s,a)=>{const u=String(a+e);return yO(u,r-u.length)+t+s})}(e);return{shaderName:f,errors:_O(s,g),warnings:_O(a,g)}}(i,this.source,this.shaderType,this.id);throw cn.error("GLSL compilation errors in ".concat(r,"\n").concat(s))(),cn.warn("GLSL compilation warnings in ".concat(r,"\n").concat(a))(),new Error("GLSL compilation errors in ".concat(r))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class YC extends Vv{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,t){"string"==typeof t&&(t={source:t}),super(e,Object.assign({},t,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class KC extends Vv{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,t){"string"==typeof t&&(t={source:t}),super(e,Object.assign({},t,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const oa=5126,Uv=5124,jv=5125,JC={[oa]:[oa,1,"float"],35664:[oa,2,"vec2"],35665:[oa,3,"vec3"],35666:[oa,4,"vec4"],[Uv]:[Uv,1,"int"],35667:[Uv,2,"ivec2"],35668:[Uv,3,"ivec3"],35669:[Uv,4,"ivec4"],[jv]:[jv,1,"uint"],36294:[jv,2,"uvec2"],36295:[jv,3,"uvec3"],36296:[jv,4,"uvec4"],35670:[oa,1,"bool"],35671:[oa,2,"bvec2"],35672:[oa,3,"bvec3"],35673:[oa,4,"bvec4"],35674:[oa,8,"mat2"],35685:[oa,8,"mat2x3"],35686:[oa,8,"mat2x4"],35675:[oa,12,"mat3"],35687:[oa,12,"mat3x2"],35688:[oa,12,"mat3x4"],35676:[oa,16,"mat4"],35689:[oa,16,"mat4x2"],35690:[oa,16,"mat4x3"]};function TO(n){const e=JC[n];if(!e)return null;const[t,i]=e;return{type:t,components:i}}function CO(n,e){switch(n){case 5120:case 5121:case 5122:case 5123:n=oa}for(const t in JC){const[i,r,s]=JC[t];if(i===n&&r===e)return{glType:t,name:s}}return null}class FZ{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const t=Number(e);return Number.isFinite(t)?this.attributeInfosByLocation[t]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const t=this.getAttributeInfo(e);return t?t.location:-1}getAttributeAccessor(e){const t=this.getAttributeInfo(e);return t?t.accessor:null}getVaryingInfo(e){const t=Number(e);return Number.isFinite(t)?this.varyingInfos[t]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const t=this.getVaryingInfo();return t?t.location:-1}getVaryingAccessor(e){const t=this.getVaryingInfo();return t?t.accessor:null}_readAttributesFromProgram(e){const{gl:t}=e,i=t.getProgramParameter(e.handle,35721);for(let r=0;r<i;r++){const{name:s,type:a,size:u}=t.getActiveAttrib(e.handle,r),f=t.getAttribLocation(e.handle,s);f>=0&&this._addAttribute(f,s,a,u)}this.attributeInfos.sort((r,s)=>r.location-s.location)}_readVaryingsFromProgram(e){const{gl:t}=e;if(!Hi(t))return;const i=t.getProgramParameter(e.handle,35971);for(let r=0;r<i;r++){const{name:s,type:a,size:u}=t.getTransformFeedbackVarying(e.handle,r);this._addVarying(r,s,a,u)}this.varyingInfos.sort((r,s)=>r.location-s.location)}_addAttribute(e,t,i,r){const{type:s,components:a}=TO(i),u={type:s,size:r*a};this._inferProperties(e,t,u);const f={location:e,name:t,accessor:new iu(u)};this.attributeInfos.push(f),this.attributeInfosByLocation[e]=f,this.attributeInfosByName[f.name]=f}_inferProperties(e,t,i){/instance/i.test(t)&&(i.divisor=1)}_addVarying(e,t,i,r){const{type:s,components:a}=TO(i),f={location:e,name:t,accessor:new iu({type:s,size:r*a})};this.varyingInfos.push(f),this.varyingInfosByName[f.name]=f}}const NZ=35981,BZ=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class MO extends kf{get[Symbol.toStringTag](){return"Program"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,t),this.stubRemovedMethods("Program","v6.0",BZ),this._isCached=!1,this.initialize(t),Object.seal(this),this._setId(t.id)}initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{hash:t,vs:i,fs:r,varyings:s,bufferMode:a=NZ}=e;return this.hash=t||"",this.vs="string"==typeof i?new YC(this.gl,{id:"".concat(e.id,"-vs"),source:i}):i,this.fs="string"==typeof r?new KC(this.gl,{id:"".concat(e.id,"-fs"),source:r}):r,Bt(this.vs instanceof YC),Bt(this.fs instanceof KC),this.uniforms={},this._textureUniforms={},s&&s.length>0&&(wl(this.gl),this.varyings=s,this.gl2.transformFeedbackVaryings(this.handle,s,a)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new FZ(this),this.setProps(e)}delete(){return this._isCached?this:super.delete(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:t,drawMode:i=4,vertexCount:r,offset:s=0,start:a,end:u,isIndexed:f=!1,indexType:g=5123,instanceCount:E=0,isInstanced:M=E>0,vertexArray:R=null,transformFeedback:F,framebuffer:V,parameters:G={},uniforms:K,samplers:se}=e;if((K||se)&&(cn.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(K||{})),cn.priority>=t){const _e=V?V.id:"default",de="mode=".concat(Rp(this.gl,i)," verts=").concat(r," ")+"instances=".concat(E," indexType=").concat(Rp(this.gl,g)," ")+"isInstanced=".concat(M," isIndexed=").concat(f," ")+"Framebuffer=".concat(_e);cn.log(t,de)()}return Bt(R),this.gl.useProgram(this.handle),!(!this._areTexturesRenderable()||0===r||M&&0===E||(R.bindForDraw(r,E,()=>{if(void 0!==V&&(G=Object.assign({},G,{framebuffer:V})),F){const _e=function EO(n){switch(n){case 0:return 0;case 1:case 3:case 2:return 1;case 4:case 5:case 6:return 4;default:return Bt(!1),0}}(i);F.begin(_e)}this._bindTextures(),Ou(this.gl,G,()=>{f&&M?this.gl2.drawElementsInstanced(i,r,g,s,E):f&&Hi(this.gl)&&!isNaN(a)&&!isNaN(u)?this.gl2.drawRangeElements(i,a,u,r,g,s):f?this.gl.drawElements(i,r,g,s):M?this.gl2.drawArraysInstanced(i,s,r,E):this.gl.drawArrays(i,s,r)}),F&&F.end()}),0))}setUniforms(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};cn.priority>=2&&function eZ(n,e,t){for(const i in n){const r=n[i];if((!t||Boolean(t[i]))&&!tZ(r))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(i),r),new Error("".concat(e," Bad uniform ").concat(i))}}(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const t in e){const i=e[t],r=this._uniformSetters[t];if(r){let s=i,a=!1;if(s instanceof zo&&(s=s.texture),s instanceof tg)if(a=this.uniforms[t]!==i,a){void 0===r.textureIndex&&(r.textureIndex=this._textureIndexCounter++);const u=s,{textureIndex:f}=r;u.bind(f),s=f,this._textureUniforms[t]=u}else s=r.textureIndex;else this._textureUniforms[t]&&delete this._textureUniforms[t];(r(s)||a)&&nZ(this.uniforms,t,i)}}return this}_areTexturesRenderable(){let e=!0;for(const t in this._textureUniforms){const i=this._textureUniforms[t];i.update(),e=e&&i.loaded}return e}_bindTextures(){for(const e in this._textureUniforms)this._textureUniforms[e].bind(this._uniformSetters[e].textureIndex)}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const t=this.gl.getAttachedShaders(e),i={};for(const r of t)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:i.vs=new YC({handle:r});break;case 35632:i.fs=new KC({handle:r})}return i}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const t=this._getName();this.id=Lp(t)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),cn.time(4,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),cn.timeEnd(4,"linkProgram for ".concat(this._getName()))(),e.debug||cn.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let t=0;t<this._uniformCount;t++){const i=this.gl.getActiveUniform(this.handle,t),{name:r}=Qq(i.name);let s=e.getUniformLocation(this.handle,r);if(this._uniformSetters[r]=mO(e,s,i),i.size>1)for(let a=0;a<i.size;a++)s=e.getUniformLocation(this.handle,"".concat(r,"[").concat(a,"]")),this._uniformSetters["".concat(r,"[").concat(a,"]")]=mO(e,s,i)}this._textureIndexCounter=0}getActiveUniforms(e,t){return this.gl2.getActiveUniforms(this.handle,e,t)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,t){return this.gl2.getActiveUniformBlockParameter(this.handle,e,t)}uniformBlockBinding(e,t){this.gl2.uniformBlockBinding(this.handle,e,t)}}class Hv{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new Hv(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(t=>t.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const t="string"==typeof e?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==t),this.stateHash++}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{vs:t="",fs:i="",defines:r={},inject:s={},varyings:a=[],bufferMode:u=35981,transpileToGLSL100:f=!1}=e,g=this._getModuleList(e.modules),E=this._getHash(t),M=this._getHash(i),R=g.map(de=>this._getHash(de.name)).sort(),F=a.map(de=>this._getHash(de)),V=Object.keys(r).sort(),G=Object.keys(s).sort(),K=[],se=[];for(const de of V)K.push(this._getHash(de)),K.push(this._getHash(r[de]));for(const de of G)se.push(this._getHash(de)),se.push(this._getHash(s[de]));const _e="".concat(E,"/").concat(M,"D").concat(K.join("/"),"M").concat(R.join("/"),"I").concat(se.join("/"),"V").concat(F.join("/"),"H").concat(this.stateHash,"B").concat(u).concat(f?"T":"");if(!this._programCache[_e]){const de=function f7(n,e){const{vs:t,fs:i}=e,r=j9(e.modules||[]);return{gl:n,vs:RL(n,Object.assign({},e,{source:t,type:Rv,modules:r})),fs:RL(n,Object.assign({},e,{source:i,type:"fs",modules:r})),getUniforms:p7(r)}}(this.gl,{vs:t,fs:i,modules:g,inject:s,defines:r,hookFunctions:this._hookFunctions,transpileToGLSL100:f});this._programCache[_e]=new MO(this.gl,{hash:_e,vs:de.vs,fs:de.fs,varyings:a,bufferMode:u}),this._getUniforms[_e]=de.getUniforms||(Ie=>{}),this._useCounts[_e]=0}return this._useCounts[_e]++,this._programCache[_e]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const t=e.hash;this._useCounts[t]--,0===this._useCounts[t]&&(this._programCache[t].delete(),delete this._programCache[t],delete this._getUniforms[t],delete this._useCounts[t])}_getHash(e){return void 0===this._hashes[e]&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=new Array(this._defaultModules.length+e.length),i={};let r=0;for(let s=0,a=this._defaultModules.length;s<a;++s){const u=this._defaultModules[s],f=u.name;t[r++]=u,i[f]=!0}for(let s=0,a=e.length;s<a;++s){const u=e[s],f=u.name;i[f]||(t[r++]=u,i[f]=!0)}return t.length=r,t}}const AO="#define SMOOTH_EDGE_RADIUS 0.5",jZ={name:"geometry",vs:"\n".concat(AO,"\n\nstruct VertexGeometry {\n  vec4 position;\n  vec3 worldPosition;\n  vec3 worldPositionAlt;\n  vec3 normal;\n  vec2 uv;\n  vec3 pickingColor;\n} geometry = VertexGeometry(\n  vec4(0.0, 0.0, 1.0, 0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec2(0.0),\n  vec3(0.0)\n);\n"),fs:"\n".concat(AO,"\n\nstruct FragmentGeometry {\n  vec2 uv;\n} geometry;\n\nfloat smoothedge(float edge, float x) {\n  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);\n}\n")},HZ=Object.keys(Dr).map(n=>"const int COORDINATE_SYSTEM_".concat(n," = ").concat(Dr[n],";")).join(""),GZ=Object.keys(Td).map(n=>"const int PROJECTION_MODE_".concat(n," = ").concat(Td[n],";")).join(""),WZ=Object.keys(Ym).map(n=>"const int UNIT_".concat(n.toUpperCase()," = ").concat(Ym[n],";")).join(""),$Z="".concat(HZ,"\n").concat(GZ,"\n").concat(WZ,'\n\nuniform int project_uCoordinateSystem;\nuniform int project_uProjectionMode;\nuniform float project_uScale;\nuniform bool project_uWrapLongitude;\nuniform vec3 project_uCommonUnitsPerMeter;\nuniform vec3 project_uCommonUnitsPerWorldUnit;\nuniform vec3 project_uCommonUnitsPerWorldUnit2;\nuniform vec4 project_uCenter;\nuniform mat4 project_uModelMatrix;\nuniform mat4 project_uViewProjectionMatrix;\nuniform vec2 project_uViewportSize;\nuniform float project_uDevicePixelRatio;\nuniform float project_uFocalDistance;\nuniform vec3 project_uCameraPosition;\nuniform vec3 project_uCoordinateOrigin;\nuniform vec3 project_uCommonOrigin;\nuniform bool project_uPseudoMeters;\n\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / (PI * 2.0);\nconst vec3 ZERO_64_LOW = vec3(0.0);\nconst float EARTH_RADIUS = 6370972.0; // meters\nconst float GLOBE_RADIUS = 256.0;\n\n// returns an adjustment factor for uCommonUnitsPerMeter\nfloat project_size() {\n  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&\n    project_uPseudoMeters == false) {\n\n    // uCommonUnitsPerMeter in low-zoom Web Mercator is non-linear\n    // Adjust by 1 / cos(latitude)\n    // If geometry.position (vertex in common space) is populated, use it\n    // Otherwise use geometry.worldPosition (anchor in world space)\n    \n    if (geometry.position.w == 0.0) {\n      float y = clamp(geometry.worldPosition.y, -89.9, 89.9);\n      return 1.0 / cos(radians(y));\n    }\n\n    // latitude from common y: 2.0 * (atan(exp(y / TILE_SIZE * 2.0 * PI - PI)) - PI / 4.0)\n    // Taylor series of 1 / cos(latitude)\n    // Max error < 0.003\n  \n    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;\n    float y2 = y * y;\n    float y4 = y2 * y2;\n    float y6 = y4 * y2;\n    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;\n  }\n  return 1.0;\n}\n//\n// Scaling offsets - scales meters to "world distance"\n// Note the scalar version of project_size is for scaling the z component only\n//\nfloat project_size(float meters) {\n  return meters * project_uCommonUnitsPerMeter.z * project_size();\n}\n\nvec2 project_size(vec2 meters) {\n  return meters * project_uCommonUnitsPerMeter.xy * project_size();\n}\n\nvec3 project_size(vec3 meters) {\n  return meters * project_uCommonUnitsPerMeter * project_size();\n}\n\nvec4 project_size(vec4 meters) {\n  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);\n}\n\n// Get rotation matrix that aligns the z axis with the given up vector\n// Find 3 unit vectors ux, uy, uz that are perpendicular to each other and uz == up\nmat3 project_get_orientation_matrix(vec3 up) {\n  vec3 uz = normalize(up);\n  // Tangent on XY plane\n  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));\n  vec3 uy = cross(uz, ux);\n  return mat3(ux, uy, uz);\n}\n\nbool project_needs_rotation(vec3 commonPosition, out mat3 transform) {\n  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\n    transform = project_get_orientation_matrix(commonPosition);\n    return true;\n  }\n  return false;\n}\n\n//\n// Projecting normal - transform deltas from current coordinate system to\n// normals in the worldspace\n//\nvec3 project_normal(vec3 vector) {\n  // Apply model matrix\n  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);\n  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);\n  mat3 rotation;\n  if (project_needs_rotation(geometry.position.xyz, rotation)) {\n    n = rotation * n;\n  }\n  return n;\n}\n\nvec4 project_offset_(vec4 offset) {\n  float dy = offset.y;\n  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;\n  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);\n}\n\n//\n// Projecting positions - non-linear projection: lnglats => unit tile [0-1, 0-1]\n//\nvec2 project_mercator_(vec2 lnglat) {\n  float x = lnglat.x;\n  if (project_uWrapLongitude) {\n    x = mod(x + 180., 360.0) - 180.;\n  }\n  float y = clamp(lnglat.y, -89.9, 89.9);\n  return vec2(\n    radians(x) + PI,\n    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))\n  ) * WORLD_SCALE;\n}\n\nvec3 project_globe_(vec3 lnglatz) {\n  float lambda = radians(lnglatz.x);\n  float phi = radians(lnglatz.y);\n  float cosPhi = cos(phi);\n  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;\n\n  return vec3(\n    sin(lambda) * cosPhi,\n    -cos(lambda) * cosPhi,\n    sin(phi)\n  ) * D;\n}\n\n//\n// Projects positions (defined by project_uCoordinateSystem) to common space (defined by project_uProjectionMode)\n//\nvec4 project_position(vec4 position, vec3 position64Low) {\n  vec4 position_world = project_uModelMatrix * position;\n\n  // Work around for a Mac+NVIDIA bug https://github.com/visgl/deck.gl/issues/4145\n  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4(\n        project_mercator_(position_world.xy),\n        project_size(position_world.z),\n        position_world.w\n      );\n    }\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {\n      position_world.xyz += project_uCoordinateOrigin;\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4(\n        project_globe_(position_world.xyz),\n        position_world.w\n      );\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {\n        // Too far from the projection center for offset mode to be accurate\n        // Only use high parts\n        return vec4(\n          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,\n          project_size(position_world.z),\n          position_world.w\n        );\n      }\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||\n    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&\n    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {\n    // Subtract high part of 64 bit value. Convert remainder to float32, preserving precision.\n    position_world.xyz -= project_uCoordinateOrigin;\n  }\n\n  // Translation is already added to the high parts\n  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));\n}\n\nvec4 project_position(vec4 position) {\n  return project_position(position, ZERO_64_LOW);\n}\n\nvec3 project_position(vec3 position, vec3 position64Low) {\n  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);\n  return projected_position.xyz;\n}\n\nvec3 project_position(vec3 position) {\n  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);\n  return projected_position.xyz;\n}\n\nvec2 project_position(vec2 position) {\n  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);\n  return projected_position.xy;\n}\n\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\n  return viewProjectionMatrix * position + center;\n}\n\n//\n// Projects from common space coordinates to clip space.\n// Uses project_uViewProjectionMatrix\n//\nvec4 project_common_position_to_clipspace(vec4 position) {\n  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);\n}\n\n// Returns a clip space offset that corresponds to a given number of screen pixels\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\n  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;\n  return offset * project_uFocalDistance;\n}\n\nfloat project_size_to_pixel(float meters) {\n  return project_size(meters) * project_uScale;\n}\nfloat project_size_to_pixel(float size, int unit) {\n  if (unit == UNIT_METERS) return project_size_to_pixel(size);\n  if (unit == UNIT_COMMON) return size * project_uScale;\n  // UNIT_PIXELS\n  return size;\n}\nfloat project_pixel_size(float pixels) {\n  return pixels / project_uScale;\n}\nvec2 project_pixel_size(vec2 pixels) {\n  return pixels / project_uScale;\n}\n');function qZ(n,e){if(n===e)return!0;if(Array.isArray(n)){const t=n.length;if(!e||e.length!==t)return!1;for(let i=0;i<t;i++)if(n[i]!==e[i])return!1;return!0}return!1}function Rx(n){let t,e={};return i=>{for(const r in i)if(!qZ(i[r],e[r])){t=n(i),e=i;break}return t}}const DO=[0,0,0,0],ZZ=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],IO=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],XZ=[0,0,0],PO=[0,0,0],YZ=Rx(function QZ({viewport:n,devicePixelRatio:e,coordinateSystem:t,coordinateOrigin:i}){const{projectionCenter:r,viewProjectionMatrix:s,originCommon:a,cameraPosCommon:u,shaderCoordinateOrigin:f,geospatialOrigin:g}=function KZ(n,e,t){const{viewMatrixUncentered:i,projectionMatrix:r}=n;let{viewMatrix:s,viewProjectionMatrix:a}=n,u=DO,f=DO,g=n.cameraPosition;const{geospatialOrigin:E,shaderCoordinateOrigin:M,offsetMode:R}=kO(n,e,t);return R&&(f=n.projectPosition(E||M),g=[g[0]-f[0],g[1]-f[1],g[2]-f[2]],f[3]=1,u=Pv([],f,a),s=i||s,a=Xm([],r,s),a=Xm([],a,ZZ)),{viewMatrix:s,viewProjectionMatrix:a,projectionCenter:u,originCommon:f,cameraPosCommon:g,shaderCoordinateOrigin:M,geospatialOrigin:E}}(n,t,i),E=n.getDistanceScales(),M=[n.width*e,n.height*e],R=Pv([],[0,0,-n.focalDistance,1],n.projectionMatrix)[3]||1,F={project_uCoordinateSystem:t,project_uProjectionMode:n.projectionMode,project_uCoordinateOrigin:f,project_uCommonOrigin:a.slice(0,3),project_uCenter:r,project_uPseudoMeters:Boolean(n._pseudoMeters),project_uViewportSize:M,project_uDevicePixelRatio:e,project_uFocalDistance:R,project_uCommonUnitsPerMeter:E.unitsPerMeter,project_uCommonUnitsPerWorldUnit:E.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:XZ,project_uScale:n.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:s,project_uModelMatrix:IO,project_uCameraPosition:u};if(g){const V=n.getDistanceScales(g);switch(t){case Dr.METER_OFFSETS:F.project_uCommonUnitsPerWorldUnit=V.unitsPerMeter,F.project_uCommonUnitsPerWorldUnit2=V.unitsPerMeter2;break;case Dr.LNGLAT:case Dr.LNGLAT_OFFSETS:n._pseudoMeters||(F.project_uCommonUnitsPerMeter=V.unitsPerMeter),F.project_uCommonUnitsPerWorldUnit=V.unitsPerDegree,F.project_uCommonUnitsPerWorldUnit2=V.unitsPerDegree2;break;case Dr.CARTESIAN:F.project_uCommonUnitsPerWorldUnit=[1,1,V.unitsPerMeter[2]],F.project_uCommonUnitsPerWorldUnit2=[0,0,V.unitsPerMeter2[2]]}}return F});function kO(n,e,t=PO){t.length<3&&(t=[t[0],t[1],0]);let r,i=t,s=!0;switch(r=e===Dr.LNGLAT_OFFSETS||e===Dr.METER_OFFSETS?t:n.isGeospatial?[Math.fround(n.longitude),Math.fround(n.latitude),0]:null,n.projectionMode){case Td.WEB_MERCATOR:(e===Dr.LNGLAT||e===Dr.CARTESIAN)&&(r=[0,0,0],s=!1);break;case Td.WEB_MERCATOR_AUTO_OFFSET:e===Dr.LNGLAT?i=r:e===Dr.CARTESIAN&&(i=[Math.fround(n.center[0]),Math.fround(n.center[1]),0],r=n.unprojectPosition(i),i[0]-=t[0],i[1]-=t[1],i[2]-=t[2]);break;case Td.IDENTITY:i=n.position.map(Math.fround),i[2]=i[2]||0;break;case Td.GLOBE:s=!1,r=null;break;default:s=!1}return{geospatialOrigin:r,shaderCoordinateOrigin:i,offsetMode:s}}const eX={},QC={name:"project",dependencies:[{name:"fp32",vs:"#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\nconst float TWO_PI = 6.2831854820251465;\nconst float PI_2 = 1.5707963705062866;\nconst float PI_16 = 0.1963495463132858;\n\nconst float SIN_TABLE_0 = 0.19509032368659973;\nconst float SIN_TABLE_1 = 0.3826834261417389;\nconst float SIN_TABLE_2 = 0.5555702447891235;\nconst float SIN_TABLE_3 = 0.7071067690849304;\n\nconst float COS_TABLE_0 = 0.9807852506637573;\nconst float COS_TABLE_1 = 0.9238795042037964;\nconst float COS_TABLE_2 = 0.8314695954322815;\nconst float COS_TABLE_3 = 0.7071067690849304;\n\nconst float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;\nconst float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;\nconst float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;\nconst float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;\n\nfloat sin_taylor_fp32(float a) {\n  float r, s, t, x;\n\n  if (a == 0.0) {\n    return 0.0;\n  }\n\n  x = -a * a;\n  s = a;\n  r = a;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_3;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_5;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_7;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_9;\n  s = s + t;\n\n  return s;\n}\n\nvoid sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {\n  if (a == 0.0) {\n    sin_t = 0.0;\n    cos_t = 1.0;\n  }\n  sin_t = sin_taylor_fp32(a);\n  cos_t = sqrt(1.0 - sin_t * sin_t);\n}\n\nfloat tan_taylor_fp32(float a) {\n    float sin_a;\n    float cos_a;\n\n    if (a == 0.0) {\n        return 0.0;\n    }\n    float z = floor(a / TWO_PI);\n    float r = a - TWO_PI * z;\n\n    float t;\n    float q = floor(r / PI_2 + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return 1.0 / 0.0;\n    }\n\n    t = r - PI_2 * q;\n\n    q = floor(t / PI_16 + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return 1.0 / 0.0;\n    } else {\n        t = t - PI_16 * q;\n    }\n\n    float u = 0.0;\n    float v = 0.0;\n\n    float sin_t, cos_t;\n    float s, c;\n    sincos_taylor_fp32(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0;\n            v = SIN_TABLE_0;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1;\n            v = SIN_TABLE_1;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2;\n            v = SIN_TABLE_2;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3;\n            v = SIN_TABLE_3;\n        }\n        if (k > 0) {\n            s = u * sin_t + v * cos_t;\n            c = u * cos_t - v * sin_t;\n        } else {\n            s = u * sin_t - v * cos_t;\n            c = u * cos_t + v * sin_t;\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return sin_a / cos_a;\n}\n#endif\n\nfloat tan_fp32(float a) {\n#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\n  return tan_taylor_fp32(a);\n#else\n  return tan(a);\n#endif\n}\n",fs:null},jZ],vs:$Z,getUniforms:function tX(n=eX){return"viewport"in n?function JZ({viewport:n,devicePixelRatio:e=1,modelMatrix:t=null,coordinateSystem:i=Dr.DEFAULT,coordinateOrigin:r=PO,autoWrapLongitude:s=!1}){i===Dr.DEFAULT&&(i=n.isGeospatial?Dr.LNGLAT:Dr.CARTESIAN);const a=YZ({viewport:n,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:r});return a.project_uWrapLongitude=s,a.project_uModelMatrix=t||IO,a}(n):{}}},nX=[QC],iX=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function rX(n){const e=Hv.getDefaultProgramManager(n);for(const t of nX)e.addDefaultModule(t);for(const t of iX)e.addShaderHook(t);return e}class aX{constructor(e,{deck:t,stats:i,viewport:r,timeline:s}={}){Y(this,"layers",void 0),Y(this,"context",void 0),Y(this,"resourceManager",void 0),Y(this,"_lastRenderedLayers",[]),Y(this,"_needsRedraw",!1),Y(this,"_needsUpdate",!1),Y(this,"_nextLayers",null),Y(this,"_debug",!1),Y(this,"activateViewport",a=>{xl("layerManager.activateViewport",this,a),a&&(this.context.viewport=a)}),this.layers=[],this.resourceManager=new b$({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:t,programManager:e&&rX(e),stats:i||new AT({id:"deck.gl"}),viewport:r||new Km({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new hR,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const r=i.getNeedsRedraw(e);t=t||r}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(i=>0===t.id.indexOf(i))):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){xl("layerManager.setLayers",this,t,e),this._lastRenderedLayers=e;const i=k_(e,Boolean);for(const r of i)r.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,t,i){i.raiseError(t,"".concat(e," of ").concat(i))}_updateLayers(e,t){const i={};for(const a of e)i[a.id]?ur.warn("Multiple old layers with same id ".concat(a.id))():i[a.id]=a;const r=[];this._updateSublayersRecursively(t,i,r),this._finalizeOldLayers(i);let s=!1;for(const a of r)if(a.hasUniformTransition()){s="Uniform transition in ".concat(a);break}this._needsUpdate=s,this.layers=r}_updateSublayersRecursively(e,t,i){for(const r of e){r.context=this.context;const s=t[r.id];null===s&&ur.warn("Multiple new layers with same id ".concat(r.id))(),t[r.id]=null;let a=null;try{this._debug&&s!==r&&r.validateProps(),s?(this._transferLayerState(s,r),this._updateLayer(r)):this._initializeLayer(r),i.push(r),a=r.isComposite?r.getSubLayers():null}catch(u){this._handleError("matching",u,r)}a&&this._updateSublayersRecursively(a,t,i)}}_finalizeOldLayers(e){for(const t in e){const i=e[t];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle="Initialized"}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle="Matched. State transferred from previous layer",t!==e&&(e.lifecycle="Discarded. Awaiting garbage collection")}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle="No longer matched. Awaiting garbage collection";try{e._finalize(),e.lifecycle="Finalized! Awaiting garbage collection"}catch(t){this._handleError("finalization",t,e)}}}function Z_(n,e){if(n===e)return!0;if(!n||!e)return!1;for(const t in n){const i=n[t],r=e[t];if(!(i===r||Array.isArray(i)&&Array.isArray(r)&&Z_(i,r)))return!1}return!0}class lX{constructor(e){Y(this,"width",void 0),Y(this,"height",void 0),Y(this,"views",void 0),Y(this,"viewState",void 0),Y(this,"controllers",void 0),Y(this,"timeline",void 0),Y(this,"_viewports",void 0),Y(this,"_viewportMap",void 0),Y(this,"_isUpdating",void 0),Y(this,"_needsRedraw",void 0),Y(this,"_needsUpdate",void 0),Y(this,"_eventManager",void 0),Y(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t="string"==typeof e?this.getView(e):e,i=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,t){const i=this.getViewports(),r={x:e[0],y:e[1]};for(let s=i.length-1;s>=0;--s){const a=i[s];if(a.containsPixel(r)){const u=e.slice();return u[0]-=a.x,u[1]-=a.y,a.unproject(u,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=k_(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Z_(e,this.viewState)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):ur.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,t){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...t,viewId:e})}_createController(e,t){return new(0,t.type)({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,t.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var a;return null===(a=this.getView(e.id))||void 0===a?void 0:a.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(e,t,i,r){const s=e.controller;if(s){const a={...t,...s,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return r||(r=this._createController(e,a)),r&&r.setProps(a),r}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let r=e.length;r--;){const s=e[r],a=this.getViewState(s),u=s.makeViewport({viewState:a,width:this.width,height:this.height});let f=t[s.id];const g=Boolean(s.controller);g&&!f&&(i=!0),(i||!g)&&f&&(f.finalize(),f=null),this.controllers[s.id]=this._updateController(s,a,u,f),this._viewports.unshift(u)}for(const r in t){const s=t[r];s&&!this.controllers[r]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length||e.some((i,r)=>!e[r].equals(t[r]))}}const cX=/([0-9]+\.?[0-9]*)(%|px)/;function Fp(n){switch(typeof n){case"number":return{position:n,relative:!1};case"string":const e=cX.exec(n);if(e&&e.length>=3){const t="%"===e[2],i=parseFloat(e[1]);return{position:t?i/100:i,relative:t}}default:throw new Error("Could not parse position string ".concat(n))}}function Np(n,e){return n.relative?Math.round(n.position*e):n.position}function bo(n,e){if(!n)throw new Error(e||"deck.gl: assertion failed.")}class RO{constructor(e){Y(this,"id",void 0),Y(this,"viewportInstance",void 0),Y(this,"_x",void 0),Y(this,"_y",void 0),Y(this,"_width",void 0),Y(this,"_height",void 0),Y(this,"_padding",void 0),Y(this,"props",void 0);const{id:t,x:i=0,y:r=0,width:s="100%",height:a="100%",padding:u=null,viewportInstance:f}=e||{};bo(!f||f instanceof Km),this.viewportInstance=f,this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Fp(i),this._y=Fp(r),this._width=Fp(s),this._height=Fp(a),this._padding=u&&{left:Fp(u.left||0),right:Fp(u.right||0),top:Fp(u.top||0),bottom:Fp(u.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e||(this.viewportInstance?!!e.viewportInstance&&this.viewportInstance.equals(e.viewportInstance):this.ViewportType===e.ViewportType&&Z_(this.props,e.props))}makeViewport({width:e,height:t,viewState:i}){if(this.viewportInstance)return this.viewportInstance;i=this.filterViewState(i);const r=this.getDimensions({width:e,height:t});return new this.ViewportType({...i,...this.props,...r})}getViewStateId(){const{viewState:e}=this.props;return"string"==typeof e?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&"object"==typeof this.props.viewState){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const i in this.props.viewState)"id"!==i&&(t[i]=this.props.viewState[i]);return t}return e}getDimensions({width:e,height:t}){const i={x:Np(this._x,e),y:Np(this._y,t),width:Np(this._width,e),height:Np(this._height,t)};return this._padding&&(i.padding={left:Np(this._padding.left,e),top:Np(this._padding.top,t),right:Np(this._padding.right,e),bottom:Np(this._padding.bottom,t)}),i}get controller(){const e=this.props.controller;return e?!0===e?{type:this.ControllerType}:"function"==typeof e?{type:e}:{type:this.ControllerType,...e}:null}}const dX=Math.PI/180;function LO(n){return 512/4003e4/Math.cos(n*dX)}class Lf extends Km{constructor(e={}){const{latitude:t=0,longitude:i=0,zoom:r=0,pitch:s=0,bearing:a=0,nearZMultiplier:u=.1,farZMultiplier:f=1.01,orthographic:g=!1,projectionMatrix:E,repeat:M=!1,worldOffset:R=0,legacyMeterSizes:F=!1}=e;let{width:V,height:G,altitude:K=1.5}=e;const se=Math.pow(2,r);V=V||1,G=G||1;let _e,de=null;E?(K=E[5]/2,_e=wx(K)):(e.fovy?(_e=e.fovy,K=dL(_e)):_e=wx(K),de=function hL(n){const{width:e,height:t,altitude:i,pitch:r=0,offset:s,center:a,scale:u,nearZMultiplier:f=1,farZMultiplier:g=1}=n;let{fovy:E=wx(C9)}=n;void 0!==i&&(E=wx(i));const M=E*Lu,R=r*Lu,F=dL(E);let V=F;a&&(V+=a[2]*u/Math.cos(R)/t);const G=M*(.5+(s?s[1]:0)/t),K=Math.sin(G)*V/Math.sin(bC(Math.PI/2-R-G,.01,Math.PI-.01)),se=Math.sin(R)*K+V;return{fov:M,aspect:e/t,focalDistance:F,near:f,far:Math.min(se*g,10*V)}}({width:V,height:G,pitch:s,fovy:_e,nearZMultiplier:u,farZMultiplier:f}));let Ie=function A9(n){const{height:e,pitch:t,bearing:i,altitude:r,scale:s,center:a}=n,u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];px(u,u,[0,0,-r]),iL(u,u,-t*Lu),rL(u,u,i*Lu);const f=s/e;return _C(u,u,[f,f,f]),a&&px(u,u,function F$(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}([],a)),u}({height:G,pitch:s,bearing:a,scale:se,altitude:K});R&&(Ie=(new Ru).translate([512*R,0,0]).multiplyLeft(Ie)),super({...e,width:V,height:G,viewMatrix:Ie,longitude:i,latitude:t,zoom:r,...de,fovy:_e,focalDistance:K}),Y(this,"longitude",void 0),Y(this,"latitude",void 0),Y(this,"pitch",void 0),Y(this,"bearing",void 0),Y(this,"altitude",void 0),Y(this,"fovy",void 0),Y(this,"orthographic",void 0),Y(this,"_subViewports",void 0),Y(this,"_pseudoMeters",void 0),this.latitude=t,this.longitude=i,this.zoom=r,this.pitch=s,this.bearing=a,this.altitude=K,this.fovy=_e,this.orthographic=g,this._subViewports=M?[]:null,this._pseudoMeters=F,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let r=t;r<=i;r++){const s=r?new Lf({...this,worldOffset:r}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,i]=this.projectFlat(e);return[t,i,(e[2]||0)*LO(e[1])]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,i]=this.unprojectFlat(e);return[t,i,(e[2]||0)/LO(i)]}addMetersToLngLat(e,t){return uL(e,t)}panByPosition(e,t){const i=Ex(t,this.pixelUnprojectionMatrix),s=mx([],this.projectFlat(e),sL([],i)),a=mx([],this.center,s),[u,f]=this.unprojectFlat(a);return{longitude:u,latitude:f}}getBounds(e={}){const t=function I9(n,e=0){const{width:t,height:i,unproject:r}=n,s={targetZ:e},a=r([0,i],s),u=r([t,i],s);let f,g;return(n.fovy?.5*n.fovy*mL:Math.atan(.5/n.altitude))>(90-n.pitch)*mL-.01?(f=gL(n,0,e),g=gL(n,t,e)):(f=r([0,0],s),g=r([t,0],s)),[a,u,g,f]}(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:i,height:r}=this,{longitude:s,latitude:a,zoom:u}=pL({width:i,height:r,bounds:e,...t});return new Lf({width:i,height:r,longitude:s,latitude:a,zoom:u})}}Y(Lf,"displayName","WebMercatorViewport");class Gv{constructor(e){Y(this,"_inProgress",void 0),Y(this,"_handle",void 0),Y(this,"_timeline",void 0),Y(this,"time",void 0),Y(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var t,i;this.cancel(),this.settings=e,this._inProgress=!0,null===(t=(i=this.settings).onStart)||void 0===t||t.call(i,this)}end(){var e,t;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,null===(e=(t=this.settings).onEnd)||void 0===e||e.call(t,this))}cancel(){var e,t;this._inProgress&&(null===(e=(t=this.settings).onInterrupt)||void 0===e||e.call(t,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,t;if(!this._inProgress)return!1;if(null===this._handle){const{_timeline:i,settings:r}=this;this._handle=i.addChannel({delay:i.getTime(),duration:r.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),null===(e=(t=this.settings).onUpdate)||void 0===e||e.call(t,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const OO=()=>{},fX=n=>n;class mX{constructor(e){Y(this,"getControllerState",void 0),Y(this,"props",void 0),Y(this,"propsInTransition",void 0),Y(this,"transition",void 0),Y(this,"onViewStateChange",void 0),Y(this,"onStateChange",void 0),Y(this,"_onTransitionUpdate",t=>{const{time:i,settings:{interpolator:r,startProps:s,endProps:a,duration:u,easing:f}}=t,g=f(i/u),E=r.interpolateProps(s,a,g);this.propsInTransition=this.getControllerState({...this.props,...E}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Gv(e.timeline),this.onViewStateChange=e.onViewStateChange||OO,this.onStateChange=e.onStateChange||OO}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let r=i;if(this.transition.inProgress){const{interruption:s,endProps:a}=this.transition.settings;r={...i,...2===s?a:this.propsInTransition||i}}this._triggerTransition(r,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:i}=e;return(t>0||"auto"===t)&&Boolean(i)}_isUpdateDueToCurrentTransition(e){return!(!this.transition.inProgress||!this.propsInTransition)&&this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition)}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?3===this.transition.settings.interruption||this._isUpdateDueToCurrentTransition(t):!this._isTransitionEnabled(t)||t.transitionInterpolator.arePropsEqual(e,t)}_triggerTransition(e,t){const i=this.getControllerState(e),r=this.getControllerState(t).shortestPathFrom(i),s=t.transitionInterpolator,a=s.getDuration?s.getDuration(e,t):t.transitionDuration;if(0===a)return;const u=s.initializeProps(e,r);this.propsInTransition={};const f={duration:a,easing:t.transitionEasing||fX,interpolator:s,interruption:t.transitionInterruption||1,startProps:u.start,endProps:u.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(f),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(t)}}}const _X=["longitude","latitude","zoom","bearing","pitch"],yX=["longitude","latitude","zoom"];class tS extends class gX{constructor(e){Y(this,"_propsToCompare",void 0),Y(this,"_propsToExtract",void 0),Y(this,"_requiredProps",void 0);const{compare:t,extract:i,required:r}=e;this._propsToCompare=t,this._propsToExtract=i||t,this._requiredProps=r}arePropsEqual(e,t){for(const i of this._propsToCompare)if(!(i in e)||!(i in t)||!F_(e[i],t[i]))return!1;return!0}initializeProps(e,t){const i={},r={};for(const s of this._propsToExtract)(s in e||s in t)&&(i[s]=e[s],r[s]=t[s]);return this._checkRequiredProps(i),this._checkRequiredProps(r),{start:i,end:r}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){!this._requiredProps||this._requiredProps.forEach(t=>{const i=e[t];bo(Number.isFinite(i)||Array.isArray(i),"".concat(t," is required for transition"))})}}{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:_X,required:yX},super(i.transitionProps),Y(this,"opts",void 0),this.opts=i}initializeProps(e,t){const i=super.initializeProps(e,t),{makeViewport:r,around:s}=this.opts;if(r&&s){const a=r(e),u=r(t),f=a.unproject(s);i.start.around=s,Object.assign(i.end,{around:u.project(f),aroundPosition:f,width:t.width,height:t.height})}return i}interpolateProps(e,t,i){const r={};for(const s of this._propsToExtract)r[s]=dx(e[s]||0,t[s]||0,i);if(t.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...t,...r});Object.assign(r,s.panByPosition(t.aroundPosition,dx(e.around,t.around,i)))}return r}}const Bp={transitionDuration:0},Lx=n=>1-(1-n)*(1-n),X__WHEEL=["wheel"],X__PAN=["panstart","panmove","panend"],X__PINCH=["pinchstart","pinchmove","pinchend"],X__TRIPLE_PAN=["tripanstart","tripanmove","tripanend"],X__DOUBLE_TAP=["doubletap"],X__KEYBOARD=["keydown"],ig={};class FO{constructor(e){Y(this,"props",void 0),Y(this,"state",{}),Y(this,"transitionManager",void 0),Y(this,"eventManager",void 0),Y(this,"onViewStateChange",void 0),Y(this,"onStateChange",void 0),Y(this,"makeViewport",void 0),Y(this,"_controllerState",void 0),Y(this,"_events",{}),Y(this,"_interactionState",{isDragging:!1}),Y(this,"_customEvents",[]),Y(this,"_eventStartBlocked",null),Y(this,"_panMove",!1),Y(this,"invertPan",!1),Y(this,"dragMode","rotate"),Y(this,"inertia",0),Y(this,"scrollZoom",!0),Y(this,"dragPan",!0),Y(this,"dragRotate",!0),Y(this,"doubleClickZoom",!0),Y(this,"touchZoom",!0),Y(this,"touchRotate",!1),Y(this,"keyboard",!0),this.transitionManager=new mX({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const t in this._events)if(this._events[t]){var e;null===(e=this.eventManager)||void 0===e||e.off(t,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return!t&&this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return!t&&this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return!t&&this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:i}=this.props,{offsetCenter:r}=e;return[r.x-t,r.y-i]}isPointInBounds(e,t){const{width:i,height:r}=this.props;if(t&&t.handled)return!1;const s=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=r;return s&&t&&t.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:t}=e;return Boolean(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:!0===t?300:0;const{scrollZoom:i=!0,dragPan:r=!0,dragRotate:s=!0,doubleClickZoom:a=!0,touchZoom:u=!0,touchRotate:f=!1,keyboard:g=!0}=e,E=Boolean(this.onViewStateChange);this.toggleEvents(X__WHEEL,E&&i),this.toggleEvents(X__PAN,E&&(r||s)),this.toggleEvents(X__PINCH,E&&(u||f)),this.toggleEvents(X__TRIPLE_PAN,E&&f),this.toggleEvents(X__DOUBLE_TAP,E&&a),this.toggleEvents(X__KEYBOARD,E&&g),this.scrollZoom=i,this.dragPan=r,this.dragRotate=s,this.doubleClickZoom=a,this.touchZoom=u,this.touchRotate=f,this.keyboard=g}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(i=>{this._events[i]!==t&&(this._events[i]=t,t?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,t=null,i={}){const r={...e.getViewportProps(),...t},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),s){const a=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:r,interactionState:this._interactionState,oldViewState:a})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||"pan"===this.dragMode)&&(i=!i);const r=this.controllerState[i?"panStart":"rotateStart"]({pos:t});return this._panMove=i,this.updateViewport(r,Bp,{isDragging:!0}),!0}_onPan(e){return!!this.isDragging()&&(this._panMove?this._onPanMove(e):this._onPanRotate(e))}_onPanEnd(e){return!!this.isDragging()&&(this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e))}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),i=this.controllerState.pan({pos:t});return this.updateViewport(i,Bp,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const i=this.getCenter(e),s=this.controllerState.pan({pos:[i[0]+e.velocityX*t/2,i[1]+e.velocityY*t/2]}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Lx},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),i=this.controllerState.rotate({pos:t});return this.updateViewport(i,Bp,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const i=this.getCenter(e),s=this.controllerState.rotate({pos:[i[0]+e.velocityX*t/2,i[1]+e.velocityY*t/2]}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Lx},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;e.srcEvent.preventDefault();const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const{speed:i=.01,smooth:r=!1}=!0===this.scrollZoom?{}:this.scrollZoom,{delta:s}=e;let a=2/(1+Math.exp(-Math.abs(s*i)));s<0&&0!==a&&(a=1/a);const u=this.controllerState.zoom({pos:t,scale:a});return this.updateViewport(u,{...this._getTransitionProps({around:t}),transitionDuration:r?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.controllerState.rotateStart({pos:t});return this.updateViewport(i,Bp,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const i=this.controllerState.rotate({pos:t});return this.updateViewport(i,Bp,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const i=this.getCenter(e),r=[i[0],i[1]+=e.velocityY*t/2],s=this.controllerState.rotate({pos:r});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Lx},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return ig._startPinchRotation=e.rotation,ig._lastPinchEvent=e,this.updateViewport(i,Bp,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:i}=e,r=this.getCenter(e);t=t.zoom({pos:r,scale:i})}if(this.touchRotate){const{rotation:i}=e;t=t.rotate({deltaAngleX:ig._startPinchRotation-i})}return this.updateViewport(t,Bp,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),ig._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:i}=ig;if(this.touchZoom&&t&&i&&e.scale!==i.scale){const r=this.getCenter(e);let s=this.controllerState.rotateEnd();const a=Math.log2(e.scale),u=(a-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),f=Math.pow(2,a+u*t/2);s=s.zoom({pos:r,scale:f}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:r}),transitionDuration:t,transitionEasing:Lx},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const r=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return ig._startPinchRotation=null,ig._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.isFunctionKeyPressed(e),r=this.controllerState.zoom({pos:t,scale:i?.5:2});return this.updateViewport(r,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:r,rotateSpeedX:s,rotateSpeedY:a}=!0===this.keyboard?{}:this.keyboard,{controllerState:u}=this;let f;const g={};switch(e.srcEvent.code){case"Minus":f=t?u.zoomOut(i).zoomOut(i):u.zoomOut(i),g.isZooming=!0;break;case"Equal":f=t?u.zoomIn(i).zoomIn(i):u.zoomIn(i),g.isZooming=!0;break;case"ArrowLeft":t?(f=u.rotateLeft(s),g.isRotating=!0):(f=u.moveLeft(r),g.isPanning=!0);break;case"ArrowRight":t?(f=u.rotateRight(s),g.isRotating=!0):(f=u.moveRight(r),g.isPanning=!0);break;case"ArrowUp":t?(f=u.rotateUp(a),g.isRotating=!0):(f=u.moveUp(r),g.isPanning=!0);break;case"ArrowDown":t?(f=u.rotateDown(a),g.isRotating=!0):(f=u.moveDown(r),g.isPanning=!0);break;default:return!1}return this.updateViewport(f,this._getTransitionProps(),g),!0}_getTransitionProps(e){const{transition:t}=this;return t&&t.transitionInterpolator?e?{...t,transitionInterpolator:new tS({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t:Bp}}class NO{constructor(e,t){Y(this,"_viewportProps",void 0),Y(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}class xX extends NO{constructor(e){const{width:t,height:i,latitude:r,longitude:s,zoom:a,bearing:u=0,pitch:f=0,altitude:g=1.5,position:E=[0,0,0],maxZoom:M=20,minZoom:R=0,maxPitch:F=60,minPitch:V=0,startPanLngLat:G,startZoomLngLat:K,startRotatePos:se,startBearing:_e,startPitch:de,startZoom:Ie,normalize:qe=!0}=e;bo(Number.isFinite(s)),bo(Number.isFinite(r)),bo(Number.isFinite(a)),super({width:t,height:i,latitude:r,longitude:s,zoom:a,bearing:u,pitch:f,altitude:g,maxZoom:M,minZoom:R,maxPitch:F,minPitch:V,normalize:qe,position:E},{startPanLngLat:G,startZoomLngLat:K,startRotatePos:se,startBearing:_e,startPitch:de,startZoom:Ie}),Y(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const i=this.getState().startPanLngLat||this._unproject(t);if(!i)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:i=0}){const{startRotatePos:r,startBearing:s,startPitch:a}=this.getState();if(!r||void 0===s||void 0===a)return this;let u;return u=e?this._getNewRotation(e,r,a,s):{bearing:s+t,pitch:a+i},this._getUpdatedState(u)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:i}){let{startZoom:r,startZoomLngLat:s}=this.getState();if(s||(r=this.getViewportProps().zoom,s=this._unproject(t)||this._unproject(e)),!s)return this;const{maxZoom:a,minZoom:u}=this.getViewportProps();let f=r+Math.log2(i);f=$a(f,u,a);const g=this.makeViewport({...this.getViewportProps(),zoom:f});return this._getUpdatedState({zoom:f,...g.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),i={...this.getViewportProps()},{bearing:r,longitude:s}=i;return Math.abs(r-t.bearing)>180&&(i.bearing=r<0?r+360:r-360),Math.abs(s-t.longitude)>180&&(i.longitude=s<0?s+360:s-360),i}applyConstraints(e){const{maxZoom:t,minZoom:i,zoom:r}=e;e.zoom=$a(r,i,t);const{maxPitch:s,minPitch:a,pitch:u}=e;e.pitch=$a(u,a,s);const{normalize:f=!0}=e;return f&&Object.assign(e,function P9(n){const{width:e,height:t,pitch:i=0}=n;let{longitude:r,latitude:s,zoom:a,bearing:u=0}=n;(r<-180||r>180)&&(r=lL(r+180,360)-180),(u<-180||u>180)&&(u=lL(u+180,360)-180);const f=xC(t/512);if(a<=f)a=f,s=0;else{const g=t/2/Math.pow(2,a),E=V_([0,g])[1];if(s<E)s=E;else{const M=V_([0,512-g])[1];s>M&&(s=M)}}return{width:e,height:t,longitude:r,latitude:s,zoom:a,pitch:i,bearing:u}}(e)),e}_zoomFromCenter(e){const{width:t,height:i}=this.getViewportProps();return this.zoom({pos:[t/2,i/2],scale:e})}_panFromCenter(e){const{width:t,height:i}=this.getViewportProps();return this.pan({startPos:[t/2,i/2],pos:[t/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,i,r){const s=e[0]-t[0],a=e[1]-t[1],u=e[1],f=t[1],{width:g,height:E}=this.getViewportProps(),M=s/g;let R=0;a>0?Math.abs(E-f)>5&&(R=a/(f-E)*1.2):a<0&&f>5&&(R=1-u/f),R=$a(R,-1,1);const{minPitch:F,maxPitch:V}=this.getViewportProps();let K=i;return R>0?K=i+R*(V-i):R<0&&(K=i-R*(F-i)),{pitch:K,bearing:r+180*M}}}class wX extends FO{constructor(...e){super(...e),Y(this,"ControllerState",xX),Y(this,"transition",{transitionDuration:300,transitionInterpolator:new tS({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),Y(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class nS extends RO{get ViewportType(){return Lf}get ControllerType(){return wX}}Y(nS,"displayName","MapView");const EX=[255,255,255],TX=1;let CX=0;class SX{constructor(e={}){Y(this,"id",void 0),Y(this,"color",void 0),Y(this,"intensity",void 0),Y(this,"type","ambient");const{color:t=EX}=e,{intensity:i=TX}=e;this.id=e.id||"ambient-".concat(CX++),this.color=t,this.intensity=i}}const MX=[255,255,255],AX=1,DX=[0,0,-1];let IX=0;class zO{constructor(e={}){Y(this,"id",void 0),Y(this,"color",void 0),Y(this,"intensity",void 0),Y(this,"type","directional"),Y(this,"direction",void 0),Y(this,"shadow",void 0);const{color:t=MX}=e,{intensity:i=AX}=e,{direction:r=DX}=e,{_shadow:s=!1}=e;this.id=e.id||"directional-".concat(IX++),this.color=t,this.intensity=i,this.type="directional",this.direction=new Ed(r).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class Ox extends class PX{constructor(e,t={id:"pass"}){Y(this,"id",void 0),Y(this,"gl",void 0),Y(this,"props",void 0);const{id:i}=t;this.id=i,this.gl=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}{constructor(...e){super(...e),Y(this,"_lastRenderIndex",-1)}render(e){return Pf(this.gl,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:t,moduleParameters:i,viewports:r,views:s,onViewportActive:a,clearStack:u=!0,clearCanvas:f=!0}=e;e.pass=e.pass||"unknown";const g=this.gl;f&&function RX(n){Pf(n,{viewport:[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}),n.clear(16640)}(g),u&&(this._lastRenderIndex=-1);const E=[];for(const M of r){const R=s&&s[M.id];a(M);const F=this._getDrawLayerParams(M,e),V=M.subViewports||[M];for(const G of V){const K=this._drawLayersInViewport(g,{target:t,moduleParameters:i,viewport:G,view:R,pass:e.pass,layers:e.layers},F);E.push(K)}}return E}_getDrawLayerParams(e,{layers:t,pass:i,layerFilter:r,cullRect:s,effects:a,moduleParameters:u}){const f=[],g=VO(this._lastRenderIndex+1),E={layer:t[0],viewport:e,isPicking:i.startsWith("picking"),renderPass:i,cullRect:s},M={};for(let R=0;R<t.length;R++){const F=t[R],V=this._shouldDrawLayer(F,E,r,M),G={shouldDrawLayer:V};V&&(G.layerRenderIndex=g(F,V),G.moduleParameters=this._getModuleParameters(F,a,i,u),G.layerParameters=this.getLayerParameters(F,R,e)),f[R]=G}return f}_drawLayersInViewport(e,{layers:t,moduleParameters:i,pass:r,target:s,viewport:a,view:u},f){const g=function kX(n,{moduleParameters:e,target:t,viewport:i}){const r=t&&"default-framebuffer"!==t.id,s=e&&e.devicePixelRatio||j_(n);return[i.x*s,(r?t.height:n.drawingBufferHeight)-(i.y+i.height)*s,i.width*s,i.height*s]}(e,{moduleParameters:i,target:s,viewport:a});if(u&&u.props.clear){const M=!0===u.props.clear?{color:!0,depth:!0}:u.props.clear;Ou(e,{scissorTest:!0,scissor:g},()=>$C(e,M))}const E={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};Pf(e,{viewport:g});for(let M=0;M<t.length;M++){const R=t[M],{shouldDrawLayer:F,layerRenderIndex:V,moduleParameters:G,layerParameters:K}=f[M];if(F&&R.props.pickable&&E.pickableCount++,R.isComposite)E.compositeCount++;else if(F){E.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,V),G.viewport=a;try{R._drawLayer({moduleParameters:G,uniforms:{layerIndex:V},parameters:K})}catch(se){R.raiseError(se,"drawing ".concat(R," to ").concat(r))}}}return E}shouldDrawLayer(e){return!0}getModuleParameters(e,t){return null}getLayerParameters(e,t,i){return e.props.parameters}_shouldDrawLayer(e,t,i,r){if(!e.props.visible||!this.shouldDrawLayer(e))return!1;t.layer=e;let a=e.parent;for(;a;){if(!a.props.visible||!a.filterSubLayer(t))return!1;t.layer=a,a=a.parent}if(i){const u=t.layer.id;if(u in r||(r[u]=i(t)),!r[u])return!1}return e.activateViewport(t.viewport),!0}_getModuleParameters(e,t,i,r){var s;const a=Object.assign(Object.create((null===(s=e.internalState)||void 0===s?void 0:s.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:j_(this.gl)});if(t)for(const f of t){var u;Object.assign(a,null===(u=f.getModuleParameters)||void 0===u?void 0:u.call(f,e))}return Object.assign(a,this.getModuleParameters(e,t),r)}}function VO(n=0,e={}){const t={},i=(r,s)=>{const a=r.props._offset,u=r.id,f=r.parent&&r.parent.id;let g;if(f&&!(f in e)&&i(r.parent,!1),f in t){const E=t[f]=t[f]||VO(e[f],e);g=E(r,s),t[u]=E}else Number.isFinite(a)?(g=a+(e[f]||0),t[u]=null):g=n;return s&&g>=n&&(n=g+1),e[u]=g,g};return i}class LX extends Ox{constructor(e,t){super(e,t),Y(this,"shadowMap",void 0),Y(this,"depthBuffer",void 0),Y(this,"fbo",void 0),this.shadowMap=new Ql(e,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new W_(e,{format:33189,width:1,height:1}),this.fbo=new zo(e,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(e){const t=this.fbo;Ou(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const i=e.viewports[0],r=j_(this.gl),s=i.width*r,a=i.height*r;(s!==t.width||a!==t.height)&&t.resize({width:s,height:a}),super.render({...e,target:t,pass:"shadow"})})}shouldDrawLayer(e){return!1!==e.props.shadowEnabled}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const NX=Rx(function jX({viewport:n,center:e}){return new Ru(n.viewProjectionMatrix).invert().transform(e)}),BX=Rx(function HX({viewport:n,shadowMatrices:e}){const t=[],i=n.pixelUnprojectionMatrix,r=n.isGeospatial?void 0:1,s=[[0,0,r],[n.width,0,r],[0,n.height,r],[n.width,n.height,r],[0,0,-1],[n.width,0,-1],[0,n.height,-1],[n.width,n.height,-1]].map(a=>function UX(n,e){const[t,i,r]=n,s=Ex([t,i,r],e);return Number.isFinite(r)?s:[s[0],s[1],0]}(a,i));for(const a of e){const u=a.clone().translate(new Ed(n.center).negate()),f=s.map(E=>u.transform(E)),g=(new Ru).ortho({left:Math.min(...f.map(E=>E[0])),right:Math.max(...f.map(E=>E[0])),bottom:Math.min(...f.map(E=>E[1])),top:Math.max(...f.map(E=>E[1])),near:Math.min(...f.map(E=>-E[2])),far:Math.max(...f.map(E=>-E[2]))});t.push(g.multiplyRight(a))}return t}),zX=[0,0,0,1],VX=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],iS={name:"shadow",dependencies:[QC],vs:"\nconst int max_lights = 2;\nuniform mat4 shadow_uViewProjectionMatrices[max_lights];\nuniform vec4 shadow_uProjectCenters[max_lights];\nuniform bool shadow_uDrawShadowMap;\nuniform bool shadow_uUseShadowMap;\nuniform int shadow_uLightId;\nuniform float shadow_uLightCount;\n\nvarying vec3 shadow_vPosition[max_lights];\n\nvec4 shadow_setVertexPosition(vec4 position_commonspace) {\n  if (shadow_uDrawShadowMap) {\n    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);\n  }\n  if (shadow_uUseShadowMap) {\n    for (int i = 0; i < max_lights; i++) {\n      if(i < int(shadow_uLightCount)) {\n        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);\n        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;\n      }\n    }\n  }\n  return gl_Position;\n}\n",fs:"\nconst int max_lights = 2;\nuniform bool shadow_uDrawShadowMap;\nuniform bool shadow_uUseShadowMap;\nuniform sampler2D shadow_uShadowMap0;\nuniform sampler2D shadow_uShadowMap1;\nuniform vec4 shadow_uColor;\nuniform float shadow_uLightCount;\n\nvarying vec3 shadow_vPosition[max_lights];\n\nconst vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);\nconst vec4 bitUnpackShift = 1.0 / bitPackShift;\nconst vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);\n\nfloat shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {\n  vec4 rgbaDepth = texture2D(shadowMap, position.xy);\n\n  float z = dot(rgbaDepth, bitUnpackShift);\n  return smoothstep(0.001, 0.01, position.z - z);\n}\n\nvec4 shadow_filterShadowColor(vec4 color) {\n  if (shadow_uDrawShadowMap) {\n    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);\n    rgbaDepth -= rgbaDepth.gbaa * bitMask;\n    return rgbaDepth;\n  }\n  if (shadow_uUseShadowMap) {\n    float shadowAlpha = 0.0;\n    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);\n    if(shadow_uLightCount > 1.0) {\n      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);\n    }\n    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;\n    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);\n\n    return vec4(\n      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),\n      blendedAlpha\n    );\n  }\n  return color;\n}\n",inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    position = shadow_setVertexPosition(geometry.position);\n    ","fs:DECKGL_FILTER_COLOR":"\n    color = shadow_filterShadowColor(color);\n    "},getUniforms:(n={},e={})=>"viewport"in n&&(n.drawToShadowMap||n.shadowMaps&&n.shadowMaps.length>0)?function GX(n,e){const{shadowEnabled:t=!0}=n;if(!t||!n.shadowMatrices||!n.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const i={shadow_uDrawShadowMap:Boolean(n.drawToShadowMap),shadow_uUseShadowMap:!!n.shadowMaps&&n.shadowMaps.length>0,shadow_uColor:n.shadowColor||zX,shadow_uLightId:n.shadowLightId||0,shadow_uLightCount:n.shadowMatrices.length},r=NX({viewport:n.viewport,center:e.project_uCenter}),s=[],a=BX({shadowMatrices:n.shadowMatrices,viewport:n.viewport}).slice();for(let u=0;u<n.shadowMatrices.length;u++){const f=a[u],g=f.clone().translate(new Ed(n.viewport.center).negate());e.project_uCoordinateSystem===Dr.LNGLAT&&e.project_uProjectionMode===Td.WEB_MERCATOR?(a[u]=g,s[u]=r):(a[u]=f.clone().multiplyRight(VX),s[u]=g.transform(r))}for(let u=0;u<a.length;u++)i["shadow_uViewProjectionMatrices[".concat(u,"]")]=a[u],i["shadow_uProjectCenters[".concat(u,"]")]=s[u],i["shadow_uShadowMap".concat(u)]=n.shadowMaps&&n.shadowMaps.length>0?n.shadowMaps[u]:n.dummyShadowMap;return i}(n,e):{}},WX={color:[255,255,255],intensity:1},UO=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],$X=[0,0,0,200/255];class jO{constructor(e={}){Y(this,"id","lighting-effect"),Y(this,"props",null),Y(this,"shadowColor",$X),Y(this,"shadow",void 0),Y(this,"ambientLight",null),Y(this,"directionalLights",[]),Y(this,"pointLights",[]),Y(this,"shadowPasses",[]),Y(this,"shadowMaps",[]),Y(this,"dummyShadowMap",null),Y(this,"programManager",void 0),Y(this,"shadowMatrices",void 0);for(const t in e){const i=e[t];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i)}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow)}preRender(e,{layers:t,layerFilter:i,viewports:r,onViewportActive:s,views:a}){if(this.shadow){this.shadowMatrices=this._calculateMatrices(),0===this.shadowPasses.length&&this._createShadowPasses(e),this.programManager||(this.programManager=Hv.getDefaultProgramManager(e),iS&&this.programManager.addDefaultModule(iS)),this.dummyShadowMap||(this.dummyShadowMap=new Ql(e,{width:1,height:1}));for(let u=0;u<this.shadowPasses.length;u++)this.shadowPasses[u].render({layers:t,layerFilter:i,viewports:r,onViewportActive:s,views:a,moduleParameters:{shadowLightId:u,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const t=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return t.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(i=>i.getProjectedLight({layer:e})),pointLights:this.pointLights.map(i=>i.getProjectedLight({layer:e}))},t}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(iS),this.programManager=null)}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const i=(new Ru).lookAt({eye:new Ed(t.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const i=new LX(e);this.shadowPasses[t]=i,this.shadowMaps[t]=i.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:i}=this;!e&&0===t.length&&0===i.length&&(this.ambientLight=new SX(WX),this.directionalLights.push(new zO(UO[0]),new zO(UO[1])))}}class qX extends Ox{constructor(e,t){super(e,t),Y(this,"maskMap",void 0),Y(this,"fbo",void 0);const{mapSize:i=2048}=t;this.maskMap=new Ql(e,{width:i,height:i,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.fbo=new zo(e,{id:"maskmap",width:i,height:i,attachments:{36064:this.maskMap}})}render(e){const t=this.gl,i=[!1,!1,!1,!1];return i[e.channel]=!0,Ou(t,{clearColor:[255,255,255,255],blend:!0,blendFunc:[0,1],blendEquation:32778,colorMask:i,depthTest:!1},()=>super.render({...e,target:this.fbo,pass:"mask"}))}shouldDrawLayer(e){return"mask"===e.props.operation}delete(){this.fbo.delete(),this.maskMap.delete()}}const ZX=(new Ru).lookAt({eye:[0,0,1]});function XX({width:n,height:e,near:t,far:i,padding:r}){let s=-n/2,a=n/2,u=-e/2,f=e/2;if(r){const{left:g=0,right:E=0,top:M=0,bottom:R=0}=r,F=$a((g+n-E)/2,0,n)-n/2,V=$a((M+e-R)/2,0,e)-e/2;s-=F,a-=F,u+=V,f+=V}return(new Ru).ortho({left:s,right:a,bottom:u,top:f,near:t,far:i})}class YX extends Km{constructor(e){const{width:t,height:i,near:r=.1,far:s=1e3,zoom:a=0,target:u=[0,0,0],padding:f=null,flipY:g=!0}=e,E=Array.isArray(a)?a[0]:a,M=Array.isArray(a)?a[1]:a,R=Math.min(E,M),F=Math.pow(2,R);let V;if(E!==M){const G=Math.pow(2,E),K=Math.pow(2,M);V={unitsPerMeter:[G/F,K/F,1],metersPerUnit:[F/G,F/K,1]}}super({...e,longitude:void 0,position:u,viewMatrix:ZX.clone().scale([F,F*(g?-1:1),F]),projectionMatrix:XX({width:t||1,height:i||1,padding:f,near:r,far:s}),zoom:R,distanceScales:V})}projectFlat([e,t]){const{unitsPerMeter:i}=this.distanceScales;return[e*i[0],t*i[1]]}unprojectFlat([e,t]){const{metersPerUnit:i}=this.distanceScales;return[e*i[0],t*i[1]]}panByPosition(e,t){const i=Ex(t,this.pixelUnprojectionMatrix),s=mx([],this.projectFlat(e),sL([],i)),a=mx([],this.center,s);return{target:this.unprojectFlat(a)}}}class HO extends NO{constructor(e){const{width:t,height:i,rotationX:r=0,rotationOrbit:s=0,target:a=[0,0,0],zoom:u=0,minRotationX:f=-90,maxRotationX:g=90,minZoom:E=-1/0,maxZoom:M=1/0,startPanPosition:R,startRotatePos:F,startRotationX:V,startRotationOrbit:G,startZoomPosition:K,startZoom:se}=e;super({width:t,height:i,rotationX:r,rotationOrbit:s,target:a,zoom:u,minRotationX:f,maxRotationX:g,minZoom:E,maxZoom:M},{startPanPosition:R,startRotatePos:F,startRotationX:V,startRotationOrbit:G,startZoomPosition:K,startZoom:se}),Y(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanPosition:this._unproject(e)})}pan({pos:e,startPosition:t}){const i=this.getState().startPanPosition||t;if(!i)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanPosition:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:i=0}){const{startRotatePos:r,startRotationX:s,startRotationOrbit:a}=this.getState(),{width:u,height:f}=this.getViewportProps();if(!r||void 0===s||void 0===a)return this;let g;if(e){let E=(e[0]-r[0])/u;(s<-90||s>90)&&(E*=-1),g={rotationX:s+(e[1]-r[1])/f*180,rotationOrbit:a+180*E}}else g={rotationX:s+i,rotationOrbit:a+t};return this._getUpdatedState(g)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(e){const t=e.getViewportProps(),i={...this.getViewportProps()},{rotationOrbit:r}=i;return Math.abs(r-t.rotationOrbit)>180&&(i.rotationOrbit=r<0?r+360:r-360),i}zoomStart({pos:e}){return this._getUpdatedState({startZoomPosition:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:i}){let{startZoom:r,startZoomPosition:s}=this.getState();if(s||(r=this.getViewportProps().zoom,s=this._unproject(t)||this._unproject(e)),!s)return this;const a=this._calculateNewZoom({scale:i,startZoom:r}),u=this.makeViewport({...this.getViewportProps(),zoom:a});return this._getUpdatedState({zoom:a,...u.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}zoomIn(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:e})})}zoomOut(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/e})})}moveLeft(e=50){return this._panFromCenter([-e,0])}moveRight(e=50){return this._panFromCenter([e,0])}moveUp(e=50){return this._panFromCenter([0,-e])}moveDown(e=50){return this._panFromCenter([0,e])}rotateLeft(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-e})}rotateRight(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+e})}rotateUp(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-e})}rotateDown(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_calculateNewZoom({scale:e,startZoom:t}){const{maxZoom:i,minZoom:r}=this.getViewportProps();return void 0===t&&(t=this.getViewportProps().zoom),$a(t+Math.log2(e),r,i)}_panFromCenter(e){const{width:t,height:i,target:r}=this.getViewportProps();return this.pan({startPosition:r,pos:[t/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}applyConstraints(e){const{maxZoom:t,minZoom:i,zoom:r,maxRotationX:s,minRotationX:a,rotationOrbit:u}=e;return e.zoom=Array.isArray(r)?[$a(r[0],i,t),$a(r[1],i,t)]:$a(r,i,t),e.rotationX=$a(e.rotationX,a,s),(u<-180||u>180)&&(e.rotationOrbit=function Z$(n,e){const t=n%e;return t<0?e+t:t}(u+180,360)-180),e}}class KX extends HO{constructor(e){super(e),Y(this,"zoomAxis",void 0),this.zoomAxis=e.zoomAxis||"all"}_calculateNewZoom({scale:e,startZoom:t}){const{maxZoom:i,minZoom:r}=this.getViewportProps();void 0===t&&(t=this.getViewportProps().zoom);let s=Math.log2(e);if(Array.isArray(t)){let[a,u]=t;switch(this.zoomAxis){case"X":a=$a(a+s,r,i);break;case"Y":u=$a(u+s,r,i);break;default:let f=Math.min(a+s,u+s);f<r&&(s+=r-f),f=Math.max(a+s,u+s),f>i&&(s+=i-f),a+=s,u+=s}return[a,u]}return $a(t+s,r,i)}}class JX extends FO{constructor(...e){super(...e),Y(this,"ControllerState",KX),Y(this,"transition",{transitionDuration:300,transitionInterpolator:new tS(["target","zoom"])}),Y(this,"dragMode","pan")}_onPanRotate(){return!1}}class GO extends RO{get ViewportType(){return YX}get ControllerType(){return JX}}Y(GO,"displayName","OrthographicView");class nY{constructor(){Y(this,"id","mask-effect"),Y(this,"props",null),Y(this,"useInPicking",!0),Y(this,"dummyMaskMap",void 0),Y(this,"channels",[]),Y(this,"masks",null),Y(this,"maskPass",void 0),Y(this,"maskMap",void 0),Y(this,"lastViewport",void 0)}preRender(e,{layers:t,layerFilter:i,viewports:r,onViewportActive:s,views:a}){this.dummyMaskMap||(this.dummyMaskMap=new Ql(e,{width:1,height:1}));const u=t.filter(M=>M.props.visible&&"mask"===M.props.operation);if(0===u.length)return this.masks=null,void(this.channels.length=0);this.masks={},this.maskPass||(this.maskPass=new qX(e,{id:"default-mask"}),this.maskMap=this.maskPass.maskMap);const f=this._sortMaskChannels(u),g=r[0],E=!this.lastViewport||!this.lastViewport.equals(g);for(const M in f)this._renderChannel(f[M],{layerFilter:i,onViewportActive:s,views:a,viewport:g,viewportChanged:E})}_renderChannel(e,{layerFilter:t,onViewportActive:i,views:r,viewport:s,viewportChanged:a}){const u=this.channels[e.index];if(!u)return;const f=e===u||u.layers.length!==e.layers.length||e.layerBounds.some((g,E)=>g!==u.layerBounds[E]);if(e.bounds=u.bounds,e.maskBounds=u.maskBounds,this.channels[e.index]=e,(f||a)&&(this.lastViewport=s,e.bounds=function QX({layers:n,viewport:e}){let t=null;for(const s of n){const a=s.getBounds();a&&(t?(t[0]=Math.min(t[0],a[0][0]),t[1]=Math.min(t[1],a[0][1]),t[2]=Math.max(t[2],a[1][0]),t[3]=Math.max(t[3],a[1][1])):t=[a[0][0],a[0][1],a[1][0],a[1][1]])}const i=e.getBounds();if(!t)return i;const r=function tY(n){const e_x=n[2]-n[0],e_y=n[3]-n[1],t_x=n[0]+.5*e_x,t_y=n[1]+.5*e_y;return[t_x-e_x,t_y-e_y,t_x+e_x,t_y+e_y]}(i);return t[2]-t[0]<r[2]-r[0]||t[3]-t[1]<r[3]-r[1]||(t[0]=Math.max(t[0],r[0]),t[1]=Math.max(t[1],r[1]),t[2]=Math.min(t[2],r[2]),t[3]=Math.min(t[3],r[3])),t}({layers:e.layers,viewport:s}),f||!F_(e.bounds,u.bounds))){const{maskPass:g,maskMap:E}=this,M=function eY({bounds:n,viewport:e,width:t,height:i}){if(n[2]<=n[0]||n[3]<=n[1])return null;if(t-=2,i-=2,e instanceof Lf){const{longitude:u,latitude:f,zoom:g}=pL({width:t,height:i,bounds:[[n[0],n[1]],[n[2],n[3]]],maxZoom:20});return new Lf({longitude:u,latitude:f,zoom:g,x:1,y:1,width:t,height:i})}const s=[(n[0]+n[2])/2,(n[1]+n[3])/2,0],a=Math.min(20,t/(n[2]-n[0]),i/(n[3]-n[1]));return new GO({x:1,y:1}).makeViewport({width:t,height:i,viewState:{target:s,zoom:Math.log2(a)}})}({bounds:e.bounds,viewport:s,width:E.width,height:E.height});e.maskBounds=M?M.getBounds():[0,0,1,1],g.render({pass:"mask",channel:e.index,layers:e.layers,layerFilter:t,viewports:M?[M]:[],onViewportActive:i,views:r,moduleParameters:{devicePixelRatio:1}})}this.masks[e.id]={index:e.index,bounds:e.maskBounds,coordinateOrigin:e.coordinateOrigin,coordinateSystem:e.coordinateSystem}}_sortMaskChannels(e){const t={};let i=0;for(const r of e){const{id:s}=r.root;let a=t[s];if(!a){if(++i>4){ur.warn("Too many mask layers. The max supported is 4")();continue}a={id:s,index:this.channels.findIndex(u=>u?.id===s),layers:[],layerBounds:[],coordinateOrigin:r.root.props.coordinateOrigin,coordinateSystem:r.root.props.coordinateSystem},t[s]=a}a.layers.push(r),a.layerBounds.push(r.getBounds())}for(let r=0;r<4;r++){const s=this.channels[r];(!s||!(s.id in t))&&(this.channels[r]=null)}for(const r in t){const s=t[r];s.index<0&&(s.index=this.channels.findIndex(a=>!a),this.channels[s.index]=s)}return t}getModuleParameters(){return{maskMap:this.masks?this.maskMap:this.dummyMaskMap,maskChannels:this.masks}}cleanup(){this.dummyMaskMap&&(this.dummyMaskMap.delete(),this.dummyMaskMap=void 0),this.maskPass&&(this.maskPass.delete(),this.maskPass=void 0,this.maskMap=void 0),this.lastViewport=void 0,this.masks=null,this.channels.length=0}}const iY=new jO;class rY{constructor(){Y(this,"effects",void 0),Y(this,"_internalEffects",void 0),Y(this,"_needsRedraw",void 0),this.effects=[],this._internalEffects=[],this._needsRedraw="Initial render",this.setEffects()}setProps(e){"effects"in e&&(e.effects.length!==this.effects.length||!Z_(e.effects,this.effects))&&(this.setEffects(e.effects),this._needsRedraw="effects changed")}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._internalEffects}finalize(){this.cleanup()}setEffects(e=[]){this.cleanup(),this.effects=e,this._internalEffects=e.slice(),this._internalEffects.push(new nY),e.some(t=>t instanceof jO)||this._internalEffects.push(iY)}cleanup(){for(const e of this.effects)e.cleanup();for(const e of this._internalEffects)e.cleanup();this.effects.length=0,this._internalEffects.length=0}}class sY extends Ox{shouldDrawLayer(e){return"draw"===e.props.operation}}const WO={blendFunc:[1,0,32771,0],blendEquation:32774};class $O extends Ox{constructor(...e){super(...e),Y(this,"pickZ",void 0),Y(this,"_colors",null)}render(e){return e.pickingFBO?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:i,viewports:r,onViewportActive:s,pickingFBO:a,deviceRect:{x:u,y:f,width:g,height:E},cullRect:M,effects:R,pass:F="picking",pickZ:V}){const G=this.gl;this.pickZ=V;const K=V?null:{byLayer:new Map,byAlpha:[]};this._colors=K;const se=Ou(G,{scissorTest:!0,scissor:[u,f,g,E],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...WO,blend:!V},()=>super.render({target:a,layers:e,layerFilter:t,views:i,viewports:r,onViewportActive:s,cullRect:M,effects:R?.filter(de=>de.useInPicking),pass:F}));return this._colors=null,{decodePickingColor:K&&aY.bind(null,K),stats:se}}shouldDrawLayer(e){return e.props.pickable&&"draw"===e.props.operation}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,t,i){const r={...e.props.parameters};return this._colors?(Object.assign(r,WO),r.blend=!0,r.blendColor=function oY(n,e,t){const{byLayer:i,byAlpha:r}=n;let s,a=i.get(e);return a?(a.viewports.push(t),s=a.a):(s=i.size+1,s<=255?(a={a:s,layer:e,viewports:[t]},i.set(e,a),r[s]=a):(ur.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}(this._colors,e,i)):r.blend=!1,r}}function aY(n,e){const t=n.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}class cY{constructor(e){this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new sY(e),this.pickLayersPass=new $O(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){"layerFilter"in e&&this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),"drawPickingColors"in e&&this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass;e.layerFilter=e.layerFilter||this.layerFilter,e.effects=e.effects||[],e.target=e.target||zo.getDefaultFramebuffer(this.gl),this._preRender(e.effects,e);const i=this.lastPostProcessEffect?this.renderBuffers[0]:e.target,r=t.render({...e,target:i});this._postRender(e.effects,e),this.renderCount++,xl("deckRenderer.renderLayers",this,r,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){let i=null;for(const r of e)r.preRender(this.gl,t),r.postRender&&(i=r);i&&this._resizeRenderBuffers(),this.lastPostProcessEffect=i}_resizeRenderBuffers(){const{renderBuffers:e}=this;0===e.length&&e.push(new zo(this.gl),new zo(this.gl));for(const t of e)t.resize()}_postRender(e,t){const{renderBuffers:i}=this,r={inputBuffer:i[0],swapBuffer:i[1],target:null};for(const s of e)if(s.postRender){if(s===this.lastPostProcessEffect){r.target=t.target,s.postRender(this.gl,r);break}const a=s.postRender(this.gl,r);r.inputBuffer=a,r.swapBuffer=a===i[0]?i[1]:i[0]}}}const uY={pickedColor:null,pickedObjectIndex:-1};function hY({pickedColors:n,decodePickingColor:e,deviceX:t,deviceY:i,deviceRadius:r,deviceRect:s}){const{x:a,y:u,width:f,height:g}=s;let E=r*r,M=-1,R=0;for(let F=0;F<g;F++){const V=F+u-i,G=V*V;if(G>E)R+=4*f;else for(let K=0;K<f;K++){if(n[R+3]-1>=0){const _e=K+a-t,de=_e*_e+G;de<=E&&(E=de,M=R)}R+=4}}if(M>=0){const F=n.slice(M,M+4),V=e(F);if(V){const G=Math.floor(M/4/f),K=M/4-G*f;return{...V,pickedColor:F,pickedX:a+K,pickedY:u+G}}ur.error("Picked non-existent layer. Is picking buffer corrupt?")()}return uY}function qO({pickInfo:n,viewports:e,pixelRatio:t,x:i,y:r,z:s}){let u,a=e[0];if(e.length>1&&(a=function pY(n,e){for(let t=n.length-1;t>=0;t--){const i=n[t];if(i.containsPixel(e))return i}return n[0]}(n?.pickedViewports||e,{x:i,y:r})),a){const f=[i-a.x,r-a.y];void 0!==s&&(f[2]=s),u=a.unproject(f)}return{color:null,layer:null,viewport:a,index:-1,picked:!1,x:i,y:r,pixel:[i,r],coordinate:u,devicePixel:n&&"pickedX"in n?[n.pickedX,n.pickedY]:void 0,pixelRatio:t}}function fY(n){const{pickInfo:e,lastPickedInfo:t,mode:i,layers:r}=n,{pickedColor:s,pickedLayer:a,pickedObjectIndex:u}=e,f=a?[a]:[];if("hover"===i){const M=t.index,R=t.layerId,F=a?a.props.id:null;if(F!==R||u!==M){if(F!==R){const V=r.find(G=>G.props.id===R);V&&f.unshift(V)}t.layerId=F,t.index=u,t.info=null}}const g=qO(n),E=new Map;return E.set(null,g),f.forEach(M=>{let R={...g};M===a&&(R.color=s,R.index=u,R.picked=!0),R=ZO({layer:M,info:R,mode:i});const F=R.layer;M===a&&"hover"===i&&(t.info=R),E.set(F.id,R),"hover"===i&&F.updateAutoHighlight(R)}),E}function ZO({layer:n,info:e,mode:t}){for(;n&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=n,e=n.getPickingInfo({info:e,mode:t,sourceLayer:i}),n=n.parent}return e}class mY{constructor(e){Y(this,"gl",void 0),Y(this,"pickingFBO",void 0),Y(this,"depthFBO",void 0),Y(this,"pickLayersPass",void 0),Y(this,"layerFilter",void 0),Y(this,"lastPickedInfo",void 0),Y(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new $O(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:i,viewports:r},s=this.lastPickedInfo.info){const a=s&&s.layer&&s.layer.id,u=s&&s.viewport&&s.viewport.id,f=a?i.find(R=>R.id===a):null,g=u&&r.find(R=>R.id===u)||r[0],E=g&&g.unproject([e-g.x,t-g.y]);return{...s,x:e,y:t,viewport:g,coordinate:E,layer:f}}_resizeBuffer(){var e,t;const{gl:i}=this;if(!this.pickingFBO&&(this.pickingFBO=new zo(i),zo.isSupported(i,{colorBufferFloat:!0}))){const r=new zo(i);r.attach({36064:new Ql(i,{format:Hi(i)?34836:6408,type:5126})}),this.depthFBO=r}null===(e=this.pickingFBO)||void 0===e||e.resize({width:i.canvas.width,height:i.canvas.height}),null===(t=this.depthFBO)||void 0===t||t.resize({width:i.canvas.width,height:i.canvas.height})}_getPickable(e){if(!1===this._pickable)return null;const t=e.filter(i=>i.isPickable()&&!i.isComposite);return t.length?t:null}_pickClosestObject({layers:e,views:t,viewports:i,x:r,y:s,radius:a=0,depth:u=1,mode:f="query",unproject3D:g,onViewportActive:E,effects:M}){const R=this._getPickable(e),F=j_(this.gl);if(!R)return{result:[],emptyInfo:qO({viewports:i,x:r,y:s,pixelRatio:F})};this._resizeBuffer();const V=NC(this.gl,[r,s],!0),G=[V.x+Math.floor(V.width/2),V.y+Math.floor(V.height/2)],K=Math.round(a*F),{width:se,height:_e}=this.pickingFBO,de=this._getPickingRect({deviceX:G[0],deviceY:G[1],deviceRadius:K,deviceWidth:se,deviceHeight:_e}),Ie={x:r-a,y:s-a,width:2*a+1,height:2*a+1};let qe;const Qe=[],Ct=new Set;for(let Xt=0;Xt<u;Xt++){let Ft,Ut;Ft=de?hY({...this._drawAndSample({layers:R,views:t,viewports:i,onViewportActive:E,deviceRect:de,cullRect:Ie,effects:M,pass:"picking:".concat(f)}),deviceX:G[0],deviceY:G[1],deviceRadius:K,deviceRect:de}):{pickedColor:null,pickedObjectIndex:-1},Ft.pickedLayer&&g&&this.depthFBO&&(Ut=this._drawAndSample({layers:[Ft.pickedLayer],views:t,viewports:i,onViewportActive:E,deviceRect:{x:Ft.pickedX,y:Ft.pickedY,width:1,height:1},cullRect:Ie,effects:M,pass:"picking:".concat(f,":z")},!0).pickedColors[0]),Ft.pickedLayer&&Xt+1<u&&(Ct.add(Ft.pickedLayer),Ft.pickedLayer.disablePickingIndex(Ft.pickedObjectIndex)),qe=fY({pickInfo:Ft,lastPickedInfo:this.lastPickedInfo,mode:f,layers:R,viewports:i,x:r,y:s,z:Ut,pixelRatio:F});for(const mn of qe.values())mn.layer&&Qe.push(mn);if(!Ft.pickedColor)break}for(const Xt of Ct)Xt.restorePickingColors();return{result:Qe,emptyInfo:qe.get(null)}}_pickVisibleObjects({layers:e,views:t,viewports:i,x:r,y:s,width:a=1,height:u=1,mode:f="query",maxObjects:g=null,onViewportActive:E,effects:M}){const R=this._getPickable(e);if(!R)return[];this._resizeBuffer();const F=j_(this.gl),V=NC(this.gl,[r,s],!0),G=V.x,K=V.y+V.height,se=NC(this.gl,[r+a,s+u],!0),de=se.y,Qe=function dY({pickedColors:n,decodePickingColor:e}){const t=new Map;if(n)for(let i=0;i<n.length;i+=4)if(n[i+3]-1>=0){const s=n.slice(i,i+4),a=s.join(",");if(!t.has(a)){const u=e(s);u?t.set(a,{...u,color:s}):ur.error("Picked non-existent layer. Is picking buffer corrupt?")()}}return Array.from(t.values())}(this._drawAndSample({layers:R,views:t,viewports:i,onViewportActive:E,deviceRect:{x:G,y:de,width:se.x+se.width-G,height:K-de},cullRect:{x:r,y:s,width:a,height:u},effects:M,pass:"picking:".concat(f)})),Ct=new Map,Xt=Number.isFinite(g);for(let Ft=0;Ft<Qe.length&&!(Xt&&g&&Ct.size>=g);Ft++){const Ut=Qe[Ft];let mn={color:Ut.pickedColor,layer:null,index:Ut.pickedObjectIndex,picked:!0,x:r,y:s,pixelRatio:F};mn=ZO({layer:Ut.pickedLayer,info:mn,mode:f}),Ct.has(mn.object)||Ct.set(mn.object,mn)}return Array.from(Ct.values())}_drawAndSample({layers:e,views:t,viewports:i,onViewportActive:r,deviceRect:s,cullRect:a,effects:u,pass:f},g=!1){const E=g?this.depthFBO:this.pickingFBO,{decodePickingColor:M}=this.pickLayersPass.render({layers:e,layerFilter:this.layerFilter,views:t,viewports:i,onViewportActive:r,pickingFBO:E,deviceRect:s,cullRect:a,effects:u,pass:f,pickZ:g}),{x:R,y:F,width:V,height:G}=s,K=new(g?Float32Array:Uint8Array)(V*G*4);return Dx(E,{sourceX:R,sourceY:F,sourceWidth:V,sourceHeight:G,target:K}),{pickedColors:K,decodePickingColor:M}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:i,deviceWidth:r,deviceHeight:s}){const a=Math.max(0,e-i),u=Math.max(0,t-i),f=Math.min(r,e+i+1)-a,g=Math.min(s,t+i+1)-u;return f<=0||g<=0?null:{x:a,y:u,width:f,height:g}}}const gY={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class _Y{constructor(e){Y(this,"el",null),Y(this,"isVisible",!1);const t=e.parentElement;t&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,gY),t.appendChild(this.el))}setTooltip(e,t,i){const r=this.el;if(r){if("string"==typeof e)r.innerText=e;else{if(!e)return this.isVisible=!1,void(r.style.display="none");e.text&&(r.innerText=e.text),e.html&&(r.innerHTML=e.html),e.className&&(r.className=e.className),Object.assign(r.style,e.style)}this.isVisible=!0,r.style.display="block",r.style.transform="translate(".concat(t,"px, ").concat(i,"px)")}}remove(){this.el&&(this.el.remove(),this.el=null)}}const{_parseImageNode:vY}=globalThis,rS=typeof Image<"u",sS=typeof ImageBitmap<"u",bY=Boolean(vY),oS=!!zT||bY;function XO(n){const e=function KO(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&n instanceof Image?"image":n&&"object"==typeof n&&n.data&&n.width&&n.height?"data":null}(n);if(!e)throw new Error("Not an image");return e}function YO(n){switch(XO(n)){case"data":return n;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=n.width,e.height=n.height,t.drawImage(n,0,0),t.getImageData(0,0,n.width,n.height);default:throw new Error("getImageData")}}const EY=/^data:image\/svg\+xml/,TY=/\.svg((\?|#).*)?$/;function aS(n){return n&&(EY.test(n)||TY.test(n))}function CY(n,e){if(aS(e)){let i=(new TextDecoder).decode(n);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(i=unescape(encodeURIComponent(i)))}catch(s){throw new Error(s.message)}return"data:image/svg+xml;base64,".concat(btoa(i))}return JO(n,e)}function JO(n,e){if(aS(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(n)])}function QO(n,e,t){return lS.apply(this,arguments)}function lS(){return lS=As(function*(n,e,t){const i=CY(n,t),r=self.URL||self.webkitURL,s="string"!=typeof i&&r.createObjectURL(i);try{return yield SY(s||i,e)}finally{s&&r.revokeObjectURL(s)}}),lS.apply(this,arguments)}function SY(n,e){return cS.apply(this,arguments)}function cS(){return cS=As(function*(n,e){const t=new Image;return t.src=n,e.image&&e.image.decode&&t.decode?(yield t.decode(),t):yield new Promise((i,r)=>{try{t.onload=()=>i(t),t.onerror=s=>r(new Error("Could not load image ".concat(n,": ").concat(s)))}catch(s){r(s)}})}),cS.apply(this,arguments)}const MY={};let eF=!0;function AY(n,e,t){return uS.apply(this,arguments)}function uS(){return uS=As(function*(n,e,t){let i;i=aS(t)?yield QO(n,e,t):JO(n,t);const r=e&&e.imagebitmap;return yield DY(i,r)}),uS.apply(this,arguments)}function DY(n){return hS.apply(this,arguments)}function hS(){return hS=As(function*(n,e=null){if((IY(e)||!eF)&&(e=null),e)try{return yield createImageBitmap(n,e)}catch(t){console.warn(t),eF=!1}return yield createImageBitmap(n)}),hS.apply(this,arguments)}function IY(n){for(const e in n||MY)return!1;return!0}const Sd=!1,Wv=!0;function tF(n){const e=$v(n);return function PY(n){const e=$v(n);return e.byteLength>=24&&2303741511===e.getUint32(0,Sd)?{mimeType:"image/png",width:e.getUint32(16,Sd),height:e.getUint32(20,Sd)}:null}(e)||function LY(n){const e=$v(n);if(!(e.byteLength>=3&&65496===e.getUint16(0,Sd)&&255===e.getUint8(2)))return null;const{tableMarkers:i,sofMarkers:r}=function OY(){const n=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)n.add(t);return{tableMarkers:n,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}();let s=2;for(;s+9<e.byteLength;){const a=e.getUint16(s,Sd);if(r.has(a))return{mimeType:"image/jpeg",height:e.getUint16(s+5,Sd),width:e.getUint16(s+7,Sd)};if(!i.has(a))return null;s+=2,s+=e.getUint16(s,Sd)}return null}(e)||function kY(n){const e=$v(n);return e.byteLength>=10&&1195984440===e.getUint32(0,Sd)?{mimeType:"image/gif",width:e.getUint16(6,Wv),height:e.getUint16(8,Wv)}:null}(e)||function RY(n){const e=$v(n);return e.byteLength>=14&&16973===e.getUint16(0,Sd)&&e.getUint32(2,Wv)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Wv),height:e.getUint32(22,Wv)}:null}(e)}function $v(n){if(n instanceof DataView)return n;if(ArrayBuffer.isView(n))return new DataView(n.buffer);if(n instanceof ArrayBuffer)return new DataView(n);throw new Error("toDataView")}function FY(n,e){return dS.apply(this,arguments)}function dS(){return dS=As(function*(n,e){const{mimeType:t}=tF(n)||{},i=globalThis._parseImageNode;return ox(i),yield i(n,t)}),dS.apply(this,arguments)}function fS(){return fS=As(function*(n,e,t){const r=((e=e||{}).image||{}).type||"auto",{url:s}=t||{};let u;switch(BY(r)){case"imagebitmap":u=yield AY(n,e,s);break;case"image":u=yield QO(n,e,s);break;case"data":u=yield FY(n,e);break;default:ox(!1)}return"data"===r&&(u=YO(u)),u}),fS.apply(this,arguments)}function BY(n){switch(n){case"auto":case"data":return function wY(){if(sS)return"imagebitmap";if(rS)return"image";if(oS)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function xY(n){switch(n){case"auto":return sS||rS||oS;case"imagebitmap":return sS;case"image":return rS;case"data":return oS;default:throw new Error("@loaders.gl/images: image ".concat(n," not supported in this environment"))}}(n),n}}const nF={id:"image",module:"images",name:"Images",version:"3.2.9",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg"],parse:function NY(n,e,t){return fS.apply(this,arguments)},tests:[n=>Boolean(tF(new DataView(n)))],options:{image:{type:"auto",decode:!0}}},VY={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:function zY(n){const e=n[0],t=n[n.length-1];return"{"===e&&"}"===t||"["===e&&"]"===t},parseTextSync:JSON.parse},qv="8.8.12",Fx=globalThis.deck&&globalThis.deck.VERSION;if(Fx&&Fx!==qv)throw new Error("deck.gl - multiple versions detected: ".concat(Fx," vs ").concat(qv));Fx||(ur.log(1,"deck.gl ".concat(qv))(),globalThis.deck={...globalThis.deck,VERSION:qv,version:qv,log:ur,_registerLoggers:function eW(n){MT=n}},function a$(n){const e=WR();n=Array.isArray(n)?n:[n];for(const t of n){const i=IT(t);e.find(r=>i===r)||e.unshift(i)}}([VY,[nF,{imagebitmap:{premultiplyAlpha:"none"}}]]));const UY=globalThis.deck,Nx=globalThis;function iF(n){if(!n&&!bd())return"Node";if(dR(n))return"Electron";const t=n||(typeof navigator<"u"?navigator:{}).userAgent||"";if(t.indexOf("Edge")>-1)return"Edge";const i=-1!==t.indexOf("MSIE "),r=-1!==t.indexOf("Trident/");return i||r?"IE":Nx.chrome?"Chrome":Nx.safari?"Safari":Nx.mozInnerScreenX?"Firefox":"Unknown"}class Bx extends kf{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const i=Hi(e),r=hO(e,"TIMER_QUERY");let s=i||r;for(const a of t)switch(a){case"queries":s=s&&i;break;case"timers":s=s&&r;break;default:Bt(!1)}return s}constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(35007)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.begin(e?36202:35887)}beginTransformFeedbackQuery(){return this.begin(35976)}begin(e){return this._queryPending||(this.target=e,this.gl2.beginQuery(this.target,this.handle)),this}end(){return this._queryPending||this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(36795)}getResult(){return this.gl2.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise((i,r)=>{const s=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):t++>e?(r("Timed out"),this._pollingPromise=null):requestAnimationFrame(s)};requestAnimationFrame(s)}),this._pollingPromise}_createHandle(){return Bx.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}const rF=bd()&&typeof document<"u";let KY=0;class JY{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{onCreateContext:t=(K=>XL(K)),onAddHTML:i=null,onInitialize:r=(()=>{}),onRender:s=(()=>{}),onFinalize:a=(()=>{}),onError:u,gl:f=null,glOptions:g={},debug:E=!1,createFramebuffer:M=!1,autoResizeViewport:R=!0,autoResizeDrawingBuffer:F=!0,stats:V=eg.get("animation-loop-".concat(KY++))}=e;let{useDevicePixels:G=!0}=e;"useDevicePixelRatio"in e&&(cn.deprecated("useDevicePixelRatio","useDevicePixels")(),G=e.useDevicePixelRatio),this.props={onCreateContext:t,onAddHTML:i,onInitialize:r,onRender:s,onFinalize:a,onError:u,gl:f,glOptions:g,debug:E,createFramebuffer:M},this.gl=f,this.needsRedraw=null,this.timeline=null,this.stats=V,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:R,autoResizeDrawingBuffer:F,useDevicePixels:G}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return Bt("string"==typeof e),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._running)return this;this._running=!0;const t=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=Bx.isSupported(this.gl,["timers"])?new Bx(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(i=>{this._running&&(this._addCallbackData(i||{}),!1!==i&&this._startLoop())});return this.props.onError&&t.catch(this.props.onError),this}redraw(){return this.isContextLost()||(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers()),this}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}toDataURL(){var e=this;return As(function*(){return e.setNeedsRedraw("toDataURL"),yield e.waitForRender(),e.gl.canvas.toDataURL()})()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const i=document.getElementById(e);return i?Number(i.value):t}setViewParameters(){return cn.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{!this._running||(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=rF?new Promise((e,t)=>{rF&&"complete"===document.readyState?e(document):window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):function YY(n){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(n):clearTimeout(n)}(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):function XY(n){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(n):setTimeout(n,1e3/60)}(e)}_renderFrame(){this.display?this.display._renderFrame(...arguments):this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:t,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){"object"==typeof e&&null!==e&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?zC(this.props.gl,e):this.onCreateContext(e),!Mx(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");(function oq(n){Pf(n,FC)})(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(t);const i=this.props.onAddHTML(t);i&&(t.innerHTML=i)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,t=this.gl.drawingBufferHeight;let i=1;const{canvas:r}=this.gl;return r&&r.clientHeight?i=r.clientWidth/r.clientHeight:e>0&&t>0&&(i=e/t),{width:e,height:t,aspect:i}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&function hq(n){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(n.canvas)return void gq(n,aq(e.useDevicePixels),e);const t=n.getExtension("STACKGL_resize_drawingbuffer");t&&"width"in e&&"height"in e&&t.resize(e.width,e.height)}(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new zo(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}var zx=ns(386);const QY={mousedown:1,mousemove:2,mouseup:4};(function tK(n){const e=n.prototype.handler;n.prototype.handler=function(i){const r=this.store;i.button>0&&"pointerdown"===i.type&&(function eK(n,e){for(let t=0;t<n.length;t++)if(e(n[t]))return!0;return!1}(r,s=>s.pointerId===i.pointerId)||r.push(i)),e.call(this,i)}})(zx.PointerEventInput),function nK(n){n.prototype.handler=function(t){let i=QY[t.type];1&i&&t.button>=0&&(this.pressed=!0),2&i&&0===t.which&&(i=4),this.pressed&&(4&i&&(this.pressed=!1),this.callback(this.manager,i,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}}(zx.MouseInput);const iK=zx.Manager,Md=zx;class Vx{constructor(e,t,i){this.element=e,this.callback=t,this.options={enable:!0,...i}}}const rK=Md?[[Md.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Md.Rotate,{enable:!1}],[Md.Pinch,{enable:!1}],[Md.Swipe,{enable:!1}],[Md.Pan,{threshold:0,enable:!1}],[Md.Press,{enable:!1}],[Md.Tap,{event:"doubletap",taps:2,enable:!1}],[Md.Tap,{event:"anytap",enable:!1}],[Md.Tap,{enable:!1}]]:null,aF={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},sK={doubletap:["tap"]},oK={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},mS={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},aK={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},lF={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},lK=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Y_=typeof window<"u"?window:global;typeof global<"u"?global:window,typeof document<"u"&&document;let gS=!1;try{Y_.addEventListener("test",null,{get passive(){return gS=!0,!0}}),Y_.removeEventListener("test",null)}catch{gS=!1}const cK=-1!==lK.indexOf("firefox"),{WHEEL_EVENTS:uK}=mS,uF=4.000244140625;class fK extends Vx{constructor(e,t,i){super(e,t,i),this.handleEvent=r=>{if(!this.options.enable)return;let s=r.deltaY;Y_.WheelEvent&&(cK&&r.deltaMode===Y_.WheelEvent.DOM_DELTA_PIXEL&&(s/=Y_.devicePixelRatio),r.deltaMode===Y_.WheelEvent.DOM_DELTA_LINE&&(s*=40)),0!==s&&s%uF==0&&(s=Math.floor(s/uF)),r.shiftKey&&s&&(s*=.25),this.callback({type:"wheel",center:{x:r.clientX,y:r.clientY},delta:-s,srcEvent:r,pointerType:"mouse",target:r.target})},this.events=(this.options.events||[]).concat(uK),this.events.forEach(r=>e.addEventListener(r,this.handleEvent,!!gS&&{passive:!1}))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){"wheel"===e&&(this.options.enable=t)}}const{MOUSE_EVENTS:pK}=mS,hF="pointermove",dF="pointerover",fF="pointerout",pF="pointerenter",mF="pointerleave";class mK extends Vx{constructor(e,t,i){super(e,t,i),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:r}=this.options;this.enableMoveEvent=r,this.enableLeaveEvent=r,this.enableEnterEvent=r,this.enableOutEvent=r,this.enableOverEvent=r,this.events=(this.options.events||[]).concat(pK),this.events.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===hF&&(this.enableMoveEvent=t),e===dF&&(this.enableOverEvent=t),e===fF&&(this.enableOutEvent=t),e===pF&&(this.enableEnterEvent=t),e===mF&&(this.enableLeaveEvent=t)}handleOverEvent(e){this.enableOverEvent&&"mouseover"===e.type&&this._emit(dF,e)}handleOutEvent(e){this.enableOutEvent&&"mouseout"===e.type&&this._emit(fF,e)}handleEnterEvent(e){this.enableEnterEvent&&"mouseenter"===e.type&&this._emit(pF,e)}handleLeaveEvent(e){this.enableLeaveEvent&&"mouseleave"===e.type&&this._emit(mF,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":0===e.which&&(this.pressed=!1),this.pressed||this._emit(hF,e);break;case"mouseup":this.pressed=!1}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const{KEY_EVENTS:gK}=mS,gF="keydown";class _K extends Vx{constructor(e,t,i){super(e,t,i),this.handleEvent=r=>{const s=r.target||r.srcElement;"INPUT"===s.tagName&&"text"===s.type||"TEXTAREA"===s.tagName||(this.enableDownEvent&&"keydown"===r.type&&this.callback({type:gF,srcEvent:r,key:r.key,target:r.target}),this.enableUpEvent&&"keyup"===r.type&&this.callback({type:"keyup",srcEvent:r,key:r.key,target:r.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(gK),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(r=>e.addEventListener(r,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===gF&&(this.enableDownEvent=t),"keyup"===e&&(this.enableUpEvent=t)}}const yF="contextmenu";class yK extends Vx{constructor(e,t,i){super(e,t,i),this.handleEvent=r=>{!this.options.enable||this.callback({type:yF,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e===yF&&(this.options.enable=t)}}const vK={pointerdown:1,pointermove:2,pointerup:4,mousedown:1,mousemove:2,mouseup:4};function DK(n){const e=vK[n.srcEvent.type];if(!e)return null;const{buttons:t,button:i,which:r}=n.srcEvent;let s=!1,a=!1,u=!1;return 4===e||2===e&&!Number.isFinite(t)?(s=1===r,a=2===r,u=3===r):2===e?(s=Boolean(1&t),a=Boolean(4&t),u=Boolean(2&t)):1===e&&(s=0===i,a=1===i,u=2===i),{leftButton:s,middleButton:a,rightButton:u}}function IK(n,e){const t=n.center;if(!t)return null;const i=e.getBoundingClientRect();return{center:t,offsetCenter:{x:(t.x-i.left-e.clientLeft)/(i.width/e.offsetWidth||1),y:(t.y-i.top-e.clientTop)/(i.height/e.offsetHeight||1)}}}const vS={srcElement:"root",priority:0};class PK{constructor(e){this.handleEvent=t=>{if(this.isEmpty())return;const i=this._normalizeEvent(t);let r=t.srcEvent.target;for(;r&&r!==i.rootElement;){if(this._emit(i,r),i.handled)return;r=r.parentNode}this._emit(i,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,i,r=!1,s=!1){const{handlers:a,handlersByElement:u}=this;let f=vS;"string"==typeof i||i&&i.addEventListener?f={...vS,srcElement:i}:i&&(f={...vS,...i});let g=u.get(f.srcElement);g||(g=[],u.set(f.srcElement,g));const E={type:e,handler:t,srcElement:f.srcElement,priority:f.priority};r&&(E.once=!0),s&&(E.passive=!0),a.push(E),this._active=this._active||!E.passive;let M=g.length-1;for(;M>=0&&!(g[M].priority>=E.priority);)M--;g.splice(M+1,0,E)}remove(e,t){const{handlers:i,handlersByElement:r}=this;for(let s=i.length-1;s>=0;s--){const a=i[s];if(a.type===e&&a.handler===t){i.splice(s,1);const u=r.get(a.srcElement);u.splice(u.indexOf(a),1),0===u.length&&r.delete(a.srcElement)}}this._active=i.some(s=>!s.passive)}_emit(e,t){const i=this.handlersByElement.get(t);if(i){let r=!1;const s=()=>{e.handled=!0},a=()=>{e.handled=!0,r=!0},u=[];for(let f=0;f<i.length;f++){const{type:g,handler:E,once:M}=i[f];if(E({...e,type:g,stopPropagation:s,stopImmediatePropagation:a}),M&&u.push(i[f]),r)break}for(let f=0;f<u.length;f++){const{type:g,handler:E}=u[f];this.remove(g,E)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...DK(e),...IK(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}const kK={events:null,recognizers:null,recognizerOptions:{},Manager:iK,touchAction:"none",tabIndex:0};class RK{constructor(e=null,t){this._onBasicInput=r=>{const{srcEvent:s}=r,a=oK[s.type];a&&this.manager.emit(a,r)},this._onOtherEvent=r=>{this.manager.emit(r.type,r)},this.options={...kK,...t},this.events=new Map,this.setElement(e);const{events:i}=this.options;i&&this.on(i)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:t}=this;this.manager=new(0,t.Manager)(e,{touchAction:t.touchAction,recognizers:t.recognizers||rK}).on("hammer.input",this._onBasicInput),t.recognizers||Object.keys(aF).forEach(r=>{const s=this.manager.get(r);s&&aF[r].forEach(a=>{s.recognizeWith(a)})});for(const r in t.recognizerOptions){const s=this.manager.get(r);if(s){const a=t.recognizerOptions[r];delete a.enable,s.set(a)}}this.wheelInput=new fK(e,this._onOtherEvent,{enable:!1}),this.moveInput=new mK(e,this._onOtherEvent,{enable:!1}),this.keyInput=new _K(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new yK(e,this._onOtherEvent,{enable:!1});for(const[r,s]of this.events)s.isEmpty()||(this._toggleRecognizer(s.recognizerName,!0),this.manager.on(r,s.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,t,i){this._addEventHandler(e,t,i,!1)}once(e,t,i){this._addEventHandler(e,t,i,!0)}watch(e,t,i){this._addEventHandler(e,t,i,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){const{manager:i}=this;if(!i)return;const r=i.get(e);if(r&&r.options.enable!==t){r.set({enable:t});const s=sK[e];s&&!this.options.recognizers&&s.forEach(a=>{const u=i.get(a);t?(u.requireFailure(e),r.dropRequireFailure(a)):u.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,t),this.moveInput.enableEventType(e,t),this.keyInput.enableEventType(e,t),this.contextmenuInput.enableEventType(e,t)}_addEventHandler(e,t,i,r,s){if("string"!=typeof e){i=t;for(const E in e)this._addEventHandler(E,e[E],i,r,s);return}const{manager:a,events:u}=this,f=lF[e]||e;let g=u.get(f);g||(g=new PK(this),u.set(f,g),g.recognizerName=aK[f]||f,a&&a.on(f,g.handleEvent)),g.add(e,t,i,r,s),g.isEmpty()||this._toggleRecognizer(g.recognizerName,!0)}_removeEventHandler(e,t){if("string"!=typeof e){for(const a in e)this._removeEventHandler(a,e[a]);return}const{events:i}=this,s=i.get(lF[e]||e);if(s&&(s.remove(e,t),s.isEmpty())){const{recognizerName:a}=s;let u=!1;for(const f of i.values())if(f.recognizerName===a&&!f.isEmpty()){u=!0;break}u||this._toggleRecognizer(a,!1)}}}function rg(){}const vF={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:rg,onResize:rg,onViewStateChange:rg,onInteractionStateChange:rg,onBeforeRender:rg,onAfterRender:rg,onLoad:rg,onError:n=>ur.error(n.message)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:({isDragging:n})=>n?"grabbing":"grab",getTooltip:null,debug:!1,drawPickingColors:!1};class Zv{constructor(e){Y(this,"props",void 0),Y(this,"width",0),Y(this,"height",0),Y(this,"userData",{}),Y(this,"canvas",null),Y(this,"viewManager",null),Y(this,"layerManager",null),Y(this,"effectManager",null),Y(this,"deckRenderer",null),Y(this,"deckPicker",null),Y(this,"eventManager",null),Y(this,"tooltip",null),Y(this,"metrics",void 0),Y(this,"animationLoop",void 0),Y(this,"stats",void 0),Y(this,"viewState",void 0),Y(this,"cursorState",void 0),Y(this,"_needsRedraw",void 0),Y(this,"_pickRequest",void 0),Y(this,"_lastPointerDownInfo",null),Y(this,"_metricsCounter",void 0),Y(this,"_onPointerMove",t=>{const{_pickRequest:i}=this;if("pointerleave"===t.type)i.x=-1,i.y=-1,i.radius=0;else{if(t.leftButton||t.rightButton)return;{const r=t.offsetCenter;if(!r)return;i.x=r.x,i.y=r.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=t}),Y(this,"_onEvent",t=>{const i=xL[t.type],r=t.offsetCenter;if(!i||!r||!this.layerManager)return;const s=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:r.x,y:r.y,layers:s,viewports:this.getViewports(r)},this._lastPointerDownInfo),{layer:u}=a,f=u&&(u[i.handler]||u.props[i.handler]),g=this.props[i.handler];let E=!1;f&&(E=f.call(u,a,t)),!E&&g&&g(a,t)}),Y(this,"_onPointerDown",t=>{const i=t.offsetCenter,r=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=r.result[0]||r.emptyInfo}),this.props={...vF,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&ur.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),"IE"===iF()&&ur.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new AT({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&O_.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,t,i,r,s,a,u,f;this.animationLoop.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,null===(e=this.layerManager)||void 0===e||e.finalize(),this.layerManager=null,null===(t=this.viewManager)||void 0===t||t.finalize(),this.viewManager=null,null===(i=this.effectManager)||void 0===i||i.finalize(),this.effectManager=null,null===(r=this.deckRenderer)||void 0===r||r.finalize(),this.deckRenderer=null,null===(s=this.deckPicker)||void 0===s||s.finalize(),this.deckPicker=null,null===(a=this.eventManager)||void 0===a||a.destroy(),this.eventManager=null,null===(u=this.tooltip)||void 0===u||u.remove(),this.tooltip=null,this.props.canvas||this.props.gl||!this.canvas||(null===(f=this.canvas.parentElement)||void 0===f||f.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&ur.removed("onLayerHover","onHover")(),"onLayerClick"in e&&ur.removed("onLayerClick","onClick")(),e.initialViewState&&!Z_(this.props.initialViewState,e.initialViewState)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),r=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),a=this.deckRenderer.needsRedraw(e);return t=t||i||r||s||a,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return null!==this.viewManager}getViews(){return bo(this.viewManager),this.viewManager.views}getViewports(e){return bo(this.viewManager),this.viewManager.getViewports(e)}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_pick(e,t,i){bo(this.deckPicker);const{stats:r}=this;r.get("Pick Count").incrementCount(),r.get(t).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return r.get(t).timeEnd(),s}_createCanvas(e){let t=e.canvas;return"string"==typeof t&&(t=document.getElementById(t),bo(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;const{width:t,height:i}=e;if(t||0===t){const s=Number.isFinite(t)?"".concat(t,"px"):t;this.canvas.style.width=s}if(i||0===i){var r;const s=Number.isFinite(i)?"".concat(i,"px"):i;this.canvas.style.position=(null===(r=e.style)||void 0===r?void 0:r.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const t=e.clientWidth||e.width,i=e.clientHeight||e.height;var r;t===this.width&&i===this.height||(this.width=t,this.height=i,null===(r=this.viewManager)||void 0===r||r.setProps({width:t,height:i}),this.props.onResize({width:t,height:i}))}_createAnimationLoop(e){const{width:t,height:i,gl:r,glOptions:s,debug:a,onError:u,onBeforeRender:f,onAfterRender:g,useDevicePixels:E}=e;return new JY({width:t,height:i,useDevicePixels:E,autoResizeViewport:!1,gl:r,onCreateContext:M=>XL({...s,...M,canvas:this.canvas,debug:a,onContextLost:()=>this._onContextLost()}),onInitialize:M=>this._setGLContext(M.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:f,onAfterRender:g,onError:u})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new nS({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:i,emptyInfo:r}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=i.length>0;let s=r,a=!1;for(const u of i){var t;s=u,a=(null===(t=u.layer)||void 0===t?void 0:t.onHover(u,e.event))||a}if(!a&&this.props.onHover&&this.props.onHover(s,e.event),this.props.getTooltip&&this.tooltip){const u=this.props.getTooltip(s);this.tooltip.setTooltip(u,s.x,s.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,zC(e,{enable:!0,copyState:!0})),this.tooltip=new _Y(this.canvas),Pf(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const t=new hR;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new RK(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const r in xL)this.eventManager.on(r,this._onEvent);this.viewManager=new lX({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new aX(e,{deck:this,stats:this.stats,viewport:i,timeline:t}),this.effectManager=new rY,this.deckRenderer=new cY(e),this.deckPicker=new mY(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){const{gl:i}=this.layerManager.context;Pf(i,this.props.parameters),this.props.onBeforeRender({gl:i}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",redrawReason:e,effects:this.effectManager.getEffects(),...t}),this.props.onAfterRender({gl:i})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60==0&&(this._getMetrics(),this.stats.reset(),ur.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const i=eg.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}function Xv(n){const{lng:e,lat:t}=n.getCenter();return{longitude:(e+540)%360-180,latitude:t,zoom:n.getZoom(),bearing:n.getBearing(),pitch:n.getPitch(),padding:n.getPadding(),repeat:n.getRenderWorldCopies()}}function bF(n,e,t=!0){const{mapboxVersion:i}=n.userData;return new Lf(Object.assign({id:"mapbox",x:0,y:0,width:n.width,height:n.height},Xv(e),t?{nearZMultiplier:1===i.major&&i.minor>=3||i.major>=2?.02:1/(n.height||1)}:{nearZMultiplier:.1}))}function bS(n){if(n.userData.isExternal)return;const e=[];n.userData.mapboxLayers.forEach(t=>{const r=new(0,t.props.type)(t.props);e.push(r)}),n.setProps({layers:e})}Y(Zv,"defaultProps",vF),Y(Zv,"VERSION",UY.VERSION);class jK{constructor(e){if(Y(this,"id",void 0),Y(this,"type",void 0),Y(this,"renderingMode",void 0),Y(this,"map",void 0),Y(this,"deck",void 0),Y(this,"props",void 0),!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.map=null,this.deck=null,this.props=e}onAdd(e,t){this.map=e,this.deck=function LK({map:n,gl:e,deck:t}){if(n.__deck)return n.__deck;const i=t?.props._customRender,r={useDevicePixels:!0,_customRender:()=>{n.triggerRepaint(),i?.("")},parameters:{depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774},views:t&&t.props.views||[new nS({id:"mapbox"})]};let s;return(!t||t.props.gl===e)&&(Object.assign(r,{gl:e,width:null,height:null,touchAction:"unset",viewState:Xv(n)}),n.on("move",()=>function UK(n,e){n.setProps({viewState:Xv(e)}),n.needsRedraw({clearRedrawFlags:!0})}(s,n))),t?(s=t,t.setProps(r),t.userData.isExternal=!0):(s=new Zv(r),n.on("remove",()=>{s.finalize(),n.__deck=null})),s.userData.mapboxLayers=new Set,s.userData.mapboxVersion=function zK(n){let e=0,t=0;const i=n.version;return i&&([e,t]=i.split(".").slice(0,2).map(Number)),{major:e,minor:t}}(n),n.__deck=s,n.on("render",()=>{s.isInitialized&&function VK(n,e){const{mapboxLayers:t,isExternal:i}=n.userData;if(i){const r=Array.from(t,E=>E.id),a=k_(n.props.layers,Boolean).some(E=>E&&!r.includes(E.id));let u=n.getViewports();const f=u.findIndex(E=>"mapbox"===E.id),g=u.length>1||f<0;(a||g)&&(f>=0&&(u=u.slice(),u[f]=bF(n,e,!1)),n._drawLayers("mapbox-repaint",{viewports:u,layerFilter:E=>(!n.props.layerFilter||n.props.layerFilter(E))&&("mapbox"!==E.viewport.id||!r.includes(E.layer.id)),clearCanvas:!1}))}n.userData.currentViewport=null}(s,n)}),s}({map:e,gl:t,deck:this.props.deck}),function OK(n,e){n.userData.mapboxLayers.add(e),bS(n)}(this.deck,this)}onRemove(){this.deck&&function FK(n,e){n.userData.mapboxLayers.delete(e),bS(n)}(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&function NK(n,e){bS(n)}(this.deck)}render(){!function BK(n,e,t){let{currentViewport:i}=n.userData,r=!1;i||(i=bF(n,e,!0),n.userData.currentViewport=i,r=!0),n.isInitialized&&n._drawLayers("mapbox-repaint",{viewports:[i],layerFilter:({layer:s})=>t.id===s.id,clearStack:r,clearCanvas:!1})}(this.deck,this.map,this)}}const xS="__UNDEFINED__";function jx(n,e,t,i){if(!(n&&e&&n.style&&n.style._loaded))return;const r=k_(i,Boolean);if(t!==i){const u=k_(t,Boolean),f=new Set(u.map(g=>g.id));for(const g of r)f.delete(g.id);for(const g of f)n.getLayer(g)&&n.removeLayer(g)}for(const u of r){const f=n.getLayer(u.id);f?f.implementation.setProps(u.props):n.addLayer(new jK({id:u.id,deck:e}),u.props.beforeId)}const s=n.style._order,a={};for(const u of r){let{beforeId:f}=u.props;(!f||!s.includes(f))&&(f=xS),a[f]=a[f]||[],a[f].push(u.id)}for(const u in a){const f=a[u];let g=u===xS?s.length:s.indexOf(u),E=u===xS?void 0:u;for(let M=f.length-1;M>=0;M--){const R=f[M],F=s.indexOf(R);F!==g-1&&(n.moveLayer(R,E),F>g&&g++),g--,E=R}}}class HK{constructor(e){Y(this,"_props",void 0),Y(this,"_deck",void 0),Y(this,"_map",void 0),Y(this,"_container",void 0),Y(this,"_interleaved",void 0),Y(this,"_handleStyleChange",()=>{jx(this._map,this._deck,this._props.layers,this._props.layers)}),Y(this,"_updateContainerSize",()=>{if(this._map&&this._container){const{clientWidth:r,clientHeight:s}=this._map.getContainer();Object.assign(this._container.style,{width:"".concat(r,"px"),height:"".concat(s,"px")})}}),Y(this,"_updateViewState",()=>{const r=this._deck;r&&(r.setProps({viewState:Xv(this._map)}),r.redraw())}),Y(this,"_handleMouseEvent",r=>{const s=this._deck;if(!s)return;const a={type:r.type,offsetCenter:r.point,srcEvent:r};switch(r.type){case"click":a.tapCount=1,s._onPointerDown(a),s._onEvent(a);break;case"dblclick":a.type="click",a.tapCount=2,s._onEvent(a);break;case"mousemove":a.type="pointermove",s._onPointerMove(a);break;case"mouseout":a.type="pointerleave",s._onPointerMove(a);break;default:return}});const{interleaved:t=!1,...i}=e;this._interleaved=t,this._props=i}setProps(e){this._interleaved&&e.layers&&jx(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,e),this._deck&&this._deck.setProps(this._props)}onAdd(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}_onAddOverlaid(e){const t=document.createElement("div");return Object.assign(t.style,{position:"absolute",left:0,top:0,pointerEvents:"none"}),this._container=t,this._deck=new Zv({...this._props,parent:t,viewState:Xv(e)}),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),t}_onAddInterleaved(e){return this._deck=new Zv({...this._props,gl:e.painter.context.gl}),e.on("styledata",this._handleStyleChange),jx(e,this._deck,[],this._props.layers),document.createElement("div")}onRemove(){var e;const t=this._map;t&&(this._interleaved?this._onRemoveInterleaved(t):this._onRemoveOverlaid(t)),null===(e=this._deck)||void 0===e||e.finalize(),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(e){e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent)}_onRemoveInterleaved(e){e.off("styledata",this._handleStyleChange),jx(e,this._deck,this._props.layers,[])}getDefaultPosition(){return"top-left"}pickObject(e){return bo(this._deck),this._deck.pickObject(e)}pickMultipleObjects(e){return bo(this._deck),this._deck.pickMultipleObjects(e)}pickObjects(e){return bo(this._deck),this._deck.pickObjects(e)}finalize(){this._map&&this._map.removeControl(this)}}class wS{constructor(e,t){Y(this,"opts",void 0),Y(this,"source",void 0),this.opts=t,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),t=this.getAccessor();if(e)return[e,t];const{value:i}=this.source,{size:r}=t;let s=i;if(i&&i.length!==r){s=new Float32Array(r);const a=t.elementOffset||0;for(let u=0;u<r;++u)s[u]=i[a+u]}return s}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function Hx(n){return n.stride||n.size*n.bytesPerElement}function xF(n,e){e.offset&&ur.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=Hx(n),s=(void 0!==e.vertexOffset?e.vertexOffset:n.vertexOffset||0)*t+(e.elementOffset||0)*n.bytesPerElement+(n.offset||0);return{...e,offset:s,stride:t}}const wF=[],EF=[];function Gx(n,e=0,t=1/0){let i=wF;const r={index:-1,data:n,target:[]};return n?"function"==typeof n[Symbol.iterator]?i=n:n.length>0&&(EF.length=n.length,i=EF):i=wF,(e>0||Number.isFinite(t))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,t),r.index=e-1),{iterable:i,objectInfo:r}}function TF(n){return n&&n[Symbol.asyncIterator]}function CF(n,e){const{size:t,stride:i,offset:r,startIndices:s,nested:a}=e,u=n.BYTES_PER_ELEMENT,f=i?i/u:t,g=r?r/u:0,E=Math.floor((n.length-g)/f);return(M,{index:R,target:F})=>{if(!s){const se=R*f+g;for(let _e=0;_e<t;_e++)F[_e]=n[se+_e];return F}const V=s[R],G=s[R+1]||E;let K;if(a){K=new Array(G-V);for(let se=V;se<G;se++){const _e=se*f+g;F=new Array(t);for(let de=0;de<t;de++)F[de]=n[_e+de];K[se-V]=F}}else if(f===t)K=n.subarray(V*t+g,G*t+g);else{K=new n.constructor((G-V)*t);let se=0;for(let _e=V;_e<G;_e++){const de=_e*f+g;for(let Ie=0;Ie<t;Ie++)K[se++]=n[de+Ie]}}return K}}const qK=[],Wx=[[0,1/0]];function ES(n){const{source:e,target:t,start:i=0,size:r,getData:s}=n,u=e.length,f=(n.end||t.length)-i;if(u>f)return void t.set(e.subarray(0,f),i);if(t.set(e,i),!s)return;let g=u;for(;g<f;){const E=s(g,e);for(let M=0;M<r;M++)t[i+g]=E[M]||0,g++}}const YK={interpolation:{duration:0,easing:n=>n},spring:{stiffness:.05,damping:.5}};function SF(n,e){if(!n)return null;Number.isFinite(n)&&(n={type:"interpolation",duration:n});const t=n.type||"interpolation";return{...YK[t],...e,...n,type:t}}function MF(n,e){const t=e.getBuffer();return t?[t,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function AF(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(n,'"'))}}function DF(n){n.push(n.shift())}function TS(n,e){const{doublePrecision:t,settings:i,value:r,size:s}=n,a=t&&r instanceof Float64Array?2:1;return(i.noAlloc?r.length:e*s)*a}function IF({buffer:n,numInstances:e,attribute:t,fromLength:i,fromStartIndices:r,getData:s=(a=>a)}){const a=t.doublePrecision&&t.value instanceof Float64Array?2:1,u=t.size*a,f=t.byteOffset,g=t.startIndices,E=r&&g,M=TS(t,e),R=t.isConstant;if(!E&&i>=M)return;const F=R?t.value:t.getBuffer().getData({srcByteOffset:f});if(t.settings.normalized&&!R){const se=s;s=(_e,de)=>t.normalizeConstant(se(_e,de))}const V=R?(se,_e)=>s(F,_e):(se,_e)=>s(F.subarray(se,se+u),_e),G=n.getData({length:i}),K=new Float32Array(M);(function XK({source:n,target:e,size:t,getData:i,sourceStartIndices:r,targetStartIndices:s}){if(!Array.isArray(s))return ES({source:n,target:e,size:t,getData:i}),e;let a=0,u=0;const f=i&&((E,M)=>i(E+u,M)),g=Math.min(r.length,s.length);for(let E=1;E<g;E++){const M=r[E]*t,R=s[E]*t;ES({source:n.subarray(a,M),target:e,start:u,end:R,size:t,getData:f}),a=M,u=R}u<e.length&&ES({source:[],target:e,start:u,size:t,getData:f})})({source:G,target:K,sourceStartIndices:r,targetStartIndices:g,size:u,getData:V}),n.byteLength<K.byteLength+f&&n.reallocate(K.byteLength+f),n.subData({data:K,offset:f})}class CS extends class $K{constructor(e,t,i){Y(this,"gl",void 0),Y(this,"id",void 0),Y(this,"size",void 0),Y(this,"settings",void 0),Y(this,"value",void 0),Y(this,"doublePrecision",void 0),Y(this,"_buffer",void 0),Y(this,"state",void 0),this.gl=e,this.id=t.id||"",this.size=t.size||1;const r=t.logicalType||t.type,s=5130===r;let u,{defaultValue:a}=t;a=Number.isFinite(a)?[a]:a||new Array(this.size).fill(0),u=s?5126:!r&&t.isIndexed?e&&function Hq(n,e){return hO(n,e)}(e,"ELEMENT_INDEX_UINT32")?5125:5123:r||5126;let f=function GK(n){switch(n){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}(r||u||5126);this.doublePrecision=s,s&&!1===t.fp64&&(f=Float32Array),this.value=null,this.settings={...t,defaultType:f,defaultValue:a,logicalType:r,type:u,size:this.size,bytesPerElement:f.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:t}=this.settings;this._buffer=new Nr(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:t}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Hx(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),O_.release(this.state.allocatedValue)}getShaderAttributes(e,t){if(this.doublePrecision){const i={},r=this.value instanceof Float64Array,s=function WK(n,e){const t=xF(n,e);return{high:t,low:{...t,offset:t.offset+4*n.size}}}(this.getAccessor(),t||{});return i[e]=new wS(this,s.high),i["".concat(e,"64Low")]=r?new wS(this,s.low):new Float32Array(this.size),i}if(t){const i=xF(this.getAccessor(),t);return{[e]:new wS(this,i)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:i,size:r}=this,s=i*r;if(t&&s&&t.length>=s){const a=new Array(r).fill(1/0),u=new Array(r).fill(-1/0);for(let f=0;f<s;)for(let g=0;g<r;g++){const E=t[f++];E<a[g]&&(a[g]=E),E>u[g]&&(u[g]=E)}e=[a,u]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let i;i=ArrayBuffer.isView(e)?{value:e}:e instanceof Nr?{buffer:e}:e;const r={...this.settings,...i};if(t.bufferAccessor=r,t.bounds=null,i.constant){let s=i.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),t.constant&&this._areValuesEqual(s,this.value))return!1;t.externalBuffer=null,t.constant=!0,this.value=s}else if(i.buffer){const s=i.buffer;t.externalBuffer=s,t.constant=!1,this.value=i.value||null;const a=i.value instanceof Float64Array;r.type=i.type||s.accessor.type,r.bytesPerElement=s.accessor.BYTES_PER_ELEMENT*(a?2:1),r.stride=Hx(r)}else if(i.value){this._checkExternalBuffer(i);let s=i.value;t.externalBuffer=null,t.constant=!1,this.value=s,r.bytesPerElement=s.BYTES_PER_ELEMENT,r.stride=Hx(r);const{buffer:a,byteOffset:u}=this;this.doublePrecision&&s instanceof Float64Array&&(s=mC(s,r));const f=s.byteLength+u+2*r.stride;a.byteLength<f&&a.reallocate(f),a.setAccessor(null),a.subData({data:s,offset:u}),r.type=i.type||a.accessor.type}return!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:i=0,endOffset:r}=e;this.buffer.subData({data:this.doublePrecision&&t instanceof Float64Array?mC(t,{size:this.size,startIndex:i,endIndex:r}):t.subarray(i,r),offset:i*t.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e,t=!1){const{state:i}=this,r=i.allocatedValue,s=O_.allocate(r,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=s;const{buffer:a,byteOffset:u}=this;return a.byteLength<s.byteLength+u&&(a.reallocate(s.byteLength+u),t&&r&&a.subData({data:r instanceof Float64Array?mC(r,this):r,offset:u})),i.allocatedValue=s,i.constant=!1,i.externalBuffer=null,i.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const i=this.settings.defaultType;let r=!1;if(this.doublePrecision&&(r=t.BYTES_PER_ELEMENT<4),r)throw new Error("Attribute ".concat(this.id," does not support ").concat(t.constructor.name));!(t instanceof i)&&this.settings.normalized&&!("normalized"in e)&&ur.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(t=>(t+128)/255*2-1);case 5122:return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case 5121:return new Float32Array(e).map(t=>t/255);case 5123:return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,i){const{defaultValue:r,size:s}=this.settings;if(Number.isFinite(e))return t[i]=e,t;if(!e)return t[i]=r[0],t;switch(s){case 4:t[i+3]=Number.isFinite(e[3])?e[3]:r[3];case 3:t[i+2]=Number.isFinite(e[2])?e[2]:r[2];case 2:t[i+1]=Number.isFinite(e[1])?e[1]:r[1];case 1:t[i+0]=Number.isFinite(e[0])?e[0]:r[0];break;default:let a=s;for(;--a>=0;)t[i+a]=Number.isFinite(e[a])?e[a]:r[a]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:i}=this;for(let r=0;r<i;r++)if(e[r]!==t[r])return!1;return!0}}{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:Wx}),Y(this,"constant",!1),this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat("function"!=typeof e&&e||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,i=this.settings.transition;return SF(Array.isArray(t)?e[t.find(s=>e[s])]:e[t],i)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:i=0,endRow:r=1/0}=t;this.state.updateRanges=function ZK(n,e){if(n===Wx||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return n;const t=[],i=n.length;let r=0;for(let s=0;s<i;s++){const a=n[s];a[1]<e[0]?(t.push(a),r=s+1):a[0]>e[1]?t.push(a):e=[Math.min(a[0],e[0]),Math.max(a[1],e[1])]}return t.splice(r,0,e),t}(this.state.updateRanges,[i,r])}else this.state.updateRanges=Wx}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=qK}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:i}=this;return!i.noAlloc&&!!i.update&&(super.allocate(e,t.updateRanges!==Wx),!0)}updateBuffer({numInstances:e,data:t,props:i,context:r}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:a,noAlloc:u}}=this;let f=!0;if(a){for(const[g,E]of s)a.call(r,this,{data:t,startRow:g,endRow:E,props:i,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[g,E]of s){const M=Number.isFinite(g)?this.getVertexOffset(g):0,R=Number.isFinite(E)?this.getVertexOffset(E):u||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:M,endOffset:R})}this._checkAttributeArray()}else f=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),f}setConstantValue(e){return void 0!==e&&"function"!=typeof e&&(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:i,settings:r}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(r.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),r.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const a=e;bo(ArrayBuffer.isView(a.value),"invalid ".concat(r.accessor));const u=Boolean(a.size)&&a.size!==this.size;return i.binaryAccessor=CF(a.value,{size:a.size||this.size,stride:a.stride,offset:a.offset,startIndices:t,nested:u}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?t[e]:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},t={};for(const i in e)Object.assign(t,super.getShaderAttributes(i,e[i]));return t}_autoUpdater(e,{data:t,startRow:i,endRow:r,props:s,numInstances:a}){if(e.constant)return;const{settings:u,state:f,value:g,size:E,startIndices:M}=e,{accessor:R,transform:F}=u,V=f.binaryAccessor||("function"==typeof R?R:s[R]);bo("function"==typeof V,'accessor "'.concat(R,'" is not a function'));let G=e.getVertexOffset(i);const{iterable:K,objectInfo:se}=Gx(t,i,r);for(const _e of K){se.index++;let de=V(_e,se);if(F&&(de=F.call(this,de)),M){const Ie=(se.index<M.length-1?M[se.index+1]:a)-M[se.index];if(de&&Array.isArray(de[0])){let qe=G;for(const Qe of de)e._normalizeValue(Qe,g,qe),qe+=E}else de&&de.length>E?g.set(de,G):(e._normalizeValue(de,se.target,0),tW({target:g,source:se.target,start:G,count:Ie}));G+=Ie*E}else e._normalizeValue(de,g,G),G+=E}}_validateAttributeUpdaters(){const{settings:e}=this;if(!e.noAlloc&&"function"!=typeof e.update)throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let i=!0;switch(t){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error("Illegal attribute generated for ".concat(this.id))}}}const KK="void main() {gl_FragColor = vec4(0);}",PF="out vec4 transform_output;\nvoid main() {\n  transform_output = vec4(0);\n}",JK="#version 300 es\n".concat(PF);function kF(n,e){e=Array.isArray(e)?e:[e];const t=n.replace(/^\s+/,"").split(/\s+/),[i,r,s]=t;return e.includes(i)&&r&&s?{qualifier:i,type:r,name:s.split(";")[0]}:null}function RF(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{version:e=100,input:t,inputType:i,output:r}=n;if(!t)return 300===e?JK:e>300?"#version ".concat(e,"\n").concat(PF):KK;const s=tJ(t,i);return e>=300?"#version ".concat(e," ").concat(300===e?"es":"","\nin ").concat(i," ").concat(t,";\nout vec4 ").concat(r,";\nvoid main() {\n  ").concat(r," = ").concat(s,";\n}"):"varying ".concat(i," ").concat(t,";\nvoid main() {\n  gl_FragColor = ").concat(s,";\n}")}function tJ(n,e){switch(e){case"float":return"vec4(".concat(n,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(n,", 0.0, 1.0)");case"vec3":return"vec4(".concat(n,", 1.0)");case"vec4":return n;default:return tu(!1),null}}class LF extends kf{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return Hi(e)}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};wl(e),super(e,t),this.initialize(t),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,H_(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.bind(()=>{for(const t in e)this.setBuffer(t,e[t])}),this}setBuffer(e,t){const i=this._getVaryingIndex(e),{buffer:r,byteSize:s,byteOffset:a}=this._getBufferParams(t);return i<0?(this.unused[e]=r,cn.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[i]=t,this.bindOnUse||this._bindBuffer(i,r,a,s),this)}begin(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let t,i,r;return e instanceof Nr?r=e:(r=e.buffer,i=e.byteSize,t=e.byteOffset),(void 0!==t||void 0!==i)&&(t=t||0,i=i||r.byteLength-t),{buffer:r,byteOffset:t,byteSize:i}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const t=Number(e);return Number.isFinite(t)?t:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:t,byteSize:i,byteOffset:r}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,t,r,i)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,t){let r=arguments.length>3?arguments[3]:void 0;const s=t&&t.handle;return s&&void 0!==r?this.gl.bindBufferRange(35982,e,s,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r):this.gl.bindBufferBase(35982,e,s),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}class nJ{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(t),Object.seal(this)}setupResources(e){for(const t of this.bindings)this._setupTransformFeedback(t,e)}updateModelProps(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{varyings:t}=this;return t.length>0&&(e=Object.assign({},e,{varyings:t})),e}getDrawOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=this.bindings[this.currentIndex],{sourceBuffers:i,transformFeedback:r}=t;return{attributes:Object.assign({},i,e.attributes),transformFeedback:r}}swap(){return!!this.feedbackMap&&(this.currentIndex=this._getNextIndex(),!0)}update(){this._setupBuffers(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}getBuffer(e){const{feedbackBuffers:t}=this.bindings[this.currentIndex],i=e?t[e]:null;return i?i instanceof Nr?i:i.buffer:null}getData(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{varyingName:t}=e,i=this.getBuffer(t);return i?i.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&Bt(Hi(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:t={}}=e,i={};if(this.bindings[this.currentIndex]&&Object.assign(i,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const r in this.feedbackMap){const s=this.feedbackMap[r];r in t&&(i[s]=r)}Object.assign(i,e.feedbackBuffers);for(const r in i){const s=i[r];if("string"==typeof s){const a=t[s],{byteLength:u,usage:f,accessor:g}=a;i[r]=this._createNewBuffer(r,{byteLength:u,usage:f,accessor:g})}}return i}_setupBuffers(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{sourceBuffers:t=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const i=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:t,feedbackBuffers:i})}_setupTransformFeedback(e,t){let{model:i}=t;const{program:r}=i;e.transformFeedback=new LF(this.gl,{program:r,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:t,feedbackBuffers:i}=this._swapBuffers(this.bindings[this.currentIndex]),r=this._getNextIndex();this.bindings[r]=this._updateBinding(this.bindings[r],{sourceBuffers:t,feedbackBuffers:i})}}_updateBinding(e,t){return e?(Object.assign(e.sourceBuffers,t.sourceBuffers),Object.assign(e.feedbackBuffers,t.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},t.sourceBuffers),feedbackBuffers:Object.assign({},t.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const t=Object.assign({},e.sourceBuffers),i=Object.assign({},e.feedbackBuffers);for(const r in this.feedbackMap){const s=this.feedbackMap[r];t[r]=e.feedbackBuffers[s],i[s]=e.sourceBuffers[r],Bt(i[s]instanceof Nr)}return{sourceBuffers:t,feedbackBuffers:i}}_createNewBuffer(e,t){const i=new Nr(this.gl,t);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=i,i}_getNextIndex(){return(this.currentIndex+1)%2}}function OF(n){let e=100;const t=n.match(/[^\s]+/g);if(t.length>=2&&"#version"===t[0]){const i=parseInt(t[1],10);Number.isFinite(i)&&(e=i)}return e}const iJ={name:"transform",vs:"attribute float transform_elementID;\nvec2 transform_getPixelSizeHalf(vec2 size) {\n  return vec2(1.) / (2. * size);\n}\n\nvec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {\n  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);\n  float xIndex = transform_elementID - (yIndex * texSize[0]);\n  return vec2(xIndex, yIndex);\n}\nvec2 transform_getTexCoord(vec2 size) {\n  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);\n  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);\n  vec2 coord = indices / size + pixelSizeHalf;\n  return coord;\n}\nvec2 transform_getPos(vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);\n  return pos;\n}\nvec4 transform_getInput(sampler2D texSampler, vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  vec4 textureColor = texture2D(texSampler, texCoord);\n  return textureColor;\n}\n",fs:null},$x="transform_uSize_",FF="transform_position";const hJ={10241:9728,10240:9728,10242:33071,10243:33071};class fJ{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(t),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=this._processVertexShader(e);return Object.assign({},e,t)}getDrawOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{sourceBuffers:t,sourceTextures:i,framebuffer:r,targetTexture:s}=this.bindings[this.currentIndex],a=Object.assign({},t,e.attributes),u=Object.assign({},e.uniforms),f=Object.assign({},e.parameters);let g=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){a.transform_elementID=this.elementIDBuffer;for(const M in this.samplerTextureMap)u[M]=i[this.samplerTextureMap[M]];this._setSourceTextureParameters();const E=function oJ(n){let{sourceTextureMap:e,targetTextureVarying:t,targetTexture:i}=n;const r={};let s,a;t&&(({width:s,height:a}=i),r["".concat($x).concat(t)]=[s,a]);for(const u in e)({width:s,height:a}=e[u]),r["".concat($x).concat(u)]=[s,a];return r}({sourceTextureMap:i,targetTextureVarying:this.targetTextureVarying,targetTexture:s});Object.assign(u,E)}return this.hasTargetTexture&&(g=!1,f.viewport=[0,0,r.width,r.height]),{attributes:a,framebuffer:r,uniforms:u,discard:g,parameters:f}}swap(){return!!this._swapTexture&&(this.currentIndex=this._getNextIndex(),!0)}update(){this._setupTextures(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{framebuffer:t}=this.bindings[this.currentIndex],i=Dx(t);if(!e)return i;const r=i.constructor,s=function eJ(n){switch(n){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return tu(!1),null}}(this.targetTextureType),a=new r(i.length*s/4);let u=0;for(let f=0;f<i.length;f+=4)for(let g=0;g<s;g++)a[u++]=i[f+g];return a}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{_targetTextureVarying:t,_swapTexture:i}=e;this._swapTexture=i,this.targetTextureVarying=t,this.hasTargetTexture=t,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:t,textureOrReference:i}=e;if(i instanceof Ql)return i;const r=t[i];return r?(this._targetRefTexName=i,this._createNewTexture(r)):null}_setupTextures(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{sourceBuffers:t,_sourceTextures:i={},_targetTexture:r}=e,s=this._createTargetTexture({sourceTextures:i,textureOrReference:r});this.hasSourceTextures=this.hasSourceTextures||i&&Object.keys(i).length>0,this._updateBindings({sourceBuffers:t,sourceTextures:i,targetTexture:s}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if("number"!=typeof e||this.elementCount>=e)return;const t=new Float32Array(e);t.forEach((i,r,s)=>{s[r]=r}),this.elementIDBuffer?this.elementIDBuffer.setData({data:t}):this.elementIDBuffer=new Nr(this.gl,{data:t,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:t,targetTexture:i}=this._swapTextures(this.bindings[this.currentIndex]),r=this._getNextIndex();this.bindings[r]=this._updateBinding(this.bindings[r],{sourceTextures:t,targetTexture:i})}}_updateBinding(e,t){const{sourceBuffers:i,sourceTextures:r,targetTexture:s}=t;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,r),Object.assign(e.sourceBuffers,i),s){e.targetTexture=s;const{width:a,height:u}=s,{framebuffer:f}=e;f?(f.update({attachments:{36064:s},resizeAttachments:!1}),f.resize({width:a,height:u})):e.framebuffer=new zo(this.gl,{id:"transform-framebuffer",width:a,height:u,attachments:{36064:s}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:t}=this.bindings[e];for(const i in t)t[i].setParameters(hJ)}_swapTextures(e){if(!this._swapTexture)return null;const t=Object.assign({},e.sourceTextures);return t[this._swapTexture]=e.targetTexture,{sourceTextures:t,targetTexture:e.sourceTextures[this._swapTexture]}}_createNewTexture(e){const t=function Nq(n,e){Bt(n instanceof Ql||n instanceof Oq||n instanceof Fq);const t=n.constructor,{gl:i,width:r,height:s,format:a,type:u,dataFormat:f,border:g,mipmaps:E}=n;return new t(i,Object.assign({width:r,height:s,format:a,type:u,dataFormat:f,border:g,mipmaps:E},e))}(e,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=t,t}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{sourceTextures:t,targetTexture:i}=this.bindings[this.currentIndex],{vs:r,uniforms:s,targetTextureType:a,inject:u,samplerTextureMap:f}=function sJ(n){let{vs:e,sourceTextureMap:t,targetTextureVarying:i,targetTexture:r}=n,a=Object.keys(t).length,u=null;const f={};let g=e,E={};if(a>0||i){const M=g.split("\n"),R=M.slice();if(M.forEach((F,V,G)=>{if(a>0){const K=function uJ(n,e){const t={},i=function aJ(n){return kF(n,["attribute","in"])}(n);if(!i)return null;const{type:r,name:s}=i;if(s&&e[s]){const a="// ".concat(n," => Replaced by Transform with a sampler"),{samplerName:u,sizeName:f,uniformDeclerations:g}=function lJ(n){const e="".concat("transform_uSampler_").concat(n),t="".concat($x).concat(n);return{samplerName:e,sizeName:t,uniformDeclerations:"  uniform sampler2D ".concat(e,";\n  uniform vec2 ").concat(t,";")}}(s),E=function QK(n){switch(n){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return tu(!1),null}}(r),M="  ".concat(r," ").concat(s," = transform_getInput(").concat(u,", ").concat(f,").").concat(E,";\n");return t[u]=s,{updatedLine:a,inject:{"vs:#decl":g,"vs:#main-start":M},samplerTextureMap:t}}return null}(F,t);if(K){const{updatedLine:se,inject:_e}=K;R[V]=se,E=kC([E,_e]),Object.assign(f,K.samplerTextureMap),a--}}i&&!u&&(u=function cJ(n,e){const t=kF(n,["varying","out"]);return t&&t.name===e?t.type:null}(F,i))}),i){Bt(r);const F="".concat($x).concat(i),V="uniform vec2 ".concat(F,";\n"),G="     vec2 ".concat(FF," = transform_getPos(").concat(F,");\n     gl_Position = vec4(").concat(FF,", 0, 1.);\n");E=kC([E,{"vs:#decl":V,"vs:#main-start":G}])}g=R.join("\n")}return{vs:g,targetTextureType:u,inject:E,samplerTextureMap:f}}({vs:e.vs,sourceTextureMap:t,targetTextureVarying:this.targetTextureVarying,targetTexture:i}),g=kC([e.inject||{},u]);return this.targetTextureType=a,this.samplerTextureMap=f,{vs:r,fs:e._fs||RF({version:OF(r),input:this.targetTextureVarying,inputType:a,output:"transform_output"}),modules:this.hasSourceTextures||this.targetTextureVarying?[iJ].concat(e.modules||[]):e.modules,uniforms:s,inject:g}}}let qx=null;class su extends kf{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return!(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).constantAttributeZero||Hi(e)||"Chrome"===iF()}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new su(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return su.MAX_ATTRIBUTES=su.MAX_ATTRIBUTES||e.getParameter(34921),su.MAX_ATTRIBUTES}static setConstant(e,t,i){switch(i.constructor){case Float32Array:su._setConstantFloatArray(e,t,i);break;case Int32Array:su._setConstantIntArray(e,t,i);break;case Uint32Array:su._setConstantUintArray(e,t,i);break;default:Bt(!1)}}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,Object.assign({},t,{id:t.id||t.program&&t.program.id})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=t.isDefaultArray||!1,this.gl2=e,this.initialize(t),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return su.getMaxAttributes(this.gl)}initialize(){return this.setProps(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return Bt(!e||34963===e.target,"elements must be GL.ELEMENT_ARRAY_BUFFER"),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,t,i){if(34963===t.target)return this.setElementBuffer(t,i);const{size:r,type:s,stride:a,offset:u,normalized:f,integer:g,divisor:E}=i,{gl:M,gl2:R}=this;return e=Number(e),this.bind(()=>{M.bindBuffer(34962,t.handle),g?(Bt(Hi(M)),R.vertexAttribIPointer(e,r,s,a,u)):M.vertexAttribPointer(e,r,s,f,a,u),M.enableVertexAttribArray(e),R.vertexAttribDivisor(e,E||0)}),this}enable(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return!t&&0===e&&!su.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>t?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,t){const i=this._normalizeConstantArrayValue(t),r=i.byteLength*e,s=i.length*e;let a=!this.buffer;if(this.buffer=this.buffer||new Nr(this.gl,r),a=a||this.buffer.reallocate(r),a=a||!this._compareConstantArrayValues(i,this.bufferValue),a){const u=function mJ(n,e){const t=function pJ(n){return(!qx||qx.byteLength<n)&&(qx=new ArrayBuffer(n)),qx}(n.BYTES_PER_ELEMENT*e);return new n(t,0,e)}(t.constructor,s);(function gJ(n){let{target:e,source:t,start:i=0,count:r=1}=n;const s=t.length,a=r*s;let u=0;for(let f=i;u<s;u++)e[f++]=t[u];for(;u<a;)u<a-u?(e.copyWithin(i+u,i,i+u),u*=2):(e.copyWithin(i+u,i,i+a-u),u=a)})({target:u,source:i,start:0,count:s}),this.buffer.subData(u),this.bufferValue=t}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}static _setConstantFloatArray(e,t,i){switch(i.length){case 1:e.vertexAttrib1fv(t,i);break;case 2:e.vertexAttrib2fv(t,i);break;case 3:e.vertexAttrib3fv(t,i);break;case 4:e.vertexAttrib4fv(t,i);break;default:Bt(!1)}}static _setConstantIntArray(e,t,i){switch(Bt(Hi(e)),i.length){case 1:e.vertexAttribI1iv(t,i);break;case 2:e.vertexAttribI2iv(t,i);break;case 3:e.vertexAttribI3iv(t,i);break;case 4:e.vertexAttribI4iv(t,i);break;default:Bt(!1)}}static _setConstantUintArray(e,t,i){switch(Bt(Hi(e)),i.length){case 1:e.vertexAttribI1uiv(t,i);break;case 2:e.vertexAttribI2uiv(t,i);break;case 3:e.vertexAttribI3uiv(t,i);break;case 4:e.vertexAttribI4uiv(t,i);break;default:Bt(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,t){let{location:i}=t;return Bt(Number.isFinite(i)),this.bind(()=>34373===e?this.gl.getVertexAttribOffset(i,e):this.gl.getVertexAttrib(i,e))}}const vJ=/^(.+)__LOCATION_([0-9]+)$/,bJ=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class xJ{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=t.id||t.program&&t.program.id,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new su(e),JL(this,"VertexArray","v6.0",bJ),this.initialize(t),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const t in e)this._setAttribute(t,e[t]);this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.elements=e,this.elementsAccessor=t,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,t),this}setBuffer(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(34963===t.target)return this.setElementBuffer(t,i);const{location:r,accessor:s}=this._resolveLocationAndAccessor(e,t,t.accessor,i);return r>=0&&(this.values[r]=t,this.accessors[r]=s,this.clearDrawParams(),this.vertexArrayObject.setBuffer(r,t,s)),this}setConstant(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{location:r,accessor:s}=this._resolveLocationAndAccessor(e,t,Object.assign({size:t.length},i));return r>=0&&(t=this.vertexArrayObject._normalizeConstantArrayValue(t),this.values[r]=t,this.accessors[r]=s,this.clearDrawParams(),this.vertexArrayObject.enable(r,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new Nr(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof Nr&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const t=this.values[e];t instanceof Nr&&this.setBuffer(e,t)}}),this}bindForDraw(e,t,i){let r;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,t),r=i()}),r}_resolveLocationAndAccessor(e,t,i,r){const s={location:-1,accessor:null},{location:a,name:u}=this._getAttributeIndex(e);if(!Number.isFinite(a)||a<0)return this.unused[e]=t,cn.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),s;const f=this._getAttributeInfo(u||a);if(!f)return s;const E=iu.resolve(f.accessor,this.accessors[a]||{},i,r),{size:M,type:R}=E;return Bt(Number.isFinite(M)&&Number.isFinite(R)),{location:a,accessor:E}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const t=Number(e);if(Number.isFinite(t))return{location:t};const i=vJ.exec(e),r=i?i[1]:e,s=i?Number(i[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(r)+s,name:r}:{location:-1}}_setAttribute(e,t){if(t instanceof Nr)this.setBuffer(e,t);else if(Array.isArray(t)&&t.length&&t[0]instanceof Nr)this.setBuffer(e,t[0],t[1]);else if(ArrayBuffer.isView(t)||Array.isArray(t))this.setConstant(e,t);else{if(!(t.buffer instanceof Nr))throw new Error("VertexArray: attributes must be Buffers or constants (i.e. typed array)");this.setBuffer(e,t.buffer,t)}}_setConstantAttributes(e,t){const i=Math.max(0|e,0|t);let r=this.values[0];ArrayBuffer.isView(r)&&this._setConstantAttributeZero(r,i);for(let s=1;s<this.vertexArrayObject.MAX_ATTRIBUTES;s++)r=this.values[s],ArrayBuffer.isView(r)&&this._setConstantAttribute(s,r)}_setConstantAttributeZero(e,t){if(su.isSupported(this.gl,{constantAttributeZero:!0}))return void this._setConstantAttribute(0,e);const i=this.vertexArrayObject.getConstantBuffer(t,e);this.vertexArrayObject.setBuffer(0,i,this.accessors[0])}_setConstantAttribute(e,t){su.setConstant(this.gl,e,t)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)this._updateDrawParamsForLocation(e,t);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,t){const i=this.values[t],r=this.accessors[t];if(!i)return;const{divisor:s}=r,a=s>0;if(e.isInstanced=e.isInstanced||a,i instanceof Nr){const u=i;if(a){const f=u.getVertexCount(r);e.instanceCount=Math.min(e.instanceCount,f)}else{const f=u.getVertexCount(r);e.vertexCount=Math.min(e.vertexCount,f)}}}setElements(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return cn.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,t)}}function wJ(n,e){const{maxElts:t=16,size:i=1}=e;let r="[";for(let a=0;a<n.length&&a<t;++a)a>0&&(r+=",".concat(a%i==0?" ":"")),r+=Yv(n[a],e);const s=n.length>t?"...":"]";return"".concat(r).concat(s)}function Yv(n){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const t=1e-16,{isInteger:i=!1}=e;if(Array.isArray(n)||ArrayBuffer.isView(n))return wJ(n,e);if(!Number.isFinite(n))return String(n);if(Math.abs(n)<t)return i?"0":"0.";if(i||Math.abs(n)>100&&Math.abs(n)<1e4)return n.toFixed(0);const r=n.toPrecision(2);return r.indexOf(".0")===r.length-2?r.slice(0,-1):r}function NF(n,e,t,i){const{gl:r}=n;if(!e)return{[i]:"null","Format ":"N/A"};let g,E,M,s="NOT PROVIDED",a=1,u=0,f=0;if(t&&(s=t.type,a=t.size,s=String(s).replace("Array",""),g=-1!==s.indexOf("nt")),e instanceof Nr){const R=e,{data:F,changed:V}=R.getDebugData();let G;return E=V?"*":"",M=F,f=R.byteLength,u=f/F.BYTES_PER_ELEMENT/a,t?G="".concat(t.divisor>0?"I ":"P "," ").concat(u," (x").concat(a,"=").concat(f," bytes ").concat(Rp(r,s),")"):(g=!0,G="".concat(f," bytes")),{[i]:"".concat(E).concat(Yv(M,{size:a,isInteger:g})),"Format ":G}}return M=e,a=e.length,s=String(e.constructor.name).replace("Array",""),g=-1!==s.indexOf("nt"),{[i]:"".concat(Yv(M,{size:a,isInteger:g})," (constant)"),"Format ":"".concat(a,"x").concat(s," (constant)")}}function TJ(n,e){const{type:t,size:i}=e,r=CO(t,i);return r?"".concat(n," (").concat(r.name,")"):n}function BF(n){let{header:e="Uniforms",program:t,uniforms:i,undefinedOnly:r=!1}=n;Bt(t);const a=".*Matrix",f={},g=Object.keys(t._uniformSetters).sort();let E=0;for(const F of g)!F.match(".*_.*")&&!F.match(a)&&SS({table:f,header:e,uniforms:i,uniformName:F,undefinedOnly:r})&&E++;for(const F of g)F.match(a)&&SS({table:f,header:e,uniforms:i,uniformName:F,undefinedOnly:r})&&E++;for(const F of g)f[F]||SS({table:f,header:e,uniforms:i,uniformName:F,undefinedOnly:r})&&E++;let M=0;const R={};if(!r)for(const F in i){const V=i[F];f[F]||(M++,R[F]={Type:"NOT USED: ".concat(V),[e]:Yv(V)})}return{table:f,count:E,unusedTable:R,unusedCount:M}}function SS(n){let{table:e,header:t,uniforms:i,uniformName:r,undefinedOnly:s}=n;const a=i[r],u=function CJ(n){return null!=n}(a);return!(s&&u||(e[r]={[t]:u?Yv(a):"N/A","Uniform Type":u?a:"NOT PROVIDED"},0))}function zF(n){const{type:e,size:t}=n.accessor,i=CO(e,t);return i?"".concat(i.name," ").concat(n.name):n.name}const MJ={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function DJ(n,e){const{attributeMap:t=MJ}=e||{};return t&&t[n]||n}function IJ(n,e){let t;switch(n){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":t="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":t="vectors"}switch(t){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2}Bt(Number.isFinite(e.size),"attribute ".concat(n," needs size"))}const VF=()=>{},RJ={};class Kv{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{id:i=Lp("model")}=t;Bt(Mx(e)),this.id=i,this.gl=e,this.id=t.id||Lp("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(t)}initialize(e){this.props={},this.programManager=e.programManager||Hv.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:t=null,vs:i,fs:r,modules:s,defines:a,inject:u,varyings:f,bufferMode:g,transpileToGLSL100:E}=e;this.programProps={program:t,vs:i,fs:r,modules:s,defines:a,inject:u,varyings:f,bufferMode:g,transpileToGLSL100:E},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=void 0!==e.drawMode?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},Bt(void 0!==this.drawMode&&Number.isFinite(this.vertexCount),"Model needs drawMode and vertexCount")}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:t,vs:i,fs:r,modules:s,defines:a,inject:u,varyings:f,bufferMode:g,transpileToGLSL100:E}=e;this.programProps={program:t,vs:i,fs:r,modules:s,defines:a,inject:u,varyings:f,bufferMode:g,transpileToGLSL100:E},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return Bt(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return Bt(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=function AJ(n,e,t){const i={};let r=e.indices;for(const s in e.attributes){const a=e.attributes[s],u=DJ(s,t);if("indices"===s)r=a;else if(a.constant)i[u]=a.value;else{const f=a.value,g={...a};delete g.value,i[u]=[new Nr(n,f),g],IJ(s,g)}}if(r){const s=r.value||r;Bt(s instanceof Uint16Array||s instanceof Uint32Array,'attribute array for "indices" must be of integer type');const a={size:1,isIndexed:void 0===r.isIndexed||r.isIndexed};i.indices=[new Nr(n,{data:s,target:34963}),a]}return i}(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(H_(e))return this;const t={};for(const i in e){const r=e[i];t[i]=r.getValue?r.getValue():r}return this.vertexArray.setAttributes(t),this}setUniforms(){return Object.assign(this.uniforms,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this}getModuleUniforms(e){this._checkProgram();const t=this.programManager.getUniforms(this.program);return t?t(e):{}}updateModuleSettings(e){const t=this.getModuleUniforms(e||{});return this.setUniforms(t)}clear(e){return $C(this.program.gl,e),this}draw(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._checkProgram();const{moduleSettings:t=null,framebuffer:i,uniforms:r={},attributes:s={},transformFeedback:a=this.transformFeedback,parameters:u={},vertexArray:f=this.vertexArray}=e;let g;this.setAttributes(s),this.updateModuleSettings(t),this.setUniforms(r),cn.priority>=2&&(g=this._logDrawCallStart(2));const E=this.vertexArray.getDrawParams(),{isIndexed:M=E.isIndexed,indexType:R=E.indexType,indexOffset:F=E.indexOffset,vertexArrayInstanced:V=E.isInstanced}=this.props;V&&!this.isInstanced&&cn.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:G,instanceCount:K}=this,{onBeforeRender:se=VF,onAfterRender:_e=VF}=this.props;se(),this.program.setUniforms(this.uniforms);const de=this.program.draw(Object.assign(RJ,e,{logPriority:g,uniforms:null,framebuffer:i,parameters:u,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:f,transformFeedback:a,isIndexed:M,indexType:R,isInstanced:G,instanceCount:K,offset:M?F:0}));return _e(),cn.priority>=2&&this._logDrawCallEnd(g,f,i),de}transform(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{discard:t=!0,feedbackBuffers:i,unbindModels:r=[]}=e;let{parameters:s}=e;i&&this._setFeedbackBuffers(i),t&&(s=Object.assign({},s,{35977:t})),r.forEach(a=>a.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:s}))}finally{r.forEach(a=>a.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return cn.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!this._programDirty&&this.programManager.stateHash===this._programManagerState)return;let{program:t}=this.programProps;if(t)this._managedProgram=!1;else{const{vs:i,fs:r,modules:s,inject:a,defines:u,varyings:f,bufferMode:g,transpileToGLSL100:E}=this.programProps;t=this.programManager.get({vs:i,fs:r,modules:s,inject:a,defines:u,varyings:f,bufferMode:g,transpileToGLSL100:E}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}Bt(t instanceof MO,"Model needs a program"),this._programDirty=!1,t!==this.program&&(this.program=t,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new xJ(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const t=this.geometryBuffers[e][0]||this.geometryBuffers[e];t instanceof Nr&&t.delete()}}_setAnimationProps(e){this.animated&&Bt(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(H_(e))return this;const{gl:t}=this.program;return this.transformFeedback=this.transformFeedback||new LF(t,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const t=e>3?0:1e4;if(!(Date.now()-this.lastLogTime<t))return this.lastLogTime=Date.now(),cn.group(2,">>> DRAWING MODEL ".concat(this.id),{collapsed:cn.level<=2})(),e}_logDrawCallEnd(e,t,i,r){if(void 0===e)return;const s=function EJ(n){let{vertexArray:e,header:t="Attributes"}=n;if(!e.configuration)return{};const i={};e.elements&&(i.ELEMENT_ARRAY_BUFFER=NF(e,e.elements,null,t));const r=e.values;for(const s in r){const a=e._getAttributeInfo(s);if(a){let u="".concat(s,": ").concat(a.name);const f=e.accessors[a.location];f&&(u="".concat(s,": ").concat(TJ(a.name,f))),i[u]=NF(e,r[s],f,t)}}return i}({vertexArray:t,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:a,unusedTable:u,unusedCount:f}=BF({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i)}),{table:g,count:E}=BF({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i),undefinedOnly:!0});E>0&&cn.log("MISSING UNIFORMS",Object.keys(g))(),f>0&&cn.log("UNUSED UNIFORMS",Object.keys(u))();const M=function SJ(n){const e={},t="Accessors for ".concat(n.id);for(const i of n.attributeInfos)if(i){const r=zF(i);e["in ".concat(r)]={[t]:JSON.stringify(i.accessor)}}for(const i of n.varyingInfos)if(i){const r=zF(i);e["out ".concat(r)]={[t]:JSON.stringify(i.accessor)}}return e}(this.vertexArray.configuration);cn.table(e,s)(),cn.table(e,a)(),cn.table(e+1,M)(),r&&r.log({logLevel:2,message:"Rendered to ".concat(r.id)}),cn.groupEnd(2)()}}class MS{static isSupported(e){return Hi(e)}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(t),Object.seal(this)}delete(){const{model:e,bufferTransform:t,textureTransform:i}=this;e&&e.delete(),t&&t.delete(),i&&i.delete()}run(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{clearRenderTarget:t=!0}=e,i=this._updateDrawOptions(e);t&&i.framebuffer&&i.framebuffer.clear({color:!0}),this.model.transform(i)}swap(){let e=!1;const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of t)e=e||i.swap();Bt(e,"Nothing to swap")}getBuffer(){return this.bufferTransform&&this.bufferTransform.getBuffer(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)}getData(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of t){const r=i.getData(e);if(r)return r}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of t)i.update(e)}_initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{gl:t}=this;this._buildResourceTransforms(t,e),e=this._updateModelProps(e),this.model=new Kv(t,Object.assign({},e,{fs:e.fs||RF({version:OF(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let t=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of i)t=r.updateModelProps(t);return t}_buildResourceTransforms(e,t){(function LJ(n){return!(H_(n.feedbackBuffers)&&H_(n.feedbackMap)&&!(n.varyings&&n.varyings.length>0))})(t)&&(this.bufferTransform=new nJ(e,t)),function OJ(n){return!(H_(n._sourceTextures)&&!n._targetTexture&&!n._targetTextureVarying)}(t)&&(this.textureTransform=new fJ(e,t)),Bt(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let t=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of i)t=Object.assign(t,r.getDrawOptions(t));return t}}const HJ={interpolation:class FJ{constructor({gl:e,attribute:t,timeline:i}){Y(this,"gl",void 0),Y(this,"type","interpolation"),Y(this,"attributeInTransition",void 0),Y(this,"settings",void 0),Y(this,"attribute",void 0),Y(this,"transition",void 0),Y(this,"currentStartIndices",void 0),Y(this,"currentLength",void 0),Y(this,"transform",void 0),Y(this,"buffers",void 0),this.gl=e,this.transition=new Gv(i),this.attribute=t,this.attributeInTransition=new CS(e,t.settings),this.currentStartIndices=t.startIndices,this.currentLength=0,this.transform=function BJ(n,e){const t=AF(e.size);return new MS(n,{vs:"\n#define SHADER_NAME interpolation-transition-vertex-shader\n\nuniform float time;\nattribute ATTRIBUTE_TYPE aFrom;\nattribute ATTRIBUTE_TYPE aTo;\nvarying ATTRIBUTE_TYPE vCurrent;\n\nvoid main(void) {\n  vCurrent = mix(aFrom, aTo, time);\n  gl_Position = vec4(0.0);\n}\n",defines:{ATTRIBUTE_TYPE:t},varyings:["vCurrent"]})}(e,t);const r={byteLength:0,usage:35050};this.buffers=[new Nr(e,r),new Nr(e,r)]}get inProgress(){return this.transition.inProgress}start(e,t){if(e.duration<=0)return void this.transition.cancel();this.settings=e;const{buffers:r,attribute:s}=this;DF(r);const a={numInstances:t,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const u of r)IF({buffer:u,...a});this.currentStartIndices=s.startIndices,this.currentLength=TS(s,t),this.attributeInTransition.setData({buffer:r[1],value:s.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aFrom:r[0],aTo:MF(0,s)},feedbackBuffers:{vCurrent:r[1]}})}update(){const e=this.transition.update();if(e){const{duration:t,easing:i}=this.settings,{time:r}=this.transition;let s=r/t;i&&(s=i(s)),this.transform.run({uniforms:{time:s}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}},spring:class zJ{constructor({gl:e,attribute:t,timeline:i}){Y(this,"gl",void 0),Y(this,"type","spring"),Y(this,"attributeInTransition",void 0),Y(this,"settings",void 0),Y(this,"attribute",void 0),Y(this,"transition",void 0),Y(this,"currentStartIndices",void 0),Y(this,"currentLength",void 0),Y(this,"texture",void 0),Y(this,"framebuffer",void 0),Y(this,"transform",void 0),Y(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new Gv(i),this.attribute=t,this.attributeInTransition=new CS(e,{...t.settings,normalized:!1}),this.currentStartIndices=t.startIndices,this.currentLength=0,this.texture=function UJ(n){return new Ql(n,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}(e),this.framebuffer=function jJ(n,e){return new zo(n,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:e}})}(e,this.texture),this.transform=function VJ(n,e,t){const i=AF(e.size);return new MS(n,{framebuffer:t,vs:"\n#define SHADER_NAME spring-transition-vertex-shader\n\n#define EPSILON 0.00001\n\nuniform float stiffness;\nuniform float damping;\nattribute ATTRIBUTE_TYPE aPrev;\nattribute ATTRIBUTE_TYPE aCur;\nattribute ATTRIBUTE_TYPE aTo;\nvarying ATTRIBUTE_TYPE vNext;\nvarying float vIsTransitioningFlag;\n\nATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {\n  ATTRIBUTE_TYPE velocity = cur - prev;\n  ATTRIBUTE_TYPE delta = dest - cur;\n  ATTRIBUTE_TYPE spring = delta * stiffness;\n  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;\n  return spring + damper + velocity + cur;\n}\n\nvoid main(void) {\n  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;\n  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;\n\n  vNext = getNextValue(aCur, aPrev, aTo);\n  gl_Position = vec4(0, 0, 0, 1);\n  gl_PointSize = 100.0;\n}\n",fs:"\n#define SHADER_NAME spring-transition-is-transitioning-fragment-shader\n\nvarying float vIsTransitioningFlag;\n\nvoid main(void) {\n  if (vIsTransitioningFlag == 0.0) {\n    discard;\n  }\n  gl_FragColor = vec4(1.0);\n}",defines:{ATTRIBUTE_TYPE:i},varyings:["vNext"]})}(e,t,this.framebuffer);const r={byteLength:0,usage:35050};this.buffers=[new Nr(e,r),new Nr(e,r),new Nr(e,r)]}get inProgress(){return this.transition.inProgress}start(e,t){const{buffers:r,attribute:s}=this,a={numInstances:t,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const u of r)IF({buffer:u,...a});this.settings=e,this.currentStartIndices=s.startIndices,this.currentLength=TS(s,t),this.attributeInTransition.setData({buffer:r[1],value:s.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aTo:MF(0,s)}})}update(){const{buffers:e,transform:t,framebuffer:i,transition:r}=this;if(!r.update())return!1;const a=this.settings;return t.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),t.run({framebuffer:i,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:a.stiffness,damping:a.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),DF(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),Dx(i)[0]>0||r.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}};class GJ{constructor(e,{id:t,timeline:i}){Y(this,"id",void 0),Y(this,"isSupported",void 0),Y(this,"gl",void 0),Y(this,"timeline",void 0),Y(this,"transitions",void 0),Y(this,"needsRedraw",void 0),Y(this,"numInstances",void 0),this.id=t,this.gl=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=MS.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:i}){this.numInstances=i||1;for(const r in e){const s=e[r],a=s.getTransitionSetting(t);!a||this._updateAttribute(r,s,a)}for(const r in this.transitions){const s=e[r];(!s||!s.getTransitionSetting(t))&&this._removeTransition(r)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const i=this.transitions[t];i.inProgress&&(e[t]=i.attributeInTransition)}return e}run(){if(!this.isSupported||0===this.numInstances)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,t,i){const r=this.transitions[e];let s=!r||r.type!==i.type;if(s){if(!this.isSupported)return void ur.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();r&&this._removeTransition(e);const a=HJ[i.type];a?this.transitions[e]=new a({attribute:t,timeline:this.timeline,gl:this.gl}):(ur.error("unsupported transition type '".concat(i.type,"'"))(),s=!1)}(s||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const UF="attributeManager.invalidate";class YJ{constructor(e,{id:t="attribute-manager",stats:i,timeline:r}={}){Y(this,"id",void 0),Y(this,"gl",void 0),Y(this,"attributes",void 0),Y(this,"updateTriggers",void 0),Y(this,"needsRedraw",void 0),Y(this,"userData",void 0),Y(this,"stats",void 0),Y(this,"attributeTransitionManager",void 0),this.id=t,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new GJ(e,{id:"".concat(t,"-transitions"),timeline:r}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const t of e)void 0!==this.attributes[t]&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const i=this._invalidateTrigger(e,t);xl(UF,this,e,i)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);xl(UF,this,"all")}update({data:e,numInstances:t,startIndices:i=null,transitions:r,props:s={},buffers:a={},context:u={}}){let f=!1;xl("attributeManager.updateStart",this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const g in this.attributes){const E=this.attributes[g],M=E.settings.accessor;E.startIndices=i,E.numInstances=t,s[g]&&ur.removed("props.".concat(g),"data.attributes.".concat(g))(),E.setExternalBuffer(a[g])||E.setBinaryValue("string"==typeof M?a[M]:void 0,e.startIndices)||"string"==typeof M&&!a[M]&&E.setConstantValue(s[M])||E.needsUpdate()&&(f=!0,this._updateAttribute({attribute:E,numInstances:t,data:e,props:s,context:u})),this.needsRedraw=this.needsRedraw||E.needsRedraw()}f&&xl("attributeManager.updateEnd",this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:r})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return this.attributes}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:i}=this,r={...i.getAttributes()};for(const s in t){const a=t[s];a.needsRedraw(e)&&!i.hasAttribute(s)&&(r[s]=a)}return r}getShaderAttributes(e,t={}){e||(e=this.getAttributes());const i={};for(const r in e)t[r]||Object.assign(i,e[r].getShaderAttributes());return i}_add(e,t={}){for(const i in e)this.attributes[i]=this._createAttribute(i,e[i],t);this._mapUpdateTriggersToAttributes()}_createAttribute(e,t,i){const r={...t,id:e,size:(t.isIndexed?1:t.size)||1,divisor:i.instanced?1:t.divisor||0};return new CS(this.gl,r)}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(r=>{e[r]||(e[r]=[]),e[r].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:i,updateTriggers:r}=this,s=r[e];return s&&s.forEach(a=>{const u=i[a];u&&u.setNeedsUpdate(u.id,t)}),s}_updateAttribute(e){const{attribute:t,numInstances:i}=e;xl("attribute.updateStart",t),t.constant?t.setConstantValue(t.value):(t.allocate(i)&&xl("attribute.allocate",t,i),t.updateBuffer(e)&&(this.needsRedraw=!0,xl("attribute.updateEnd",t,i)))}}function HF(n,e,t,i,r){const s=e-n;return(t-e)*r+-s*i+s+e}function GF(n,e){if(Array.isArray(n)){let t=0;for(let i=0;i<n.length;i++){const r=n[i]-e[i];t+=r*r}return Math.sqrt(t)}return Math.abs(n-e)}const eQ={interpolation:class KJ extends Gv{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:i,duration:r,easing:s}}=this,a=s(e/r);this._value=dx(t,i,a)}},spring:class QJ extends Gv{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:i,stiffness:r}=this.settings,{_prevValue:s=e,_currValue:a=e}=this;let u=function JJ(n,e,t,i,r){if(Array.isArray(t)){const s=[];for(let a=0;a<t.length;a++)s[a]=HF(n[a],e[a],t[a],i,r);return s}return HF(n,e,t,i,r)}(s,a,t,i,r);const f=GF(u,t),g=GF(u,a);f<1e-5&&g<1e-5&&(u=t,this.end()),this._prevValue=a,this._currValue=u}}};class tQ{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,i,r){const{transitions:s}=this;if(s.has(e)){const f=s.get(e),{value:g=f.settings.fromValue}=f;t=g,this.remove(e)}if(!(r=SF(r)))return;const a=eQ[r.type];if(!a)return void ur.error("unsupported transition type '".concat(r.type,"'"))();const u=new a(this.timeline);u.start({...r,fromValue:t,toValue:i}),s.set(e,u)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,i]of this.transitions)i.update(),e[t]=i.value,i.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function rQ(n,e){if(!n.transitions)return!1;const t={},i=DS(n);let r=!1;for(const s in n.transitions){const a=i[s],u=a&&a.type;("number"===u||"color"===u||"array"===u)&&AS(n[s],e[s],a)&&(t[s]=!0,r=!0)}return!!r&&t}function WF({newProps:n,oldProps:e,ignoreProps:t={},propTypes:i={},triggerName:r="props"}){if(e===n)return!1;if("object"!=typeof n||null===n||"object"!=typeof e||null===e)return"".concat(r," changed shallowly");for(const s of Object.keys(n))if(!(s in t)){if(!(s in e))return"".concat(r,".").concat(s," added");const a=AS(n[s],e[s],i[s]);if(a)return"".concat(r,".").concat(s," ").concat(a)}for(const s of Object.keys(e))if(!(s in t)){if(!(s in n))return"".concat(r,".").concat(s," dropped");if(!Object.hasOwnProperty.call(n,s)){const a=AS(n[s],e[s],i[s]);if(a)return"".concat(r,".").concat(s," ").concat(a)}}return!1}function AS(n,e,t){let i=t&&t.equal;return i&&!i(n,e,t)||!i&&(i=n&&e&&n.equals,i&&!i.call(n,e))?"changed deeply":i||e===n?null:"changed shallowly"}function aQ(n,e){if(null===e)return!0;const t=e.extensions,{extensions:i}=n;if(i===t)return!1;if(!t||!i||i.length!==t.length)return!0;for(let r=0;r<i.length;r++)if(!i[r].equals(t[r]))return!0;return!1}function $F(n,e,t){let i=n.updateTriggers[t];i=i??{};let r=e.updateTriggers[t];return r=r??{},WF({oldProps:r,newProps:i,triggerName:t})}function DS(n){const e=n[nx],t=e&&e.constructor;return t?t._propTypes:{}}function fQ(n,e){if(!e)return n;const t={...n,...e};if("defines"in e&&(t.defines={...n.defines,...e.defines}),"modules"in e&&(t.modules=(n.modules||[]).concat(e.modules),e.modules.some(i=>"project64"===i.name))){const i=t.modules.findIndex(r=>"project32"===r.name);i>=0&&t.modules.splice(i,1)}if("inject"in e)if(n.inject){const i={...n.inject};for(const r in e.inject)i[r]=(i[r]||"")+e.inject[r];t.inject=i}else t.inject=e.inject;return t}function IS(n,e,t=!1){const i=e.projectPosition(n);if(t&&e instanceof Lf){const[r,s,a=0]=n,u=e.getDistanceScales([r,s]);i[2]=a*u.unitsPerMeter[2]}return i}function qF(n,{viewport:e,modelMatrix:t,coordinateSystem:i,coordinateOrigin:r,offsetMode:s}){let[a,u,f=0]=n;switch(t&&([a,u,f]=Pv([],[a,u,f,1],t)),i){case Dr.LNGLAT:return IS([a,u,f],e,s);case Dr.LNGLAT_OFFSETS:return IS([a+r[0],u+r[1],f+(r[2]||0)],e,s);case Dr.METER_OFFSETS:return IS(uL(r,[a,u,f]),e,s);default:return e.isGeospatial?[a+r[0],u+r[1],f+r[2]]:e.projectPosition([a,u,f])}}const gQ={10241:9987,10240:9729,10242:33071,10243:33071},PS={},vQ={boolean:{validate:(n,e)=>!0,equal:(n,e,t)=>Boolean(n)===Boolean(e)},number:{validate:(n,e)=>Number.isFinite(n)&&(!("max"in e)||n<=e.max)&&(!("min"in e)||n>=e.min)},color:{validate:(n,e)=>e.optional&&!n||Qv(n)&&(3===n.length||4===n.length),equal:(n,e,t)=>kS(n,e)},accessor:{validate(n,e){const t=Zx(n);return"function"===t||t===Zx(e.value)},equal:(n,e,t)=>"function"==typeof e||kS(n,e)},array:{validate:(n,e)=>e.optional&&!n||Qv(n),equal:(n,e,t)=>t.compare?kS(n,e):n===e},object:{equal:(n,e,t)=>t.compare?Z_(n,e):n===e},function:{validate:(n,e)=>e.optional&&!n||"function"==typeof n,equal:(n,e,t)=>!t.compare||n===e},data:{transform:(n,e,t)=>{const{dataTransform:i}=t.props;return i&&n?i(n):n}},image:{transform:(n,e,t)=>function _Q(n,e){const t=n.context&&n.context.gl;if(!t||!e)return null;if(e instanceof Ql)return e;e.constructor&&"Object"!==e.constructor.name&&(e={data:e});let i=null;e.compressed&&(i={10241:e.data.length>1?9985:9729});const r=new Ql(t,{...e,parameters:{...gQ,...i,...n.props.textureParameters}});return PS[r.id]=!0,r}(t,n),release:n=>{!function yQ(n){!n||!(n instanceof Ql)||PS[n.id]&&(n.delete(),delete PS[n.id])}(n)}}};function kS(n,e){if(n===e)return!0;if(!Qv(n)||!Qv(e))return!1;const t=n.length;if(t!==e.length)return!1;for(let i=0;i<t;i++)if(n[i]!==e[i])return!1;return!0}function xQ(n,e){switch(Zx(e)){case"object":return Jv(n,e);case"array":return Jv(n,{type:"array",value:e,compare:!1});case"boolean":return Jv(n,{type:"boolean",value:e});case"number":return Jv(n,{type:"number",value:e});case"function":return Jv(n,{type:"function",value:e,compare:!0});default:return{name:n,type:"unknown",value:e}}}function Jv(n,e){return"type"in e?{name:n,...vQ[e.type],...e}:"value"in e?{name:n,type:Zx(e.value),...e}:{name:n,type:"object",value:e}}function Qv(n){return Array.isArray(n)||ArrayBuffer.isView(n)}function Zx(n){return Qv(n)?"array":null===n?"null":typeof n}function ZF(n){return Xx(n,"_mergedDefaultProps")||(function EQ(n){if(!n.prototype)return;const t=Object.getPrototypeOf(n),i=ZF(t),s=function bQ(n){const e={},t={},i={};for(const[r,s]of Object.entries(n)){const a=s?.deprecatedFor;if(a)i[r]=Array.isArray(a)?a:[a];else{const u=xQ(r,s);e[r]=u,t[r]=u.value}}return{propTypes:e,defaultProps:t,deprecatedProps:i}}(Xx(n,"defaultProps")||{}),a=function TQ(n,e,t){const i=Object.create(null);Object.assign(i,e,n);const r=function AQ(n){const e=Xx(n,"layerName")||Xx(n,"componentName");return e||ur.once(0,"".concat(n.name,".componentName not specified"))(),e||n.name}(t);return delete n.id,Object.defineProperties(i,{id:{writable:!0,value:r}}),i}(s.defaultProps,i,n),u={...t._propTypes,...s.propTypes};!function SQ(n,e){const t={},i={};for(const r in e){const s=e[r],{name:a,value:u}=s;s.async&&(t[a]=u,i[a]=MQ(a))}n[D_]=t,n[qm]={},Object.defineProperties(n,i)}(a,u);const f={...t._deprecatedProps,...s.deprecatedProps};(function CQ(n,e){for(const t in e)Object.defineProperty(n,t,{enumerable:!1,set(i){const r="".concat(this.id,": ").concat(t);for(const s of e[t])XF(this,s)||(this[s]=i);ur.deprecated(r,e[t].join("/"))()}})})(a,f),n._mergedDefaultProps=a,n._propTypes=u,n._deprecatedProps=f}(n),n._mergedDefaultProps)}function MQ(n){return{enumerable:!0,set(e){"string"==typeof e||e instanceof Promise||TF(e)?this[qm][n]=e:this[Ap][n]=e},get(){if(this[Ap]){if(n in this[Ap])return this[Ap][n]||this[D_][n];if(n in this[qm]){const e=this[nx]&&this[nx].internalState;if(e&&e.hasAsyncProp(n))return e.getAsyncProp(n)||this[D_][n]}}return this[D_][n]}}}function XF(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Xx(n,e){return XF(n,e)&&n[e]}let DQ=0;class RS{constructor(...e){Y(this,"id",void 0),Y(this,"props",void 0),Y(this,"count",void 0),this.props=function wQ(n,e){const t=ZF(n.constructor),i=Object.create(t);i[nx]=n,i[qm]={},i[Ap]={};for(let r=0;r<e.length;++r){const s=e[r];for(const a in s)i[a]=s[a]}return Object.freeze(i),i}(this,e),this.id=this.props.id,this.count=DQ++}clone(e){const{props:t}=this,i={};for(const r in t[D_])r in t[Ap]?i[r]=t[Ap][r]:r in t[qm]&&(i[r]=t[qm][r]);return new this.constructor({...t,...i,...e})}}Y(RS,"componentName","Component"),Y(RS,"defaultProps",{});const IQ=Object.freeze({});class kQ extends class PQ{constructor(e){Y(this,"component",void 0),Y(this,"onAsyncPropUpdated",void 0),Y(this,"asyncProps",void 0),Y(this,"oldProps",void 0),Y(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}}getOldProps(){return this.oldAsyncProps||this.oldProps||IQ}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component.props}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return Boolean(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){const t=e[Ap]||{},i=e[qm]||e,r=e[D_]||{};for(const s in t){const a=t[s];this._createAsyncPropData(s,r[s]),this._updateAsyncProp(s,a),t[s]=this.getAsyncProp(s)}for(const s in i){const a=i[s];this._createAsyncPropData(s,r[s]),this._updateAsyncProp(s,a)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if("string"==typeof t&&(t=this._fetch(e,t)),t instanceof Promise)return void this._watchPromise(e,t);if(TF(t))return void this._resolveAsyncIterable(e,t);this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const i=this.asyncProps[e];return t!==i.resolvedValue&&t!==i.lastValue&&(i.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(t=this._postProcessValue(i,t),i.resolvedValue=t,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,t,i){const r=this.asyncProps[e];r&&i>=r.resolvedLoadCount&&void 0!==t&&(this._freezeAsyncOldProps(),r.resolvedValue=t,r.resolvedLoadCount=i,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const r=i.pendingLoadCount;t.then(s=>{s=this._postProcessValue(i,s),this._setAsyncPropValue(e,s,r),this._onResolve(e,s)}).catch(s=>{this._onError(e,s)})}}_resolveAsyncIterable(e,t){var i=this;return As(function*(){if("data"!==e)return void i._setPropValue(e,t);const r=i.asyncProps[e];if(!r)return;r.pendingLoadCount++;const s=r.pendingLoadCount;let a=[],u=0;var E,f=!1,g=!1;try{for(var R,M=ZT(t);f=!(R=yield M.next()).done;f=!1){const F=R.value,{dataTransform:V}=i.component.props;a=V?V(F,a):a.concat(F),Object.defineProperty(a,"__diff",{enumerable:!1,value:[{startRow:u,endRow:a.length}]}),u=a.length,i._setAsyncPropValue(e,a,s)}}catch(F){g=!0,E=F}finally{try{f&&null!=M.return&&(yield M.return())}finally{if(g)throw E}}i._onResolve(e,a)})()}_postProcessValue(e,t){const i=e.type;return i&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(t,i,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const r=this.component&&this.component.constructor._propTypes;this.asyncProps[e]={type:r&&r[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}{constructor({attributeManager:e,layer:t}){super(t),Y(this,"attributeManager",void 0),Y(this,"needsRedraw",void 0),Y(this,"needsUpdate",void 0),Y(this,"subLayers",void 0),Y(this,"usesPickingColorCache",void 0),Y(this,"changeFlags",void 0),Y(this,"viewport",void 0),Y(this,"uniformTransitions",void 0),Y(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}set layer(e){this.component=e}_fetch(e,t){const i=this.component.props.fetch;return i?i(t,{propName:e,layer:this.layer}):super._fetch(e,t)}_onResolve(e,t){const i=this.component.props.onDataLoad;"data"===e&&i&&i(t,{propName:e,layer:this.layer})}_onError(e,t){this.layer.raiseError(t,"loading ".concat(e," of ").concat(this.layer))}}const BQ=Object.freeze([]),zQ=Rx(({oldViewport:n,viewport:e})=>n.equals(e));let Ad=new Uint8ClampedArray(0);const VQ={data:{type:"data",value:BQ,async:!0},dataComparator:{type:"function",value:null,compare:!1,optional:!0},_dataDiff:{type:"function",value:n=>n&&n.__diff,compare:!1,optional:!0},dataTransform:{type:"function",value:null,compare:!1,optional:!0},onDataLoad:{type:"function",value:null,compare:!1,optional:!0},onError:{type:"function",value:null,compare:!1,optional:!0},fetch:{type:"function",value:(n,{propName:e,layer:t,loaders:i,loadOptions:r,signal:s})=>{const{resourceManager:a}=t.context;var u;r=r||t.getLoadOptions(),i=i||t.props.loaders,s&&(r={...r,fetch:{...null===(u=r)||void 0===u?void 0:u.fetch,signal:s}});let f=a.contains(n);return!f&&!r&&(a.add({resourceId:n,data:hx(n,i),persistent:!1}),f=!0),f?a.subscribe({resourceId:n,onChange:g=>{var E;return null===(E=t.internalState)||void 0===E?void 0:E.reloadAsyncProp(e,g)},consumerId:t.id,requestId:e}):hx(n,i,r)},compare:!1},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,compare:!1,optional:!0},onClick:{type:"function",value:null,compare:!1,optional:!0},onDragStart:{type:"function",value:null,compare:!1,optional:!0},onDrag:{type:"function",value:null,compare:!1,optional:!0},onDragEnd:{type:"function",value:null,compare:!1,optional:!0},coordinateSystem:Dr.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,compare:!0},getPolygonOffset:{type:"function",value:({layerIndex:n})=>[0,100*-n],compare:!1},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class sg extends RS{constructor(...e){super(...e),Y(this,"internalState",null),Y(this,"lifecycle","Awaiting state"),Y(this,"context",void 0),Y(this,"state",void 0),Y(this,"parent",null)}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return"".concat(this.constructor.layerName||this.constructor.name,"({id: '").concat(this.props.id,"'})")}project(e){bo(this.internalState);const t=this.internalState.viewport||this.context.viewport,i=qF(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[r,s,a]=fL(i,t.pixelProjectionMatrix);return 2===e.length?[r,s]:[r,s,a]}unproject(e){return bo(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){return bo(this.internalState),function mQ(n,e){const{viewport:t,coordinateSystem:i,coordinateOrigin:r,modelMatrix:s,fromCoordinateSystem:a,fromCoordinateOrigin:u}=function pQ(n){const{viewport:e,modelMatrix:t,coordinateOrigin:i}=n;let{coordinateSystem:r,fromCoordinateSystem:s,fromCoordinateOrigin:a}=n;return r===Dr.DEFAULT&&(r=e.isGeospatial?Dr.LNGLAT:Dr.CARTESIAN),void 0===s&&(s=r),void 0===a&&(a=i),{viewport:e,coordinateSystem:r,coordinateOrigin:i,modelMatrix:t,fromCoordinateSystem:s,fromCoordinateOrigin:a}}(e),{geospatialOrigin:f,shaderCoordinateOrigin:g,offsetMode:E}=kO(t,i,r),M=qF(n,{viewport:t,modelMatrix:s,coordinateSystem:a,coordinateOrigin:u,offsetMode:E});E&&function O$(n,e,t){n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2]}(M,M,t.projectPosition(f||g));return M}(e,{viewport:this.internalState.viewport||this.context.viewport,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return!!this.internalState&&!this.internalState.isAsyncPropLoading()}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const t of this.getModels())t.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Dr.DEFAULT||e===Dr.LNGLAT||e===Dr.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){bo(e instanceof Uint8Array);const[t,i,r]=e;return t+256*i+65536*r-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&void 0!==this.state.numInstances?this.state.numInstances:function uQ(n){if(!function dQ(n){return null!==n&&"object"==typeof n}(n))throw new Error("count(): argument not an object");if("function"==typeof n.count)return n.count();if(Number.isFinite(n.size))return n.size;if(Number.isFinite(n.length))return n.length;if(function hQ(n){return null!==n&&"object"==typeof n&&n.constructor===Object}(n))return Object.keys(n).length;throw new Error("count(): argument not a container")}(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;const t=this.getAttributeManager();if(!t)return null;const{positions:i,instancePositions:r}=t.attributes;return null===(e=i||r)||void 0===e?void 0:e.getBounds()}getShaders(e){for(const t of this.props.extensions)e=fQ(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&t)if(Array.isArray(i))for(const f of i)t.invalidateAll(f);else t.invalidateAll();const{props:r,oldProps:s}=e,a=Number.isInteger(s.highlightedObjectIndex)||s.pickable,u=Number.isInteger(r.highlightedObjectIndex)||r.pickable;if(a!==u&&t){const{pickingColors:f,instancePickingColors:g}=t.attributes,E=f||g;E&&(u&&E.constant&&(E.constant=!1,t.invalidate(E.id)),!E.value&&!u&&(E.constant=!0,E.value=[0,0,0]))}}finalizeState(e){for(const i of this.getModels())i.delete();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e)}getPickingInfo({info:e}){const{index:r}=e;return r>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[r]),e}raiseError(e,t){var i,r,s,a;t&&(e.message="".concat(t,": ").concat(e.message)),null!==(i=(r=this.props).onError)&&void 0!==i&&i.call(r,e)||null===(s=this.context)||void 0===s||null===(a=s.onError)||void 0===a||a.call(s,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return!!this.internalState&&(this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()))}hasUniformTransition(){var e;return(null===(e=this.internalState)||void 0===e?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!zQ({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();!t||("all"===e?t.invalidateAll():t.invalidate(e))}updateAttributes(e){for(const t of this.getModels())this._setModelAttributes(t,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,i=this.getNumInstances(),r=this.getStartIndices();e.update({data:t.data,numInstances:i,startIndices:r,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),i=Object.create(this.props);for(const r in t)Object.defineProperty(i,r,{value:t[r]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const i=Math.floor(Ad.length/3);if(this.internalState.usesPickingColorCache=!0,i<t){t>16777215&&ur.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Ad=O_.allocate(Ad,t,{size:3,copy:!0,maxCount:Math.max(t,16777215)});const r=Math.floor(Ad.length/3),s=[];for(let a=i;a<r;a++)this.encodePickingColor(a,s),Ad[3*a+0]=s[0],Ad[3*a+1]=s[1],Ad[3*a+2]=s[2]}e.value=Ad.subarray(0,3*t)}_setModelAttributes(e,t){const s=this.getAttributeManager().getShaderAttributes(t,e.userData.excludeAttributes||{});e.setAttributes(s)}disablePickingIndex(e){this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:i}=this.getAttributeManager().attributes,r=t||i;if(!r)return;const s=r.getVertexOffset(e),a=r.getVertexOffset(e+1);r.buffer.subData({data:new Uint8Array(a-s),offset:s})}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,i=e||t;!i||(this.internalState.usesPickingColorCache&&i.value.buffer!==Ad.buffer&&(i.value=Ad.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){bo(!this.internalState),bo(Number.isFinite(this.props.coordinateSystem)),xl("layer.initialize",this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new kQ({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(ur.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.layer=this,this.internalState.uniformTransitions=new tQ(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){xl("layer.matched",this,this===e);const{state:t,internalState:i}=e;this!==e&&(this.internalState=i,this.internalState.layer=this,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(xl("layer.update",this,e),!e)return;const t=this.props,i=this.context,r=this.internalState,s=i.viewport,a=this._updateUniformTransition();r.propsInTransition=a,i.viewport=r.viewport||s,this.props=a;try{const u=this._getUpdateParams(),f=this.getModels();if(i.gl)this.updateState(u);else try{this.updateState(u)}catch{}for(const E of this.props.extensions)E.updateState.call(this,u,E);const g=this.getModels()[0]!==f[0];this._postUpdate(u,g)}finally{i.viewport=s,this.props=t,this._clearChangeFlags(),r.needsUpdate=!1,r.resetOldProps()}}_finalize(){xl("layer.finalize",this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,e)}_drawLayer({moduleParameters:e=null,uniforms:t={},parameters:i={}}){this._updateAttributeTransition();const r=this.props,s=this.context;this.props=this.internalState.propsInTransition||r,t.opacity=Math.pow(this.props.opacity,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:u}=this.props,f=u&&u(t)||[0,0];Pf(s.gl,{polygonOffset:f}),Ou(s.gl,i,()=>{const g={moduleParameters:e,uniforms:t,parameters:i,context:s};for(const E of this.props.extensions)E.draw.call(this,g,E);this.draw(g)})}finally{this.props=r}}getChangeFlags(){var e;return null===(e=this.internalState)||void 0===e?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const r in e)if(e[r]){let s=!1;if("dataChanged"===r){const a=e[r],u=t[r];a&&Array.isArray(u)&&(t.dataChanged=Array.isArray(a)?u.concat(a):a,s=!0)}t[r]||(t[r]=e[r],s=!0),s&&xl("layer.changeFlag",this,r,e)}const i=Boolean(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=i,t.somethingChanged=i||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){const i=function iQ(n,e){const t=WF({newProps:n,oldProps:e,propTypes:DS(n),ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=function sQ(n,e){if(null===e)return"oldProps is null, initial diff";let t=!1;const{dataComparator:i,_dataDiff:r}=n;return i?i(n.data,e.data)||(t="Data comparator detected a change"):n.data!==e.data&&(t="A new data container was supplied"),t&&r&&(t=r(n.data,e.data)||t),t}(n,e);let r=!1;return i||(r=function oQ(n,e){if(null===e)return{all:!0};if("all"in n.updateTriggers&&$F(n,e,"all"))return{all:!0};const t={};let i=!1;for(const r in n.updateTriggers)"all"!==r&&$F(n,e,r)&&(t[r]=!0,i=!0);return!!i&&t}(n,e)),{dataChanged:i,propsChanged:t,updateTriggersChanged:r,extensionsChanged:aQ(n,e),transitionsChanged:rQ(n,e)}}(e,t);if(i.updateTriggersChanged)for(const s in i.updateTriggersChanged)i.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(i.transitionsChanged)for(const s in i.transitionsChanged){var r;this.internalState.uniformTransitions.add(s,t[s],e[s],null===(r=e.transitions)||void 0===r?void 0:r[s])}return this.setChangeFlags(i)}validateProps(){!function nQ(n){const e=DS(n);for(const t in e){const i=e[t],{validate:r}=i;if(r&&!r(n[t],i))throw new Error("Invalid prop ".concat(t,": ").concat(n[t]))}}(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={pickingSelectedColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&"function"==typeof i&&(t.pickingHighlightColor=i(e)),this.setModuleParameters(t),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new YJ(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:i,oldProps:r}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:s}=this.state;s?.setInstanceCount(this.getNumInstances());const{autoHighlight:a,highlightedObjectIndex:u,highlightColor:f}=i;if(t||r.autoHighlight!==a||r.highlightedObjectIndex!==u||r.highlightColor!==f){const g={};a||(g.pickingSelectedColor=null),Array.isArray(f)&&(g.pickingHighlightColor=f),Number.isInteger(u)&&(g.pickingSelectedColor=Number.isFinite(u)&&u>=0?this.encodePickingColor(u):null),this.setModuleParameters(g)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id,this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags;const i=this.getAttributeManager(),r=!!i&&i.getNeedsRedraw(e);return t=t||r,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Y(sg,"defaultProps",VQ),Y(sg,"layerName","Layer");class LS extends sg{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id&&(e.object=t.__source.object,e.index=t.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||t}getSubLayerRow(e,t,i){return e.__source={parent:this,object:t,index:i},e}getSubLayerAccessor(e){if("function"==typeof e){const t={index:-1,data:this.props.data,target:[]};return(i,r)=>i&&i.__source?(t.index=i.__source.index,e(i.__source.object,t)):e(i,r)}return e}getSubLayerProps(e={}){var t;const{opacity:i,pickable:r,visible:s,parameters:a,getPolygonOffset:u,highlightedObjectIndex:f,autoHighlight:g,highlightColor:E,coordinateSystem:M,coordinateOrigin:R,wrapLongitude:F,positionFormat:V,modelMatrix:G,extensions:K,fetch:se,operation:_e,_subLayerProps:de}=this.props,Ie={id:"",updateTriggers:{},opacity:i,pickable:r,visible:s,parameters:a,getPolygonOffset:u,highlightedObjectIndex:f,autoHighlight:g,highlightColor:E,coordinateSystem:M,coordinateOrigin:R,wrapLongitude:F,positionFormat:V,modelMatrix:G,extensions:K,fetch:se,operation:_e},qe=de&&e.id&&de[e.id],Qe=qe&&qe.updateTriggers,Ct=e.id||"sublayer";if(qe){const Xt=this.constructor._propTypes,Ft=e.type?e.type._propTypes:{};for(const Ut in qe){const mn=Ft[Ut]||Xt[Ut];mn&&"accessor"===mn.type&&(qe[Ut]=this.getSubLayerAccessor(qe[Ut]))}}Object.assign(Ie,e,qe),Ie.id="".concat(this.props.id,"-").concat(Ct),Ie.updateTriggers={all:null===(t=this.props.updateTriggers)||void 0===t?void 0:t.all,...e.updateTriggers,...Qe};for(const Xt of K){const Ft=Xt.getSubLayerProps.call(this,Xt);Ft&&Object.assign(Ie,Ft,{updateTriggers:Object.assign(Ie.updateTriggers,Ft.updateTriggers)})}return Ie}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let i=this.internalState.subLayers;const r=!i||this.needsUpdate();r&&(i=k_(this.renderLayers(),Boolean),this.internalState.subLayers=i),xl("compositeLayer.renderLayers",this,r,i);for(const s of i)s.parent=this}}Y(LS,"layerName","CompositeLayer");const Yx={name:"project32",dependencies:[QC],vs:"\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition\n) {\n  vec3 projectedPosition = project_position(position, position64Low);\n  mat3 rotation;\n  if (project_needs_rotation(projectedPosition, rotation)) {\n    // offset is specified as ENU\n    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe\n    offset = rotation * offset;\n  }\n  commonPosition = vec4(projectedPosition + offset, 1.0);\n  return project_common_position_to_clipspace(commonPosition);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset\n) {\n  vec4 commonPosition;\n  return project_position_to_clipspace(position, position64Low, offset, commonPosition);\n}\n"},HQ={pickingSelectedColor:null,pickingHighlightColor:new Uint8Array([0,255,255,255]),pickingActive:!1,pickingAttribute:!1},Kx={inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    // for picking depth values\n    picking_setPickingAttribute(position.z / position.w);\n  ","vs:DECKGL_FILTER_COLOR":"\n  picking_setPickingColor(geometry.pickingColor);\n  ","fs:DECKGL_FILTER_COLOR":{order:99,injection:"\n  // use highlight color if this fragment belongs to the selected object.\n  color = picking_filterHighlightColor(color);\n\n  // use picking color if rendering to picking FBO.\n  color = picking_filterPickingColor(color);\n    "}},name:"picking",vs:"uniform bool picking_uActive;\nuniform bool picking_uAttribute;\nuniform vec3 picking_uSelectedColor;\nuniform bool picking_uSelectedColorValid;\n\nout vec4 picking_vRGBcolor_Avalid;\n\nconst float COLOR_SCALE = 1. / 255.;\n\nbool picking_isColorValid(vec3 color) {\n  return dot(color, vec3(1.0)) > 0.001;\n}\n\nbool isVertexPicked(vec3 vertexColor) {\n  return\n    picking_uSelectedColorValid &&\n    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));\n}\n\nvoid picking_setPickingColor(vec3 pickingColor) {\n  if (picking_uActive) {\n    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));\n\n    if (!picking_uAttribute) {\n      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;\n    }\n  } else {\n    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));\n  }\n}\n\nvoid picking_setPickingAttribute(float value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.r = value;\n  }\n}\nvoid picking_setPickingAttribute(vec2 value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.rg = value;\n  }\n}\nvoid picking_setPickingAttribute(vec3 value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.rgb = value;\n  }\n}\n",fs:"uniform bool picking_uActive;\nuniform vec3 picking_uSelectedColor;\nuniform vec4 picking_uHighlightColor;\n\nin vec4 picking_vRGBcolor_Avalid;\nvec4 picking_filterHighlightColor(vec4 color) {\n  if (picking_uActive) {\n    return color;\n  }\n  bool selected = bool(picking_vRGBcolor_Avalid.a);\n\n  if (selected) {\n    float highLightAlpha = picking_uHighlightColor.a;\n    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);\n    float highLightRatio = highLightAlpha / blendedAlpha;\n\n    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);\n    return vec4(blendedRGB, blendedAlpha);\n  } else {\n    return color;\n  }\n}\nvec4 picking_filterPickingColor(vec4 color) {\n  if (picking_uActive) {\n    if (picking_vRGBcolor_Avalid.a == 0.0) {\n      discard;\n    }\n    return picking_vRGBcolor_Avalid;\n  }\n  return color;\n}\nvec4 picking_filterColor(vec4 color) {\n  vec4 highightColor = picking_filterHighlightColor(color);\n  return picking_filterPickingColor(highightColor);\n}\n\n",getUniforms:function GQ(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:HQ;const e={};if(void 0!==n.pickingSelectedColor)if(n.pickingSelectedColor){const t=n.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=t}else e.picking_uSelectedColorValid=0;if(n.pickingHighlightColor){const t=Array.from(n.pickingHighlightColor,i=>i/255);Number.isFinite(t[3])||(t[3]=1),e.picking_uHighlightColor=t}return void 0!==n.pickingActive&&(e.picking_uActive=Boolean(n.pickingActive),e.picking_uAttribute=Boolean(n.pickingAttribute)),e}},KF={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class Jx{static get DRAW_MODE(){return KF}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{id:t=Lp("geometry"),drawMode:i=KF.TRIANGLES,attributes:r={},indices:s=null,vertexCount:a=null}=e;this.id=t,this.drawMode=0|i,this.attributes={},this.userData={},this._setAttributes(r,s),this.vertexCount=a||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,t){t&&(this.indices=ArrayBuffer.isView(t)?{value:t,size:1}:t);for(const i in e){let r=e[i];r=ArrayBuffer.isView(r)?{value:r}:r,Bt(ArrayBuffer.isView(r.value),"".concat(this._print(i),": must be typed array or object with value as typed array")),("POSITION"===i||"positions"===i)&&!r.size&&(r.size=3),"indices"===i?(Bt(!this.indices),this.indices=r):this.attributes[i]=r}return this.indices&&void 0!==this.indices.isIndexed&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,t){if(t)return t.value.length;let i=1/0;for(const r in e){const s=e[r],{value:a,size:u,constant:f}=s;!f&&a&&u>=1&&(i=Math.min(i,a.length/u))}return Bt(Number.isFinite(i)),i}}function r0(n,e,t,i,r=[]){let s,a;if(8&t)s=(i[3]-n[1])/(e[1]-n[1]),a=3;else if(4&t)s=(i[1]-n[1])/(e[1]-n[1]),a=1;else if(2&t)s=(i[2]-n[0])/(e[0]-n[0]),a=2;else{if(!(1&t))return null;s=(i[0]-n[0])/(e[0]-n[0]),a=0}for(let u=0;u<n.length;u++)r[u]=(1&a)===u?i[a]:s*(e[u]-n[u])+n[u];return r}function Of(n,e){let t=0;return n[0]<e[0]?t|=1:n[0]>e[2]&&(t|=2),n[1]<e[1]?t|=4:n[1]>e[3]&&(t|=8),t}function nw(n,e){const t=e.length,i=n.length;if(i>0){let r=!0;for(let s=0;s<t;s++)if(n[i-t+s]!==e[s]){r=!1;break}if(r)return!1}for(let r=0;r<t;r++)n[i+r]=e[r];return!0}function nN(n,e){const t=e.length;for(let i=0;i<t;i++)n[i]=e[i]}function iN(n,e,t,i,r=[]){const s=i+e*t;for(let a=0;a<t;a++)r[a]=n[s+a];return r}function rN(n,e){const{size:t=2,broken:i=!1,gridResolution:r=10,gridOffset:s=[0,0],startIndex:a=0,endIndex:u=n.length}=e||{},f=(u-a)/t;let g=[];const E=[g],M=iN(n,0,t,a);let R,F;const V=function aN(n,e,t,i){const r=Math.floor((n[0]-t[0])/e)*e+t[0],s=Math.floor((n[1]-t[1])/e)*e+t[1];return i[0]=r,i[1]=s,i[2]=r+e,i[3]=s+e,i}(M,r,s,[]),G=[];nw(g,M);for(let K=1;K<f;K++){for(R=iN(n,K,t,a,R),F=Of(R,V);F;){r0(M,R,F,V,G);const se=Of(G,V);se&&(r0(M,G,se,V,G),F=se),nw(g,G),nN(M,G),fee(V,r,F),i&&g.length>t&&(g=[],E.push(g),nw(g,M)),F=Of(R,V)}nw(g,R),nN(M,R)}return i?E:E[0]}function fee(n,e,t){8&t?(n[1]+=e,n[3]+=e):4&t?(n[1]-=e,n[3]-=e):2&t?(n[0]+=e,n[2]+=e):1&t&&(n[0]-=e,n[2]-=e)}function cN(n,e){let t;const i=n.length/e;for(let s=0;s<i&&(t=n[s*e],(t+180)%360==0);s++);const r=360*-Math.round(t/360);if(0!==r)for(let s=0;s<i;s++)n[s*e]+=r}function vee(n,e,t,i){let r;if(Array.isArray(n[0])){r=new Array(n.length*e);for(let a=0;a<n.length;a++)for(let u=0;u<e;u++)r[a*e+u]=n[a][u]||0}else r=n;return t?rN(r,{size:e,gridResolution:t}):i?function gee(n,e){const{size:t=2,startIndex:i=0,endIndex:r=n.length,normalize:s=!0}=e||{},a=n.slice(i,r);!function lN(n,e,t,i){let s,r=n[0];for(let a=t;a<i;a+=e){s=n[a];const u=s-r;(u>180||u<-180)&&(s-=360*Math.round(u/360)),n[a]=r=s}}(a,t,0,r-i);const u=rN(a,{size:t,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(const f of u)cN(f,t);return u}(r,{size:e}):r}class wee extends class WQ{constructor(e){Y(this,"opts",void 0),Y(this,"typedArrayManager",void 0),Y(this,"indexStarts",[0]),Y(this,"vertexStarts",[0]),Y(this,"vertexCount",0),Y(this,"instanceCount",0),Y(this,"attributes",void 0),Y(this,"_attributeDefs",void 0),Y(this,"data",void 0),Y(this,"getGeometry",void 0),Y(this,"geometryBuffer",void 0),Y(this,"buffers",void 0),Y(this,"positionSize",void 0),Y(this,"normalize",void 0);const{attributes:t={}}=e;this.typedArrayManager=O_,this.attributes={},this._attributeDefs=t,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:t,buffers:i={},getGeometry:r,geometryBuffer:s,positionFormat:a,dataChanged:u,normalize:f=!0}=this.opts;if(this.data=t,this.getGeometry=r,this.positionSize=s&&s.size||("XY"===a?2:3),this.buffers=i,this.normalize=f,s&&(bo(t.startIndices),this.getGeometry=this.getGeometryFromBuffer(s),f||(i.positions=s)),this.geometryBuffer=i.positions,Array.isArray(u))for(const g of u)this._rebuildGeometry(g);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:t}){this._rebuildGeometry({startRow:e,endRow:t})}getGeometryFromBuffer(e){const t=e.value||e;return ArrayBuffer.isView(t)?CF(t,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,t){const{attributes:i,buffers:r,_attributeDefs:s,typedArrayManager:a}=this;for(const u in s)if(u in r)a.release(i[u]),i[u]=null;else{const f=s[u];f.copy=t,i[u]=a.allocate(i[u],e,f)}}_forEachGeometry(e,t,i){const{data:r,getGeometry:s}=this,{iterable:a,objectInfo:u}=Gx(r,t,i);for(const f of a)u.index++,e(s?s(f,u):null,u.index)}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:t,vertexStarts:i,instanceCount:r}=this;const{data:s,geometryBuffer:a}=this,{startRow:u=0,endRow:f=1/0}=e||{},g={};if(e||(t=[0],i=[0]),this.normalize||!a)this._forEachGeometry((M,R)=>{const F=M&&this.normalizeGeometry(M);g[R]=F,i[R+1]=i[R]+(F?this.getGeometrySize(F):0)},u,f),r=i[i.length-1];else if(i=s.startIndices,r=i[s.length]||0,ArrayBuffer.isView(a))r=r||a.length/this.positionSize;else if(a instanceof Nr){const M=a.accessor.stride||4*this.positionSize;r=r||a.byteLength/M}else if(a.buffer){const M=a.stride||4*this.positionSize;r=r||a.buffer.byteLength/M}else if(a.value){const M=a.value,R=a.stride/M.BYTES_PER_ELEMENT||this.positionSize;r=r||M.length/R}this._allocate(r,Boolean(e)),this.indexStarts=t,this.vertexStarts=i,this.instanceCount=r;const E={};this._forEachGeometry((M,R)=>{const F=g[R]||M;E.vertexStart=i[R],E.indexStart=t[R],E.geometrySize=(R<i.length-1?i[R+1]:r)-i[R],E.geometryIndex=R,this.updateGeometryAttributes(F,E)},u,f),this.vertexCount=t[t.length-1]}}{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?vee(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(uN(e)){let i=0;for(const r of e)i+=this.getGeometrySize(r);return i}const t=this.getPathLength(e);return t<2?0:this.isClosed(e)?t<3?0:t+2:t}updateGeometryAttributes(e,t){if(0!==t.geometrySize)if(e&&uN(e))for(const i of e){const r=this.getGeometrySize(i);t.geometrySize=r,this.updateGeometryAttributes(i,t),t.vertexStart+=r}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}_updateSegmentTypes(e,t){const i=this.attributes.segmentTypes,r=!!e&&this.isClosed(e),{vertexStart:s,geometrySize:a}=t;i.fill(0,s,s+a),r?(i[s]=4,i[s+a-2]=4):(i[s]+=1,i[s+a-2]+=2),i[s+a-1]=4}_updatePositions(e,t){const{positions:i}=this.attributes;if(!i||!e)return;const{vertexStart:r,geometrySize:s}=t,a=new Array(3);for(let u=r,f=0;f<s;u++,f++)this.getPointOnPath(e,f,a),i[3*u]=a[0],i[3*u+1]=a[1],i[3*u+2]=a[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,t,i=[]){const{positionSize:r}=this;t*r>=e.length&&(t+=1-e.length/r);const s=t*r;return i[0]=e[s],i[1]=e[s+1],i[2]=3===r&&e[s+2]||0,i}isClosed(e){if(!this.normalize)return Boolean(this.opts.loop);const{positionSize:t}=this,i=e.length-t;return e[0]===e[i]&&e[1]===e[i+1]&&(2===t||e[2]===e[i+2])}}function uN(n){return Array.isArray(n[0])}const hN=[0,0,0,255],Cee={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:n=>n.path},getColor:{type:"accessor",value:hN},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},BS={enter:(n,e)=>e.length?e.subarray(e.length-n.length):n};class zS extends sg{constructor(...e){super(...e),Y(this,"state",void 0)}getShaders(){return super.getShaders({vs:"#define SHADER_NAME path-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute float instanceTypes;\nattribute vec3 instanceStartPositions;\nattribute vec3 instanceEndPositions;\nattribute vec3 instanceLeftPositions;\nattribute vec3 instanceRightPositions;\nattribute vec3 instanceLeftPositions64Low;\nattribute vec3 instanceStartPositions64Low;\nattribute vec3 instanceEndPositions64Low;\nattribute vec3 instanceRightPositions64Low;\nattribute float instanceStrokeWidths;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float jointType;\nuniform float capType;\nuniform float miterLimit;\nuniform bool billboard;\nuniform int widthUnits;\n\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\nvarying float vJointType;\n\nconst float EPSILON = 0.001;\nconst vec3 ZERO_OFFSET = vec3(0.0);\n\nfloat flipIfTrue(bool flag) {\n  return -(float(flag) * 2. - 1.);\n}\n\n// calculate line join positions\nvec3 lineJoin(\n  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,\n  vec2 width\n) {\n  bool isEnd = positions.x > 0.0;\n  // side of the segment - -1: left, 0: center, 1: right\n  float sideOfPath = positions.y;\n  float isJoint = float(sideOfPath == 0.0);\n\n  vec3 deltaA3 = (currPoint - prevPoint);\n  vec3 deltaB3 = (nextPoint - currPoint);\n\n  mat3 rotationMatrix;\n  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);\n  if (needsRotation) {\n    deltaA3 = deltaA3 * rotationMatrix;\n    deltaB3 = deltaB3 * rotationMatrix;\n  }\n  vec2 deltaA = deltaA3.xy / width;\n  vec2 deltaB = deltaB3.xy / width;\n\n  float lenA = length(deltaA);\n  float lenB = length(deltaB);\n\n  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);\n  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);\n\n  vec2 perpA = vec2(-dirA.y, dirA.x);\n  vec2 perpB = vec2(-dirB.y, dirB.x);\n\n  // tangent of the corner\n  vec2 tangent = dirA + dirB;\n  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;\n  // direction of the corner\n  vec2 miterVec = vec2(-tangent.y, tangent.x);\n  // direction of the segment\n  vec2 dir = isEnd ? dirA : dirB;\n  // direction of the extrusion\n  vec2 perp = isEnd ? perpA : perpB;\n  // length of the segment\n  float L = isEnd ? lenA : lenB;\n\n  // A = angle of the corner\n  float sinHalfA = abs(dot(miterVec, perp));\n  float cosHalfA = abs(dot(dirA, miterVec));\n\n  // -1: right, 1: left\n  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);\n\n  // relative position to the corner:\n  // -1: inside (smaller side of the angle)\n  // 0: center\n  // 1: outside (bigger side of the angle)\n  float cornerPosition = sideOfPath * turnDirection;\n\n  float miterSize = 1.0 / max(sinHalfA, EPSILON);\n  // trim if inside corner extends further than the line segment\n  miterSize = mix(\n    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),\n    miterSize,\n    step(0.0, cornerPosition)\n  );\n\n  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))\n    * (sideOfPath + isJoint * turnDirection);\n\n  // special treatment for start cap and end cap\n  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));\n  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));\n  bool isCap = isStartCap || isEndCap;\n\n  // extend out a triangle to envelope the round cap\n  if (isCap) {\n    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);\n    vJointType = capType;\n  } else {\n    vJointType = jointType;\n  }\n\n  // Generate variables for fragment shader\n  vPathLength = L;\n  vCornerOffset = offsetVec;\n  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);\n  vMiterLength = isCap ? isJoint : vMiterLength;\n\n  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);\n  vPathPosition = vec2(\n    dot(offsetFromStartOfPath, perp),\n    dot(offsetFromStartOfPath, dir)\n  );\n  geometry.uv = vPathPosition;\n\n  float isValid = step(instanceTypes, 3.5);\n  vec3 offset = vec3(offsetVec * width * isValid, 0.0);\n\n  if (needsRotation) {\n    offset = rotationMatrix * offset;\n  }\n  return currPoint + offset;\n}\n\n// In clipspace extrusion, if a line extends behind the camera, clip it to avoid visual artifacts\nvoid clipLine(inout vec4 position, vec4 refPosition) {\n  if (position.w < EPSILON) {\n    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);\n    position = refPosition + (position - refPosition) * r;\n  }\n}\n\nvoid main() {\n  geometry.pickingColor = instancePickingColors;\n\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);\n\n  float isEnd = positions.x;\n\n  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);\n  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);\n\n  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\n  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);\n\n  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);\n  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);\n\n  geometry.worldPosition = currPosition;\n  vec2 widthPixels = vec2(clamp(\n    project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),\n    widthMinPixels, widthMaxPixels) / 2.0);\n  vec3 width;\n\n  if (billboard) {\n    // Extrude in clipspace\n    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);\n    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);\n    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);\n\n    clipLine(prevPositionScreen, currPositionScreen);\n    clipLine(nextPositionScreen, currPositionScreen);\n    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));\n\n    width = vec3(widthPixels, 0.0);\n    DECKGL_FILTER_SIZE(width, geometry);\n\n    vec3 pos = lineJoin(\n      prevPositionScreen.xyz / prevPositionScreen.w,\n      currPositionScreen.xyz / currPositionScreen.w,\n      nextPositionScreen.xyz / nextPositionScreen.w,\n      project_pixel_size_to_clipspace(width.xy)\n    );\n\n    gl_Position = vec4(pos * currPositionScreen.w, currPositionScreen.w);\n  } else {\n    // Extrude in commonspace\n    prevPosition = project_position(prevPosition, prevPosition64Low);\n    currPosition = project_position(currPosition, currPosition64Low);\n    nextPosition = project_position(nextPosition, nextPosition64Low);\n\n    width = vec3(project_pixel_size(widthPixels), 0.0);\n    DECKGL_FILTER_SIZE(width, geometry);\n\n    vec4 pos = vec4(\n      lineJoin(prevPosition, currPosition, nextPosition, width.xy),\n      1.0);\n    geometry.position = pos;\n    gl_Position = project_common_position_to_clipspace(pos);\n  }\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME path-layer-fragment-shader\n\nprecision highp float;\n\nuniform float miterLimit;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\n/*\n * vPathPosition represents the relative coordinates of the current fragment on the path segment.\n * vPathPosition.x - position along the width of the path, between [-1, 1]. 0 is the center line.\n * vPathPosition.y - position along the length of the path, between [0, L / width].\n */\nvarying vec2 vPathPosition;\nvarying float vPathLength;\nvarying float vJointType;\n\nvoid main(void) {\n  geometry.uv = vPathPosition;\n\n  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {\n    // if joint is rounded, test distance from the corner\n    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {\n      discard;\n    }\n    // trim miter\n    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {\n      discard;\n    }\n  }\n  gl_FragColor = vColor;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[Yx,Kx]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:BS,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:BS,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:BS,defaultValue:hN},instancePickingColors:{size:3,type:5121,accessor:(i,{index:r,target:s})=>this.encodePickingColor(i&&i.__source?i.__source.index:r,s)}}),this.setState({pathTesselator:new wee({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:t,changeFlags:i}=e,r=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){const{pathTesselator:u}=this.state,f=t.data.attributes||{};u.updateGeometry({data:t.data,geometryBuffer:f.getPath,buffers:f,normalize:!t._pathType,loop:"loop"===t._pathType,getGeometry:t.getPath,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:u.instanceCount,startIndices:u.vertexStarts}),i.dataChanged||r.invalidateAll()}if(i.extensionsChanged){var a;const{gl:u}=this.context;null===(a=this.state.model)||void 0===a||a.delete(),this.state.model=this._getModel(u),r.invalidateAll()}}getPickingInfo(e){const t=super.getPickingInfo(e),{index:i}=t,{data:r}=this.props;return r[0]&&r[0].__source&&(t.object=r.find(s=>s.__source.index===i)),t}disablePickingIndex(e){const{data:t}=this.props;if(t[0]&&t[0].__source)for(let i=0;i<t.length;i++)t[i].__source.index===e&&this._disablePickingIndex(i);else this._disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:t,capRounded:i,billboard:r,miterLimit:s,widthUnits:a,widthScale:u,widthMinPixels:f,widthMaxPixels:g}=this.props;this.state.model.setUniforms(e).setUniforms({jointType:Number(t),capType:Number(i),billboard:r,widthUnits:Ym[a],widthScale:u,miterLimit:s,widthMinPixels:f,widthMaxPixels:g}).draw()}_getModel(e){return new Kv(e,{...this.getShaders(),id:this.props.id,geometry:new Jx({drawMode:4,attributes:{indices:new Uint16Array([0,1,2,1,4,2,1,3,4,3,5,4]),positions:{value:new Float32Array([0,0,0,-1,0,1,1,-1,1,1,1,0]),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateSegmentTypes(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}}Y(zS,"defaultProps",Cee),Y(zS,"layerName","PathLayer");const dN=[0,0,0,255],Aee={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:n=>n.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:dN},getLineColor:{type:"accessor",value:dN},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class VS extends sg{getShaders(){return super.getShaders({vs:"#define SHADER_NAME scatterplot-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute float instanceRadius;\nattribute float instanceLineWidths;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusScale;\nuniform float radiusMinPixels;\nuniform float radiusMaxPixels;\nuniform float lineWidthScale;\nuniform float lineWidthMinPixels;\nuniform float lineWidthMaxPixels;\nuniform float stroked;\nuniform bool filled;\nuniform bool antialiasing;\nuniform bool billboard;\nuniform int radiusUnits;\nuniform int lineWidthUnits;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\nvarying float outerRadiusPixels;\n\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n\n  // Multiply out radius and clamp to limits\n  outerRadiusPixels = clamp(\n    project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),\n    radiusMinPixels, radiusMaxPixels\n  );\n  \n  // Multiply out line width and clamp to limits\n  float lineWidthPixels = clamp(\n    project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),\n    lineWidthMinPixels, lineWidthMaxPixels\n  );\n\n  // outer radius needs to offset by half stroke width\n  outerRadiusPixels += stroked * lineWidthPixels / 2.0;\n\n  // Expand geometry to accomodate edge smoothing\n  float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;\n\n  // position on the containing square in [-1, 1] space\n  unitPosition = edgePadding * positions.xy;\n  geometry.uv = unitPosition;\n  geometry.pickingColor = instancePickingColors;\n\n  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;\n  \n  if (billboard) {\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\n    vec3 offset = edgePadding * positions * outerRadiusPixels;\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n  } else {\n    vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);\n  }\n\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  // Apply opacity to instance color, or return instance picking color\n  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);\n  DECKGL_FILTER_COLOR(vFillColor, geometry);\n  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);\n  DECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n",fs:"#define SHADER_NAME scatterplot-layer-fragment-shader\n\nprecision highp float;\n\nuniform bool filled;\nuniform float stroked;\nuniform bool antialiasing;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\nvarying float outerRadiusPixels;\n\nvoid main(void) {\n  geometry.uv = unitPosition;\n\n  float distToCenter = length(unitPosition) * outerRadiusPixels;\n  float inCircle = antialiasing ? \n    smoothedge(distToCenter, outerRadiusPixels) : \n    step(distToCenter, outerRadiusPixels);\n\n  if (inCircle == 0.0) {\n    discard;\n  }\n\n  if (stroked > 0.5) {\n    float isLine = antialiasing ? \n      smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :\n      step(innerUnitRadius * outerRadiusPixels, distToCenter);\n\n    if (filled) {\n      gl_FragColor = mix(vFillColor, vLineColor, isLine);\n    } else {\n      if (isLine == 0.0) {\n        discard;\n      }\n      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);\n    }\n  } else if (filled) {\n    gl_FragColor = vFillColor;\n  } else {\n    discard;\n  }\n\n  gl_FragColor.a *= inCircle;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[Yx,Kx]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var t;const{gl:i}=this.context;null===(t=this.state.model)||void 0===t||t.delete(),this.state.model=this._getModel(i),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{radiusUnits:t,radiusScale:i,radiusMinPixels:r,radiusMaxPixels:s,stroked:a,filled:u,billboard:f,antialiasing:g,lineWidthUnits:E,lineWidthScale:M,lineWidthMinPixels:R,lineWidthMaxPixels:F}=this.props;this.state.model.setUniforms(e).setUniforms({stroked:a?1:0,filled:u,billboard:f,antialiasing:g,radiusUnits:Ym[t],radiusScale:i,radiusMinPixels:r,radiusMaxPixels:s,lineWidthUnits:Ym[E],lineWidthScale:M,lineWidthMinPixels:R,lineWidthMaxPixels:F}).draw()}_getModel(e){return new Kv(e,{...this.getShaders(),id:this.props.id,geometry:new Jx({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,1,0])}}}),isInstanced:!0})}}Y(VS,"defaultProps",Aee),Y(VS,"layerName","ScatterplotLayer");const fN=()=>{},pN={10241:9987,10240:9729,10242:33071,10243:33071};function Ree(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function Lee(n,e,t,i){return t===e.width&&i===e.height?e:(n.canvas.height=i,n.canvas.width=t,n.clearRect(0,0,n.canvas.width,n.canvas.height),n.drawImage(e,0,0,e.width,e.height,0,0,t,i),n.canvas)}function s0(n){return n&&(n.id||n.url)}function mN(n,e,t){for(let i=0;i<e.length;i++){const{icon:r,xOffset:s}=e[i];n[s0(r)]={...r,x:s,y:t}}}class Bee{constructor(e,{onUpdate:t=fN,onError:i=fN}){Y(this,"gl",void 0),Y(this,"onUpdate",void 0),Y(this,"onError",void 0),Y(this,"_loadOptions",null),Y(this,"_texture",null),Y(this,"_externalTexture",null),Y(this,"_mapping",{}),Y(this,"_textureParameters",null),Y(this,"_pendingCount",0),Y(this,"_autoPacking",!1),Y(this,"_xOffset",0),Y(this,"_yOffset",0),Y(this,"_rowHeight",0),Y(this,"_buffer",4),Y(this,"_canvasWidth",1024),Y(this,"_canvasHeight",0),Y(this,"_canvas",null),this.gl=e,this.onUpdate=t,this.onError=i}finalize(){var e;null===(e=this._texture)||void 0===e||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const t=this._autoPacking?s0(e):e;return this._mapping[t]||{}}setProps({loadOptions:e,autoPacking:t,iconAtlas:i,iconMapping:r,textureParameters:s}){var a;e&&(this._loadOptions=e),void 0!==t&&(this._autoPacking=t),r&&(this._mapping=r),i&&(null===(a=this._texture)||void 0===a||a.delete(),this._texture=null,this._externalTexture=i),s&&(this._textureParameters=s)}get isLoaded(){return 0===this._pendingCount}packIcons(e,t){if(!this._autoPacking||typeof document>"u")return;const i=Object.values(function Nee(n,e,t){if(!n||!e)return null;t=t||{};const i={},{iterable:r,objectInfo:s}=Gx(n);for(const a of r){s.index++;const u=e(a,s),f=s0(u);if(!u)throw new Error("Icon is missing.");if(!u.url)throw new Error("Icon url is missing.");!i[f]&&(!t[f]||u.url!==t[f].url)&&(i[f]={...u,source:a,sourceIndex:s.index})}return i}(e,t,this._mapping)||{});if(i.length>0){const{mapping:r,xOffset:s,yOffset:a,rowHeight:u,canvasHeight:f}=function Fee({icons:n,buffer:e,mapping:t={},xOffset:i=0,yOffset:r=0,rowHeight:s=0,canvasWidth:a}){let u=[];for(let f=0;f<n.length;f++){const g=n[f];if(!t[s0(g)]){const{height:M,width:R}=g;i+R+e>a&&(mN(t,u,r),i=0,r=s+r+e,s=0,u=[]),u.push({icon:g,xOffset:i}),i=i+R+e,s=Math.max(s,M)}}return u.length>0&&mN(t,u,r),{mapping:t,rowHeight:s,xOffset:i,yOffset:r,canvasWidth:a,canvasHeight:Ree(s+r+e)}}({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=u,this._mapping=r,this._xOffset=s,this._yOffset=a,this._canvasHeight=f,this._texture||(this._texture=new Ql(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:this._textureParameters||pN})),this._texture.height!==this._canvasHeight&&(this._texture=function Oee(n,e,t,i){const r=n.width,s=n.height,a=new Ql(n.gl,{width:e,height:t,parameters:i});return function zq(n,e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{sourceX:i=0,sourceY:r=0,targetMipmaplevel:s=0,targetInternalFormat:a=6408}=t;let{targetX:u,targetY:f,targetZ:g,width:E,height:M}=t;const{framebuffer:R,deleteFramebuffer:F}=zv(n);Bt(R);const{gl:V,handle:G}=R,K=typeof u<"u"||typeof f<"u"||typeof g<"u";u=u||0,f=f||0,g=g||0;const se=V.bindFramebuffer(36160,G);Bt(e);let _e=null;if(e instanceof tg&&(_e=e,E=Number.isFinite(E)?E:_e.width,M=Number.isFinite(M)?M:_e.height,_e.bind(0),e=_e.target),K)switch(e){case 3553:case 34067:V.copyTexSubImage2D(e,s,u,f,i,r,E,M);break;case 35866:case 32879:wl(V).copyTexSubImage3D(e,s,u,f,g,i,r,E,M)}else V.copyTexImage2D(e,s,a,i,r,E,M,0);_e&&_e.unbind(),V.bindFramebuffer(36160,se||null),F&&R.delete()}(n,a,{targetY:0,width:r,height:s}),n.delete(),a}(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||pN)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}_loadIcons(e){const t=this._canvas.getContext("2d");for(const i of e)this._pendingCount++,hx(i.url,nF,this._loadOptions).then(r=>{const s=s0(i),{x:a,y:u,width:f,height:g}=this._mapping[s],E=Lee(t,r,f,g);this._texture.setSubImageData({data:E,x:a,y:u,width:f,height:g}),this._texture.generateMipmap(),this.onUpdate()}).catch(r=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:r})}).finally(()=>{this._pendingCount--})}}const gN=[0,0,0,255],zee={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:n=>n.position},getIcon:{type:"accessor",value:n=>n.icon},getColor:{type:"accessor",value:gN},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,compare:!1,optional:!0}};class rw extends sg{constructor(...e){super(...e),Y(this,"state",void 0)}getShaders(){return super.getShaders({vs:'#define SHADER_NAME icon-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute float instanceSizes;\nattribute float instanceAngles;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec4 instanceIconFrames;\nattribute float instanceColorModes;\nattribute vec2 instanceOffsets;\nattribute vec2 instancePixelOffset;\n\nuniform float sizeScale;\nuniform vec2 iconsTextureDim;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform bool billboard;\nuniform int sizeUnits;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\n\nvec2 rotate_by_angle(vec2 vertex, float angle) {\n  float angle_radian = angle * PI / 180.0;\n  float cos_angle = cos(angle_radian);\n  float sin_angle = sin(angle_radian);\n  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\n  return rotationMatrix * vertex;\n}\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  geometry.uv = positions;\n  geometry.pickingColor = instancePickingColors;\n  uv = positions;\n\n  vec2 iconSize = instanceIconFrames.zw;\n  // convert size in meters to pixels, then scaled and clamp\n \n  // project meters to pixels and clamp to limits \n  float sizePixels = clamp(\n    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits), \n    sizeMinPixels, sizeMaxPixels\n  );\n\n  // scale icon height to match instanceSize\n  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;\n\n  // scale and rotate vertex in "pixel" value and convert back to fraction in clipspace\n  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;\n  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;\n  pixelOffset += instancePixelOffset;\n  pixelOffset.y *= -1.0;\n\n  if (billboard)  {\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\n    vec3 offset = vec3(pixelOffset, 0.0);\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n\n  } else {\n    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\n    DECKGL_FILTER_SIZE(offset_common, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); \n  }\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  vTextureCoords = mix(\n    instanceIconFrames.xy,\n    instanceIconFrames.xy + iconSize,\n    (positions.xy + 1.0) / 2.0\n  ) / iconsTextureDim;\n\n  vColor = instanceColors;\n  DECKGL_FILTER_COLOR(vColor, geometry);\n\n  vColorMode = instanceColorModes;\n}\n',fs:"#define SHADER_NAME icon-layer-fragment-shader\n\nprecision highp float;\n\nuniform float opacity;\nuniform sampler2D iconsTexture;\nuniform float alphaCutoff;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\n\nvoid main(void) {\n  geometry.uv = uv;\n\n  vec4 texColor = texture2D(iconsTexture, vTextureCoords);\n\n  // if colorMode == 0, use pixel color from the texture\n  // if colorMode == 1 or rendering picking buffer, use texture as transparency mask\n  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);\n  // Take the global opacity and the alpha from vColor into account for the alpha component\n  float a = texColor.a * opacity * vColor.a;\n\n  if (a < alphaCutoff) {\n    discard;\n  }\n\n  gl_FragColor = vec4(color, a);\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[Yx,Kx]})}initializeState(){this.state={iconManager:new Bee(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:gN},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:t,oldProps:i,changeFlags:r}=e,s=this.getAttributeManager(),{iconAtlas:a,iconMapping:u,data:f,getIcon:g,textureParameters:E}=t,{iconManager:M}=this.state,R=a||this.internalState.isAsyncPropLoading("iconAtlas");if(M.setProps({loadOptions:t.loadOptions,autoPacking:!R,iconAtlas:a,iconMapping:R?u:null,textureParameters:E}),R?i.iconMapping!==t.iconMapping&&s.invalidate("getIcon"):(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getIcon))&&M.packIcons(f,g),r.extensionsChanged){var F;const{gl:V}=this.context;null===(F=this.state.model)||void 0===F||F.delete(),this.state.model=this._getModel(V),s.invalidateAll()}}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:t,sizeMinPixels:i,sizeMaxPixels:r,sizeUnits:s,billboard:a,alphaCutoff:u}=this.props,{iconManager:f}=this.state,g=f.getTexture();g&&this.state.model.setUniforms(e).setUniforms({iconsTexture:g,iconsTextureDim:[g.width,g.height],sizeUnits:Ym[s],sizeScale:t,sizeMinPixels:i,sizeMaxPixels:r,billboard:a,alphaCutoff:u}).draw()}_getModel(e){return new Kv(e,{...this.getShaders(),id:this.props.id,geometry:new Jx({drawMode:6,attributes:{positions:{size:2,value:new Float32Array([-1,-1,-1,1,1,1,1,-1])}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var t;const i=null===(t=this.getCurrentLayer())||void 0===t?void 0:t.props.onIconError;i?i(e):ur.error(e.error.message)()}getInstanceOffset(e){const{width:t,height:i,anchorX:r=t/2,anchorY:s=i/2}=this.state.iconManager.getIconMapping(e);return[t/2-r,i/2-s]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:t,y:i,width:r,height:s}=this.state.iconManager.getIconMapping(e);return[t,i,r,s]}}Y(rw,"defaultProps",zee),Y(rw,"layerName","IconLayer");const yN=[];class US extends rw{constructor(...e){super(...e),Y(this,"state",void 0)}getShaders(){return{...super.getShaders(),fs:"#define SHADER_NAME multi-icon-layer-fragment-shader\n\nprecision highp float;\n\nuniform float opacity;\nuniform sampler2D iconsTexture;\nuniform float gamma;\nuniform bool sdf;\nuniform float alphaCutoff;\nuniform float buffer;\nuniform float outlineBuffer;\nuniform vec4 outlineColor;\n\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\n\nvoid main(void) {\n  geometry.uv = uv;\n\n  if (!picking_uActive) {\n    float alpha = texture2D(iconsTexture, vTextureCoords).a;\n    vec4 color = vColor;\n\n    // if enable sdf (signed distance fields)\n    if (sdf) {\n      float distance = alpha;\n      alpha = smoothstep(buffer - gamma, buffer + gamma, distance);\n\n      if (outlineBuffer > 0.0) {\n        float inFill = alpha;\n        float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);\n        color = mix(outlineColor, vColor, inFill);\n        alpha = inBorder;\n      }\n    }\n\n    // Take the global opacity and the alpha from color into account for the alpha component\n    float a = alpha * color.a;\n    \n    if (a < alphaCutoff) {\n      discard;\n    }\n\n    gl_FragColor = vec4(color.rgb, a * opacity);\n  }\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n"}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:(t,{index:i,target:r})=>this.encodePickingColor(i,r)}})}updateState(e){super.updateState(e);const{props:t,oldProps:i}=e;let{outlineColor:r}=t;r!==i.outlineColor&&(r=r.map(s=>s/255),r[3]=Number.isFinite(r[3])?r[3]:1,this.setState({outlineColor:r})),!t.sdf&&t.outlineWidth&&ur.warn("".concat(this.id,": fontSettings.sdf is required to render outline"))()}draw(e){const{sdf:t,smoothing:i,outlineWidth:r}=this.props,{outlineColor:s}=this.state;e.uniforms={...e.uniforms,buffer:.75,outlineBuffer:r?Math.max(i,.75*(1-r)):-1,gamma:i,sdf:Boolean(t),outlineColor:s},super.draw(e)}getInstanceOffset(e){return e?Array.from(e).flatMap(t=>super.getInstanceOffset(t)):yN}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(t=>super.getInstanceIconFrame(t)):yN}}Y(US,"defaultProps",{getIconOffsets:{type:"accessor",value:n=>n.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}}),Y(US,"layerName","MultiIconLayer");var jee=ns(803),Hee=ns.n(jee);const Wee=[];function $ee(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function vN(n,e,t,i){let r=0;for(let a=e;a<t;a++){var s;r+=(null===(s=i[n[a]])||void 0===s?void 0:s.width)||0}return r}function bN(n,e,t,i,r,s){let a=e,u=0;for(let f=e;f<t;f++){const g=vN(n,f,f+1,r);u+g>i&&(a<f&&s.push(f),a=f,u=0),u+=g}return u}function Xee(n,e,t,i,r=0,s){void 0===s&&(s=n.length);const a=[];return"break-all"===e?bN(n,r,s,t,i,a):function Zee(n,e,t,i,r,s){let a=e,u=e,f=e,g=0;for(let E=e;E<t;E++)if((" "===n[E]||" "===n[E+1]||E+1===t)&&(f=E+1),f>u){let M=vN(n,u,f,r);g+M>i&&(a<u&&(s.push(u),a=u,g=0),M>i&&(M=bN(n,u,f,i,r,s),a=s[s.length-1])),u=f,g+=M}}(n,r,s,t,i,a),a}function Yee(n,e,t,i,r,s){let a=0,u=0;for(let f=e;f<t;f++){const g=n[f],E=i[g];E?(u||(u=E.height),r[f]=a+E.width/2,a+=E.width):(ur.warn("Missing character: ".concat(g," (").concat(g.codePointAt(0),")"))(),r[f]=a,a+=32)}s[0]=a,s[1]=u}function xN(n,e,t,i,r){const s=Array.from(n),a=s.length,u=new Array(a),f=new Array(a),g=new Array(a),E=("break-word"===t||"break-all"===t)&&isFinite(i)&&i>0,M=[0,0],R=[0,0];let F=0,V=0,G=0;for(let K=0;K<=a;K++){const se=s[K];if(("\n"===se||K===a)&&(G=K),G>V){const _e=E?Xee(s,t,i,r,V,G):Wee;for(let de=0;de<=_e.length;de++){const Ie=0===de?V:_e[de-1],qe=de<_e.length?_e[de]:G;Yee(s,Ie,qe,r,u,R);for(let Qe=Ie;Qe<qe;Qe++)f[Qe]=F+R[1]/2,g[Qe]=R[0];F+=R[1]*e,M[0]=Math.max(M[0],R[0])}V=G}"\n"===se&&(u[V]=0,f[V]=0,g[V]=0,V++)}return M[1]=F,{x:u,y:f,rowWidth:g,size:M}}class wN{constructor(e=5){Y(this,"limit",void 0),Y(this,"_cache",{}),Y(this,"_order",[]),this.limit=e}get(e){const t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}set(e,t){this._cache[e]?(this.delete(e),this._cache[e]=t,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const t=this._order.indexOf(e);t>=0&&this._order.splice(t,1)}_appendOrder(e){this._order.push(e)}}const o0={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:function Jee(){const n=[];for(let e=32;e<128;e++)n.push(String.fromCharCode(e));return n}(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1};let sw=new wN(3);function tte(n,e){for(let t=0;t<n.length;t++)e.data[4*t+3]=n[t]}function SN(n,e,t,i){n.font="".concat(i," ").concat(t,"px ").concat(e),n.fillStyle="#000",n.textBaseline="alphabetic",n.textAlign="left"}class ite{constructor(){Y(this,"props",{...o0}),Y(this,"_key",void 0),Y(this,"_atlas",void 0)}get texture(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){return 1.2}setProps(e={}){Object.assign(this.props,e);const t=this._key;this._key=this._getKey();const i=function ete(n,e){let t;t="string"==typeof e?new Set(Array.from(e)):new Set(e);const i=sw.get(n);if(!i)return t;for(const r in i.mapping)t.has(r)&&t.delete(r);return t}(this._key,this.props.characterSet),r=sw.get(this._key);if(r&&0===i.size)return void(this._key!==t&&(this._atlas=r));const s=this._generateFontAtlas(this._key,i,r);this._atlas=s,sw.set(this._key,s)}_generateFontAtlas(e,t,i){const{fontFamily:r,fontWeight:s,fontSize:a,buffer:u,sdf:f,radius:g,cutoff:E}=this.props;let M=i&&i.data;M||(M=document.createElement("canvas"),M.width=1024);const R=M.getContext("2d");SN(R,r,a,s);const{mapping:F,canvasHeight:V,xOffset:G,yOffset:K}=function qee({characterSet:n,getFontWidth:e,fontHeight:t,buffer:i,maxCanvasWidth:r,mapping:s={},xOffset:a=0,yOffset:u=0}){let f=0,g=a;for(const M of n)if(!s[M]){const R=e(M);g+R+2*i>r&&(g=0,f++),s[M]={x:g+i,y:u+f*(t+2*i)+i,width:R,height:t},g+=R+2*i}const E=t+2*i;return{mapping:s,xOffset:g,yOffset:u+f*E,canvasHeight:$ee(u+(f+1)*E)}}({getFontWidth:se=>R.measureText(se).width,fontHeight:1.2*a,buffer:u,characterSet:t,maxCanvasWidth:1024,...i&&{mapping:i.mapping,xOffset:i.xOffset,yOffset:i.yOffset}});if(M.height!==V){const se=R.getImageData(0,0,M.width,M.height);M.height=V,R.putImageData(se,0,0)}if(SN(R,r,a,s),f){const se=new(Hee())(a,u,g,E,r,s),_e=R.getImageData(0,0,se.size,se.size);for(const de of t)tte(se.draw(de),_e),R.putImageData(_e,F[de].x-u,F[de].y+u)}else for(const se of t)R.fillText(se,F[se].x,F[se].y+.9*a);return{xOffset:G,yOffset:K,mapping:F,data:M,width:M.width,height:M.height}}_getKey(){const{fontFamily:e,fontWeight:t,fontSize:i,buffer:r,sdf:s,radius:a,cutoff:u}=this.props;return s?"".concat(e," ").concat(t," ").concat(i," ").concat(r," ").concat(a," ").concat(u):"".concat(e," ").concat(t," ").concat(i," ").concat(r)}}const ote={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:n=>n.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class jS extends sg{constructor(...e){super(...e),Y(this,"state",void 0)}getShaders(){return super.getShaders({vs:"#define SHADER_NAME text-background-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute vec4 instanceRects;\nattribute float instanceSizes;\nattribute float instanceAngles;\nattribute vec2 instancePixelOffsets;\nattribute float instanceLineWidths;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\nuniform bool billboard;\nuniform float opacity;\nuniform float sizeScale;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform vec4 padding;\nuniform int sizeUnits;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying float vLineWidth;\nvarying vec2 uv;\nvarying vec2 dimensions;\n\nvec2 rotate_by_angle(vec2 vertex, float angle) {\n  float angle_radian = radians(angle);\n  float cos_angle = cos(angle_radian);\n  float sin_angle = sin(angle_radian);\n  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\n  return rotationMatrix * vertex;\n}\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  geometry.uv = positions;\n  geometry.pickingColor = instancePickingColors;\n  uv = positions;\n  vLineWidth = instanceLineWidths;\n\n  // convert size in meters to pixels, then scaled and clamp\n\n  // project meters to pixels and clamp to limits\n  float sizePixels = clamp(\n    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),\n    sizeMinPixels, sizeMaxPixels\n  );\n\n  dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;\n\n  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);\n  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);\n  pixelOffset += instancePixelOffsets;\n  pixelOffset.y *= -1.0;\n\n  if (billboard)  {\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\n    vec3 offset = vec3(pixelOffset, 0.0);\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n  } else {\n    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\n    DECKGL_FILTER_SIZE(offset_common, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);\n  }\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  // Apply opacity to instance color, or return instance picking color\n  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);\n  DECKGL_FILTER_COLOR(vFillColor, geometry);\n  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);\n  DECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n",fs:"#define SHADER_NAME text-background-layer-fragment-shader\n\nprecision highp float;\n\nuniform bool stroked;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying float vLineWidth;\nvarying vec2 uv;\nvarying vec2 dimensions;\n\nvoid main(void) {\n  geometry.uv = uv;\n\n  vec2 pixelPosition = uv * dimensions;\n  if (stroked) {\n    float distToEdge = min(\n      min(pixelPosition.x, dimensions.x - pixelPosition.x),\n      min(pixelPosition.y, dimensions.y - pixelPosition.y)\n    );\n    float isBorder = smoothedge(distToEdge, vLineWidth);\n    gl_FragColor = mix(vFillColor, vLineColor, isBorder);\n  } else {\n    gl_FragColor = vFillColor;\n  }\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[Yx,Kx]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);const{changeFlags:t}=e;if(t.extensionsChanged){var i;const{gl:r}=this.context;null===(i=this.state.model)||void 0===i||i.delete(),this.state.model=this._getModel(r),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{billboard:t,sizeScale:i,sizeUnits:r,sizeMinPixels:s,sizeMaxPixels:a,getLineWidth:u}=this.props;let{padding:f}=this.props;f.length<4&&(f=[f[0],f[1],f[0],f[1]]),this.state.model.setUniforms(e).setUniforms({billboard:t,stroked:Boolean(u),padding:f,sizeUnits:Ym[r],sizeScale:i,sizeMinPixels:s,sizeMaxPixels:a}).draw()}_getModel(e){return new Kv(e,{...this.getShaders(),id:this.props.id,geometry:new Jx({drawMode:6,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array([0,0,1,0,1,1,0,1])}}}),isInstanced:!0})}}Y(jS,"defaultProps",ote),Y(jS,"layerName","TextBackgroundLayer");const MN={start:1,middle:0,end:-1},AN={top:1,center:0,bottom:-1},HS=[0,0,0,255],lte={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:HS},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:o0.characterSet},fontFamily:o0.fontFamily,fontWeight:o0.fontWeight,lineHeight:1,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:HS},fontSettings:{},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:n=>n.text},getPosition:{type:"accessor",value:n=>n.position},getColor:{type:"accessor",value:HS},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class GS extends LS{constructor(...e){super(...e),Y(this,"state",void 0),Y(this,"getBoundingRect",(t,i)=>{const r=this.state.fontAtlasManager.mapping,s=this.state.getText,{wordBreak:a,maxWidth:u,lineHeight:f,getTextAnchor:g,getAlignmentBaseline:E}=this.props,M=s(t,i)||"",{size:[R,F]}=xN(M,f,a,u,r);return[(MN["function"==typeof g?g(t,i):g]-1)*R/2,(AN["function"==typeof E?E(t,i):E]-1)*F/2,R,F]}),Y(this,"getIconOffsets",(t,i)=>{const r=this.state.fontAtlasManager.mapping,s=this.state.getText,{wordBreak:a,maxWidth:u,lineHeight:f,getTextAnchor:g,getAlignmentBaseline:E}=this.props,M=s(t,i)||"",{x:R,y:F,rowWidth:V,size:[G,K]}=xN(M,f,a,u,r),se=MN["function"==typeof g?g(t,i):g],_e=AN["function"==typeof E?E(t,i):E],de=R.length,Ie=new Array(2*de);let qe=0;for(let Qe=0;Qe<de;Qe++)Ie[qe++]=(se-1)*G/2+(1-se)*(G-V[Qe])/2+R[Qe],Ie[qe++]=(_e-1)*K/2+F[Qe];return Ie})}initializeState(){this.state={styleVersion:0,fontAtlasManager:new ite}}updateState(e){const{props:t,oldProps:i,changeFlags:r}=e;(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||t.lineHeight!==i.lineHeight||t.wordBreak!==i.wordBreak||t.maxWidth!==i.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:t,fontWeight:i}=this.props,{fontAtlasManager:r,characterSet:s}=this.state,a={...e,characterSet:s,fontFamily:t,fontWeight:i};if(!r.mapping)return r.setProps(a),!0;for(const u in a)if(a[u]!==r.props[u])return r.setProps(a),!0;return!1}_updateText(){var e;const{data:t,characterSet:i}=this.props,r=null===(e=t.attributes)||void 0===e?void 0:e.getText;let u,{getText:s}=this.props,a=t.startIndices;const f="auto"===i&&new Set;if(r&&a){const{texts:g,characterCount:E}=function Kee({value:n,length:e,stride:t,offset:i,startIndices:r,characterSet:s}){const a=n.BYTES_PER_ELEMENT,u=t?t/a:1,f=i?i/a:0,g=r[e]||Math.ceil((n.length-f)/u),E=s&&new Set,M=new Array(e);let R=n;if(u>1||f>0){R=new(0,n.constructor)(g);for(let V=0;V<g;V++)R[V]=n[V*u+f]}for(let F=0;F<e;F++){const K=R.subarray(r[F],r[F+1]||g);M[F]=String.fromCodePoint.apply(null,K),E&&K.forEach(E.add,E)}if(E)for(const F of E)s.add(String.fromCodePoint(F));return{texts:M,characterCount:g}}({...ArrayBuffer.isView(r)?{value:r}:r,length:t.length,startIndices:a,characterSet:f});u=E,s=(M,{index:R})=>g[R]}else{const{iterable:g,objectInfo:E}=Gx(t);a=[0],u=0;for(const M of g){E.index++;const R=Array.from(s(M,E)||"");f&&R.forEach(f.add,f),u+=R.length,a.push(u)}}this.setState({getText:s,startIndices:a,numInstances:u,characterSet:f||i})}renderLayers(){const{startIndices:e,numInstances:t,getText:i,fontAtlasManager:{scale:r,texture:s,mapping:a},styleVersion:u}=this.state,{data:f,_dataDiff:g,getPosition:E,getColor:M,getSize:R,getAngle:F,getPixelOffset:V,getBackgroundColor:G,getBorderColor:K,getBorderWidth:se,backgroundPadding:_e,background:de,billboard:Ie,fontSettings:qe,outlineWidth:Qe,outlineColor:Ct,sizeScale:Xt,sizeUnits:Ft,sizeMinPixels:Ut,sizeMaxPixels:mn,transitions:Rn,updateTriggers:gn}=this.props,_i=this.getSubLayerClass("characters",US),Vo=this.getSubLayerClass("background",jS);return[de&&new Vo({getFillColor:G,getLineColor:K,getLineWidth:se,padding:_e,getPosition:E,getSize:R,getAngle:F,getPixelOffset:V,billboard:Ie,sizeScale:Xt/this.state.fontAtlasManager.props.fontSize,sizeUnits:Ft,sizeMinPixels:Ut,sizeMaxPixels:mn,transitions:Rn&&{getPosition:Rn.getPosition,getAngle:Rn.getAngle,getSize:Rn.getSize,getFillColor:Rn.getBackgroundColor,getLineColor:Rn.getBorderColor,getLineWidth:Rn.getBorderWidth,getPixelOffset:Rn.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:gn.getPosition,getAngle:gn.getAngle,getSize:gn.getSize,getFillColor:gn.getBackgroundColor,getLineColor:gn.getBorderColor,getLineWidth:gn.getBorderWidth,getPixelOffset:gn.getPixelOffset,getBoundingRect:{getText:gn.getText,getTextAnchor:gn.getTextAnchor,getAlignmentBaseline:gn.getAlignmentBaseline,styleVersion:u}}}),{data:f.attributes&&f.attributes.background?{length:f.length,attributes:f.attributes.background}:f,_dataDiff:g,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new _i({sdf:qe.sdf,smoothing:Number.isFinite(qe.smoothing)?qe.smoothing:o0.smoothing,outlineWidth:Qe,outlineColor:Ct,iconAtlas:s,iconMapping:a,getPosition:E,getColor:M,getSize:R,getAngle:F,getPixelOffset:V,billboard:Ie,sizeScale:Xt*r,sizeUnits:Ft,sizeMinPixels:Ut*r,sizeMaxPixels:mn*r,transitions:Rn&&{getPosition:Rn.getPosition,getAngle:Rn.getAngle,getColor:Rn.getColor,getSize:Rn.getSize,getPixelOffset:Rn.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{getIcon:gn.getText,getPosition:gn.getPosition,getAngle:gn.getAngle,getColor:gn.getColor,getSize:gn.getSize,getPixelOffset:gn.getPixelOffset,getIconOffsets:{getText:gn.getText,getTextAnchor:gn.getTextAnchor,getAlignmentBaseline:gn.getAlignmentBaseline,styleVersion:u}}}),{data:f,_dataDiff:g,startIndices:e,numInstances:t,getIconOffsets:this.getIconOffsets,getIcon:i})]}static set fontAtlasCacheLimit(e){!function nte(n){ur.assert(Number.isFinite(n)&&n>=3,"Invalid cache limit"),sw=new wN(n)}(e)}}Y(GS,"defaultProps",lte),Y(GS,"layerName","TextLayer");const WS=[89,186,255,255],ute={spy:{x:0,y:0,width:512,height:512,mask:!0}};class hte extends LS{renderLayers(){const{binData:e,length:t}=this.props;return[new zS({data:{length:t,startIndices:e.pathStartIndices,attributes:{getPath:{value:e.path,size:2},getColor:{value:e.pathColor,size:4},getWidth:{value:e.pathWidths}}},pickable:!1,widthUnits:"pixels",positionFormat:"XY",_pathType:"loop"},this.getSubLayerProps({id:"polygon"})),new VS({data:{length:t,attributes:{getPosition:{value:e.centers,size:2},getFillColor:{value:e.pointColors,size:4},getLineWidth:{value:e.pointStrokeWidths}}},pickable:!0,stroked:!0,filled:!0,radiusUnits:"pixels",lineWidthUnits:"pixels",positionFormat:"XY",getRadius:15,getLineColor:WS},this.getSubLayerProps({id:"point"})),new rw({data:{length:t,attributes:{getPosition:{value:e.centers,size:2}}},pickable:!1,iconAtlas:"./assets/spy.png",iconMapping:ute,sizeScale:1,getSize:20,positionFormat:"XY",getIcon:i=>"spy"},this.getSubLayerProps({id:"icon"})),new GS({data:{length:t,startIndices:e.textsIndices,attributes:{getPosition:{value:e.textsPositions,size:2},getText:{value:e.texts},getColor:{value:e.textsColors,size:4}}},pickable:!1,sizeUnits:"pixels",fontFamily:"Droid, Arial",fontSettings:{sdf:!0},outlineWidth:.5,outlineColor:[255,255,255],getSize:20,getAngle:0,getTextAnchor:"start",getPixelOffset:[18,-10],getAlignmentBaseline:"center"},this.getSubLayerProps({id:"text"}))]}getPickingInfo({info:e}){if(e.index>=0&&e.index<this.props.length){const t=String.fromCharCode(...this.props.binData.texts.subarray(this.props.binData.textsIndices[e.index],this.props.binData.textsIndices[e.index+1]));e.object={name:t}}return e}}var dte=ns(489);function og(n,e,t){void 0===t&&(t={});var i={type:"Feature"};return(0===t.id||t.id)&&(i.id=t.id),t.bbox&&(i.bbox=t.bbox),i.properties=e||{},i.geometry=n,i}function $S(n,e,t){if(void 0===t&&(t={}),!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!l0(n[0])||!l0(n[1]))throw new Error("coordinates must contain numbers");return og({type:"Point",coordinates:n},e,t)}function a0(n,e){void 0===e&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=n,t}function l0(n){return!isNaN(n)&&null!==n&&!Array.isArray(n)}function ZS(n){return Array.isArray(n)?LN(n):n&&n.bbox?LN(n.bbox):[360*RN(),180*RN()]}function bte(n,e){void 0===e&&(e={}),null==n&&(n=1);for(var t=[],i=0;i<n;i++)t.push($S(ZS(e.bbox)));return a0(t)}function xte(n,e){void 0===e&&(e={}),null==n&&(n=1),(!l0(e.num_vertices)||void 0===e.num_vertices)&&(e.num_vertices=10),(!l0(e.max_radial_length)||void 0===e.max_radial_length)&&(e.max_radial_length=10);for(var t=[],i=function(s){var a=[],u=function(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;var i=Array(n),r=0;for(e=0;e<t;e++)for(var s=arguments[e],a=0,u=s.length;a<u;a++,r++)i[r]=s[a];return i}(Array(e.num_vertices+1)).map(Math.random);u.forEach(function(f,g,E){E[g]=g>0?f+E[g-1]:f}),u.forEach(function(f){f=2*f*Math.PI/u[u.length-1];var g=Math.random();a.push([g*(e.max_radial_length||10)*Math.sin(f),g*(e.max_radial_length||10)*Math.cos(f)])}),a[a.length-1]=a[0],a=a.map(function wte(n){return function(e){return[e[0]+n[0],e[1]+n[1]]}}(ZS(e.bbox))),t.push(function qS(n,e,t){void 0===t&&(t={});for(var i=0,r=n;i<r.length;i++){var s=r[i];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<s[s.length-1].length;a++)if(s[s.length-1][a]!==s[0][a])throw new Error("First and last Position are not equivalent.")}return og({type:"Polygon",coordinates:n},e,t)}([a]))},r=0;r<n;r++)i();return a0(t)}function RN(){return Math.random()-.5}function LN(n){return[Math.random()*(n[2]-n[0])+n[0],Math.random()*(n[3]-n[1])+n[1]]}let ow=(()=>{class n{constructor(){this.genConfig$=new Fi,this.onGenConfigChange=this.genConfig$.asObservable()}updateConfig(t){n.configVersion++,this.genConfig$.next(t)}currentConfigVersion(){return n.configVersion}}return n.configVersion=0,n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=lt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Cte=(()=>{class n{constructor(t){this.genControlService=t,this.entities=new Map,this.selectedName="",this.entities$=new UP([]),this.onEntitiesUpdated$=this.entities$.asObservable(),this.genControlService.onGenConfigChange.subscribe(i=>this.genConfigChanged(i))}selectEntity(t){const i=this.entities.get(t);if(i){const r=this.entities.get(this.selectedName);r&&this.entities.set(this.selectedName,{...r,isSelected:!1}),this.entities.set(i.name,{...i,isSelected:!0}),this.selectedName=i.name,console.log(`Entity selected: ${t}`),this.entities$.next(Array.from(this.entities.values()))}}genConfigChanged(t){this.entities$.next(this.generateEntities(t.layersCount,t.entitiesInLayer,t.polygonEntities,t.pointsInPolygon)),this.scheduleUpdating(t.updatingRate,t.updatingEntities)}scheduleUpdating(t,i){clearInterval(this.updatingInterval),this.updatingInterval=setInterval(()=>{this.updateRandomEntities(i),this.entities$.next(Array.from(this.entities.values()))},1e3*t)}generateEntities(t,i,r,s){this.entities.clear();for(let a=0;a<t;a++){const u=[Math.floor(255*Math.random()),Math.floor(255*Math.random()),Math.floor(255*Math.random()),255],f=bte(i,{bbox:[-180,-80,180,80]}).features.map(g=>g.geometry.coordinates);for(let g=0;g<f.length;g++){const E=`[${a}]-${g}`;this.entities.set(E,{layerId:a,name:E,center:f[g],color:u,polygon:[f[g],f[g],f[g]],icon:"/assets/entity.png",isSelected:!1})}}return this.addPolygons(r,s),Array.from(this.entities.values())}addPolygons(t,i){Array.from(this.entities.values()).forEach(r=>{if(100*Math.random()<t){const s=Math.round(Math.random()*(i-3)+3),a=xte(1,{bbox:[r.center[0],r.center[1],r.center[0],r.center[1]],num_vertices:s,max_radial_length:.5});r.polygon=a.features[0].geometry.coordinates.flat()}return r})}updateRandomEntities(t){Array.from(this.entities.values()).forEach(i=>{if(100*Math.random()<t){const r=[.1*Math.random()-.05,.1*Math.random()-.05];i.center=[i.center[0]+r[0],i.center[1]+r[1]],i.polygon=i?.polygon?.map(s=>[s[0]+r[0],s[1]+r[1]])}return i})}}return n.\u0275fac=function(t){return new(t||n)(nt(ow))},n.\u0275prov=lt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),ON=(()=>{class n{constructor(){this.metrics$=new Fi,this.onMetricsChanged$=this.metrics$.asObservable()}updateMetrics(t){this.metrics$.next(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=lt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Ste=["map"];function Mte(n,e){1&n&&(bn(0,"div",2)(1,"div",3),Ga(2,"mat-spinner",4),bn(3,"h2"),Qi(4,"Refreshing..."),jn()()())}const XS=typeof Worker<"u"?new Worker(URL.createObjectURL(new Blob(["("+function fte(){addEventListener("message",({data:n})=>{const{entities:e,layerId:t,configVersion:i,SelectedColor:r}=n,s={centers:new Float32Array(e.flatMap(({center:a})=>a)),pointColors:new Uint8Array(e.flatMap(({color:a})=>a)),pointStrokeWidths:new Uint8Array(e.map(({isSelected:a})=>a?5:0)),path:new Float32Array(e.map(({polygon:a})=>a).flat(2)),pathStartIndices:new Uint32Array(e.reduce((a,{polygon:u})=>(a.push(a[a.length-1]+(u?.length??0)),a),[0])),pathColor:new Uint8Array(e.map(({polygon:a,isSelected:u,color:f})=>a.map(g=>u?r:f)).flat(2)),pathWidths:new Uint8Array(e.map(({polygon:a,isSelected:u})=>a.map(f=>u?5:2)).flat(2)),texts:new Uint16Array(e.flatMap(({name:a})=>Array.from(a).map(u=>u.charCodeAt(0)))),textsPositions:new Float32Array(e.map(({name:a,center:u})=>Array.from(a).map(f=>u)).flat(2)),textsColors:new Float32Array(e.map(({name:a})=>Array.from(a).map(u=>[0,0,0,255])).flat(2)),textsIndices:new Uint32Array(e.reduce((a,{name:u})=>(a.push(a[a.length-1]+u.length),a),[0]))};postMessage({length:e.length,layerId:t,configVersion:i,...s},Object.values(s).map(a=>a.buffer))})}.toString()+")()"],{type:"text/javascript"}))):void 0;let Ate=(()=>{class n{constructor(t,i,r){this.entitiesService=t,this.genControlService=i,this.metricsDataService=r,this.isLoading=!1,this.layers=new Map,XS&&(XS.onmessage=({data:s})=>{this.updateLayer(s)}),this.genControlService.onGenConfigChange.subscribe(s=>{this.layers.clear(),this.isLoading=!0,this.renderLayers()})}ngAfterViewInit(){this.map=new NG.Map({container:this.mapContainer.nativeElement,style:"https://demotiles.maplibre.org/style.json",center:[-74.5,40],zoom:5}),this.overlay=new HK({getTooltip:({object:t})=>this.getTooltip(t?.name),_onMetrics:t=>this.metricsDataService.updateMetrics(t)}),this.map?.addControl(this.overlay),this.entitiesService.onEntitiesUpdated$.subscribe(t=>this.onDataUpdated(t))}getTooltip(t){if(t){const[i,r]=t.split("-");return{text:`Entity: [Layer Id: ${i.slice(1,-1)}, Index: ${r}]`,style:{borderRadius:"0.5em",backgroundColor:"#0000007F",color:"white"}}}return null}onDataUpdated(t){const i=(0,dte.groupBy)(t,r=>r.layerId);Object.entries(i).map(([r,s])=>XS?.postMessage({entities:s,layerId:r,SelectedColor:WS,configVersion:this.genControlService.currentConfigVersion()}))}updateLayer(t){t.configVersion===this.genControlService.currentConfigVersion()&&(this.layers.set(Number(t.layerId),new hte({id:`entities-${t.layerId}`,length:t.length,pickable:!0,binData:t,autoHighlight:!0,highlightColor:[...WS.slice(0,3),150],onClick:i=>{this.entitiesService.selectEntity(i.object.name)}})),this.renderLayers(),this.isLoading=!1)}renderLayers(){this.overlay?.setProps({layers:Array.from(this.layers.values())})}}return n.\u0275fac=function(t){return new(t||n)(Ye(Cte),Ye(ow),Ye(ON))},n.\u0275cmp=jt({type:n,selectors:[["app-map"]],viewQuery:function(t,i){if(1&t&&tv(Ste,5),2&t){let r;ev(r=nv())&&(i.mapContainer=r.first)}},decls:4,vars:1,consts:[["map",""],["class","loading-container",4,"ngIf"],[1,"loading-container"],[1,"loading"],["color","accent"]],template:function(t,i){1&t&&(bn(0,"section"),Ga(1,"div",null,0),jn(),f_(3,Mte,5,0,"div",1)),2&t&&(Li(3),ps("ngIf",i.isLoading))},dependencies:[Eb,Cf],styles:["section[_ngcontent-%COMP%]{height:100%;width:100%}section[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{height:100%;width:100%}.loading-container[_ngcontent-%COMP%]{position:fixed;top:0;left:0;height:100vh;width:100vw;background-color:#000000b3;z-index:10}.loading-container[_ngcontent-%COMP%]   .loading[_ngcontent-%COMP%]{position:absolute;top:50vh;left:50vw;transform:translate3d(-50%,-50%,0);color:#fff}"]}),n})();const FN={layersCount:2,entitiesInLayer:1e3,polygonEntities:50,pointsInPolygon:10,updatingEntities:50,updatingRate:2},NN="generationConfig";let Dte=(()=>{class n{constructor(t){t.onGenConfigChange.subscribe(this.saveConfig.bind(this))}retrieveConfig(){const t=localStorage.getItem(NN);if(t)return JSON.parse(t)}saveConfig(t){localStorage.setItem(NN,JSON.stringify(t))}}return n.\u0275fac=function(t){return new(t||n)(nt(ow))},n.\u0275prov=lt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function Ite(n,e){1&n&&bf(0,0,["*ngIf","isExpanded"])}const Pte=["*"];let BN=(()=>{class n{constructor(){this.minWidth="0",this.defaultIsExpanded=!0,this.titleText="",this.titleTextExpanded="",this.isExpanded=!0}ngOnInit(){this.isExpanded=this.defaultIsExpanded}ngOnChanges(t){this.titleTextExpanded||(this.titleTextExpanded=this.titleText)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=jt({type:n,selectors:[["app-expandable-card"]],inputs:{minWidth:"minWidth",defaultIsExpanded:"defaultIsExpanded",titleText:"titleText",titleTextExpanded:"titleTextExpanded"},features:[Xo],ngContentSelectors:Pte,decls:8,vars:6,consts:[[3,"click"],["mat-icon-button","",3,"matTooltip"],[4,"ngIf"]],template:function(t,i){1&t&&(p_(),bn(0,"mat-card")(1,"mat-card-title-group",0),Vs("click",function(){return i.isExpanded=!i.isExpanded}),bn(2,"mat-card-title"),Qi(3),jn(),bn(4,"button",1)(5,"mat-icon"),Qi(6),jn()()(),f_(7,Ite,1,0,"ng-content",2),jn()),2&t&&(yp("min-width",i.minWidth),Li(3),Jc("",i.isExpanded?i.titleTextExpanded:i.titleText," "),Li(1),ps("matTooltip",i.isExpanded?"Hide":"Show"),Li(2),Om(i.isExpanded?"expand_less":"expand_more"),Li(1),ps("ngIf",i.isExpanded))},dependencies:[Eb,kj,Rj,Ij,Sk,KH,RG],styles:["mat-card-title-group[_ngcontent-%COMP%]{display:flex;align-items:flex-end;cursor:pointer;-webkit-user-select:none;user-select:none}mat-card-title-group[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:first-child{flex-grow:1}"]}),n})();function kte(n,e){if(1&n){const t=function uA(){return L()}();bn(0,"div",1)(1,"span"),Qi(2,"Updating rate (s):"),jn(),bn(3,"mat-slider",10),Vs("valueChange",function(r){return function I(n){return hn.lFrame.contextLView=n,n[8]}(t),function H(n){return hn.lFrame.contextLView=null,n}(Wy().genConfig.updatingRate=r)}),jn(),bn(4,"span"),Qi(5),jn()()}if(2&n){const t=Wy();Li(3),ps("value",t.genConfig.updatingRate)("displayWith",t.secondsLabel),Li(2),Jc("(",t.genConfig.updatingRate,"s)")}}let Rte=(()=>{class n{constructor(t,i){this.genControlService=t,this.currentDisplayEntities=0,this.genConfig=FN;const r=i.retrieveConfig();r&&this.applyConfig(r)}ngOnInit(){this.applyGenConfig()}applyGenConfig(){this.isValidGenConfig(this.genConfig)&&(this.genControlService.updateConfig({...this.genConfig}),this.currentDisplayEntities=this.genConfig.entitiesInLayer*this.genConfig.layersCount)}applyDefaultConfig(){this.applyConfig(FN),this.applyGenConfig()}entitiesCountLabel(t){return t>=1e3?t/1e3+"k":t.toString()}percentLabel(t){return`${t}%`}secondsLabel(t){return`${t}s`}applyConfig(t){this.genConfig={...t}}isValidGenConfig(t){return t.layersCount&&t.entitiesInLayer&&t.polygonEntities&&t.updatingEntities&&t.updatingRate}}return n.\u0275fac=function(t){return new(t||n)(Ye(ow),Ye(Dte))},n.\u0275cmp=jt({type:n,selectors:[["app-generation-control-form"]],decls:46,vars:17,consts:[["titleTextExpanded","Generation options",3,"defaultIsExpanded","titleText"],[1,"slider-container"],["min","0","max","20","thumbLabel","",3,"value","valueChange"],["min","0","max","25000","step","100","thumbLabel","",3,"value","displayWith","valueChange"],["min","0","max","100","thumbLabel","",3,"value","displayWith","valueChange"],["min","3","max","100","thumbLabel","",3,"value","valueChange"],["class","slider-container",4,"ngIf"],["align","end"],["mat-stroked-button","","color","primary",3,"click"],["mat-raised-button","","color","primary",3,"click"],["min","1","max","10","thumbLabel","",3,"value","displayWith","valueChange"]],template:function(t,i){1&t&&(bn(0,"app-expandable-card",0),Ga(1,"br"),bn(2,"mat-card-content")(3,"div",1)(4,"span"),Qi(5,"Layers:"),jn(),bn(6,"mat-slider",2),Vs("valueChange",function(s){return i.genConfig.layersCount=s}),jn(),bn(7,"span"),Qi(8),jn()(),bn(9,"div",1)(10,"span"),Qi(11,"Entities per layer:"),jn(),bn(12,"mat-slider",3),Vs("valueChange",function(s){return i.genConfig.entitiesInLayer=s}),jn(),bn(13,"span"),Qi(14),jn()(),bn(15,"div",1)(16,"span"),Qi(17,"Entities w/ polygon (%):"),jn(),bn(18,"mat-slider",4),Vs("valueChange",function(s){return i.genConfig.polygonEntities=s}),jn(),bn(19,"span"),Qi(20),jn()(),bn(21,"div",1)(22,"span"),Qi(23,"Max points in polygon:"),jn(),bn(24,"mat-slider",5),Vs("valueChange",function(s){return i.genConfig.pointsInPolygon=s}),jn(),bn(25,"span"),Qi(26),jn()(),bn(27,"div",1)(28,"span"),Qi(29,"Updating entities (%):"),jn(),bn(30,"mat-slider",4),Vs("valueChange",function(s){return i.genConfig.updatingEntities=s}),jn(),bn(31,"span"),Qi(32),jn()(),f_(33,kte,6,3,"div",6),Ga(34,"br"),bn(35,"h3"),Qi(36,"Rendering a total of "),bn(37,"b"),Qi(38),jn(),Qi(39," entities "),jn()(),Ga(40,"mat-divider"),bn(41,"mat-card-actions",7)(42,"button",8),Vs("click",function(){return i.applyDefaultConfig()}),Qi(43,"Default"),jn(),bn(44,"button",9),Vs("click",function(){return i.applyGenConfig()}),Qi(45,"Apply"),jn()()()),2&t&&(ps("defaultIsExpanded",!0)("titleText","Rendering "+i.currentDisplayEntities+" entities"),Li(6),ps("value",i.genConfig.layersCount),Li(2),Jc("(",i.genConfig.layersCount,")"),Li(4),ps("value",i.genConfig.entitiesInLayer)("displayWith",i.entitiesCountLabel),Li(2),Jc("(",i.genConfig.entitiesInLayer,")"),Li(4),ps("value",i.genConfig.polygonEntities)("displayWith",i.percentLabel),Li(2),Jc("(",i.genConfig.polygonEntities,"%)"),Li(4),ps("value",i.genConfig.pointsInPolygon),Li(2),Jc("(",i.genConfig.pointsInPolygon,")"),Li(4),ps("value",i.genConfig.updatingEntities)("displayWith",i.percentLabel),Li(2),Jc("(",i.genConfig.updatingEntities,"%)"),Li(1),ps("ngIf",i.genConfig.updatingEntities&&i.genConfig.updatingEntities>0),Li(5),Om(i.currentDisplayEntities))},dependencies:[Eb,m2,Pj,Ek,Sk,Mk,BN],styles:[".slider-container[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;gap:1em}.slider-container[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:first-child{flex:1}.slider-container[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:last-child{width:7ch;text-align:center}"]}),n})(),Lte=(()=>{class n{constructor(t){this.metricsDataService=t,this.metrics=this.metricsDataService.onMetricsChanged$.pipe(Kn(this.prepareMetrics))}ngOnInit(){}prepareMetrics(t){return{...t,fps:Math.floor(t.fps),cpuTimePerFrame:Number(t.cpuTimePerFrame.toFixed(2)),gpuTimePerFrame:Number(t.gpuTimePerFrame.toFixed(2)),gpuMemory:Math.floor(t.gpuMemory/1048576)}}}return n.\u0275fac=function(t){return new(t||n)(Ye(ON))},n.\u0275cmp=jt({type:n,selectors:[["app-metrics-display"]],decls:28,vars:16,consts:[["minWidth","18ch","titleTextExpanded","Performance metrics",3,"defaultIsExpanded","titleText"],[1,"metric-container"]],template:function(t,i){if(1&t&&(bn(0,"app-expandable-card",0),Nm(1,"async"),Ga(2,"br"),bn(3,"mat-card-content")(4,"div",1)(5,"p"),Qi(6,"FPS"),jn(),bn(7,"h2"),Qi(8),Nm(9,"async"),jn()(),bn(10,"div",1)(11,"p"),Qi(12,"CPU Time/Frame"),jn(),bn(13,"h2"),Qi(14),Nm(15,"async"),jn()(),bn(16,"div",1)(17,"p"),Qi(18,"GPU Time/Frame"),jn(),bn(19,"h2"),Qi(20),Nm(21,"async"),jn()(),bn(22,"div",1)(23,"p"),Qi(24,"GPU Memory Usage"),jn(),bn(25,"h2"),Qi(26),Nm(27,"async"),jn()()()()),2&t){let r,s,a,u,f;ps("defaultIsExpanded",!1)("titleText","FPS: "+(null!==(r=null==(r=Bm(1,6,i.metrics))?null:r.fps)&&void 0!==r?r:"-")),Li(8),Om(null==(s=Bm(9,8,i.metrics))?null:s.fps),Li(6),Jc("",null==(a=Bm(15,10,i.metrics))?null:a.cpuTimePerFrame,"ms"),Li(6),Jc("",null==(u=Bm(21,12,i.metrics))?null:u.gpuTimePerFrame,"ms"),Li(6),Jc("",null==(f=Bm(27,14,i.metrics))?null:f.gpuMemory," MB")}},dependencies:[m2,BN,xE],styles:[".metric-container[_ngcontent-%COMP%]{display:flex;align-items:baseline;gap:1em}.metric-container[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:first-child{flex-grow:1}.metric-container[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:last-child{width:10ch;text-align:center}"]}),n})(),Ote=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=jt({type:n,selectors:[["app-root"]],decls:13,vars:1,consts:[[1,"main-section"],["href","https://github.com/SlavaSimonov/ng-deckgl-dynamic-check","target","_blank"],[3,"vertical"],["href","https://www.flaticon.com","target","_blank"]],template:function(t,i){1&t&&(bn(0,"main"),Ga(1,"app-map",0),bn(2,"footer")(3,"p"),Qi(4,"Copyright \xa9 2022 Slava Simonov. "),bn(5,"a",1),Qi(6,"Source Code"),jn()(),Ga(7,"mat-divider",2),bn(8,"a",3),Qi(9,"Icons by Freepik - Flaticon"),jn()()(),bn(10,"aside"),Ga(11,"app-generation-control-form")(12,"app-metrics-display"),jn()),2&t&&(Li(7),ps("vertical",!0))},dependencies:[Mk,Ate,Rte,Lte],styles:["main[_ngcontent-%COMP%]{height:100vh;width:100vw;display:flex;flex-direction:column;align-items:stretch}main[_ngcontent-%COMP%]   .main-section[_ngcontent-%COMP%]{flex-grow:1}footer[_ngcontent-%COMP%]{text-align:center;background-color:#000;color:#fff;font-size:.9em;padding:.2em 1em;-webkit-user-select:none;user-select:none;display:flex;align-items:baseline;justify-content:space-between}footer[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff}aside[_ngcontent-%COMP%]{display:flex;gap:1em;flex-wrap:wrap;width:calc(100vw - 2em);position:fixed;pointer-events:none;top:0;left:0;margin:1em;z-index:2}aside[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{pointer-events:auto}"]}),n})();function zN(n){return new st(3e3,!1)}function gne(){return typeof window<"u"&&typeof window.document<"u"}function YS(){return typeof process<"u"&&"[object process]"==={}.toString.call(process)}function Vp(n){switch(n.length){case 0:return new Tv;case 1:return n[0];default:return new aR(n)}}function VN(n,e,t,i,r=new Map,s=new Map){const a=[],u=[];let f=-1,g=null;if(i.forEach(E=>{const M=E.get("offset"),R=M==f,F=R&&g||new Map;E.forEach((V,G)=>{let K=G,se=V;if("offset"!==G)switch(K=e.normalizePropertyName(K,a),se){case"!":se=r.get(G);break;case Sf:se=s.get(G);break;default:se=e.normalizeStyleValue(G,K,se,a)}F.set(K,se)}),R||u.push(F),g=F,f=M}),a.length)throw function rne(n){return new st(3502,!1)}();return u}function KS(n,e,t,i){switch(e){case"start":n.onStart(()=>i(t&&JS(t,"start",n)));break;case"done":n.onDone(()=>i(t&&JS(t,"done",n)));break;case"destroy":n.onDestroy(()=>i(t&&JS(t,"destroy",n)))}}function JS(n,e,t){const s=QS(n.element,n.triggerName,n.fromState,n.toState,e||n.phaseName,t.totalTime??n.totalTime,!!t.disabled),a=n._data;return null!=a&&(s._data=a),s}function QS(n,e,t,i,r="",s=0,a){return{element:n,triggerName:e,fromState:t,toState:i,phaseName:r,totalTime:s,disabled:!!a}}function ou(n,e,t){let i=n.get(e);return i||n.set(e,i=t),i}function UN(n){const e=n.indexOf(":");return[n.substring(1,e),n.slice(e+1)]}let eM=(n,e)=>!1,jN=(n,e,t)=>[],HN=null;function tM(n){const e=n.parentNode||n.host;return e===HN?null:e}(YS()||typeof Element<"u")&&(gne()?(HN=(()=>document.documentElement)(),eM=(n,e)=>{for(;e;){if(e===n)return!0;e=tM(e)}return!1}):eM=(n,e)=>n.contains(e),jN=(n,e,t)=>{if(t)return Array.from(n.querySelectorAll(e));const i=n.querySelector(e);return i?[i]:[]});let ag=null,GN=!1;const WN=eM,$N=jN;let qN=(()=>{class n{validateStyleProperty(t){return function yne(n){ag||(ag=function vne(){return typeof document<"u"?document.body:null}()||{},GN=!!ag.style&&"WebkitAppearance"in ag.style);let e=!0;return ag.style&&!function _ne(n){return"ebkit"==n.substring(1,6)}(n)&&(e=n in ag.style,!e&&GN&&(e="Webkit"+n.charAt(0).toUpperCase()+n.slice(1)in ag.style)),e}(t)}matchesElement(t,i){return!1}containsElement(t,i){return WN(t,i)}getParentElement(t){return tM(t)}query(t,i,r){return $N(t,i,r)}computeStyle(t,i,r){return r||""}animate(t,i,r,s,a,u=[],f){return new Tv(r,s)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=lt({token:n,factory:n.\u0275fac}),n})(),nM=(()=>{class n{}return n.NOOP=new qN,n})();const iM="ng-enter",aw="ng-leave",lw="ng-trigger",cw=".ng-trigger",XN="ng-animating",rM=".ng-animating";function Ff(n){if("number"==typeof n)return n;const e=n.match(/^(-?[\.\d]+)(m?s)/);return!e||e.length<2?0:sM(parseFloat(e[1]),e[2])}function sM(n,e){return"s"===e?1e3*n:n}function uw(n,e,t){return n.hasOwnProperty("duration")?n:function wne(n,e,t){let r,s=0,a="";if("string"==typeof n){const u=n.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===u)return e.push(zN()),{duration:0,delay:0,easing:""};r=sM(parseFloat(u[1]),u[2]);const f=u[3];null!=f&&(s=sM(parseFloat(f),u[4]));const g=u[5];g&&(a=g)}else r=n;if(!t){let u=!1,f=e.length;r<0&&(e.push(function Fte(){return new st(3100,!1)}()),u=!0),s<0&&(e.push(function Nte(){return new st(3101,!1)}()),u=!0),u&&e.splice(f,0,zN())}return{duration:r,delay:s,easing:a}}(n,e,t)}function c0(n,e={}){return Object.keys(n).forEach(t=>{e[t]=n[t]}),e}function YN(n){const e=new Map;return Object.keys(n).forEach(t=>{e.set(t,n[t])}),e}function Up(n,e=new Map,t){if(t)for(let[i,r]of t)e.set(i,r);for(let[i,r]of n)e.set(i,r);return e}function JN(n,e,t){return t?e+":"+t+";":""}function QN(n){let e="";for(let t=0;t<n.style.length;t++){const i=n.style.item(t);e+=JN(0,i,n.style.getPropertyValue(i))}for(const t in n.style)n.style.hasOwnProperty(t)&&!t.startsWith("_")&&(e+=JN(0,Sne(t),n.style[t]));n.setAttribute("style",e)}function Dd(n,e,t){n.style&&(e.forEach((i,r)=>{const s=aM(r);t&&!t.has(r)&&t.set(r,n.style[s]),n.style[s]=i}),YS()&&QN(n))}function lg(n,e){n.style&&(e.forEach((t,i)=>{const r=aM(i);n.style[r]=""}),YS()&&QN(n))}function u0(n){return Array.isArray(n)?1==n.length?n[0]:iR(n):n}const oM=new RegExp("{{\\s*(.+?)\\s*}}","g");function e3(n){let e=[];if("string"==typeof n){let t;for(;t=oM.exec(n);)e.push(t[1]);oM.lastIndex=0}return e}function h0(n,e,t){const i=n.toString(),r=i.replace(oM,(s,a)=>{let u=e[a];return null==u&&(t.push(function zte(n){return new st(3003,!1)}()),u=""),u.toString()});return r==i?n:r}function hw(n){const e=[];let t=n.next();for(;!t.done;)e.push(t.value),t=n.next();return e}const Cne=/-+([a-z0-9])/g;function aM(n){return n.replace(Cne,(...e)=>e[1].toUpperCase())}function Sne(n){return n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function au(n,e,t){switch(e.type){case 7:return n.visitTrigger(e,t);case 0:return n.visitState(e,t);case 1:return n.visitTransition(e,t);case 2:return n.visitSequence(e,t);case 3:return n.visitGroup(e,t);case 4:return n.visitAnimate(e,t);case 5:return n.visitKeyframes(e,t);case 6:return n.visitStyle(e,t);case 8:return n.visitReference(e,t);case 9:return n.visitAnimateChild(e,t);case 10:return n.visitAnimateRef(e,t);case 11:return n.visitQuery(e,t);case 12:return n.visitStagger(e,t);default:throw function Vte(n){return new st(3004,!1)}()}}function t3(n,e){return window.getComputedStyle(n)[e]}function kne(n,e){const t=[];return"string"==typeof n?n.split(/\s*,\s*/).forEach(i=>function Rne(n,e,t){if(":"==n[0]){const f=function Lne(n,e){switch(n){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(t,i)=>parseFloat(i)>parseFloat(t);case":decrement":return(t,i)=>parseFloat(i)<parseFloat(t);default:return e.push(function ene(n){return new st(3016,!1)}()),"* => *"}}(n,t);if("function"==typeof f)return void e.push(f);n=f}const i=n.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==i||i.length<4)return t.push(function Qte(n){return new st(3015,!1)}()),e;const r=i[1],s=i[2],a=i[3];e.push(n3(r,a));"<"==s[0]&&!("*"==r&&"*"==a)&&e.push(n3(a,r))}(i,t,e)):t.push(n),t}const mw=new Set(["true","1"]),gw=new Set(["false","0"]);function n3(n,e){const t=mw.has(n)||gw.has(n),i=mw.has(e)||gw.has(e);return(r,s)=>{let a="*"==n||n==r,u="*"==e||e==s;return!a&&t&&"boolean"==typeof r&&(a=r?mw.has(n):gw.has(n)),!u&&i&&"boolean"==typeof s&&(u=s?mw.has(e):gw.has(e)),a&&u}}const One=new RegExp("s*:selfs*,?","g");function lM(n,e,t,i){return new Fne(n).build(e,t,i)}class Fne{constructor(e){this._driver=e}build(e,t,i){const r=new zne(t);return this._resetContextStyleTimingState(r),au(this,u0(e),r)}_resetContextStyleTimingState(e){e.currentQuerySelector="",e.collectedStyles=new Map,e.collectedStyles.set("",new Map),e.currentTime=0}visitTrigger(e,t){let i=t.queryCount=0,r=t.depCount=0;const s=[],a=[];return"@"==e.name.charAt(0)&&t.errors.push(function jte(){return new st(3006,!1)}()),e.definitions.forEach(u=>{if(this._resetContextStyleTimingState(t),0==u.type){const f=u,g=f.name;g.toString().split(/\s*,\s*/).forEach(E=>{f.name=E,s.push(this.visitState(f,t))}),f.name=g}else if(1==u.type){const f=this.visitTransition(u,t);i+=f.queryCount,r+=f.depCount,a.push(f)}else t.errors.push(function Hte(){return new st(3007,!1)}())}),{type:7,name:e.name,states:s,transitions:a,queryCount:i,depCount:r,options:null}}visitState(e,t){const i=this.visitStyle(e.styles,t),r=e.options&&e.options.params||null;if(i.containsDynamicStyles){const s=new Set,a=r||{};i.styles.forEach(u=>{u instanceof Map&&u.forEach(f=>{e3(f).forEach(g=>{a.hasOwnProperty(g)||s.add(g)})})}),s.size&&(hw(s.values()),t.errors.push(function Gte(n,e){return new st(3008,!1)}()))}return{type:0,name:e.name,style:i,options:r?{params:r}:null}}visitTransition(e,t){t.queryCount=0,t.depCount=0;const i=au(this,u0(e.animation),t);return{type:1,matchers:kne(e.expr,t.errors),animation:i,queryCount:t.queryCount,depCount:t.depCount,options:cg(e.options)}}visitSequence(e,t){return{type:2,steps:e.steps.map(i=>au(this,i,t)),options:cg(e.options)}}visitGroup(e,t){const i=t.currentTime;let r=0;const s=e.steps.map(a=>{t.currentTime=i;const u=au(this,a,t);return r=Math.max(r,t.currentTime),u});return t.currentTime=r,{type:3,steps:s,options:cg(e.options)}}visitAnimate(e,t){const i=function Une(n,e){if(n.hasOwnProperty("duration"))return n;if("number"==typeof n)return cM(uw(n,e).duration,0,"");const t=n;if(t.split(/\s+/).some(s=>"{"==s.charAt(0)&&"{"==s.charAt(1))){const s=cM(0,0,"");return s.dynamic=!0,s.strValue=t,s}const r=uw(t,e);return cM(r.duration,r.delay,r.easing)}(e.timings,t.errors);t.currentAnimateTimings=i;let r,s=e.styles?e.styles:Mp({});if(5==s.type)r=this.visitKeyframes(s,t);else{let a=e.styles,u=!1;if(!a){u=!0;const g={};i.easing&&(g.easing=i.easing),a=Mp(g)}t.currentTime+=i.duration+i.delay;const f=this.visitStyle(a,t);f.isEmptyStep=u,r=f}return t.currentAnimateTimings=null,{type:4,timings:i,style:r,options:null}}visitStyle(e,t){const i=this._makeStyleAst(e,t);return this._validateStyleAst(i,t),i}_makeStyleAst(e,t){const i=[],r=Array.isArray(e.styles)?e.styles:[e.styles];for(let u of r)"string"==typeof u?u===Sf?i.push(u):t.errors.push(new st(3002,!1)):i.push(YN(u));let s=!1,a=null;return i.forEach(u=>{if(u instanceof Map&&(u.has("easing")&&(a=u.get("easing"),u.delete("easing")),!s))for(let f of u.values())if(f.toString().indexOf("{{")>=0){s=!0;break}}),{type:6,styles:i,easing:a,offset:e.offset,containsDynamicStyles:s,options:null}}_validateStyleAst(e,t){const i=t.currentAnimateTimings;let r=t.currentTime,s=t.currentTime;i&&s>0&&(s-=i.duration+i.delay),e.styles.forEach(a=>{"string"!=typeof a&&a.forEach((u,f)=>{const g=t.collectedStyles.get(t.currentQuerySelector),E=g.get(f);let M=!0;E&&(s!=r&&s>=E.startTime&&r<=E.endTime&&(t.errors.push(function $te(n,e,t,i,r){return new st(3010,!1)}()),M=!1),s=E.startTime),M&&g.set(f,{startTime:s,endTime:r}),t.options&&function Tne(n,e,t){const i=e.params||{},r=e3(n);r.length&&r.forEach(s=>{i.hasOwnProperty(s)||t.push(function Bte(n){return new st(3001,!1)}())})}(u,t.options,t.errors)})})}visitKeyframes(e,t){const i={type:5,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push(function qte(){return new st(3011,!1)}()),i;let s=0;const a=[];let u=!1,f=!1,g=0;const E=e.steps.map(se=>{const _e=this._makeStyleAst(se,t);let de=null!=_e.offset?_e.offset:function Vne(n){if("string"==typeof n)return null;let e=null;if(Array.isArray(n))n.forEach(t=>{if(t instanceof Map&&t.has("offset")){const i=t;e=parseFloat(i.get("offset")),i.delete("offset")}});else if(n instanceof Map&&n.has("offset")){const t=n;e=parseFloat(t.get("offset")),t.delete("offset")}return e}(_e.styles),Ie=0;return null!=de&&(s++,Ie=_e.offset=de),f=f||Ie<0||Ie>1,u=u||Ie<g,g=Ie,a.push(Ie),_e});f&&t.errors.push(function Zte(){return new st(3012,!1)}()),u&&t.errors.push(function Xte(){return new st(3200,!1)}());const M=e.steps.length;let R=0;s>0&&s<M?t.errors.push(function Yte(){return new st(3202,!1)}()):0==s&&(R=1/(M-1));const F=M-1,V=t.currentTime,G=t.currentAnimateTimings,K=G.duration;return E.forEach((se,_e)=>{const de=R>0?_e==F?1:R*_e:a[_e],Ie=de*K;t.currentTime=V+G.delay+Ie,G.duration=Ie,this._validateStyleAst(se,t),se.offset=de,i.styles.push(se)}),i}visitReference(e,t){return{type:8,animation:au(this,u0(e.animation),t),options:cg(e.options)}}visitAnimateChild(e,t){return t.depCount++,{type:9,options:cg(e.options)}}visitAnimateRef(e,t){return{type:10,animation:this.visitReference(e.animation,t),options:cg(e.options)}}visitQuery(e,t){const i=t.currentQuerySelector,r=e.options||{};t.queryCount++,t.currentQuery=e;const[s,a]=function Nne(n){const e=!!n.split(/\s*,\s*/).find(t=>":self"==t);return e&&(n=n.replace(One,"")),n=n.replace(/@\*/g,cw).replace(/@\w+/g,t=>cw+"-"+t.slice(1)).replace(/:animating/g,rM),[n,e]}(e.selector);t.currentQuerySelector=i.length?i+" "+s:s,ou(t.collectedStyles,t.currentQuerySelector,new Map);const u=au(this,u0(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=i,{type:11,selector:s,limit:r.limit||0,optional:!!r.optional,includeSelf:a,animation:u,originalSelector:e.selector,options:cg(e.options)}}visitStagger(e,t){t.currentQuery||t.errors.push(function Kte(){return new st(3013,!1)}());const i="full"===e.timings?{duration:0,delay:0,easing:"full"}:uw(e.timings,t.errors,!0);return{type:12,animation:au(this,u0(e.animation),t),timings:i,options:null}}}class zne{constructor(e){this.errors=e,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function cg(n){return n?(n=c0(n)).params&&(n.params=function Bne(n){return n?c0(n):null}(n.params)):n={},n}function cM(n,e,t){return{duration:n,delay:e,easing:t}}function uM(n,e,t,i,r,s,a=null,u=!1){return{type:1,element:n,keyframes:e,preStyleProps:t,postStyleProps:i,duration:r,delay:s,totalTime:r+s,easing:a,subTimeline:u}}class _w{constructor(){this._map=new Map}get(e){return this._map.get(e)||[]}append(e,t){let i=this._map.get(e);i||this._map.set(e,i=[]),i.push(...t)}has(e){return this._map.has(e)}clear(){this._map.clear()}}const Gne=new RegExp(":enter","g"),$ne=new RegExp(":leave","g");function hM(n,e,t,i,r,s=new Map,a=new Map,u,f,g=[]){return(new qne).buildKeyframes(n,e,t,i,r,s,a,u,f,g)}class qne{buildKeyframes(e,t,i,r,s,a,u,f,g,E=[]){g=g||new _w;const M=new dM(e,t,g,r,s,E,[]);M.options=f;const R=f.delay?Ff(f.delay):0;M.currentTimeline.delayNextStep(R),M.currentTimeline.setStyles([a],null,M.errors,f),au(this,i,M);const F=M.timelines.filter(V=>V.containsAnimation());if(F.length&&u.size){let V;for(let G=F.length-1;G>=0;G--){const K=F[G];if(K.element===t){V=K;break}}V&&!V.allowOnlyTimelineStyles()&&V.setStyles([u],null,M.errors,f)}return F.length?F.map(V=>V.buildKeyframes()):[uM(t,[],[],[],0,R,"",!1)]}visitTrigger(e,t){}visitState(e,t){}visitTransition(e,t){}visitAnimateChild(e,t){const i=t.subInstructions.get(t.element);if(i){const r=t.createSubContext(e.options),s=t.currentTimeline.currentTime,a=this._visitSubInstructions(i,r,r.options);s!=a&&t.transformIntoNewTimeline(a)}t.previousNode=e}visitAnimateRef(e,t){const i=t.createSubContext(e.options);i.transformIntoNewTimeline(),this._applyAnimationRefDelays([e.options,e.animation.options],t,i),this.visitReference(e.animation,i),t.transformIntoNewTimeline(i.currentTimeline.currentTime),t.previousNode=e}_applyAnimationRefDelays(e,t,i){for(const r of e){const s=r?.delay;if(s){const a="number"==typeof s?s:Ff(h0(s,r?.params??{},t.errors));i.delayNextStep(a)}}}_visitSubInstructions(e,t,i){let s=t.currentTimeline.currentTime;const a=null!=i.duration?Ff(i.duration):null,u=null!=i.delay?Ff(i.delay):null;return 0!==a&&e.forEach(f=>{const g=t.appendInstructionToTimeline(f,a,u);s=Math.max(s,g.duration+g.delay)}),s}visitReference(e,t){t.updateOptions(e.options,!0),au(this,e.animation,t),t.previousNode=e}visitSequence(e,t){const i=t.subContextCount;let r=t;const s=e.options;if(s&&(s.params||s.delay)&&(r=t.createSubContext(s),r.transformIntoNewTimeline(),null!=s.delay)){6==r.previousNode.type&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=yw);const a=Ff(s.delay);r.delayNextStep(a)}e.steps.length&&(e.steps.forEach(a=>au(this,a,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>i&&r.transformIntoNewTimeline()),t.previousNode=e}visitGroup(e,t){const i=[];let r=t.currentTimeline.currentTime;const s=e.options&&e.options.delay?Ff(e.options.delay):0;e.steps.forEach(a=>{const u=t.createSubContext(e.options);s&&u.delayNextStep(s),au(this,a,u),r=Math.max(r,u.currentTimeline.currentTime),i.push(u.currentTimeline)}),i.forEach(a=>t.currentTimeline.mergeTimelineCollectedStyles(a)),t.transformIntoNewTimeline(r),t.previousNode=e}_visitTiming(e,t){if(e.dynamic){const i=e.strValue;return uw(t.params?h0(i,t.params,t.errors):i,t.errors)}return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,t){const i=t.currentAnimateTimings=this._visitTiming(e.timings,t),r=t.currentTimeline;i.delay&&(t.incrementTime(i.delay),r.snapshotCurrentStyles());const s=e.style;5==s.type?this.visitKeyframes(s,t):(t.incrementTime(i.duration),this.visitStyle(s,t),r.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}visitStyle(e,t){const i=t.currentTimeline,r=t.currentAnimateTimings;!r&&i.hasCurrentStyleProperties()&&i.forwardFrame();const s=r&&r.easing||e.easing;e.isEmptyStep?i.applyEmptyStep(s):i.setStyles(e.styles,s,t.errors,t.options),t.previousNode=e}visitKeyframes(e,t){const i=t.currentAnimateTimings,r=t.currentTimeline.duration,s=i.duration,u=t.createSubContext().currentTimeline;u.easing=i.easing,e.styles.forEach(f=>{u.forwardTime((f.offset||0)*s),u.setStyles(f.styles,f.easing,t.errors,t.options),u.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(u),t.transformIntoNewTimeline(r+s),t.previousNode=e}visitQuery(e,t){const i=t.currentTimeline.currentTime,r=e.options||{},s=r.delay?Ff(r.delay):0;s&&(6===t.previousNode.type||0==i&&t.currentTimeline.hasCurrentStyleProperties())&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=yw);let a=i;const u=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!r.optional,t.errors);t.currentQueryTotal=u.length;let f=null;u.forEach((g,E)=>{t.currentQueryIndex=E;const M=t.createSubContext(e.options,g);s&&M.delayNextStep(s),g===t.element&&(f=M.currentTimeline),au(this,e.animation,M),M.currentTimeline.applyStylesToKeyframe(),a=Math.max(a,M.currentTimeline.currentTime)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(a),f&&(t.currentTimeline.mergeTimelineCollectedStyles(f),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}visitStagger(e,t){const i=t.parentContext,r=t.currentTimeline,s=e.timings,a=Math.abs(s.duration),u=a*(t.currentQueryTotal-1);let f=a*t.currentQueryIndex;switch(s.duration<0?"reverse":s.easing){case"reverse":f=u-f;break;case"full":f=i.currentStaggerTime}const E=t.currentTimeline;f&&E.delayNextStep(f);const M=E.currentTime;au(this,e.animation,t),t.previousNode=e,i.currentStaggerTime=r.currentTime-M+(r.startTime-i.currentTimeline.startTime)}}const yw={};class dM{constructor(e,t,i,r,s,a,u,f){this._driver=e,this.element=t,this.subInstructions=i,this._enterClassName=r,this._leaveClassName=s,this.errors=a,this.timelines=u,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=yw,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=f||new vw(this._driver,t,0),u.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,t){if(!e)return;const i=e;let r=this.options;null!=i.duration&&(r.duration=Ff(i.duration)),null!=i.delay&&(r.delay=Ff(i.delay));const s=i.params;if(s){let a=r.params;a||(a=this.options.params={}),Object.keys(s).forEach(u=>{(!t||!a.hasOwnProperty(u))&&(a[u]=h0(s[u],a,this.errors))})}}_copyOptions(){const e={};if(this.options){const t=this.options.params;if(t){const i=e.params={};Object.keys(t).forEach(r=>{i[r]=t[r]})}}return e}createSubContext(e=null,t,i){const r=t||this.element,s=new dM(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,i||0));return s.previousNode=this.previousNode,s.currentAnimateTimings=this.currentAnimateTimings,s.options=this._copyOptions(),s.updateOptions(e),s.currentQueryIndex=this.currentQueryIndex,s.currentQueryTotal=this.currentQueryTotal,s.parentContext=this,this.subContextCount++,s}transformIntoNewTimeline(e){return this.previousNode=yw,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,t,i){const r={duration:t??e.duration,delay:this.currentTimeline.currentTime+(i??0)+e.delay,easing:""},s=new Zne(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,r,e.stretchStartingKeyframe);return this.timelines.push(s),r}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,t,i,r,s,a){let u=[];if(r&&u.push(this.element),e.length>0){e=(e=e.replace(Gne,"."+this._enterClassName)).replace($ne,"."+this._leaveClassName);let g=this._driver.query(this.element,e,1!=i);0!==i&&(g=i<0?g.slice(g.length+i,g.length):g.slice(0,i)),u.push(...g)}return!s&&0==u.length&&a.push(function Jte(n){return new st(3014,!1)}()),u}}class vw{constructor(e,t,i,r){this._driver=e,this.element=t,this.startTime=i,this._elementTimelineStylesLookup=r,this.duration=0,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(e){const t=1===this._keyframes.size&&this._pendingStyles.size;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,t){return this.applyStylesToKeyframe(),new vw(this._driver,e,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,t){this._localTimelineStyles.set(e,t),this._globalTimelineStyles.set(e,t),this._styleSummary.set(e,{time:this.currentTime,value:t})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&this._previousKeyframe.set("easing",e);for(let[t,i]of this._globalTimelineStyles)this._backFill.set(t,i||Sf),this._currentKeyframe.set(t,Sf);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,t,i,r){t&&this._previousKeyframe.set("easing",t);const s=r&&r.params||{},a=function Xne(n,e){const t=new Map;let i;return n.forEach(r=>{if("*"===r){i=i||e.keys();for(let s of i)t.set(s,Sf)}else Up(r,t)}),t}(e,this._globalTimelineStyles);for(let[u,f]of a){const g=h0(f,s,i);this._pendingStyles.set(u,g),this._localTimelineStyles.has(u)||this._backFill.set(u,this._globalTimelineStyles.get(u)??Sf),this._updateStyle(u,g)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((e,t)=>{this._currentKeyframe.set(t,e)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((e,t)=>{this._currentKeyframe.has(t)||this._currentKeyframe.set(t,e)}))}snapshotCurrentStyles(){for(let[e,t]of this._localTimelineStyles)this._pendingStyles.set(e,t),this._updateStyle(e,t)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const e=[];for(let t in this._currentKeyframe)e.push(t);return e}mergeTimelineCollectedStyles(e){e._styleSummary.forEach((t,i)=>{const r=this._styleSummary.get(i);(!r||t.time>r.time)&&this._updateStyle(i,t.value)})}buildKeyframes(){this.applyStylesToKeyframe();const e=new Set,t=new Set,i=1===this._keyframes.size&&0===this.duration;let r=[];this._keyframes.forEach((u,f)=>{const g=Up(u,new Map,this._backFill);g.forEach((E,M)=>{"!"===E?e.add(M):E===Sf&&t.add(M)}),i||g.set("offset",f/this.duration),r.push(g)});const s=e.size?hw(e.values()):[],a=t.size?hw(t.values()):[];if(i){const u=r[0],f=new Map(u);u.set("offset",0),f.set("offset",1),r=[u,f]}return uM(this.element,r,s,a,this.duration,this.startTime,this.easing,!1)}}class Zne extends vw{constructor(e,t,i,r,s,a,u=!1){super(e,t,a.delay),this.keyframes=i,this.preStyleProps=r,this.postStyleProps=s,this._stretchStartingKeyframe=u,this.timings={duration:a.duration,delay:a.delay,easing:a.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:t,duration:i,easing:r}=this.timings;if(this._stretchStartingKeyframe&&t){const s=[],a=i+t,u=t/a,f=Up(e[0]);f.set("offset",0),s.push(f);const g=Up(e[0]);g.set("offset",o3(u)),s.push(g);const E=e.length-1;for(let M=1;M<=E;M++){let R=Up(e[M]);const F=R.get("offset");R.set("offset",o3((t+F*i)/a)),s.push(R)}i=a,t=0,r="",e=s}return uM(this.element,e,this.preStyleProps,this.postStyleProps,i,t,r,!0)}}function o3(n,e=3){const t=Math.pow(10,e-1);return Math.round(n*t)/t}class fM{}const Yne=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class Kne extends fM{normalizePropertyName(e,t){return aM(e)}normalizeStyleValue(e,t,i,r){let s="";const a=i.toString().trim();if(Yne.has(t)&&0!==i&&"0"!==i)if("number"==typeof i)s="px";else{const u=i.match(/^[+-]?[\d\.]+([a-z]*)$/);u&&0==u[1].length&&r.push(function Ute(n,e){return new st(3005,!1)}())}return a+s}}function a3(n,e,t,i,r,s,a,u,f,g,E,M,R){return{type:0,element:n,triggerName:e,isRemovalTransition:r,fromState:t,fromStyles:s,toState:i,toStyles:a,timelines:u,queriedElements:f,preStyleProps:g,postStyleProps:E,totalTime:M,errors:R}}const pM={};class l3{constructor(e,t,i){this._triggerName=e,this.ast=t,this._stateStyles=i}match(e,t,i,r){return function Jne(n,e,t,i,r){return n.some(s=>s(e,t,i,r))}(this.ast.matchers,e,t,i,r)}buildStyles(e,t,i){let r=this._stateStyles.get("*");return void 0!==e&&(r=this._stateStyles.get(e?.toString())||r),r?r.buildStyles(t,i):new Map}build(e,t,i,r,s,a,u,f,g,E){const M=[],R=this.ast.options&&this.ast.options.params||pM,V=this.buildStyles(i,u&&u.params||pM,M),G=f&&f.params||pM,K=this.buildStyles(r,G,M),se=new Set,_e=new Map,de=new Map,Ie="void"===r,qe={params:Qne(G,R),delay:this.ast.options?.delay},Qe=E?[]:hM(e,t,this.ast.animation,s,a,V,K,qe,g,M);let Ct=0;if(Qe.forEach(Ft=>{Ct=Math.max(Ft.duration+Ft.delay,Ct)}),M.length)return a3(t,this._triggerName,i,r,Ie,V,K,[],[],_e,de,Ct,M);Qe.forEach(Ft=>{const Ut=Ft.element,mn=ou(_e,Ut,new Set);Ft.preStyleProps.forEach(gn=>mn.add(gn));const Rn=ou(de,Ut,new Set);Ft.postStyleProps.forEach(gn=>Rn.add(gn)),Ut!==t&&se.add(Ut)});const Xt=hw(se.values());return a3(t,this._triggerName,i,r,Ie,V,K,Qe,Xt,_e,de,Ct)}}function Qne(n,e){const t=c0(e);for(const i in n)n.hasOwnProperty(i)&&null!=n[i]&&(t[i]=n[i]);return t}class eie{constructor(e,t,i){this.styles=e,this.defaultParams=t,this.normalizer=i}buildStyles(e,t){const i=new Map,r=c0(this.defaultParams);return Object.keys(e).forEach(s=>{const a=e[s];null!==a&&(r[s]=a)}),this.styles.styles.forEach(s=>{"string"!=typeof s&&s.forEach((a,u)=>{a&&(a=h0(a,r,t));const f=this.normalizer.normalizePropertyName(u,t);a=this.normalizer.normalizeStyleValue(u,f,a,t),i.set(f,a)})}),i}}class nie{constructor(e,t,i){this.name=e,this.ast=t,this._normalizer=i,this.transitionFactories=[],this.states=new Map,t.states.forEach(r=>{this.states.set(r.name,new eie(r.style,r.options&&r.options.params||{},i))}),c3(this.states,"true","1"),c3(this.states,"false","0"),t.transitions.forEach(r=>{this.transitionFactories.push(new l3(e,r,this.states))}),this.fallbackTransition=function iie(n,e,t){return new l3(n,{type:1,animation:{type:2,steps:[],options:null},matchers:[(a,u)=>!0],options:null,queryCount:0,depCount:0},e)}(e,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,t,i,r){return this.transitionFactories.find(a=>a.match(e,t,i,r))||null}matchStyles(e,t,i){return this.fallbackTransition.buildStyles(e,t,i)}}function c3(n,e,t){n.has(e)?n.has(t)||n.set(t,n.get(e)):n.has(t)&&n.set(e,n.get(t))}const rie=new _w;class sie{constructor(e,t,i){this.bodyNode=e,this._driver=t,this._normalizer=i,this._animations=new Map,this._playersById=new Map,this.players=[]}register(e,t){const i=[],s=lM(this._driver,t,i,[]);if(i.length)throw function sne(n){return new st(3503,!1)}();this._animations.set(e,s)}_buildPlayer(e,t,i){const r=e.element,s=VN(0,this._normalizer,0,e.keyframes,t,i);return this._driver.animate(r,s,e.duration,e.delay,e.easing,[],!0)}create(e,t,i={}){const r=[],s=this._animations.get(e);let a;const u=new Map;if(s?(a=hM(this._driver,t,s,iM,aw,new Map,new Map,i,rie,r),a.forEach(E=>{const M=ou(u,E.element,new Map);E.postStyleProps.forEach(R=>M.set(R,null))})):(r.push(function one(){return new st(3300,!1)}()),a=[]),r.length)throw function ane(n){return new st(3504,!1)}();u.forEach((E,M)=>{E.forEach((R,F)=>{E.set(F,this._driver.computeStyle(M,F,Sf))})});const g=Vp(a.map(E=>{const M=u.get(E.element);return this._buildPlayer(E,new Map,M)}));return this._playersById.set(e,g),g.onDestroy(()=>this.destroy(e)),this.players.push(g),g}destroy(e){const t=this._getPlayer(e);t.destroy(),this._playersById.delete(e);const i=this.players.indexOf(t);i>=0&&this.players.splice(i,1)}_getPlayer(e){const t=this._playersById.get(e);if(!t)throw function lne(n){return new st(3301,!1)}();return t}listen(e,t,i,r){const s=QS(t,"","","");return KS(this._getPlayer(e),i,s,r),()=>{}}command(e,t,i,r){if("register"==i)return void this.register(e,r[0]);if("create"==i)return void this.create(e,t,r[0]||{});const s=this._getPlayer(e);switch(i){case"play":s.play();break;case"pause":s.pause();break;case"reset":s.reset();break;case"restart":s.restart();break;case"finish":s.finish();break;case"init":s.init();break;case"setPosition":s.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(e)}}}const u3="ng-animate-queued",mM="ng-animate-disabled",uie=[],h3={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},hie={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Fu="__ng_removed";class gM{constructor(e,t=""){this.namespaceId=t;const i=e&&e.hasOwnProperty("value");if(this.value=function mie(n){return n??null}(i?e.value:e),i){const s=c0(e);delete s.value,this.options=s}else this.options={};this.options.params||(this.options.params={})}get params(){return this.options.params}absorbOptions(e){const t=e.params;if(t){const i=this.options.params;Object.keys(t).forEach(r=>{null==i[r]&&(i[r]=t[r])})}}}const d0="void",_M=new gM(d0);class die{constructor(e,t,i){this.id=e,this.hostElement=t,this._engine=i,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+e,Nu(t,this._hostClassName)}listen(e,t,i,r){if(!this._triggers.has(t))throw function cne(n,e){return new st(3302,!1)}();if(null==i||0==i.length)throw function une(n){return new st(3303,!1)}();if(!function gie(n){return"start"==n||"done"==n}(i))throw function hne(n,e){return new st(3400,!1)}();const s=ou(this._elementListeners,e,[]),a={name:t,phase:i,callback:r};s.push(a);const u=ou(this._engine.statesByElement,e,new Map);return u.has(t)||(Nu(e,lw),Nu(e,lw+"-"+t),u.set(t,_M)),()=>{this._engine.afterFlush(()=>{const f=s.indexOf(a);f>=0&&s.splice(f,1),this._triggers.has(t)||u.delete(t)})}}register(e,t){return!this._triggers.has(e)&&(this._triggers.set(e,t),!0)}_getTrigger(e){const t=this._triggers.get(e);if(!t)throw function dne(n){return new st(3401,!1)}();return t}trigger(e,t,i,r=!0){const s=this._getTrigger(t),a=new yM(this.id,t,e);let u=this._engine.statesByElement.get(e);u||(Nu(e,lw),Nu(e,lw+"-"+t),this._engine.statesByElement.set(e,u=new Map));let f=u.get(t);const g=new gM(i,this.id);if(!(i&&i.hasOwnProperty("value"))&&f&&g.absorbOptions(f.options),u.set(t,g),f||(f=_M),g.value!==d0&&f.value===g.value){if(!function vie(n,e){const t=Object.keys(n),i=Object.keys(e);if(t.length!=i.length)return!1;for(let r=0;r<t.length;r++){const s=t[r];if(!e.hasOwnProperty(s)||n[s]!==e[s])return!1}return!0}(f.params,g.params)){const G=[],K=s.matchStyles(f.value,f.params,G),se=s.matchStyles(g.value,g.params,G);G.length?this._engine.reportError(G):this._engine.afterFlush(()=>{lg(e,K),Dd(e,se)})}return}const R=ou(this._engine.playersByElement,e,[]);R.forEach(G=>{G.namespaceId==this.id&&G.triggerName==t&&G.queued&&G.destroy()});let F=s.matchTransition(f.value,g.value,e,g.params),V=!1;if(!F){if(!r)return;F=s.fallbackTransition,V=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:F,fromState:f,toState:g,player:a,isFallbackTransition:V}),V||(Nu(e,u3),a.onStart(()=>{Q_(e,u3)})),a.onDone(()=>{let G=this.players.indexOf(a);G>=0&&this.players.splice(G,1);const K=this._engine.playersByElement.get(e);if(K){let se=K.indexOf(a);se>=0&&K.splice(se,1)}}),this.players.push(a),R.push(a),a}deregister(e){this._triggers.delete(e),this._engine.statesByElement.forEach(t=>t.delete(e)),this._elementListeners.forEach((t,i)=>{this._elementListeners.set(i,t.filter(r=>r.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);const t=this._engine.playersByElement.get(e);t&&(t.forEach(i=>i.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,t){const i=this._engine.driver.query(e,cw,!0);i.forEach(r=>{if(r[Fu])return;const s=this._engine.fetchNamespacesByElement(r);s.size?s.forEach(a=>a.triggerLeaveAnimation(r,t,!1,!0)):this.clearElementCache(r)}),this._engine.afterFlushAnimationsDone(()=>i.forEach(r=>this.clearElementCache(r)))}triggerLeaveAnimation(e,t,i,r){const s=this._engine.statesByElement.get(e),a=new Map;if(s){const u=[];if(s.forEach((f,g)=>{if(a.set(g,f.value),this._triggers.has(g)){const E=this.trigger(e,g,d0,r);E&&u.push(E)}}),u.length)return this._engine.markElementAsRemoved(this.id,e,!0,t,a),i&&Vp(u).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){const t=this._elementListeners.get(e),i=this._engine.statesByElement.get(e);if(t&&i){const r=new Set;t.forEach(s=>{const a=s.name;if(r.has(a))return;r.add(a);const f=this._triggers.get(a).fallbackTransition,g=i.get(a)||_M,E=new gM(d0),M=new yM(this.id,a,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:a,transition:f,fromState:g,toState:E,player:M,isFallbackTransition:!0})})}}removeNode(e,t){const i=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),this.triggerLeaveAnimation(e,t,!0))return;let r=!1;if(i.totalAnimations){const s=i.players.length?i.playersByQueriedElement.get(e):[];if(s&&s.length)r=!0;else{let a=e;for(;a=a.parentNode;)if(i.statesByElement.get(a)){r=!0;break}}}if(this.prepareLeaveAnimationListeners(e),r)i.markElementAsRemoved(this.id,e,!1,t);else{const s=e[Fu];(!s||s===h3)&&(i.afterFlush(()=>this.clearElementCache(e)),i.destroyInnerAnimations(e),i._onRemovalComplete(e,t))}}insertNode(e,t){Nu(e,this._hostClassName)}drainQueuedTransitions(e){const t=[];return this._queue.forEach(i=>{const r=i.player;if(r.destroyed)return;const s=i.element,a=this._elementListeners.get(s);a&&a.forEach(u=>{if(u.name==i.triggerName){const f=QS(s,i.triggerName,i.fromState.value,i.toState.value);f._data=e,KS(i.player,u.phase,f,u.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):t.push(i)}),this._queue=[],t.sort((i,r)=>{const s=i.transition.ast.depCount,a=r.transition.ast.depCount;return 0==s||0==a?s-a:this._engine.driver.containsElement(i.element,r.element)?1:-1})}destroy(e){this.players.forEach(t=>t.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}elementContainsData(e){let t=!1;return this._elementListeners.has(e)&&(t=!0),t=!!this._queue.find(i=>i.element===e)||t,t}}class fie{constructor(e,t,i){this.bodyNode=e,this.driver=t,this._normalizer=i,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(r,s)=>{}}_onRemovalComplete(e,t){this.onRemovalComplete(e,t)}get queuedPlayers(){const e=[];return this._namespaceList.forEach(t=>{t.players.forEach(i=>{i.queued&&e.push(i)})}),e}createNamespace(e,t){const i=new die(e,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(i,t):(this.newHostElements.set(t,i),this.collectEnterElement(t)),this._namespaceLookup[e]=i}_balanceNamespaceList(e,t){const i=this._namespaceList,r=this.namespacesByHostElement;if(i.length-1>=0){let a=!1,u=this.driver.getParentElement(t);for(;u;){const f=r.get(u);if(f){const g=i.indexOf(f);i.splice(g+1,0,e),a=!0;break}u=this.driver.getParentElement(u)}a||i.unshift(e)}else i.push(e);return r.set(t,e),e}register(e,t){let i=this._namespaceLookup[e];return i||(i=this.createNamespace(e,t)),i}registerTrigger(e,t,i){let r=this._namespaceLookup[e];r&&r.register(t,i)&&this.totalAnimations++}destroy(e,t){if(!e)return;const i=this._fetchNamespace(e);this.afterFlush(()=>{this.namespacesByHostElement.delete(i.hostElement),delete this._namespaceLookup[e];const r=this._namespaceList.indexOf(i);r>=0&&this._namespaceList.splice(r,1)}),this.afterFlushAnimationsDone(()=>i.destroy(t))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){const t=new Set,i=this.statesByElement.get(e);if(i)for(let r of i.values())if(r.namespaceId){const s=this._fetchNamespace(r.namespaceId);s&&t.add(s)}return t}trigger(e,t,i,r){if(bw(t)){const s=this._fetchNamespace(e);if(s)return s.trigger(t,i,r),!0}return!1}insertNode(e,t,i,r){if(!bw(t))return;const s=t[Fu];if(s&&s.setForRemoval){s.setForRemoval=!1,s.setForMove=!0;const a=this.collectedLeaveElements.indexOf(t);a>=0&&this.collectedLeaveElements.splice(a,1)}if(e){const a=this._fetchNamespace(e);a&&a.insertNode(t,i)}r&&this.collectEnterElement(t)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),Nu(e,mM)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),Q_(e,mM))}removeNode(e,t,i,r){if(bw(t)){const s=e?this._fetchNamespace(e):null;if(s?s.removeNode(t,r):this.markElementAsRemoved(e,t,!1,r),i){const a=this.namespacesByHostElement.get(t);a&&a.id!==e&&a.removeNode(t,r)}}else this._onRemovalComplete(t,r)}markElementAsRemoved(e,t,i,r,s){this.collectedLeaveElements.push(t),t[Fu]={namespaceId:e,setForRemoval:r,hasAnimation:i,removedBeforeQueried:!1,previousTriggersValues:s}}listen(e,t,i,r,s){return bw(t)?this._fetchNamespace(e).listen(t,i,r,s):()=>{}}_buildInstruction(e,t,i,r,s){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,i,r,e.fromState.options,e.toState.options,t,s)}destroyInnerAnimations(e){let t=this.driver.query(e,cw,!0);t.forEach(i=>this.destroyActiveAnimationsForElement(i)),0!=this.playersByQueriedElement.size&&(t=this.driver.query(e,rM,!0),t.forEach(i=>this.finishActiveQueriedAnimationOnElement(i)))}destroyActiveAnimationsForElement(e){const t=this.playersByElement.get(e);t&&t.forEach(i=>{i.queued?i.markedForDestroy=!0:i.destroy()})}finishActiveQueriedAnimationOnElement(e){const t=this.playersByQueriedElement.get(e);t&&t.forEach(i=>i.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return Vp(this.players).onDone(()=>e());e()})}processLeaveNode(e){const t=e[Fu];if(t&&t.setForRemoval){if(e[Fu]=h3,t.namespaceId){this.destroyInnerAnimations(e);const i=this._fetchNamespace(t.namespaceId);i&&i.clearElementCache(e)}this._onRemovalComplete(e,t.setForRemoval)}e.classList?.contains(mM)&&this.markElementAsDisabled(e,!1),this.driver.query(e,".ng-animate-disabled",!0).forEach(i=>{this.markElementAsDisabled(i,!1)})}flush(e=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((i,r)=>this._balanceNamespaceList(i,r)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let i=0;i<this.collectedEnterElements.length;i++)Nu(this.collectedEnterElements[i],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const i=[];try{t=this._flushAnimations(i,e)}finally{for(let r=0;r<i.length;r++)i[r]()}}else for(let i=0;i<this.collectedLeaveElements.length;i++)this.processLeaveNode(this.collectedLeaveElements[i]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(i=>i()),this._flushFns=[],this._whenQuietFns.length){const i=this._whenQuietFns;this._whenQuietFns=[],t.length?Vp(t).onDone(()=>{i.forEach(r=>r())}):i.forEach(r=>r())}}reportError(e){throw function fne(n){return new st(3402,!1)}()}_flushAnimations(e,t){const i=new _w,r=[],s=new Map,a=[],u=new Map,f=new Map,g=new Map,E=new Set;this.disabledNodes.forEach(zt=>{E.add(zt);const ln=this.driver.query(zt,".ng-animate-queued",!0);for(let Sn=0;Sn<ln.length;Sn++)E.add(ln[Sn])});const M=this.bodyNode,R=Array.from(this.statesByElement.keys()),F=p3(R,this.collectedEnterElements),V=new Map;let G=0;F.forEach((zt,ln)=>{const Sn=iM+G++;V.set(ln,Sn),zt.forEach(Gi=>Nu(Gi,Sn))});const K=[],se=new Set,_e=new Set;for(let zt=0;zt<this.collectedLeaveElements.length;zt++){const ln=this.collectedLeaveElements[zt],Sn=ln[Fu];Sn&&Sn.setForRemoval&&(K.push(ln),se.add(ln),Sn.hasAnimation?this.driver.query(ln,".ng-star-inserted",!0).forEach(Gi=>se.add(Gi)):_e.add(ln))}const de=new Map,Ie=p3(R,Array.from(se));Ie.forEach((zt,ln)=>{const Sn=aw+G++;de.set(ln,Sn),zt.forEach(Gi=>Nu(Gi,Sn))}),e.push(()=>{F.forEach((zt,ln)=>{const Sn=V.get(ln);zt.forEach(Gi=>Q_(Gi,Sn))}),Ie.forEach((zt,ln)=>{const Sn=de.get(ln);zt.forEach(Gi=>Q_(Gi,Sn))}),K.forEach(zt=>{this.processLeaveNode(zt)})});const qe=[],Qe=[];for(let zt=this._namespaceList.length-1;zt>=0;zt--)this._namespaceList[zt].drainQueuedTransitions(t).forEach(Sn=>{const Gi=Sn.player,Sa=Sn.element;if(qe.push(Gi),this.collectedEnterElements.length){const Tl=Sa[Fu];if(Tl&&Tl.setForMove){if(Tl.previousTriggersValues&&Tl.previousTriggersValues.has(Sn.triggerName)){const ug=Tl.previousTriggersValues.get(Sn.triggerName),Bu=this.statesByElement.get(Sn.element);if(Bu&&Bu.has(Sn.triggerName)){const Ew=Bu.get(Sn.triggerName);Ew.value=ug,Bu.set(Sn.triggerName,Ew)}}return void Gi.destroy()}}const Id=!M||!this.driver.containsElement(M,Sa),lu=de.get(Sa),jp=V.get(Sa),Hs=this._buildInstruction(Sn,i,jp,lu,Id);if(Hs.errors&&Hs.errors.length)return void Qe.push(Hs);if(Id)return Gi.onStart(()=>lg(Sa,Hs.fromStyles)),Gi.onDestroy(()=>Dd(Sa,Hs.toStyles)),void r.push(Gi);if(Sn.isFallbackTransition)return Gi.onStart(()=>lg(Sa,Hs.fromStyles)),Gi.onDestroy(()=>Dd(Sa,Hs.toStyles)),void r.push(Gi);const E3=[];Hs.timelines.forEach(Tl=>{Tl.stretchStartingKeyframe=!0,this.disabledNodes.has(Tl.element)||E3.push(Tl)}),Hs.timelines=E3,i.append(Sa,Hs.timelines),a.push({instruction:Hs,player:Gi,element:Sa}),Hs.queriedElements.forEach(Tl=>ou(u,Tl,[]).push(Gi)),Hs.preStyleProps.forEach((Tl,ug)=>{if(Tl.size){let Bu=f.get(ug);Bu||f.set(ug,Bu=new Set),Tl.forEach((Ew,xM)=>Bu.add(xM))}}),Hs.postStyleProps.forEach((Tl,ug)=>{let Bu=g.get(ug);Bu||g.set(ug,Bu=new Set),Tl.forEach((Ew,xM)=>Bu.add(xM))})});if(Qe.length){const zt=[];Qe.forEach(ln=>{zt.push(function pne(n,e){return new st(3505,!1)}())}),qe.forEach(ln=>ln.destroy()),this.reportError(zt)}const Ct=new Map,Xt=new Map;a.forEach(zt=>{const ln=zt.element;i.has(ln)&&(Xt.set(ln,ln),this._beforeAnimationBuild(zt.player.namespaceId,zt.instruction,Ct))}),r.forEach(zt=>{const ln=zt.element;this._getPreviousPlayers(ln,!1,zt.namespaceId,zt.triggerName,null).forEach(Gi=>{ou(Ct,ln,[]).push(Gi),Gi.destroy()})});const Ft=K.filter(zt=>g3(zt,f,g)),Ut=new Map;f3(Ut,this.driver,_e,g,Sf).forEach(zt=>{g3(zt,f,g)&&Ft.push(zt)});const Rn=new Map;F.forEach((zt,ln)=>{f3(Rn,this.driver,new Set(zt),f,"!")}),Ft.forEach(zt=>{const ln=Ut.get(zt),Sn=Rn.get(zt);Ut.set(zt,new Map([...Array.from(ln?.entries()??[]),...Array.from(Sn?.entries()??[])]))});const gn=[],_i=[],Vo={};a.forEach(zt=>{const{element:ln,player:Sn,instruction:Gi}=zt;if(i.has(ln)){if(E.has(ln))return Sn.onDestroy(()=>Dd(ln,Gi.toStyles)),Sn.disabled=!0,Sn.overrideTotalTime(Gi.totalTime),void r.push(Sn);let Sa=Vo;if(Xt.size>1){let lu=ln;const jp=[];for(;lu=lu.parentNode;){const Hs=Xt.get(lu);if(Hs){Sa=Hs;break}jp.push(lu)}jp.forEach(Hs=>Xt.set(Hs,Sa))}const Id=this._buildAnimation(Sn.namespaceId,Gi,Ct,s,Rn,Ut);if(Sn.setRealPlayer(Id),Sa===Vo)gn.push(Sn);else{const lu=this.playersByElement.get(Sa);lu&&lu.length&&(Sn.parentPlayer=Vp(lu)),r.push(Sn)}}else lg(ln,Gi.fromStyles),Sn.onDestroy(()=>Dd(ln,Gi.toStyles)),_i.push(Sn),E.has(ln)&&r.push(Sn)}),_i.forEach(zt=>{const ln=s.get(zt.element);if(ln&&ln.length){const Sn=Vp(ln);zt.setRealPlayer(Sn)}}),r.forEach(zt=>{zt.parentPlayer?zt.syncPlayerEvents(zt.parentPlayer):zt.destroy()});for(let zt=0;zt<K.length;zt++){const ln=K[zt],Sn=ln[Fu];if(Q_(ln,aw),Sn&&Sn.hasAnimation)continue;let Gi=[];if(u.size){let Id=u.get(ln);Id&&Id.length&&Gi.push(...Id);let lu=this.driver.query(ln,rM,!0);for(let jp=0;jp<lu.length;jp++){let Hs=u.get(lu[jp]);Hs&&Hs.length&&Gi.push(...Hs)}}const Sa=Gi.filter(Id=>!Id.destroyed);Sa.length?_ie(this,ln,Sa):this.processLeaveNode(ln)}return K.length=0,gn.forEach(zt=>{this.players.push(zt),zt.onDone(()=>{zt.destroy();const ln=this.players.indexOf(zt);this.players.splice(ln,1)}),zt.play()}),gn}elementContainsData(e,t){let i=!1;const r=t[Fu];return r&&r.setForRemoval&&(i=!0),this.playersByElement.has(t)&&(i=!0),this.playersByQueriedElement.has(t)&&(i=!0),this.statesByElement.has(t)&&(i=!0),this._fetchNamespace(e).elementContainsData(t)||i}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,t,i,r,s){let a=[];if(t){const u=this.playersByQueriedElement.get(e);u&&(a=u)}else{const u=this.playersByElement.get(e);if(u){const f=!s||s==d0;u.forEach(g=>{g.queued||!f&&g.triggerName!=r||a.push(g)})}}return(i||r)&&(a=a.filter(u=>!(i&&i!=u.namespaceId||r&&r!=u.triggerName))),a}_beforeAnimationBuild(e,t,i){const s=t.element,a=t.isRemovalTransition?void 0:e,u=t.isRemovalTransition?void 0:t.triggerName;for(const f of t.timelines){const g=f.element,E=g!==s,M=ou(i,g,[]);this._getPreviousPlayers(g,E,a,u,t.toState).forEach(F=>{const V=F.getRealPlayer();V.beforeDestroy&&V.beforeDestroy(),F.destroy(),M.push(F)})}lg(s,t.fromStyles)}_buildAnimation(e,t,i,r,s,a){const u=t.triggerName,f=t.element,g=[],E=new Set,M=new Set,R=t.timelines.map(V=>{const G=V.element;E.add(G);const K=G[Fu];if(K&&K.removedBeforeQueried)return new Tv(V.duration,V.delay);const se=G!==f,_e=function yie(n){const e=[];return m3(n,e),e}((i.get(G)||uie).map(Ct=>Ct.getRealPlayer())).filter(Ct=>!!Ct.element&&Ct.element===G),de=s.get(G),Ie=a.get(G),qe=VN(0,this._normalizer,0,V.keyframes,de,Ie),Qe=this._buildPlayer(V,qe,_e);if(V.subTimeline&&r&&M.add(G),se){const Ct=new yM(e,u,G);Ct.setRealPlayer(Qe),g.push(Ct)}return Qe});g.forEach(V=>{ou(this.playersByQueriedElement,V.element,[]).push(V),V.onDone(()=>function pie(n,e,t){let i=n.get(e);if(i){if(i.length){const r=i.indexOf(t);i.splice(r,1)}0==i.length&&n.delete(e)}return i}(this.playersByQueriedElement,V.element,V))}),E.forEach(V=>Nu(V,XN));const F=Vp(R);return F.onDestroy(()=>{E.forEach(V=>Q_(V,XN)),Dd(f,t.toStyles)}),M.forEach(V=>{ou(r,V,[]).push(F)}),F}_buildPlayer(e,t,i){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,i):new Tv(e.duration,e.delay)}}class yM{constructor(e,t,i){this.namespaceId=e,this.triggerName=t,this.element=i,this._player=new Tv,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(e){this._containsRealPlayer||(this._player=e,this._queuedCallbacks.forEach((t,i)=>{t.forEach(r=>KS(e,i,void 0,r))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){const t=this._player;t.triggerCallback&&e.onStart(()=>t.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,t){ou(this._queuedCallbacks,e,[]).push(t)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){const t=this._player;t.triggerCallback&&t.triggerCallback(e)}}function bw(n){return n&&1===n.nodeType}function d3(n,e){const t=n.style.display;return n.style.display=e??"none",t}function f3(n,e,t,i,r){const s=[];t.forEach(f=>s.push(d3(f)));const a=[];i.forEach((f,g)=>{const E=new Map;f.forEach(M=>{const R=e.computeStyle(g,M,r);E.set(M,R),(!R||0==R.length)&&(g[Fu]=hie,a.push(g))}),n.set(g,E)});let u=0;return t.forEach(f=>d3(f,s[u++])),a}function p3(n,e){const t=new Map;if(n.forEach(u=>t.set(u,[])),0==e.length)return t;const r=new Set(e),s=new Map;function a(u){if(!u)return 1;let f=s.get(u);if(f)return f;const g=u.parentNode;return f=t.has(g)?g:r.has(g)?1:a(g),s.set(u,f),f}return e.forEach(u=>{const f=a(u);1!==f&&t.get(f).push(u)}),t}function Nu(n,e){n.classList?.add(e)}function Q_(n,e){n.classList?.remove(e)}function _ie(n,e,t){Vp(t).onDone(()=>n.processLeaveNode(e))}function m3(n,e){for(let t=0;t<n.length;t++){const i=n[t];i instanceof aR?m3(i.players,e):e.push(i)}}function g3(n,e,t){const i=t.get(n);if(!i)return!1;let r=e.get(n);return r?i.forEach(s=>r.add(s)):e.set(n,i),t.delete(n),!0}class xw{constructor(e,t,i){this.bodyNode=e,this._driver=t,this._normalizer=i,this._triggerCache={},this.onRemovalComplete=(r,s)=>{},this._transitionEngine=new fie(e,t,i),this._timelineEngine=new sie(e,t,i),this._transitionEngine.onRemovalComplete=(r,s)=>this.onRemovalComplete(r,s)}registerTrigger(e,t,i,r,s){const a=e+"-"+r;let u=this._triggerCache[a];if(!u){const f=[],E=lM(this._driver,s,f,[]);if(f.length)throw function ine(n,e){return new st(3404,!1)}();u=function tie(n,e,t){return new nie(n,e,t)}(r,E,this._normalizer),this._triggerCache[a]=u}this._transitionEngine.registerTrigger(t,r,u)}register(e,t){this._transitionEngine.register(e,t)}destroy(e,t){this._transitionEngine.destroy(e,t)}onInsert(e,t,i,r){this._transitionEngine.insertNode(e,t,i,r)}onRemove(e,t,i,r){this._transitionEngine.removeNode(e,t,r||!1,i)}disableAnimations(e,t){this._transitionEngine.markElementAsDisabled(e,t)}process(e,t,i,r){if("@"==i.charAt(0)){const[s,a]=UN(i);this._timelineEngine.command(s,t,a,r)}else this._transitionEngine.trigger(e,t,i,r)}listen(e,t,i,r,s){if("@"==i.charAt(0)){const[a,u]=UN(i);return this._timelineEngine.listen(a,t,u,s)}return this._transitionEngine.listen(e,t,i,r,s)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}let xie=(()=>{class n{constructor(t,i,r){this._element=t,this._startStyles=i,this._endStyles=r,this._state=0;let s=n.initialStylesByElement.get(t);s||n.initialStylesByElement.set(t,s=new Map),this._initialStyles=s}start(){this._state<1&&(this._startStyles&&Dd(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(Dd(this._element,this._initialStyles),this._endStyles&&(Dd(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(n.initialStylesByElement.delete(this._element),this._startStyles&&(lg(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(lg(this._element,this._endStyles),this._endStyles=null),Dd(this._element,this._initialStyles),this._state=3)}}return n.initialStylesByElement=new WeakMap,n})();function vM(n){let e=null;return n.forEach((t,i)=>{(function wie(n){return"display"===n||"position"===n})(i)&&(e=e||new Map,e.set(i,t))}),e}class _3{constructor(e,t,i,r){this.element=e,this.keyframes=t,this.options=i,this._specialStyles=r,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=i.duration,this._delay=i.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const e=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,e,this.options),this._finalKeyframe=e.length?e[e.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(e){const t=[];return e.forEach(i=>{t.push(Object.fromEntries(i))}),t}_triggerWebAnimation(e,t,i){return e.animate(this._convertKeyframesToObject(t),i)}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(e=>e()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=e*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const e=new Map;this.hasStarted()&&this._finalKeyframe.forEach((i,r)=>{"offset"!==r&&e.set(r,this._finished?i:t3(this.element,r))}),this.currentSnapshot=e}triggerCallback(e){const t="start"===e?this._onStartFns:this._onDoneFns;t.forEach(i=>i()),t.length=0}}class Eie{validateStyleProperty(e){return!0}validateAnimatableStyleProperty(e){return!0}matchesElement(e,t){return!1}containsElement(e,t){return WN(e,t)}getParentElement(e){return tM(e)}query(e,t,i){return $N(e,t,i)}computeStyle(e,t,i){return window.getComputedStyle(e)[t]}animate(e,t,i,r,s,a=[]){const f={duration:i,delay:r,fill:0==r?"both":"forwards"};s&&(f.easing=s);const g=new Map,E=a.filter(F=>F instanceof _3);(function Mne(n,e){return 0===n||0===e})(i,r)&&E.forEach(F=>{F.currentSnapshot.forEach((V,G)=>g.set(G,V))});let M=function Ene(n){return n.length?n[0]instanceof Map?n:n.map(e=>YN(e)):[]}(t).map(F=>Up(F));M=function Ane(n,e,t){if(t.size&&e.length){let i=e[0],r=[];if(t.forEach((s,a)=>{i.has(a)||r.push(a),i.set(a,s)}),r.length)for(let s=1;s<e.length;s++){let a=e[s];r.forEach(u=>a.set(u,t3(n,u)))}}return e}(e,M,g);const R=function bie(n,e){let t=null,i=null;return Array.isArray(e)&&e.length?(t=vM(e[0]),e.length>1&&(i=vM(e[e.length-1]))):e instanceof Map&&(t=vM(e)),t||i?new xie(n,t,i):null}(e,M);return new _3(e,M,f,R)}}let Tie=(()=>{class n extends tR{constructor(t,i){super(),this._nextAnimationId=0,this._renderer=t.createRenderer(i.body,{id:"0",encapsulation:da.None,styles:[],data:{animation:[]}})}build(t){const i=this._nextAnimationId.toString();this._nextAnimationId++;const r=Array.isArray(t)?iR(t):t;return y3(this._renderer,null,i,"register",[r]),new Cie(i,this._renderer)}}return n.\u0275fac=function(t){return new(t||n)(nt(rh),nt(ji))},n.\u0275prov=lt({token:n,factory:n.\u0275fac}),n})();class Cie extends class wG{}{constructor(e,t){super(),this._id=e,this._renderer=t}create(e,t){return new Sie(this._id,e,t||{},this._renderer)}}class Sie{constructor(e,t,i,r){this.id=e,this.element=t,this._renderer=r,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",i)}_listen(e,t){return this._renderer.listen(this.element,`@@${this.id}:${e}`,t)}_command(e,...t){return y3(this._renderer,this.element,this.id,e,t)}onDone(e){this._listen("done",e)}onStart(e){this._listen("start",e)}onDestroy(e){this._listen("destroy",e)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(e){this._command("setPosition",e)}getPosition(){return this._renderer.engine.players[+this.id]?.getPosition()??0}}function y3(n,e,t,i,r){return n.setProperty(e,`@@${t}:${i}`,r)}const v3="@.disabled";let Mie=(()=>{class n{constructor(t,i,r){this.delegate=t,this.engine=i,this._zone=r,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),i.onRemovalComplete=(s,a)=>{const u=a?.parentNode(s);u&&a.removeChild(u,s)}}createRenderer(t,i){const s=this.delegate.createRenderer(t,i);if(!(t&&i&&i.data&&i.data.animation)){let E=this._rendererCache.get(s);return E||(E=new b3("",s,this.engine),this._rendererCache.set(s,E)),E}const a=i.id,u=i.id+"-"+this._currentId;this._currentId++,this.engine.register(u,t);const f=E=>{Array.isArray(E)?E.forEach(f):this.engine.registerTrigger(a,u,t,E.name,E)};return i.data.animation.forEach(f),new Aie(this,u,s,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(t,i,r){t>=0&&t<this._microtaskId?this._zone.run(()=>i(r)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(s=>{const[a,u]=s;a(u)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([i,r]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return n.\u0275fac=function(t){return new(t||n)(nt(rh),nt(xw),nt(gr))},n.\u0275prov=lt({token:n,factory:n.\u0275fac}),n})();class b3{constructor(e,t,i){this.namespaceId=e,this.delegate=t,this.engine=i,this.destroyNode=this.delegate.destroyNode?r=>t.destroyNode(r):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}insertBefore(e,t,i,r=!0){this.delegate.insertBefore(e,t,i),this.engine.onInsert(this.namespaceId,t,e,r)}removeChild(e,t,i){this.engine.onRemove(this.namespaceId,t,this.delegate,i)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,i,r){this.delegate.setAttribute(e,t,i,r)}removeAttribute(e,t,i){this.delegate.removeAttribute(e,t,i)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,i,r){this.delegate.setStyle(e,t,i,r)}removeStyle(e,t,i){this.delegate.removeStyle(e,t,i)}setProperty(e,t,i){"@"==t.charAt(0)&&t==v3?this.disableAnimations(e,!!i):this.delegate.setProperty(e,t,i)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,i){return this.delegate.listen(e,t,i)}disableAnimations(e,t){this.engine.disableAnimations(e,t)}}class Aie extends b3{constructor(e,t,i,r){super(t,i,r),this.factory=e,this.namespaceId=t}setProperty(e,t,i){"@"==t.charAt(0)?"."==t.charAt(1)&&t==v3?this.disableAnimations(e,i=void 0===i||!!i):this.engine.process(this.namespaceId,e,t.slice(1),i):this.delegate.setProperty(e,t,i)}listen(e,t,i){if("@"==t.charAt(0)){const r=function Die(n){switch(n){case"body":return document.body;case"document":return document;case"window":return window;default:return n}}(e);let s=t.slice(1),a="";return"@"!=s.charAt(0)&&([s,a]=function Iie(n){const e=n.indexOf(".");return[n.substring(0,e),n.slice(e+1)]}(s)),this.engine.listen(this.namespaceId,r,s,a,u=>{this.factory.scheduleListenerCallback(u._data||-1,i,u)})}return this.delegate.listen(e,t,i)}}let Pie=(()=>{class n extends xw{constructor(t,i,r,s){super(t.body,i,r)}ngOnDestroy(){this.flush()}}return n.\u0275fac=function(t){return new(t||n)(nt(ji),nt(nM),nt(fM),nt(rv))},n.\u0275prov=lt({token:n,factory:n.\u0275fac}),n})();const x3=[{provide:tR,useClass:Tie},{provide:fM,useFactory:function kie(){return new Kne}},{provide:xw,useClass:Pie},{provide:rh,useFactory:function Rie(n,e,t){return new Mie(n,e,t)},deps:[Pb,xw,gr]}],bM=[{provide:nM,useFactory:()=>new Eie},{provide:_d,useValue:"BrowserAnimations"},...x3],w3=[{provide:nM,useClass:qN},{provide:_d,useValue:"NoopAnimations"},...x3];let Lie=(()=>{class n{static withConfig(t){return{ngModule:n,providers:t.disableAnimations?w3:bM}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=un({type:n}),n.\u0275inj=xr({providers:bM,imports:[OP]}),n})(),Oie=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=un({type:n,bootstrap:[Ote]}),n.\u0275inj=xr({imports:[OP,Lie,Lj,G8,Y8,K8,SH,JH,FG]}),n})();t6().bootstrapModule(Oie).catch(n=>console.error(n))},386:(Uo,_s,ns)=>{var Wn;!function(me,wc,w,Gt){"use strict";var xn,Fn=["","webkit","Moz","MS","ms","o"],yi=wc.createElement("div"),Ne=Math.round,wn=Math.abs,sn=Date.now;function vt(ee,oe,xe){return setTimeout(is(ee,xe),oe)}function Mn(ee,oe,xe){return!!Array.isArray(ee)&&(di(ee,xe[oe],xe),!0)}function di(ee,oe,xe){var Fe;if(ee)if(ee.forEach)ee.forEach(oe,xe);else if(ee.length!==Gt)for(Fe=0;Fe<ee.length;)oe.call(xe,ee[Fe],Fe,ee),Fe++;else for(Fe in ee)ee.hasOwnProperty(Fe)&&oe.call(xe,ee[Fe],Fe,ee)}function Jn(ee,oe,xe){var Fe="DEPRECATED METHOD: "+oe+"\n"+xe+" AT \n";return function(){var Je=new Error("get-stack-trace"),At=Je&&Je.stack?Je.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",qn=me.console&&(me.console.warn||me.console.log);return qn&&qn.call(me.console,Fe,At),ee.apply(this,arguments)}}xn="function"!=typeof Object.assign?function(oe){if(oe===Gt||null===oe)throw new TypeError("Cannot convert undefined or null to object");for(var xe=Object(oe),Fe=1;Fe<arguments.length;Fe++){var Je=arguments[Fe];if(Je!==Gt&&null!==Je)for(var At in Je)Je.hasOwnProperty(At)&&(xe[At]=Je[At])}return xe}:Object.assign;var er=Jn(function(oe,xe,Fe){for(var Je=Object.keys(xe),At=0;At<Je.length;)(!Fe||Fe&&oe[Je[At]]===Gt)&&(oe[Je[At]]=xe[Je[At]]),At++;return oe},"extend","Use `assign`."),Ci=Jn(function(oe,xe){return er(oe,xe,!0)},"merge","Use `assign`.");function si(ee,oe,xe){var Je,Fe=oe.prototype;(Je=ee.prototype=Object.create(Fe)).constructor=ee,Je._super=Fe,xe&&xn(Je,xe)}function is(ee,oe){return function(){return ee.apply(oe,arguments)}}function hr(ee,oe){return"function"==typeof ee?ee.apply(oe&&oe[0]||Gt,oe):ee}function xo(ee,oe){return ee===Gt?oe:ee}function Ir(ee,oe,xe){di(Xs(oe),function(Fe){ee.addEventListener(Fe,xe,!1)})}function Zr(ee,oe,xe){di(Xs(oe),function(Fe){ee.removeEventListener(Fe,xe,!1)})}function Is(ee,oe){for(;ee;){if(ee==oe)return!0;ee=ee.parentNode}return!1}function wo(ee,oe){return ee.indexOf(oe)>-1}function Xs(ee){return ee.trim().split(/\s+/g)}function Ys(ee,oe,xe){if(ee.indexOf&&!xe)return ee.indexOf(oe);for(var Fe=0;Fe<ee.length;){if(xe&&ee[Fe][xe]==oe||!xe&&ee[Fe]===oe)return Fe;Fe++}return-1}function Zt(ee){return Array.prototype.slice.call(ee,0)}function ys(ee,oe,xe){for(var Fe=[],Je=[],At=0;At<ee.length;){var qn=oe?ee[At][oe]:ee[At];Ys(Je,qn)<0&&Fe.push(ee[At]),Je[At]=qn,At++}return xe&&(Fe=oe?Fe.sort(function(kr,ls){return kr[oe]>ls[oe]}):Fe.sort()),Fe}function jo(ee,oe){for(var xe,Fe,Je=oe[0].toUpperCase()+oe.slice(1),At=0;At<Fn.length;){if((Fe=(xe=Fn[At])?xe+Je:oe)in ee)return Fe;At++}return Gt}var Eo=1;function vs(ee){var oe=ee.ownerDocument||ee;return oe.defaultView||oe.parentWindow||me}var aa="ontouchstart"in me,Ps=jo(me,"PointerEvent")!==Gt,Fi=aa&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),Ks="touch",ki="mouse",Ho=["x","y"],yr=["clientX","clientY"];function dr(ee,oe){var xe=this;this.manager=ee,this.callback=oe,this.element=ee.element,this.target=ee.options.inputTarget,this.domHandler=function(Fe){hr(ee.options.enable,[ee])&&xe.handler(Fe)},this.init()}function Ka(ee,oe,xe){var Fe=xe.pointers.length,Je=xe.changedPointers.length,At=1&oe&&Fe-Je==0,qn=12&oe&&Fe-Je==0;xe.isFirst=!!At,xe.isFinal=!!qn,At&&(ee.session={}),xe.eventType=oe,function He(ee,oe){var xe=ee.session,Fe=oe.pointers,Je=Fe.length;xe.firstInput||(xe.firstInput=rs(oe)),Je>1&&!xe.firstMultiple?xe.firstMultiple=rs(oe):1===Je&&(xe.firstMultiple=!1);var At=xe.firstInput,qn=xe.firstMultiple,Vr=qn?qn.center:At.center,kr=oe.center=$n(Fe);oe.timeStamp=sn(),oe.deltaTime=oe.timeStamp-At.timeStamp,oe.angle=Go(Vr,kr),oe.distance=ss(Vr,kr),function pt(ee,oe){var xe=oe.center,Fe=ee.offsetDelta||{},Je=ee.prevDelta||{},At=ee.prevInput||{};(1===oe.eventType||4===At.eventType)&&(Je=ee.prevDelta={x:At.deltaX||0,y:At.deltaY||0},Fe=ee.offsetDelta={x:xe.x,y:xe.y}),oe.deltaX=Je.x+(xe.x-Fe.x),oe.deltaY=Je.y+(xe.y-Fe.y)}(xe,oe),oe.offsetDirection=Rs(oe.deltaX,oe.deltaY);var ls=ks(oe.deltaTime,oe.deltaX,oe.deltaY);oe.overallVelocityX=ls.x,oe.overallVelocityY=ls.y,oe.overallVelocity=wn(ls.x)>wn(ls.y)?ls.x:ls.y,oe.scale=qn?function En(ee,oe){return ss(oe[0],oe[1],yr)/ss(ee[0],ee[1],yr)}(qn.pointers,Fe):1,oe.rotation=qn?function ut(ee,oe){return Go(oe[1],oe[0],yr)+Go(ee[1],ee[0],yr)}(qn.pointers,Fe):0,oe.maxPointers=xe.prevInput?oe.pointers.length>xe.prevInput.maxPointers?oe.pointers.length:xe.prevInput.maxPointers:oe.pointers.length,function ca(ee,oe){var Je,At,qn,Vr,xe=ee.lastInterval||oe,Fe=oe.timeStamp-xe.timeStamp;if(8!=oe.eventType&&(Fe>25||xe.velocity===Gt)){var kr=oe.deltaX-xe.deltaX,ls=oe.deltaY-xe.deltaY,$o=ks(Fe,kr,ls);At=$o.x,qn=$o.y,Je=wn($o.x)>wn($o.y)?$o.x:$o.y,Vr=Rs(kr,ls),ee.lastInterval=oe}else Je=xe.velocity,At=xe.velocityX,qn=xe.velocityY,Vr=xe.direction;oe.velocity=Je,oe.velocityX=At,oe.velocityY=qn,oe.direction=Vr}(xe,oe);var $o=ee.element;Is(oe.srcEvent.target,$o)&&($o=oe.srcEvent.target),oe.target=$o}(ee,xe),ee.emit("hammer.input",xe),ee.recognize(xe),ee.session.prevInput=xe}function rs(ee){for(var oe=[],xe=0;xe<ee.pointers.length;)oe[xe]={clientX:Ne(ee.pointers[xe].clientX),clientY:Ne(ee.pointers[xe].clientY)},xe++;return{timeStamp:sn(),pointers:oe,center:$n(oe),deltaX:ee.deltaX,deltaY:ee.deltaY}}function $n(ee){var oe=ee.length;if(1===oe)return{x:Ne(ee[0].clientX),y:Ne(ee[0].clientY)};for(var xe=0,Fe=0,Je=0;Je<oe;)xe+=ee[Je].clientX,Fe+=ee[Je].clientY,Je++;return{x:Ne(xe/oe),y:Ne(Fe/oe)}}function ks(ee,oe,xe){return{x:oe/ee||0,y:xe/ee||0}}function Rs(ee,oe){return ee===oe?1:wn(ee)>=wn(oe)?ee<0?2:4:oe<0?8:16}function ss(ee,oe,xe){xe||(xe=Ho);var Fe=oe[xe[0]]-ee[xe[0]],Je=oe[xe[1]]-ee[xe[1]];return Math.sqrt(Fe*Fe+Je*Je)}function Go(ee,oe,xe){return xe||(xe=Ho),180*Math.atan2(oe[xe[1]]-ee[xe[1]],oe[xe[0]]-ee[xe[0]])/Math.PI}dr.prototype={handler:function(){},init:function(){this.evEl&&Ir(this.element,this.evEl,this.domHandler),this.evTarget&&Ir(this.target,this.evTarget,this.domHandler),this.evWin&&Ir(vs(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Zr(this.element,this.evEl,this.domHandler),this.evTarget&&Zr(this.target,this.evTarget,this.domHandler),this.evWin&&Zr(vs(this.element),this.evWin,this.domHandler)}};var on={mousedown:1,mousemove:2,mouseup:4},Pr="mousedown",Ma="mousemove mouseup";function tn(){this.evEl=Pr,this.evWin=Ma,this.pressed=!1,dr.apply(this,arguments)}si(tn,dr,{handler:function(oe){var xe=on[oe.type];1&xe&&0===oe.button&&(this.pressed=!0),2&xe&&1!==oe.which&&(xe=4),this.pressed&&(4&xe&&(this.pressed=!1),this.callback(this.manager,xe,{pointers:[oe],changedPointers:[oe],pointerType:ki,srcEvent:oe}))}});var ua={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},zr={2:Ks,3:"pen",4:ki,5:"kinect"},Aa="pointerdown",vr="pointermove pointerup pointercancel";function Xr(){this.evEl=Aa,this.evWin=vr,dr.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}me.MSPointerEvent&&!me.PointerEvent&&(Aa="MSPointerDown",vr="MSPointerMove MSPointerUp MSPointerCancel"),si(Xr,dr,{handler:function(oe){var xe=this.store,Fe=!1,Je=oe.type.toLowerCase().replace("ms",""),At=ua[Je],qn=zr[oe.pointerType]||oe.pointerType,Vr=qn==Ks,kr=Ys(xe,oe.pointerId,"pointerId");1&At&&(0===oe.button||Vr)?kr<0&&(xe.push(oe),kr=xe.length-1):12&At&&(Fe=!0),!(kr<0)&&(xe[kr]=oe,this.callback(this.manager,At,{pointers:xe,changedPointers:[oe],pointerType:qn,srcEvent:oe}),Fe&&xe.splice(kr,1))}});var xi={touchstart:1,touchmove:2,touchend:4,touchcancel:8},os="touchstart",Wo="touchstart touchmove touchend touchcancel";function Ja(){this.evTarget=os,this.evWin=Wo,this.started=!1,dr.apply(this,arguments)}function Cl(ee,oe){var xe=Zt(ee.touches),Fe=Zt(ee.changedTouches);return 12&oe&&(xe=ys(xe.concat(Fe),"identifier",!0)),[xe,Fe]}si(Ja,dr,{handler:function(oe){var xe=xi[oe.type];if(1===xe&&(this.started=!0),this.started){var Fe=Cl.call(this,oe,xe);12&xe&&Fe[0].length-Fe[1].length==0&&(this.started=!1),this.callback(this.manager,xe,{pointers:Fe[0],changedPointers:Fe[1],pointerType:Ks,srcEvent:oe})}}});var ic={touchstart:1,touchmove:2,touchend:4,touchcancel:8},ha="touchstart touchmove touchend touchcancel";function le(){this.evTarget=ha,this.targetIds={},dr.apply(this,arguments)}function U(ee,oe){var xe=Zt(ee.touches),Fe=this.targetIds;if(3&oe&&1===xe.length)return Fe[xe[0].identifier]=!0,[xe,xe];var Je,At,qn=Zt(ee.changedTouches),Vr=[],kr=this.target;if(At=xe.filter(function(ls){return Is(ls.target,kr)}),1===oe)for(Je=0;Je<At.length;)Fe[At[Je].identifier]=!0,Je++;for(Je=0;Je<qn.length;)Fe[qn[Je].identifier]&&Vr.push(qn[Je]),12&oe&&delete Fe[qn[Je].identifier],Je++;return Vr.length?[ys(At.concat(Vr),"identifier",!0),Vr]:void 0}function re(){dr.apply(this,arguments);var ee=is(this.handler,this);this.touch=new le(this.manager,ee),this.mouse=new tn(this.manager,ee),this.primaryTouch=null,this.lastTouches=[]}function ye(ee,oe){1&ee?(this.primaryTouch=oe.changedPointers[0].identifier,Te.call(this,oe)):12&ee&&Te.call(this,oe)}function Te(ee){var oe=ee.changedPointers[0];if(oe.identifier===this.primaryTouch){var xe={x:oe.clientX,y:oe.clientY};this.lastTouches.push(xe);var Fe=this.lastTouches;setTimeout(function(){var At=Fe.indexOf(xe);At>-1&&Fe.splice(At,1)},2500)}}function we(ee){for(var oe=ee.srcEvent.clientX,xe=ee.srcEvent.clientY,Fe=0;Fe<this.lastTouches.length;Fe++){var Je=this.lastTouches[Fe],At=Math.abs(oe-Je.x),qn=Math.abs(xe-Je.y);if(At<=25&&qn<=25)return!0}return!1}si(le,dr,{handler:function(oe){var xe=ic[oe.type],Fe=U.call(this,oe,xe);!Fe||this.callback(this.manager,xe,{pointers:Fe[0],changedPointers:Fe[1],pointerType:Ks,srcEvent:oe})}}),si(re,dr,{handler:function(oe,xe,Fe){var At=Fe.pointerType==ki;if(!(At&&Fe.sourceCapabilities&&Fe.sourceCapabilities.firesTouchEvents)){if(Fe.pointerType==Ks)ye.call(this,xe,Fe);else if(At&&we.call(this,Fe))return;this.callback(oe,xe,Fe)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var ve=jo(yi.style,"touchAction"),Ce=ve!==Gt,je="compute",Ve="manipulation",Et="none",Mt="pan-x",ht="pan-y",Wt=function nn(){if(!Ce)return!1;var ee={},oe=me.CSS&&me.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(xe){ee[xe]=!oe||me.CSS.supports("touch-action",xe)}),ee}();function $t(ee,oe){this.manager=ee,this.set(oe)}function Hn(ee){this.options=xn({},this.defaults,ee||{}),this.id=function Yn(){return Eo++}(),this.manager=null,this.options.enable=xo(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function fi(ee){return 16&ee?"cancel":8&ee?"end":4&ee?"move":2&ee?"start":""}function Si(ee){return 16==ee?"down":8==ee?"up":2==ee?"left":4==ee?"right":""}function Da(ee,oe){var xe=oe.manager;return xe?xe.get(ee):ee}function Qs(){Hn.apply(this,arguments)}function pi(){Qs.apply(this,arguments),this.pX=null,this.pY=null}function Kt(){Qs.apply(this,arguments)}function Ec(){Hn.apply(this,arguments),this._timer=null,this._input=null}function rc(){Qs.apply(this,arguments)}function st(){Qs.apply(this,arguments)}function Ia(){Hn.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function an(ee,oe){return(oe=oe||{}).recognizers=xo(oe.recognizers,an.defaults.preset),new Qa(ee,oe)}function Qa(ee,oe){this.options=xn({},an.defaults,oe||{}),this.options.inputTarget=this.options.inputTarget||ee,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=ee,this.input=function Ya(ee){return new(ee.options.inputClass||(Ps?Xr:Fi?le:aa?re:tn))(ee,Ka)}(this),this.touchAction=new $t(this,this.options.touchAction),Sl(this,!0),di(this.options.recognizers,function(xe){var Fe=this.add(new xe[0](xe[1]));xe[2]&&Fe.recognizeWith(xe[2]),xe[3]&&Fe.requireFailure(xe[3])},this)}function Sl(ee,oe){var Fe,xe=ee.element;xe.style&&(di(ee.options.cssProps,function(Je,At){Fe=jo(xe.style,At),oe?(ee.oldCssProps[Fe]=xe.style[Fe],xe.style[Fe]=Je):xe.style[Fe]=ee.oldCssProps[Fe]||""}),oe||(ee.oldCssProps={}))}$t.prototype={set:function(ee){ee==je&&(ee=this.compute()),Ce&&this.manager.element.style&&Wt[ee]&&(this.manager.element.style[ve]=ee),this.actions=ee.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var ee=[];return di(this.manager.recognizers,function(oe){hr(oe.options.enable,[oe])&&(ee=ee.concat(oe.getTouchAction()))}),function Qn(ee){if(wo(ee,Et))return Et;var oe=wo(ee,Mt),xe=wo(ee,ht);return oe&&xe?Et:oe||xe?oe?Mt:ht:wo(ee,Ve)?Ve:"auto"}(ee.join(" "))},preventDefaults:function(ee){var oe=ee.srcEvent,xe=ee.offsetDirection;if(!this.manager.session.prevented){var Fe=this.actions,Je=wo(Fe,Et)&&!Wt[Et],At=wo(Fe,ht)&&!Wt[ht],qn=wo(Fe,Mt)&&!Wt[Mt];if(Je&&1===ee.pointers.length&&ee.distance<2&&ee.deltaTime<250)return;return qn&&At||!(Je||At&&6&xe||qn&&24&xe)?void 0:this.preventSrc(oe)}oe.preventDefault()},preventSrc:function(ee){this.manager.session.prevented=!0,ee.preventDefault()}},Hn.prototype={defaults:{},set:function(ee){return xn(this.options,ee),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(ee){if(Mn(ee,"recognizeWith",this))return this;var oe=this.simultaneous;return oe[(ee=Da(ee,this)).id]||(oe[ee.id]=ee,ee.recognizeWith(this)),this},dropRecognizeWith:function(ee){return Mn(ee,"dropRecognizeWith",this)||(ee=Da(ee,this),delete this.simultaneous[ee.id]),this},requireFailure:function(ee){if(Mn(ee,"requireFailure",this))return this;var oe=this.requireFail;return-1===Ys(oe,ee=Da(ee,this))&&(oe.push(ee),ee.requireFailure(this)),this},dropRequireFailure:function(ee){if(Mn(ee,"dropRequireFailure",this))return this;ee=Da(ee,this);var oe=Ys(this.requireFail,ee);return oe>-1&&this.requireFail.splice(oe,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(ee){return!!this.simultaneous[ee.id]},emit:function(ee){var oe=this,xe=this.state;function Fe(Je){oe.manager.emit(Je,ee)}xe<8&&Fe(oe.options.event+fi(xe)),Fe(oe.options.event),ee.additionalEvent&&Fe(ee.additionalEvent),xe>=8&&Fe(oe.options.event+fi(xe))},tryEmit:function(ee){if(this.canEmit())return this.emit(ee);this.state=32},canEmit:function(){for(var ee=0;ee<this.requireFail.length;){if(!(33&this.requireFail[ee].state))return!1;ee++}return!0},recognize:function(ee){var oe=xn({},ee);if(!hr(this.options.enable,[this,oe]))return this.reset(),void(this.state=32);56&this.state&&(this.state=1),this.state=this.process(oe),30&this.state&&this.tryEmit(oe)},process:function(ee){},getTouchAction:function(){},reset:function(){}},si(Qs,Hn,{defaults:{pointers:1},attrTest:function(ee){var oe=this.options.pointers;return 0===oe||ee.pointers.length===oe},process:function(ee){var oe=this.state,xe=ee.eventType,Fe=6&oe,Je=this.attrTest(ee);return Fe&&(8&xe||!Je)?16|oe:Fe||Je?4&xe?8|oe:2&oe?4|oe:2:32}}),si(pi,Qs,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var ee=this.options.direction,oe=[];return 6&ee&&oe.push(ht),24&ee&&oe.push(Mt),oe},directionTest:function(ee){var oe=this.options,xe=!0,Fe=ee.distance,Je=ee.direction,At=ee.deltaX,qn=ee.deltaY;return Je&oe.direction||(6&oe.direction?(Je=0===At?1:At<0?2:4,xe=At!=this.pX,Fe=Math.abs(ee.deltaX)):(Je=0===qn?1:qn<0?8:16,xe=qn!=this.pY,Fe=Math.abs(ee.deltaY))),ee.direction=Je,xe&&Fe>oe.threshold&&Je&oe.direction},attrTest:function(ee){return Qs.prototype.attrTest.call(this,ee)&&(2&this.state||!(2&this.state)&&this.directionTest(ee))},emit:function(ee){this.pX=ee.deltaX,this.pY=ee.deltaY;var oe=Si(ee.direction);oe&&(ee.additionalEvent=this.options.event+oe),this._super.emit.call(this,ee)}}),si(Kt,Qs,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Et]},attrTest:function(ee){return this._super.attrTest.call(this,ee)&&(Math.abs(ee.scale-1)>this.options.threshold||2&this.state)},emit:function(ee){1!==ee.scale&&(ee.additionalEvent=this.options.event+(ee.scale<1?"in":"out")),this._super.emit.call(this,ee)}}),si(Ec,Hn,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return["auto"]},process:function(ee){var oe=this.options,xe=ee.pointers.length===oe.pointers,Fe=ee.distance<oe.threshold,Je=ee.deltaTime>oe.time;if(this._input=ee,!Fe||!xe||12&ee.eventType&&!Je)this.reset();else if(1&ee.eventType)this.reset(),this._timer=vt(function(){this.state=8,this.tryEmit()},oe.time,this);else if(4&ee.eventType)return 8;return 32},reset:function(){clearTimeout(this._timer)},emit:function(ee){8===this.state&&(ee&&4&ee.eventType?this.manager.emit(this.options.event+"up",ee):(this._input.timeStamp=sn(),this.manager.emit(this.options.event,this._input)))}}),si(rc,Qs,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Et]},attrTest:function(ee){return this._super.attrTest.call(this,ee)&&(Math.abs(ee.rotation)>this.options.threshold||2&this.state)}}),si(st,Qs,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return pi.prototype.getTouchAction.call(this)},attrTest:function(ee){var xe,oe=this.options.direction;return 30&oe?xe=ee.overallVelocity:6&oe?xe=ee.overallVelocityX:24&oe&&(xe=ee.overallVelocityY),this._super.attrTest.call(this,ee)&&oe&ee.offsetDirection&&ee.distance>this.options.threshold&&ee.maxPointers==this.options.pointers&&wn(xe)>this.options.velocity&&4&ee.eventType},emit:function(ee){var oe=Si(ee.offsetDirection);oe&&this.manager.emit(this.options.event+oe,ee),this.manager.emit(this.options.event,ee)}}),si(Ia,Hn,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Ve]},process:function(ee){var oe=this.options,xe=ee.pointers.length===oe.pointers,Fe=ee.distance<oe.threshold,Je=ee.deltaTime<oe.time;if(this.reset(),1&ee.eventType&&0===this.count)return this.failTimeout();if(Fe&&Je&&xe){if(4!=ee.eventType)return this.failTimeout();var At=!this.pTime||ee.timeStamp-this.pTime<oe.interval,qn=!this.pCenter||ss(this.pCenter,ee.center)<oe.posThreshold;if(this.pTime=ee.timeStamp,this.pCenter=ee.center,qn&&At?this.count+=1:this.count=1,this._input=ee,0==this.count%oe.taps)return this.hasRequireFailures()?(this._timer=vt(function(){this.state=8,this.tryEmit()},oe.interval,this),2):8}return 32},failTimeout:function(){return this._timer=vt(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),an.VERSION="2.0.7",an.defaults={domEvents:!1,touchAction:je,enable:!0,inputTarget:null,inputClass:null,preset:[[rc,{enable:!1}],[Kt,{enable:!1},["rotate"]],[st,{direction:6}],[pi,{direction:6},["swipe"]],[Ia],[Ia,{event:"doubletap",taps:2},["tap"]],[Ec]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},Qa.prototype={set:function(ee){return xn(this.options,ee),ee.touchAction&&this.touchAction.update(),ee.inputTarget&&(this.input.destroy(),this.input.target=ee.inputTarget,this.input.init()),this},stop:function(ee){this.session.stopped=ee?2:1},recognize:function(ee){var oe=this.session;if(!oe.stopped){this.touchAction.preventDefaults(ee);var xe,Fe=this.recognizers,Je=oe.curRecognizer;(!Je||Je&&8&Je.state)&&(Je=oe.curRecognizer=null);for(var At=0;At<Fe.length;)xe=Fe[At],2===oe.stopped||Je&&xe!=Je&&!xe.canRecognizeWith(Je)?xe.reset():xe.recognize(ee),!Je&&14&xe.state&&(Je=oe.curRecognizer=xe),At++}},get:function(ee){if(ee instanceof Hn)return ee;for(var oe=this.recognizers,xe=0;xe<oe.length;xe++)if(oe[xe].options.event==ee)return oe[xe];return null},add:function(ee){if(Mn(ee,"add",this))return this;var oe=this.get(ee.options.event);return oe&&this.remove(oe),this.recognizers.push(ee),ee.manager=this,this.touchAction.update(),ee},remove:function(ee){if(Mn(ee,"remove",this))return this;if(ee=this.get(ee)){var oe=this.recognizers,xe=Ys(oe,ee);-1!==xe&&(oe.splice(xe,1),this.touchAction.update())}return this},on:function(ee,oe){if(ee!==Gt&&oe!==Gt){var xe=this.handlers;return di(Xs(ee),function(Fe){xe[Fe]=xe[Fe]||[],xe[Fe].push(oe)}),this}},off:function(ee,oe){if(ee!==Gt){var xe=this.handlers;return di(Xs(ee),function(Fe){oe?xe[Fe]&&xe[Fe].splice(Ys(xe[Fe],oe),1):delete xe[Fe]}),this}},emit:function(ee,oe){this.options.domEvents&&function el(ee,oe){var xe=wc.createEvent("Event");xe.initEvent(ee,!0,!0),xe.gesture=oe,oe.target.dispatchEvent(xe)}(ee,oe);var xe=this.handlers[ee]&&this.handlers[ee].slice();if(xe&&xe.length){oe.type=ee,oe.preventDefault=function(){oe.srcEvent.preventDefault()};for(var Fe=0;Fe<xe.length;)xe[Fe](oe),Fe++}},destroy:function(){this.element&&Sl(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},xn(an,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:32,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:24,DIRECTION_ALL:30,Manager:Qa,Input:dr,TouchAction:$t,TouchInput:le,MouseInput:tn,PointerEventInput:Xr,TouchMouseInput:re,SingleTouchInput:Ja,Recognizer:Hn,AttrRecognizer:Qs,Tap:Ia,Pan:pi,Swipe:st,Pinch:Kt,Rotate:rc,Press:Ec,on:Ir,off:Zr,each:di,merge:Ci,extend:er,assign:xn,inherit:si,bindFn:is,prefixed:jo}),(typeof me<"u"?me:typeof self<"u"?self:{}).Hammer=an,(Wn=function(){return an}.call(_s,ns,_s,Uo))!==Gt&&(Uo.exports=Wn)}(window,document)},489:function(Uo,_s,ns){var Wn;Uo=ns.nmd(Uo),function(){var me,Fn="Expected a function",en="__lodash_hash_undefined__",wn="__lodash_placeholder__",Yn=1/0,vs=9007199254740991,Ps=4294967295,Za=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]],ki="[object Arguments]",vi="[object Array]",Kn="[object Boolean]",Mr="[object Date]",_r="[object Error]",Js="[object Function]",la="[object GeneratorFunction]",Br="[object Map]",To="[object Number]",Zi="[object Object]",bs="[object Promise]",Ho="[object RegExp]",yr="[object Set]",dr="[object String]",Ya="[object Symbol]",He="[object WeakMap]",ca="[object ArrayBuffer]",rs="[object DataView]",$n="[object Float32Array]",ks="[object Float64Array]",Rs="[object Int8Array]",ss="[object Int16Array]",Go="[object Int32Array]",ut="[object Uint8Array]",En="[object Uint8ClampedArray]",on="[object Uint16Array]",Pr="[object Uint32Array]",Ma=/\b__p \+= '';/g,tn=/\b(__p \+=) '' \+/g,ua=/(__e\(.*?\)|\b__t\)) \+\n'';/g,zr=/&(?:amp|lt|gt|quot|#39);/g,Aa=/[&<>"']/g,vr=RegExp(zr.source),Xr=RegExp(Aa.source),xi=/<%-([\s\S]+?)%>/g,os=/<%([\s\S]+?)%>/g,Wo=/<%=([\s\S]+?)%>/g,Ja=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Cl=/^\w*$/,ic=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ha=/[\\^$.*+?()[\]{}|]/g,le=RegExp(ha.source),U=/^\s+/,$=/\s/,ie=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,re=/\{\n\/\* \[wrapped with (.+)\] \*/,ye=/,? & /,Te=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,we=/[()=,{}\[\]\/\s]/,ve=/\\(\\)?/g,Ce=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,je=/\w*$/,et=/^[-+]0x[0-9a-f]+$/i,Ve=/^0b[01]+$/i,Et=/^\[object .+?Constructor\]$/,Mt=/^0o[0-7]+$/i,ht=/^(?:0|[1-9]\d*)$/,Wt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,$t=/($^)/,Qn=/['\n\r\u2028\u2029\\]/g,nn="\\ud800-\\udfff",wi="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",ti="\\u2700-\\u27bf",br="a-z\\xdf-\\xf6\\xf8-\\xff",Da="A-Z\\xc0-\\xd6\\xd8-\\xde",Qs="\\ufe0e\\ufe0f",pi="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ec="["+nn+"]",rc="["+pi+"]",st="["+wi+"]",Ia="\\d+",an="["+ti+"]",ci="["+br+"]",Pa="[^"+nn+pi+Ia+ti+br+Da+"]",Qa="\\ud83c[\\udffb-\\udfff]",el="[^"+nn+"]",Yr="(?:\\ud83c[\\udde6-\\uddff]){2}",ee="[\\ud800-\\udbff][\\udc00-\\udfff]",oe="["+Da+"]",Fe="(?:"+ci+"|"+Pa+")",Je="(?:"+oe+"|"+Pa+")",At="(?:['\u2019](?:d|ll|m|re|s|t|ve))?",qn="(?:['\u2019](?:D|LL|M|RE|S|T|VE))?",Vr="(?:"+st+"|"+Qa+")?",kr="["+Qs+"]?",Co=kr+Vr+"(?:\\u200d(?:"+[el,Yr,ee].join("|")+")"+kr+Vr+")*",Mi="(?:"+[an,Yr,ee].join("|")+")"+Co,Nf="(?:"+[el+st+"?",st,Yr,ee,Ec].join("|")+")",Bf=RegExp("['\u2019]","g"),zf=RegExp(st,"g"),lt=RegExp(Qa+"(?="+Qa+")|"+Nf+Co,"g"),Hp=RegExp([oe+"?"+ci+"+"+At+"(?="+[rc,oe,"$"].join("|")+")",Je+"+"+qn+"(?="+[rc,oe+Fe,"$"].join("|")+")",oe+"?"+Fe+"+"+At,oe+"+"+qn,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Ia,Mi].join("|"),"g"),xr=RegExp("[\\u200d"+nn+wi+Qs+"]"),sc=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,wh=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Pd=-1,ni={};ni[$n]=ni[ks]=ni[Rs]=ni[ss]=ni[Go]=ni[ut]=ni[En]=ni[on]=ni[Pr]=!0,ni[ki]=ni[vi]=ni[ca]=ni[Kn]=ni[rs]=ni[Mr]=ni[_r]=ni[Js]=ni[Br]=ni[To]=ni[Zi]=ni[Ho]=ni[yr]=ni[dr]=ni[He]=!1;var Xi={};Xi[ki]=Xi[vi]=Xi[ca]=Xi[rs]=Xi[Kn]=Xi[Mr]=Xi[$n]=Xi[ks]=Xi[Rs]=Xi[ss]=Xi[Go]=Xi[Br]=Xi[To]=Xi[Zi]=Xi[Ho]=Xi[yr]=Xi[dr]=Xi[Ya]=Xi[ut]=Xi[En]=Xi[on]=Xi[Pr]=!0,Xi[_r]=Xi[Js]=Xi[He]=!1;var Eh={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Th=parseFloat,_n=parseInt,cu="object"==typeof global&&global&&global.Object===Object&&global,Ch="object"==typeof self&&self&&self.Object===Object&&self,Wi=cu||Ch||Function("return this")(),Sh=_s&&!_s.nodeType&&_s,Ml=Sh&&Uo&&!Uo.nodeType&&Uo,Al=Ml&&Ml.exports===Sh,qo=Al&&cu.process,ka=function(){try{return Ml&&Ml.require&&Ml.require("util").types||qo&&qo.binding&&qo.binding("util")}catch{}}(),Gp=ka&&ka.isArrayBuffer,da=ka&&ka.isDate,tr=ka&&ka.isMap,kd=ka&&ka.isRegExp,Mh=ka&&ka.isSet,Dl=ka&&ka.isTypedArray;function An(Ae,Xe,Ge){switch(Ge.length){case 0:return Ae.call(Xe);case 1:return Ae.call(Xe,Ge[0]);case 2:return Ae.call(Xe,Ge[0],Ge[1]);case 3:return Ae.call(Xe,Ge[0],Ge[1],Ge[2])}return Ae.apply(Xe,Ge)}function Il(Ae,Xe,Ge,Rt){for(var Ln=-1,Ni=null==Ae?0:Ae.length;++Ln<Ni;){var Hr=Ae[Ln];Xe(Rt,Hr,Ge(Hr),Ae)}return Rt}function eo(Ae,Xe){for(var Ge=-1,Rt=null==Ae?0:Ae.length;++Ge<Rt&&!1!==Xe(Ae[Ge],Ge,Ae););return Ae}function Ah(Ae,Xe){for(var Ge=null==Ae?0:Ae.length;Ge--&&!1!==Xe(Ae[Ge],Ge,Ae););return Ae}function uu(Ae,Xe){for(var Ge=-1,Rt=null==Ae?0:Ae.length;++Ge<Rt;)if(!Xe(Ae[Ge],Ge,Ae))return!1;return!0}function Rr(Ae,Xe){for(var Ge=-1,Rt=null==Ae?0:Ae.length,Ln=0,Ni=[];++Ge<Rt;){var Hr=Ae[Ge];Xe(Hr,Ge,Ae)&&(Ni[Ln++]=Hr)}return Ni}function Pl(Ae,Xe){return!(null==Ae||!Ae.length)&&Ur(Ae,Xe,0)>-1}function oc(Ae,Xe,Ge){for(var Rt=-1,Ln=null==Ae?0:Ae.length;++Rt<Ln;)if(Ge(Xe,Ae[Rt]))return!0;return!1}function jt(Ae,Xe){for(var Ge=-1,Rt=null==Ae?0:Ae.length,Ln=Array(Rt);++Ge<Rt;)Ln[Ge]=Xe(Ae[Ge],Ge,Ae);return Ln}function kl(Ae,Xe){for(var Ge=-1,Rt=Xe.length,Ln=Ae.length;++Ge<Rt;)Ae[Ln+Ge]=Xe[Ge];return Ae}function Un(Ae,Xe,Ge,Rt){var Ln=-1,Ni=null==Ae?0:Ae.length;for(Rt&&Ni&&(Ge=Ae[++Ln]);++Ln<Ni;)Ge=Xe(Ge,Ae[Ln],Ln,Ae);return Ge}function mi(Ae,Xe,Ge,Rt){var Ln=null==Ae?0:Ae.length;for(Rt&&Ln&&(Ge=Ae[--Ln]);Ln--;)Ge=Xe(Ge,Ae[Ln],Ln,Ae);return Ge}function un(Ae,Xe){for(var Ge=-1,Rt=null==Ae?0:Ae.length;++Ge<Rt;)if(Xe(Ae[Ge],Ge,Ae))return!0;return!1}var fr=ws("length");function to(Ae,Xe,Ge){var Rt;return Ge(Ae,function(Ln,Ni,Hr){if(Xe(Ln,Ni,Hr))return Rt=Ni,!1}),Rt}function Ai(Ae,Xe,Ge,Rt){for(var Ln=Ae.length,Ni=Ge+(Rt?1:-1);Rt?Ni--:++Ni<Ln;)if(Xe(Ae[Ni],Ni,Ae))return Ni;return-1}function Ur(Ae,Xe,Ge){return Xe==Xe?function Dh(Ae,Xe,Ge){for(var Rt=Ge-1,Ln=Ae.length;++Rt<Ln;)if(Ae[Rt]===Xe)return Rt;return-1}(Ae,Xe,Ge):Ai(Ae,Rl,Ge)}function no(Ae,Xe,Ge,Rt){for(var Ln=Ge-1,Ni=Ae.length;++Ln<Ni;)if(Rt(Ae[Ln],Xe))return Ln;return-1}function Rl(Ae){return Ae!=Ae}function xs(Ae,Xe){var Ge=null==Ae?0:Ae.length;return Ge?Es(Ae,Xe)/Ge:NaN}function ws(Ae){return function(Xe){return null==Xe?me:Xe[Ae]}}function xt(Ae){return function(Xe){return null==Ae?me:Ae[Xe]}}function Dn(Ae,Xe,Ge,Rt,Ln){return Ln(Ae,function(Ni,Hr,Bi){Ge=Rt?(Rt=!1,Ni):Xe(Ge,Ni,Hr,Bi)}),Ge}function Es(Ae,Xe){for(var Ge,Rt=-1,Ln=Ae.length;++Rt<Ln;){var Ni=Xe(Ae[Rt]);Ni!==me&&(Ge=Ge===me?Ni:Ge+Ni)}return Ge}function fa(Ae,Xe){for(var Ge=-1,Rt=Array(Ae);++Ge<Ae;)Rt[Ge]=Xe(Ge);return Rt}function Ll(Ae){return Ae&&Ae.slice(0,jr(Ae)+1).replace(U,"")}function ai(Ae){return function(Xe){return Ae(Xe)}}function ac(Ae,Xe){return jt(Xe,function(Ge){return Ae[Ge]})}function io(Ae,Xe){return Ae.has(Xe)}function In(Ae,Xe){for(var Ge=-1,Rt=Ae.length;++Ge<Rt&&Ur(Xe,Ae[Ge],0)>-1;);return Ge}function tl(Ae,Xe){for(var Ge=Ae.length;Ge--&&Ur(Xe,Ae[Ge],0)>-1;);return Ge}function du(Ae,Xe){for(var Ge=Ae.length,Rt=0;Ge--;)Ae[Ge]===Xe&&++Rt;return Rt}var fu=xt({\u00c0:"A",\u00c1:"A",\u00c2:"A",\u00c3:"A",\u00c4:"A",\u00c5:"A",\u00e0:"a",\u00e1:"a",\u00e2:"a",\u00e3:"a",\u00e4:"a",\u00e5:"a",\u00c7:"C",\u00e7:"c",\u00d0:"D",\u00f0:"d",\u00c8:"E",\u00c9:"E",\u00ca:"E",\u00cb:"E",\u00e8:"e",\u00e9:"e",\u00ea:"e",\u00eb:"e",\u00cc:"I",\u00cd:"I",\u00ce:"I",\u00cf:"I",\u00ec:"i",\u00ed:"i",\u00ee:"i",\u00ef:"i",\u00d1:"N",\u00f1:"n",\u00d2:"O",\u00d3:"O",\u00d4:"O",\u00d5:"O",\u00d6:"O",\u00d8:"O",\u00f2:"o",\u00f3:"o",\u00f4:"o",\u00f5:"o",\u00f6:"o",\u00f8:"o",\u00d9:"U",\u00da:"U",\u00db:"U",\u00dc:"U",\u00f9:"u",\u00fa:"u",\u00fb:"u",\u00fc:"u",\u00dd:"Y",\u00fd:"y",\u00ff:"y",\u00c6:"Ae",\u00e6:"ae",\u00de:"Th",\u00fe:"th",\u00df:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010a:"C",\u010c:"C",\u0107:"c",\u0109:"c",\u010b:"c",\u010d:"c",\u010e:"D",\u0110:"D",\u010f:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011a:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011b:"e",\u011c:"G",\u011e:"G",\u0120:"G",\u0122:"G",\u011d:"g",\u011f:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012a:"I",\u012c:"I",\u012e:"I",\u0130:"I",\u0129:"i",\u012b:"i",\u012d:"i",\u012f:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013b:"L",\u013d:"L",\u013f:"L",\u0141:"L",\u013a:"l",\u013c:"l",\u013e:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014a:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014b:"n",\u014c:"O",\u014e:"O",\u0150:"O",\u014d:"o",\u014f:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015a:"S",\u015c:"S",\u015e:"S",\u0160:"S",\u015b:"s",\u015d:"s",\u015f:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016a:"U",\u016c:"U",\u016e:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016b:"u",\u016d:"u",\u016f:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017b:"Z",\u017d:"Z",\u017a:"z",\u017c:"z",\u017e:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017f:"s"}),lc=xt({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function Ls(Ae){return"\\"+Eh[Ae]}function Zo(Ae){return xr.test(Ae)}function Fl(Ae){var Xe=-1,Ge=Array(Ae.size);return Ae.forEach(function(Rt,Ln){Ge[++Xe]=[Ln,Rt]}),Ge}function Ri(Ae,Xe){return function(Ge){return Ae(Xe(Ge))}}function Nl(Ae,Xe){for(var Ge=-1,Rt=Ae.length,Ln=0,Ni=[];++Ge<Rt;){var Hr=Ae[Ge];(Hr===Xe||Hr===wn)&&(Ae[Ge]=wn,Ni[Ln++]=Ge)}return Ni}function cc(Ae){var Xe=-1,Ge=Array(Ae.size);return Ae.forEach(function(Rt){Ge[++Xe]=Rt}),Ge}function Mo(Ae){return Zo(Ae)?function nr(Ae){for(var Xe=lt.lastIndex=0;lt.test(Ae);)++Xe;return Xe}(Ae):fr(Ae)}function Ts(Ae){return Zo(Ae)?function ro(Ae){return Ae.match(lt)||[]}(Ae):function hu(Ae){return Ae.split("")}(Ae)}function jr(Ae){for(var Xe=Ae.length;Xe--&&$.test(Ae.charAt(Xe)););return Xe}var ju=xt({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),Ao=function Ae(Xe){var p,Ge=(Xe=null==Xe?Wi:Ao.defaults(Wi.Object(),Xe,Ao.pick(Wi,wh))).Array,Rt=Xe.Date,Ln=Xe.Error,Ni=Xe.Function,Hr=Xe.Math,Bi=Xe.Object,il=Xe.RegExp,Dt=Xe.String,pa=Xe.TypeError,Bl=Ge.prototype,Sc=Bi.prototype,yt=Xe["__core-js_shared__"],mu=Ni.prototype.toString,Ki=Sc.hasOwnProperty,Vf=0,Rd=(p=/[^.]+$/.exec(yt&&yt.keys&&yt.keys.IE_PROTO||""))?"Symbol(src)_1."+p:"",gu=Sc.toString,Ph=mu.call(Bi),dg=Wi._,Wp=il("^"+mu.call(Ki).replace(ha,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Hu=Al?Xe.Buffer:me,Gs=Xe.Symbol,_u=Xe.Uint8Array,Xo=Hu?Hu.allocUnsafe:me,Cs=Ri(Bi.getPrototypeOf,Bi),zl=Bi.create,Ld=Sc.propertyIsEnumerable,rl=Bl.splice,Gu=Gs?Gs.isConcatSpreadable:me,Vl=Gs?Gs.iterator:me,sl=Gs?Gs.toStringTag:me,oo=function(){try{var p=Ku(Bi,"defineProperty");return p({},"",{}),p}catch{}}(),li=Xe.clearTimeout!==Wi.clearTimeout&&Xe.clearTimeout,Mc=Rt&&Rt.now!==Wi.Date.now&&Rt.now,kh=Xe.setTimeout!==Wi.setTimeout&&Xe.setTimeout,Ac=Hr.ceil,Wu=Hr.floor,Od=Bi.getOwnPropertySymbols,Kr=Hu?Hu.isBuffer:me,Ra=Xe.isFinite,Rh=Bl.join,Pt=Ri(Bi.keys,Bi),mt=Hr.max,Gr=Hr.min,$u=Rt.now,Yo=Xe.parseInt,zi=Hr.random,uc=Bl.reverse,ao=Ku(Xe,"DataView"),yu=Ku(Xe,"Map"),Os=Ku(Xe,"Promise"),Ji=Ku(Xe,"Set"),ir=Ku(Xe,"WeakMap"),hn=Ku(Bi,"create"),La=ir&&new ir,v={},l=hl(ao),d=hl(yu),_=hl(Os),x=hl(Ji),C=hl(ir),P=Gs?Gs.prototype:me,L=P?P.valueOf:me,N=P?P.toString:me;function I(p){if(Sr(p)&&!Qt(p)&&!(p instanceof ce)){if(p instanceof Q)return p;if(Ki.call(p,"__wrapped__"))return sf(p)}return new Q(p)}var H=function(){function p(){}return function(y){if(!ui(y))return{};if(zl)return zl(y);p.prototype=y;var D=new p;return p.prototype=me,D}}();function q(){}function Q(p,y){this.__wrapped__=p,this.__actions__=[],this.__chain__=!!y,this.__index__=0,this.__values__=me}function ce(p){this.__wrapped__=p,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Ps,this.__views__=[]}function Me(p){var y=-1,D=null==p?0:p.length;for(this.clear();++y<D;){var B=p[y];this.set(B[0],B[1])}}function $e(p){var y=-1,D=null==p?0:p.length;for(this.clear();++y<D;){var B=p[y];this.set(B[0],B[1])}}function rn(p){var y=-1,D=null==p?0:p.length;for(this.clear();++y<D;){var B=p[y];this.set(B[0],B[1])}}function Nn(p){var y=-1,D=null==p?0:p.length;for(this.__data__=new rn;++y<D;)this.add(p[y])}function Wr(p){var y=this.__data__=new $e(p);this.size=y.size}function wr(p,y){var D=Qt(p),B=!D&&fs(p),X=!D&&!B&&Ar(p),ae=!D&&!B&&!X&&Oo(p),be=D||B||X||ae,Se=be?fa(p.length,Dt):[],Le=Se.length;for(var rt in p)(y||Ki.call(p,rt))&&(!be||!("length"==rt||X&&("offset"==rt||"parent"==rt)||ae&&("buffer"==rt||"byteLength"==rt||"byteOffset"==rt)||xa(rt,Le)))&&Se.push(rt);return Se}function _a(p){var y=p.length;return y?p[fc(0,y-1)]:me}function Zn(p,y){return nf(ko(p),ll(y,0,p.length))}function On(p){return nf(ko(p))}function gi(p,y,D){(D!==me&&!lr(p[y],D)||D===me&&!(y in p))&&Io(p,y,D)}function Lr(p,y,D){var B=p[y];(!Ki.call(p,y)||!lr(B,D)||D===me&&!(y in p))&&Io(p,y,D)}function $r(p,y){for(var D=p.length;D--;)if(lr(p[D][0],y))return D;return-1}function mr(p,y,D,B){return Dc(p,function(X,ae,be){y(B,X,D(X),be)}),B}function Ko(p,y){return p&&pc(y,_o(y),p)}function Io(p,y,D){"__proto__"==y&&oo?oo(p,y,{configurable:!0,enumerable:!0,value:D,writable:!0}):p[y]=D}function Fa(p,y){for(var D=-1,B=y.length,X=Ge(B),ae=null==p;++D<B;)X[D]=ae?me:Zg(p,y[D]);return X}function ll(p,y,D){return p==p&&(D!==me&&(p=p<=D?p:D),y!==me&&(p=p>=y?p:y)),p}function lo(p,y,D,B,X,ae){var be,Se=1&y,Le=2&y,rt=4&y;if(D&&(be=X?D(p,B,X,ae):D(p)),be!==me)return be;if(!ui(p))return p;var tt=Qt(p);if(tt){if(be=function Kf(p){var y=p.length,D=new p.constructor(y);return y&&"string"==typeof p[0]&&Ki.call(p,"index")&&(D.index=p.index,D.input=p.input),D}(p),!Se)return ko(p,be)}else{var at=fo(p),It=at==Js||at==la;if(Ar(p))return $d(p,Se);if(at==Zi||at==ki||It&&!X){if(be=Le||It?{}:xg(p),!Se)return Le?function rm(p,y){return pc(p,Jh(p),y)}(p,function al(p,y){return p&&pc(y,ml(y),p)}(be,p)):function im(p,y){return pc(p,um(p),y)}(p,Ko(be,p))}else{if(!Xi[at])return X?p:{};be=function Jf(p,y,D){var B=p.constructor;switch(y){case ca:return em(p);case Kn:case Mr:return new B(+p);case rs:return function tm(p,y){var D=y?em(p.buffer):p.buffer;return new p.constructor(D,p.byteOffset,p.byteLength)}(p,D);case $n:case ks:case Rs:case ss:case Go:case ut:case En:case on:case Pr:return Fc(p,D);case Br:return new B;case To:case dr:return new B(p);case Ho:return function ho(p){var y=new p.constructor(p.source,je.exec(p));return y.lastIndex=p.lastIndex,y}(p);case yr:return new B;case Ya:return function qd(p){return L?Bi(L.call(p)):{}}(p)}}(p,at,Se)}}ae||(ae=new Wr);var Yt=ae.get(p);if(Yt)return Yt;ae.set(p,be),lh(p)?p.forEach(function(vn){be.add(lo(vn,y,D,vn,p,ae))}):cd(p)&&p.forEach(function(vn,Ti){be.set(Ti,lo(vn,y,D,Ti,p,ae))});var ri=tt?me:(rt?Le?Eu:lm:Le?ml:_o)(p);return eo(ri||p,function(vn,Ti){ri&&(vn=p[Ti=vn]),Lr(be,Ti,lo(vn,y,D,Ti,p,ae))}),be}function co(p,y,D){var B=D.length;if(null==p)return!B;for(p=Bi(p);B--;){var X=D[B],be=p[X];if(be===me&&!(X in p)||!(0,y[X])(be))return!1}return!0}function ya(p,y,D){if("function"!=typeof p)throw new pa(Fn);return tf(function(){p.apply(me,D)},y)}function dc(p,y,D,B){var X=-1,ae=Pl,be=!0,Se=p.length,Le=[],rt=y.length;if(!Se)return Le;D&&(y=jt(y,ai(D))),B?(ae=oc,be=!1):y.length>=200&&(ae=io,be=!1,y=new Nn(y));e:for(;++X<Se;){var tt=p[X],at=null==D?tt:D(tt);if(tt=B||0!==tt?tt:0,be&&at==at){for(var It=rt;It--;)if(y[It]===at)continue e;Le.push(tt)}else ae(y,at,B)||Le.push(tt)}return Le}I.templateSettings={escape:xi,evaluate:os,interpolate:Wo,variable:"",imports:{_:I}},(I.prototype=q.prototype).constructor=I,(Q.prototype=H(q.prototype)).constructor=Q,(ce.prototype=H(q.prototype)).constructor=ce,Me.prototype.clear=function Re(){this.__data__=hn?hn(null):{},this.size=0},Me.prototype.delete=function fe(p){var y=this.has(p)&&delete this.__data__[p];return this.size-=y?1:0,y},Me.prototype.get=function Be(p){var y=this.__data__;if(hn){var D=y[p];return D===en?me:D}return Ki.call(y,p)?y[p]:me},Me.prototype.has=function ke(p){var y=this.__data__;return hn?y[p]!==me:Ki.call(y,p)},Me.prototype.set=function We(p,y){var D=this.__data__;return this.size+=this.has(p)?0:1,D[p]=hn&&y===me?en:y,this},$e.prototype.clear=function it(){this.__data__=[],this.size=0},$e.prototype.delete=function Ue(p){var y=this.__data__,D=$r(y,p);return!(D<0||(D==y.length-1?y.pop():rl.call(y,D,1),--this.size,0))},$e.prototype.get=function wt(p){var y=this.__data__,D=$r(y,p);return D<0?me:y[D][1]},$e.prototype.has=function dt(p){return $r(this.__data__,p)>-1},$e.prototype.set=function St(p,y){var D=this.__data__,B=$r(D,p);return B<0?(++this.size,D.push([p,y])):D[B][1]=y,this},rn.prototype.clear=function Pn(){this.size=0,this.__data__={hash:new Me,map:new(yu||$e),string:new Me}},rn.prototype.delete=function Ht(p){var y=Qd(this,p).delete(p);return this.size-=y?1:0,y},rn.prototype.get=function Di(p){return Qd(this,p).get(p)},rn.prototype.has=function Ei(p){return Qd(this,p).has(p)},rn.prototype.set=function ii(p,y){var D=Qd(this,p),B=D.size;return D.set(p,y),this.size+=D.size==B?0:1,this},Nn.prototype.add=Nn.prototype.push=function Ii(p){return this.__data__.set(p,en),this},Nn.prototype.has=function cs(p){return this.__data__.has(p)},Wr.prototype.clear=function ma(){this.__data__=new $e,this.size=0},Wr.prototype.delete=function Oa(p){var y=this.__data__,D=y.delete(p);return this.size=y.size,D},Wr.prototype.get=function ol(p){return this.__data__.get(p)},Wr.prototype.has=function ga(p){return this.__data__.has(p)},Wr.prototype.set=function Do(p,y){var D=this.__data__;if(D instanceof $e){var B=D.__data__;if(!yu||B.length<199)return B.push([p,y]),this.size=++D.size,this;D=this.__data__=new rn(B)}return D.set(p,y),this.size=D.size,this};var Dc=sy(uo),Lh=sy(Fh,!0);function Fd(p,y){var D=!0;return Dc(p,function(B,X,ae){return D=!!y(B,X,ae)}),D}function vu(p,y,D){for(var B=-1,X=p.length;++B<X;){var ae=p[B],be=y(ae);if(null!=be&&(Se===me?be==be&&!Ca(be):D(be,Se)))var Se=be,Le=ae}return Le}function Ic(p,y){var D=[];return Dc(p,function(B,X,ae){y(B,X,ae)&&D.push(B)}),D}function Er(p,y,D,B,X){var ae=-1,be=p.length;for(D||(D=Vc),X||(X=[]);++ae<be;){var Se=p[ae];y>0&&D(Se)?y>1?Er(Se,y-1,D,B,X):kl(X,Se):B||(X[X.length]=Se)}return X}var Na=Wh(),Uf=Wh(!0);function uo(p,y){return p&&Na(p,y,_o)}function Fh(p,y){return p&&Uf(p,y,_o)}function Nh(p,y){return Rr(y,function(D){return Qr(p[D])})}function rr(p,y){for(var D=0,B=(y=ea(y,p)).length;null!=p&&D<B;)p=p[ta(y[D++])];return D&&D==B?p:me}function Pc(p,y,D){var B=y(p);return Qt(p)?B:kl(B,D(p))}function Po(p){return null==p?p===me?"[object Undefined]":"[object Null]":sl&&sl in Bi(p)?function oy(p){var y=Ki.call(p,sl),D=p[sl];try{p[sl]=me;var B=!0}catch{}var X=gu.call(p);return B&&(y?p[sl]=D:delete p[sl]),X}(p):function uy(p){return gu.call(p)}(p)}function va(p,y){return p>y}function kc(p,y){return null!=p&&Ki.call(p,y)}function qu(p,y){return null!=p&&y in Bi(p)}function Nd(p,y,D){for(var B=D?oc:Pl,X=p[0].length,ae=p.length,be=ae,Se=Ge(ae),Le=1/0,rt=[];be--;){var tt=p[be];be&&y&&(tt=jt(tt,ai(y))),Le=Gr(tt.length,Le),Se[be]=!D&&(y||X>=120&&tt.length>=120)?new Nn(be&&tt):me}tt=p[0];var at=-1,It=Se[0];e:for(;++at<X&&rt.length<Le;){var Yt=tt[at],yn=y?y(Yt):Yt;if(Yt=D||0!==Yt?Yt:0,!(It?io(It,yn):B(rt,yn,D))){for(be=ae;--be;){var ri=Se[be];if(!(ri?io(ri,yn):B(p[be],yn,D)))continue e}It&&It.push(yn),rt.push(Yt)}}return rt}function Bh(p,y,D){var B=null==(p=ef(p,y=ea(y,p)))?p:p[ta(Gn(y))];return null==B?me:An(B,p,D)}function Ul(p){return Sr(p)&&Po(p)==ki}function Rc(p,y,D,B,X){return p===y||(null==p||null==y||!Sr(p)&&!Sr(y)?p!=p&&y!=y:function jf(p,y,D,B,X,ae){var be=Qt(p),Se=Qt(y),Le=be?vi:fo(p),rt=Se?vi:fo(y),tt=(Le=Le==ki?Zi:Le)==Zi,at=(rt=rt==ki?Zi:rt)==Zi,It=Le==rt;if(It&&Ar(p)){if(!Ar(y))return!1;be=!0,tt=!1}if(It&&!tt)return ae||(ae=new Wr),be||Oo(p)?Yh(p,y,D,B,X,ae):function Yf(p,y,D,B,X,ae,be){switch(D){case rs:if(p.byteLength!=y.byteLength||p.byteOffset!=y.byteOffset)return!1;p=p.buffer,y=y.buffer;case ca:return!(p.byteLength!=y.byteLength||!ae(new _u(p),new _u(y)));case Kn:case Mr:case To:return lr(+p,+y);case _r:return p.name==y.name&&p.message==y.message;case Ho:case dr:return p==y+"";case Br:var Se=Fl;case yr:if(Se||(Se=cc),p.size!=y.size&&!(1&B))return!1;var rt=be.get(p);if(rt)return rt==y;B|=2,be.set(p,y);var tt=Yh(Se(p),Se(y),B,X,ae,be);return be.delete(p),tt;case Ya:if(L)return L.call(p)==L.call(y)}return!1}(p,y,Le,D,B,X,ae);if(!(1&D)){var Yt=tt&&Ki.call(p,"__wrapped__"),yn=at&&Ki.call(y,"__wrapped__");if(Yt||yn){var ri=Yt?p.value():p,vn=yn?y.value():y;return ae||(ae=new Wr),X(ri,vn,D,B,ae)}}return!!It&&(ae||(ae=new Wr),function bg(p,y,D,B,X,ae){var be=1&D,Se=lm(p),Le=Se.length;if(Le!=lm(y).length&&!be)return!1;for(var at=Le;at--;){var It=Se[at];if(!(be?It in y:Ki.call(y,It)))return!1}var Yt=ae.get(p),yn=ae.get(y);if(Yt&&yn)return Yt==y&&yn==p;var ri=!0;ae.set(p,y),ae.set(y,p);for(var vn=be;++at<Le;){var Ti=p[It=Se[at]],ei=y[It];if(B)var gl=be?B(ei,Ti,It,y,p,ae):B(Ti,ei,It,p,y,ae);if(!(gl===me?Ti===ei||X(Ti,ei,D,B,ae):gl)){ri=!1;break}vn||(vn="constructor"==It)}if(ri&&!vn){var ja=p.constructor,Zl=y.constructor;ja!=Zl&&"constructor"in p&&"constructor"in y&&!("function"==typeof ja&&ja instanceof ja&&"function"==typeof Zl&&Zl instanceof Zl)&&(ri=!1)}return ae.delete(p),ae.delete(y),ri}(p,y,D,B,X,ae))}(p,y,D,B,Rc,X))}function jl(p,y,D,B){var X=D.length,ae=X,be=!B;if(null==p)return!ae;for(p=Bi(p);X--;){var Se=D[X];if(be&&Se[2]?Se[1]!==p[Se[0]]:!(Se[0]in p))return!1}for(;++X<ae;){var Le=(Se=D[X])[0],rt=p[Le],tt=Se[1];if(be&&Se[2]){if(rt===me&&!(Le in p))return!1}else{var at=new Wr;if(B)var It=B(rt,tt,Le,p,y,at);if(!(It===me?Rc(tt,rt,3,B,at):It))return!1}}return!0}function mg(p){return!(!ui(p)||function ly(p){return!!Rd&&Rd in p}(p))&&(Qr(p)?Wp:Et).test(hl(p))}function qp(p){return"function"==typeof p?p:null==p?Ua:"object"==typeof p?Qt(p)?Hf(p[0],p[1]):jd(p):V0(p)}function Zp(p){if(!Ju(p))return Pt(p);var y=[];for(var D in Bi(p))Ki.call(p,D)&&"constructor"!=D&&y.push(D);return y}function Jr(p,y){return p<y}function Xp(p,y){var D=-1,B=Pi(p)?Ge(p.length):[];return Dc(p,function(X,ae,be){B[++D]=y(X,ae,be)}),B}function jd(p){var y=cm(p);return 1==y.length&&y[0][2]?dm(y[0][0],y[0][1]):function(D){return D===p||jl(D,p,y)}}function Hf(p,y){return Uc(p)&&hm(y)?dm(ta(p),y):function(D){var B=Zg(D,p);return B===me&&B===y?Xg(D,p):Rc(y,B,3)}}function Ba(p,y,D,B,X){p!==y&&Na(y,function(ae,be){if(X||(X=new Wr),ui(ae))!function ey(p,y,D,B,X,ae,be){var Se=Ro(p,D),Le=Ro(y,D),rt=be.get(Le);if(rt)gi(p,D,rt);else{var tt=ae?ae(Se,Le,D+"",p,y,be):me,at=tt===me;if(at){var It=Qt(Le),Yt=!It&&Ar(Le),yn=!It&&!Yt&&Oo(Le);tt=Le,It||Yt||yn?Qt(Se)?tt=Se:qt(Se)?tt=ko(Se):Yt?(at=!1,tt=$d(Le,!0)):yn?(at=!1,tt=Fc(Le,!0)):tt=[]:ah(Le)||fs(Le)?(tt=Se,fs(Se)?tt=Gg(Se):(!ui(Se)||Qr(Se))&&(tt=xg(Le))):at=!1}at&&(be.set(Le,tt),X(tt,Le,B,ae,be),be.delete(Le)),gi(p,D,tt)}}(p,y,be,D,Ba,B,X);else{var Se=B?B(Ro(p,be),ae,be+"",p,y,X):me;Se===me&&(Se=ae),gi(p,be,Se)}},ml)}function Ws(p,y){var D=p.length;if(D)return xa(y+=y<0?D:0,D)?p[y]:me}function Hd(p,y,D){y=y.length?jt(y,function(ae){return Qt(ae)?function(be){return rr(be,1===ae.length?ae[0]:ae)}:ae}):[Ua];var B=-1;return y=jt(y,ai(dn())),function pr(Ae,Xe){var Ge=Ae.length;for(Ae.sort(Xe);Ge--;)Ae[Ge]=Ae[Ge].value;return Ae}(Xp(p,function(ae,be,Se){return{criteria:jt(y,function(rt){return rt(ae)}),index:++B,value:ae}}),function(ae,be){return function nm(p,y,D){for(var B=-1,X=p.criteria,ae=y.criteria,be=X.length,Se=D.length;++B<be;){var Le=ry(X[B],ae[B]);if(Le)return B>=Se?Le:Le*("desc"==D[B]?-1:1)}return p.index-y.index}(ae,be,D)})}function Wf(p,y,D){for(var B=-1,X=y.length,ae={};++B<X;){var be=y[B],Se=rr(p,be);D(Se,be)&&Lt(ae,ea(be,p),Se)}return ae}function Lc(p,y,D,B){var X=B?no:Ur,ae=-1,be=y.length,Se=p;for(p===y&&(y=ko(y)),D&&(Se=jt(p,ai(D)));++ae<be;)for(var Le=0,rt=y[ae],tt=D?D(rt):rt;(Le=X(Se,tt,Le,B))>-1;)Se!==p&&rl.call(Se,Le,1),rl.call(p,Le,1);return p}function Zu(p,y){for(var D=p?y.length:0,B=D-1;D--;){var X=y[D];if(D==B||X!==ae){var ae=X;xa(X)?rl.call(p,X,1):Gd(p,X)}}return p}function fc(p,y){return p+Wu(zi()*(y-p+1))}function Xu(p,y){var D="";if(!p||y<1||y>vs)return D;do{y%2&&(D+=p),(y=Wu(y/2))&&(p+=p)}while(y);return D}function Tn(p,y){return fm(Eg(p,y,Ua),p+"")}function cl(p){return _a(yf(p))}function gg(p,y){var D=yf(p);return nf(D,ll(y,0,D.length))}function Lt(p,y,D,B){if(!ui(p))return p;for(var X=-1,ae=(y=ea(y,p)).length,be=ae-1,Se=p;null!=Se&&++X<ae;){var Le=ta(y[X]),rt=D;if("__proto__"===Le||"constructor"===Le||"prototype"===Le)return p;if(X!=be){var tt=Se[Le];(rt=B?B(tt,Le,Se):me)===me&&(rt=ui(tt)?tt:xa(y[X+1])?[]:{})}Lr(Se,Le,rt),Se=Se[Le]}return p}var ty=La?function(p,y){return La.set(p,y),p}:Ua,f0=oo?function(p,y){return oo(p,"toString",{configurable:!0,enumerable:!1,value:ky(y),writable:!0})}:Ua;function Kp(p){return nf(yf(p))}function ba(p,y,D){var B=-1,X=p.length;y<0&&(y=-y>X?0:X+y),(D=D>X?X:D)<0&&(D+=X),X=y>D?0:D-y>>>0,y>>>=0;for(var ae=Ge(X);++B<X;)ae[B]=p[B+y];return ae}function ny(p,y){var D;return Dc(p,function(B,X,ae){return!(D=y(B,X,ae))}),!!D}function Oc(p,y,D){var B=0,X=null==p?B:p.length;if("number"==typeof y&&y==y&&X<=2147483647){for(;B<X;){var ae=B+X>>>1,be=p[ae];null!==be&&!Ca(be)&&(D?be<=y:be<y)?B=ae+1:X=ae}return X}return Uh(p,y,Ua,D)}function Uh(p,y,D,B){var X=0,ae=null==p?0:p.length;if(0===ae)return 0;for(var be=(y=D(y))!=y,Se=null===y,Le=Ca(y),rt=y===me;X<ae;){var tt=Wu((X+ae)/2),at=D(p[tt]),It=at!==me,Yt=null===at,yn=at==at,ri=Ca(at);if(be)var vn=B||yn;else vn=rt?yn&&(B||It):Se?yn&&It&&(B||!Yt):Le?yn&&It&&!Yt&&(B||!ri):!Yt&&!ri&&(B?at<=y:at<y);vn?X=tt+1:ae=tt}return Gr(ae,4294967294)}function jh(p,y){for(var D=-1,B=p.length,X=0,ae=[];++D<B;){var be=p[D],Se=y?y(be):be;if(!D||!lr(Se,Le)){var Le=Se;ae[X++]=0===be?0:be}}return ae}function iy(p){return"number"==typeof p?p:Ca(p)?NaN:+p}function ul(p){if("string"==typeof p)return p;if(Qt(p))return jt(p,ul)+"";if(Ca(p))return N?N.call(p):"";var y=p+"";return"0"==y&&1/p==-Yn?"-0":y}function Tr(p,y,D){var B=-1,X=Pl,ae=p.length,be=!0,Se=[],Le=Se;if(D)be=!1,X=oc;else if(ae>=200){var rt=y?null:Kd(p);if(rt)return cc(rt);be=!1,X=io,Le=new Nn}else Le=y?[]:Se;e:for(;++B<ae;){var tt=p[B],at=y?y(tt):tt;if(tt=D||0!==tt?tt:0,be&&at==at){for(var It=Le.length;It--;)if(Le[It]===at)continue e;y&&Le.push(at),Se.push(tt)}else X(Le,at,D)||(Le!==Se&&Le.push(at),Se.push(tt))}return Se}function Gd(p,y){return null==(p=ef(p,y=ea(y,p)))||delete p[ta(Gn(y))]}function Hh(p,y,D,B){return Lt(p,y,D(rr(p,y)),B)}function Jp(p,y,D,B){for(var X=p.length,ae=B?X:-1;(B?ae--:++ae<X)&&y(p[ae],ae,p););return D?ba(p,B?0:ae,B?ae+1:X):ba(p,B?ae+1:0,B?X:ae)}function $f(p,y){var D=p;return D instanceof ce&&(D=D.value()),Un(y,function(B,X){return X.func.apply(X.thisArg,kl([B],X.args))},D)}function Jo(p,y,D){var B=p.length;if(B<2)return B?Tr(p[0]):[];for(var X=-1,ae=Ge(B);++X<B;)for(var be=p[X],Se=-1;++Se<B;)Se!=X&&(ae[X]=dc(ae[X]||be,p[Se],y,D));return Tr(Er(ae,1),y,D)}function Qo(p,y,D){for(var B=-1,X=p.length,ae=y.length,be={};++B<X;)D(be,p[B],B<ae?y[B]:me);return be}function qf(p){return qt(p)?p:[]}function sr(p){return"function"==typeof p?p:Ua}function ea(p,y){return Qt(p)?p:Uc(p,y)?[p]:rf(cr(p))}var Qp=Tn;function Hl(p,y,D){var B=p.length;return D=D===me?B:D,!y&&D>=B?p:ba(p,y,D)}var Wd=li||function(p){return Wi.clearTimeout(p)};function $d(p,y){if(y)return p.slice();var D=p.length,B=Xo?Xo(D):new p.constructor(D);return p.copy(B),B}function em(p){var y=new p.constructor(p.byteLength);return new _u(y).set(new _u(p)),y}function Fc(p,y){var D=y?em(p.buffer):p.buffer;return new p.constructor(D,p.byteOffset,p.length)}function ry(p,y){if(p!==y){var D=p!==me,B=null===p,X=p==p,ae=Ca(p),be=y!==me,Se=null===y,Le=y==y,rt=Ca(y);if(!Se&&!rt&&!ae&&p>y||ae&&be&&Le&&!Se&&!rt||B&&be&&Le||!D&&Le||!X)return 1;if(!B&&!ae&&!rt&&p<y||rt&&D&&X&&!B&&!ae||Se&&D&&X||!be&&X||!Le)return-1}return 0}function Gh(p,y,D,B){for(var X=-1,ae=p.length,be=D.length,Se=-1,Le=y.length,rt=mt(ae-be,0),tt=Ge(Le+rt),at=!B;++Se<Le;)tt[Se]=y[Se];for(;++X<be;)(at||X<ae)&&(tt[D[X]]=p[X]);for(;rt--;)tt[Se++]=p[X++];return tt}function _g(p,y,D,B){for(var X=-1,ae=p.length,be=-1,Se=D.length,Le=-1,rt=y.length,tt=mt(ae-Se,0),at=Ge(tt+rt),It=!B;++X<tt;)at[X]=p[X];for(var Yt=X;++Le<rt;)at[Yt+Le]=y[Le];for(;++be<Se;)(It||X<ae)&&(at[Yt+D[be]]=p[X++]);return at}function ko(p,y){var D=-1,B=p.length;for(y||(y=Ge(B));++D<B;)y[D]=p[D];return y}function pc(p,y,D,B){var X=!D;D||(D={});for(var ae=-1,be=y.length;++ae<be;){var Se=y[ae],Le=B?B(D[Se],p[Se],Se,D,p):me;Le===me&&(Le=p[Se]),X?Io(D,Se,Le):Lr(D,Se,Le)}return D}function bu(p,y){return function(D,B){var X=Qt(D)?Il:mr,ae=y?y():{};return X(D,p,dn(B,2),ae)}}function Nc(p){return Tn(function(y,D){var B=-1,X=D.length,ae=X>1?D[X-1]:me,be=X>2?D[2]:me;for(ae=p.length>3&&"function"==typeof ae?(X--,ae):me,be&&$s(D[0],D[1],be)&&(ae=X<3?me:ae,X=1),y=Bi(y);++B<X;){var Se=D[B];Se&&p(y,Se,B,ae)}return y})}function sy(p,y){return function(D,B){if(null==D)return D;if(!Pi(D))return p(D,B);for(var X=D.length,ae=y?X:-1,be=Bi(D);(y?ae--:++ae<X)&&!1!==B(be[ae],ae,be););return D}}function Wh(p){return function(y,D,B){for(var X=-1,ae=Bi(y),be=B(y),Se=be.length;Se--;){var Le=be[p?Se:++X];if(!1===D(ae[Le],Le,ae))break}return y}}function Zd(p){return function(y){var D=Zo(y=cr(y))?Ts(y):me,B=D?D[0]:y.charAt(0),X=D?Hl(D,1).join(""):y.slice(1);return B[p]()+X}}function za(p){return function(y){return Un(O0(Ay(y).replace(Bf,"")),p,"")}}function Xd(p){return function(){var y=arguments;switch(y.length){case 0:return new p;case 1:return new p(y[0]);case 2:return new p(y[0],y[1]);case 3:return new p(y[0],y[1],y[2]);case 4:return new p(y[0],y[1],y[2],y[3]);case 5:return new p(y[0],y[1],y[2],y[3],y[4]);case 6:return new p(y[0],y[1],y[2],y[3],y[4],y[5]);case 7:return new p(y[0],y[1],y[2],y[3],y[4],y[5],y[6])}var D=H(p.prototype),B=p.apply(D,y);return ui(B)?B:D}}function xu(p){return function(y,D,B){var X=Bi(y);if(!Pi(y)){var ae=dn(D,3);y=_o(y),D=function(Se){return ae(X[Se],Se,X)}}var be=p(y,D,B);return be>-1?X[ae?y[be]:be]:me}}function $h(p){return zc(function(y){var D=y.length,B=D,X=Q.prototype.thru;for(p&&y.reverse();B--;){var ae=y[B];if("function"!=typeof ae)throw new pa(Fn);if(X&&!be&&"wrapper"==Kh(ae))var be=new Q([],!0)}for(B=be?B:D;++B<D;){var Se=Kh(ae=y[B]),Le="wrapper"==Se?Tu(ae):me;be=Le&&Cu(Le[0])&&424==Le[1]&&!Le[4].length&&1==Le[9]?be[Kh(Le[0])].apply(be,Le[3]):1==ae.length&&Cu(ae)?be[Se]():be.thru(ae)}return function(){var rt=arguments,tt=rt[0];if(be&&1==rt.length&&Qt(tt))return be.plant(tt).value();for(var at=0,It=D?y[at].apply(this,rt):tt;++at<D;)It=y[at].call(this,It);return It}})}function Bc(p,y,D,B,X,ae,be,Se,Le,rt){var tt=128&y,at=1&y,It=2&y,Yt=24&y,yn=512&y,ri=It?me:Xd(p);return function vn(){for(var Ti=arguments.length,ei=Ge(Ti),gl=Ti;gl--;)ei[gl]=arguments[gl];if(Yt)var ja=Jd(vn),Zl=du(ei,ja);if(B&&(ei=Gh(ei,B,X,Yt)),ae&&(ei=_g(ei,ae,be,Yt)),Ti-=Zl,Yt&&Ti<rt){var Ms=Nl(ei,ja);return Xf(p,y,Bc,vn.placeholder,D,ei,Ms,Se,Le,rt-Ti)}var Yc=at?D:this,uh=It?Yc[p]:p;return Ti=ei.length,Se?ei=ed(ei,Se):yn&&Ti>1&&ei.reverse(),tt&&Le<Ti&&(ei.length=Le),this&&this!==Wi&&this instanceof vn&&(uh=ri||Xd(uh)),uh.apply(Yc,ei)}}function vg(p,y){return function(D,B){return function pg(p,y,D,B){return uo(p,function(X,ae,be){y(B,D(X),ae,be)}),B}(D,p,y(B),{})}}function nt(p,y){return function(D,B){var X;if(D===me&&B===me)return y;if(D!==me&&(X=D),B!==me){if(X===me)return B;"string"==typeof D||"string"==typeof B?(D=ul(D),B=ul(B)):(D=iy(D),B=iy(B)),X=p(D,B)}return X}}function Yd(p){return zc(function(y){return y=jt(y,ai(dn())),Tn(function(D){var B=this;return p(y,function(X){return An(X,B,D)})})})}function Gl(p,y){var D=(y=y===me?" ":ul(y)).length;if(D<2)return D?Xu(y,p):y;var B=Xu(y,Ac(p/Mo(y)));return Zo(y)?Hl(Ts(B),0,p).join(""):B.slice(0,p)}function qh(p){return function(y,D,B){return B&&"number"!=typeof B&&$s(y,D,B)&&(D=B=me),y=vc(y),D===me?(D=y,y=0):D=vc(D),function Yp(p,y,D,B){for(var X=-1,ae=mt(Ac((y-p)/(D||1)),0),be=Ge(ae);ae--;)be[B?ae:++X]=p,p+=D;return be}(y,D,B=B===me?y<D?1:-1:vc(B),p)}}function Zf(p){return function(y,D){return"string"==typeof y&&"string"==typeof D||(y=ql(y),D=ql(D)),p(y,D)}}function Xf(p,y,D,B,X,ae,be,Se,Le,rt){var tt=8&y;y|=tt?32:64,4&(y&=~(tt?64:32))||(y&=-4);var ri=[p,y,X,tt?ae:me,tt?be:me,tt?me:ae,tt?me:be,Se,Le,rt],vn=D.apply(me,ri);return Cu(p)&&Wl(vn,ri),vn.placeholder=B,pm(vn,p,y)}function Yu(p){var y=Hr[p];return function(D,B){if(D=ql(D),(B=null==B?0:Gr(Cn(B),292))&&Ra(D)){var X=(cr(D)+"e").split("e");return+((X=(cr(y(X[0]+"e"+(+X[1]+B)))+"e").split("e"))[0]+"e"+(+X[1]-B))}return y(D)}}var Kd=Ji&&1/cc(new Ji([,-0]))[1]==Yn?function(p){return new Ji(p)}:Kg;function wu(p){return function(y){var D=fo(y);return D==Br?Fl(y):D==yr?function Uu(Ae){var Xe=-1,Ge=Array(Ae.size);return Ae.forEach(function(Rt){Ge[++Xe]=[Rt,Rt]}),Ge}(y):function Yi(Ae,Xe){return jt(Xe,function(Ge){return[Ge,Ae[Ge]]})}(y,p(y))}}function mc(p,y,D,B,X,ae,be,Se){var Le=2&y;if(!Le&&"function"!=typeof p)throw new pa(Fn);var rt=B?B.length:0;if(rt||(y&=-97,B=X=me),be=be===me?be:mt(Cn(be),0),Se=Se===me?Se:Cn(Se),rt-=X?X.length:0,64&y){var tt=B,at=X;B=X=me}var It=Le?me:Tu(p),Yt=[p,y,D,B,X,tt,at,ae,be,Se];if(It&&function Qu(p,y){var D=p[1],B=y[1],X=D|B;if(!(X<131||(128==B&&8==D||128==B&&256==D&&p[7].length<=y[8]||384==B&&y[7].length<=y[8]&&8==D)))return p;1&B&&(p[2]=y[2],X|=1&D?0:4);var Se=y[3];if(Se){var Le=p[3];p[3]=Le?Gh(Le,Se,y[4]):Se,p[4]=Le?Nl(p[3],wn):y[4]}(Se=y[5])&&(p[5]=(Le=p[5])?_g(Le,Se,y[6]):Se,p[6]=Le?Nl(p[5],wn):y[6]),(Se=y[7])&&(p[7]=Se),128&B&&(p[8]=null==p[8]?y[8]:Gr(p[8],y[8])),null==p[9]&&(p[9]=y[9]),p[0]=y[0],p[1]=X}(Yt,It),p=Yt[0],y=Yt[1],D=Yt[2],B=Yt[3],X=Yt[4],!(Se=Yt[9]=Yt[9]===me?Le?0:p.length:mt(Yt[9]-rt,0))&&24&y&&(y&=-25),y&&1!=y)yn=8==y||16==y?function yg(p,y,D){var B=Xd(p);return function X(){for(var ae=arguments.length,be=Ge(ae),Se=ae,Le=Jd(X);Se--;)be[Se]=arguments[Se];var rt=ae<3&&be[0]!==Le&&be[ae-1]!==Le?[]:Nl(be,Le);return(ae-=rt.length)<D?Xf(p,y,Bc,X.placeholder,me,be,rt,me,me,D-ae):An(this&&this!==Wi&&this instanceof X?B:p,this,be)}}(p,y,Se):32!=y&&33!=y||X.length?Bc.apply(me,Yt):function om(p,y,D,B){var X=1&y,ae=Xd(p);return function be(){for(var Se=-1,Le=arguments.length,rt=-1,tt=B.length,at=Ge(tt+Le),It=this&&this!==Wi&&this instanceof be?ae:p;++rt<tt;)at[rt]=B[rt];for(;Le--;)at[rt++]=arguments[++Se];return An(It,X?D:this,at)}}(p,y,D,B);else var yn=function sm(p,y,D){var B=1&y,X=Xd(p);return function ae(){return(this&&this!==Wi&&this instanceof ae?X:p).apply(B?D:this,arguments)}}(p,y,D);return pm((It?ty:Wl)(yn,Yt),p,y)}function Zh(p,y,D,B){return p===me||lr(p,Sc[D])&&!Ki.call(B,D)?y:p}function Xh(p,y,D,B,X,ae){return ui(p)&&ui(y)&&(ae.set(y,p),Ba(p,y,me,Xh,ae),ae.delete(y)),p}function am(p){return ah(p)?me:p}function Yh(p,y,D,B,X,ae){var be=1&D,Se=p.length,Le=y.length;if(Se!=Le&&!(be&&Le>Se))return!1;var rt=ae.get(p),tt=ae.get(y);if(rt&&tt)return rt==y&&tt==p;var at=-1,It=!0,Yt=2&D?new Nn:me;for(ae.set(p,y),ae.set(y,p);++at<Se;){var yn=p[at],ri=y[at];if(B)var vn=be?B(ri,yn,at,y,p,ae):B(yn,ri,at,p,y,ae);if(vn!==me){if(vn)continue;It=!1;break}if(Yt){if(!un(y,function(Ti,ei){if(!io(Yt,ei)&&(yn===Ti||X(yn,Ti,D,B,ae)))return Yt.push(ei)})){It=!1;break}}else if(yn!==ri&&!X(yn,ri,D,B,ae)){It=!1;break}}return ae.delete(p),ae.delete(y),It}function zc(p){return fm(Eg(p,me,Su),p+"")}function lm(p){return Pc(p,_o,um)}function Eu(p){return Pc(p,ml,Jh)}var Tu=La?function(p){return La.get(p)}:Kg;function Kh(p){for(var y=p.name+"",D=v[y],B=Ki.call(v,y)?D.length:0;B--;){var X=D[B],ae=X.func;if(null==ae||ae==p)return X.name}return y}function Jd(p){return(Ki.call(I,"placeholder")?I:p).placeholder}function dn(){var p=I.iteratee||Yg;return p=p===Yg?qp:p,arguments.length?p(arguments[0],arguments[1]):p}function Qd(p,y){var D=p.__data__;return function jc(p){var y=typeof p;return"string"==y||"number"==y||"symbol"==y||"boolean"==y?"__proto__"!==p:null===p}(y)?D["string"==typeof y?"string":"hash"]:D.map}function cm(p){for(var y=_o(p),D=y.length;D--;){var B=y[D],X=p[B];y[D]=[B,X,hm(X)]}return y}function Ku(p,y){var D=function Ol(Ae,Xe){return null==Ae?me:Ae[Xe]}(p,y);return mg(D)?D:me}var um=Od?function(p){return null==p?[]:(p=Bi(p),Rr(Od(p),function(y){return Ld.call(p,y)}))}:Qg,Jh=Od?function(p){for(var y=[];p;)kl(y,um(p)),p=Cs(p);return y}:Qg,fo=Po;function Ns(p,y,D){for(var B=-1,X=(y=ea(y,p)).length,ae=!1;++B<X;){var be=ta(y[B]);if(!(ae=null!=p&&D(p,be)))break;p=p[be]}return ae||++B!=X?ae:!!(X=null==p?0:p.length)&&sh(X)&&xa(be,X)&&(Qt(p)||fs(p))}function xg(p){return"function"!=typeof p.constructor||Ju(p)?{}:H(Cs(p))}function Vc(p){return Qt(p)||fs(p)||!!(Gu&&p&&p[Gu])}function xa(p,y){var D=typeof p;return!!(y=y??vs)&&("number"==D||"symbol"!=D&&ht.test(p))&&p>-1&&p%1==0&&p<y}function $s(p,y,D){if(!ui(D))return!1;var B=typeof y;return!!("number"==B?Pi(D)&&xa(y,D.length):"string"==B&&y in D)&&lr(D[y],p)}function Uc(p,y){if(Qt(p))return!1;var D=typeof p;return!("number"!=D&&"symbol"!=D&&"boolean"!=D&&null!=p&&!Ca(p))||Cl.test(p)||!Ja.test(p)||null!=y&&p in Bi(y)}function Cu(p){var y=Kh(p),D=I[y];if("function"!=typeof D||!(y in ce.prototype))return!1;if(p===D)return!0;var B=Tu(D);return!!B&&p===B[0]}(ao&&fo(new ao(new ArrayBuffer(1)))!=rs||yu&&fo(new yu)!=Br||Os&&fo(Os.resolve())!=bs||Ji&&fo(new Ji)!=yr||ir&&fo(new ir)!=He)&&(fo=function(p){var y=Po(p),D=y==Zi?p.constructor:me,B=D?hl(D):"";if(B)switch(B){case l:return rs;case d:return Br;case _:return bs;case x:return yr;case C:return He}return y});var Qf=yt?Qr:Pm;function Ju(p){var y=p&&p.constructor;return p===("function"==typeof y&&y.prototype||Sc)}function hm(p){return p==p&&!ui(p)}function dm(p,y){return function(D){return null!=D&&D[p]===y&&(y!==me||p in Bi(D))}}function Eg(p,y,D){return y=mt(y===me?p.length-1:y,0),function(){for(var B=arguments,X=-1,ae=mt(B.length-y,0),be=Ge(ae);++X<ae;)be[X]=B[y+X];X=-1;for(var Se=Ge(y+1);++X<y;)Se[X]=B[X];return Se[y]=D(be),An(p,this,Se)}}function ef(p,y){return y.length<2?p:rr(p,ba(y,0,-1))}function ed(p,y){for(var D=p.length,B=Gr(y.length,D),X=ko(p);B--;){var ae=y[B];p[B]=xa(ae,D)?X[ae]:me}return p}function Ro(p,y){if(("constructor"!==y||"function"!=typeof p[y])&&"__proto__"!=y)return p[y]}var Wl=ep(ty),tf=kh||function(p,y){return Wi.setTimeout(p,y)},fm=ep(f0);function pm(p,y,D){var B=y+"";return fm(p,function $i(p,y){var D=y.length;if(!D)return p;var B=D-1;return y[B]=(D>1?"& ":"")+y[B],y=y.join(D>2?", ":" "),p.replace(ie,"{\n/* [wrapped with "+y+"] */\n")}(B,function tp(p,y){return eo(Za,function(D){var B="_."+D[0];y&D[1]&&!Pl(p,B)&&p.push(B)}),p.sort()}(function Qh(p){var y=p.match(re);return y?y[1].split(ye):[]}(B),D)))}function ep(p){var y=0,D=0;return function(){var B=$u(),X=16-(B-D);if(D=B,X>0){if(++y>=800)return arguments[0]}else y=0;return p.apply(me,arguments)}}function nf(p,y){var D=-1,B=p.length,X=B-1;for(y=y===me?B:y;++D<y;){var ae=fc(D,X),be=p[ae];p[ae]=p[D],p[D]=be}return p.length=y,p}var rf=function wg(p){var y=ct(p,function(B){return 500===D.size&&D.clear(),B}),D=y.cache;return y}(function(p){var y=[];return 46===p.charCodeAt(0)&&y.push(""),p.replace(ic,function(D,B,X,ae){y.push(X?ae.replace(ve,"$1"):B||D)}),y});function ta(p){if("string"==typeof p||Ca(p))return p;var y=p+"";return"0"==y&&1/p==-Yn?"-0":y}function hl(p){if(null!=p){try{return mu.call(p)}catch{}try{return p+""}catch{}}return""}function sf(p){if(p instanceof ce)return p.clone();var y=new Q(p.__wrapped__,p.__chain__);return y.__actions__=ko(p.__actions__),y.__index__=p.__index__,y.__values__=p.__values__,y}var lf=Tn(function(p,y){return qt(p)?dc(p,Er(y,1,qt,!0)):[]}),mm=Tn(function(p,y){var D=Gn(y);return qt(D)&&(D=me),qt(p)?dc(p,Er(y,1,qt,!0),dn(D,2)):[]}),gm=Tn(function(p,y){var D=Gn(y);return qt(D)&&(D=me),qt(p)?dc(p,Er(y,1,qt,!0),me,D):[]});function dl(p,y,D){var B=null==p?0:p.length;if(!B)return-1;var X=null==D?0:Cn(D);return X<0&&(X=mt(B+X,0)),Ai(p,dn(y,3),X)}function Cg(p,y,D){var B=null==p?0:p.length;if(!B)return-1;var X=B-1;return D!==me&&(X=Cn(D),X=D<0?mt(B+X,0):Gr(X,B-1)),Ai(p,dn(y,3),X,!0)}function Su(p){return null!=p&&p.length?Er(p,1):[]}function ym(p){return p&&p.length?p[0]:me}var cf=Tn(function(p){var y=jt(p,qf);return y.length&&y[0]===p[0]?Nd(y):[]}),vm=Tn(function(p){var y=Gn(p),D=jt(p,qf);return y===Gn(D)?y=me:D.pop(),D.length&&D[0]===p[0]?Nd(D,dn(y,2)):[]}),rp=Tn(function(p){var y=Gn(p),D=jt(p,qf);return(y="function"==typeof y?y:me)&&D.pop(),D.length&&D[0]===p[0]?Nd(D,me,y):[]});function Gn(p){var y=null==p?0:p.length;return y?p[y-1]:me}var uf=Tn(bm);function bm(p,y){return p&&p.length&&y&&y.length?Lc(p,y):p}var my=zc(function(p,y){var D=null==p?0:p.length,B=Fa(p,y);return Zu(p,jt(y,function(X){return xa(X,D)?+X:X}).sort(ry)),B});function hf(p){return null==p?p:uc.call(p)}var eh=Tn(function(p){return Tr(Er(p,1,qt,!0))}),kg=Tn(function(p){var y=Gn(p);return qt(y)&&(y=me),Tr(Er(p,1,qt,!0),dn(y,2))}),Gc=Tn(function(p){var y=Gn(p);return y="function"==typeof y?y:me,Tr(Er(p,1,qt,!0),me,y)});function Tm(p){if(!p||!p.length)return[];var y=0;return p=Rr(p,function(D){if(qt(D))return y=mt(D.length,y),!0}),fa(y,function(D){return jt(p,ws(D))})}function lp(p,y){if(!p||!p.length)return[];var D=Tm(p);return null==y?D:jt(D,function(B){return An(y,me,B)})}var cp=Tn(function(p,y){return qt(p)?dc(p,y):[]}),rd=Tn(function(p){return Jo(Rr(p,qt))}),Lg=Tn(function(p){var y=Gn(p);return qt(y)&&(y=me),Jo(Rr(p,qt),dn(y,2))}),up=Tn(function(p){var y=Gn(p);return y="function"==typeof y?y:me,Jo(Rr(p,qt),me,y)}),Or=Tn(Tm),nh=Tn(function(p){var y=p.length,D=y>1?p[y-1]:me;return D="function"==typeof D?(p.pop(),D):me,lp(p,D)});function Sm(p){var y=I(p);return y.__chain__=!0,y}function gf(p,y){return y(p)}var Mm=zc(function(p){var y=p.length,D=y?p[0]:0,B=this.__wrapped__,X=function(ae){return Fa(ae,p)};return!(y>1||this.__actions__.length)&&B instanceof ce&&xa(D)?((B=B.slice(D,+D+(y?1:0))).__actions__.push({func:gf,args:[X],thisArg:me}),new Q(B,this.__chain__).thru(function(ae){return y&&!ae.length&&ae.push(me),ae})):this.thru(X)}),od=bu(function(p,y,D){Ki.call(p,D)?++p[D]:Io(p,D,1)}),us=xu(dl),Vg=xu(Cg);function ad(p,y){return(Qt(p)?eo:Dc)(p,dn(y,3))}function fp(p,y){return(Qt(p)?Ah:Lh)(p,dn(y,3))}var ld=bu(function(p,y,D){Ki.call(p,D)?p[D].push(y):Io(p,D,[y])}),o=Tn(function(p,y,D){var B=-1,X="function"==typeof y,ae=Pi(p)?Ge(p.length):[];return Dc(p,function(be){ae[++B]=X?An(y,be,D):Bh(be,y,D)}),ae}),h=bu(function(p,y,D){Io(p,D,y)});function m(p,y){return(Qt(p)?jt:Xp)(p,dn(y,3))}var T=bu(function(p,y,D){p[D?0:1].push(y)},function(){return[[],[]]}),ne=Tn(function(p,y){if(null==p)return[];var D=y.length;return D>1&&$s(p,y[0],y[1])?y=[]:D>2&&$s(y[0],y[1],y[2])&&(y=[y[0]]),Hd(p,Er(y,1),[])}),ge=Mc||function(){return Wi.Date.now()};function Pe(p,y,D){return y=D?me:y,mc(p,128,me,me,me,me,y=p&&null==y?p.length:y)}function ze(p,y){var D;if("function"!=typeof y)throw new pa(Fn);return p=Cn(p),function(){return--p>0&&(D=y.apply(this,arguments)),p<=1&&(y=me),D}}var De=Tn(function(p,y,D){var B=1;if(D.length){var X=Nl(D,Jd(De));B|=32}return mc(p,B,y,D,X)}),Oe=Tn(function(p,y,D){var B=3;if(D.length){var X=Nl(D,Jd(Oe));B|=32}return mc(y,B,p,D,X)});function Tt(p,y,D){var B,X,ae,be,Se,Le,rt=0,tt=!1,at=!1,It=!0;if("function"!=typeof p)throw new pa(Fn);function Yt(Ms){var Yc=B,uh=X;return B=X=me,rt=Ms,be=p.apply(uh,Yc)}function yn(Ms){return rt=Ms,Se=tf(Ti,y),tt?Yt(Ms):be}function vn(Ms){var Yc=Ms-Le;return Le===me||Yc>=y||Yc<0||at&&Ms-rt>=ae}function Ti(){var Ms=ge();if(vn(Ms))return ei(Ms);Se=tf(Ti,function ri(Ms){var km=y-(Ms-Le);return at?Gr(km,ae-(Ms-rt)):km}(Ms))}function ei(Ms){return Se=me,It&&B?Yt(Ms):(B=X=me,be)}function Zl(){var Ms=ge(),Yc=vn(Ms);if(B=arguments,X=this,Le=Ms,Yc){if(Se===me)return yn(Le);if(at)return Wd(Se),Se=tf(Ti,y),Yt(Le)}return Se===me&&(Se=tf(Ti,y)),be}return y=ql(y)||0,ui(D)&&(tt=!!D.leading,ae=(at="maxWait"in D)?mt(ql(D.maxWait)||0,y):ae,It="trailing"in D?!!D.trailing:It),Zl.cancel=function gl(){Se!==me&&Wd(Se),rt=0,B=Le=X=Se=me},Zl.flush=function ja(){return Se===me?be:ei(ge())},Zl}var kt=Tn(function(p,y){return ya(p,1,y)}),bt=Tn(function(p,y,D){return ya(p,ql(y)||0,D)});function ct(p,y){if("function"!=typeof p||null!=y&&"function"!=typeof y)throw new pa(Fn);var D=function(){var B=arguments,X=y?y.apply(this,B):B[0],ae=D.cache;if(ae.has(X))return ae.get(X);var be=p.apply(this,B);return D.cache=ae.set(X,be)||ae,be};return D.cache=new(ct.Cache||rn),D}function gt(p){if("function"!=typeof p)throw new pa(Fn);return function(){var y=arguments;switch(y.length){case 0:return!p.call(this);case 1:return!p.call(this,y[0]);case 2:return!p.call(this,y[0],y[1]);case 3:return!p.call(this,y[0],y[1],y[2])}return!p.apply(this,y)}}ct.Cache=rn;var ot=Qp(function(p,y){var D=(y=1==y.length&&Qt(y[0])?jt(y[0],ai(dn())):jt(Er(y,1),ai(dn()))).length;return Tn(function(B){for(var X=-1,ae=Gr(B.length,D);++X<ae;)B[X]=y[X].call(this,B[X]);return An(p,this,B)})}),Vt=Tn(function(p,y){var D=Nl(y,Jd(Vt));return mc(p,32,me,y,D)}),Ot=Tn(function(p,y){var D=Nl(y,Jd(Ot));return mc(p,64,me,y,D)}),Bn=zc(function(p,y){return mc(p,256,me,me,me,y)});function lr(p,y){return p===y||p!=p&&y!=y}var po=Zf(va),mo=Zf(function(p,y){return p>=y}),fs=Ul(function(){return arguments}())?Ul:function(p){return Sr(p)&&Ki.call(p,"callee")&&!Ld.call(p,"callee")},Qt=Ge.isArray,Cr=Gp?ai(Gp):function $p(p){return Sr(p)&&Po(p)==ca};function Pi(p){return null!=p&&sh(p.length)&&!Qr(p)}function qt(p){return Sr(p)&&Pi(p)}var Ar=Kr||Pm,go=da?ai(da):function Bd(p){return Sr(p)&&Po(p)==Mr};function Ta(p){if(!Sr(p))return!1;var y=Po(p);return y==_r||"[object DOMException]"==y||"string"==typeof p.message&&"string"==typeof p.name&&!ah(p)}function Qr(p){if(!ui(p))return!1;var y=Po(p);return y==Js||y==la||"[object AsyncFunction]"==y||"[object Proxy]"==y}function $l(p){return"number"==typeof p&&p==Cn(p)}function sh(p){return"number"==typeof p&&p>-1&&p%1==0&&p<=vs}function ui(p){var y=typeof p;return null!=p&&("object"==y||"function"==y)}function Sr(p){return null!=p&&"object"==typeof p}var cd=tr?ai(tr):function zd(p){return Sr(p)&&fo(p)==Br};function pp(p){return"number"==typeof p||Sr(p)&&Po(p)==To}function ah(p){if(!Sr(p)||Po(p)!=Zi)return!1;var y=Cs(p);if(null===y)return!0;var D=Ki.call(y,"constructor")&&y.constructor;return"function"==typeof D&&D instanceof D&&mu.call(D)==Ph}var mp=kd?ai(kd):function zh(p){return Sr(p)&&Po(p)==Ho},lh=Mh?ai(Mh):function Vd(p){return Sr(p)&&fo(p)==yr};function ud(p){return"string"==typeof p||!Qt(p)&&Sr(p)&&Po(p)==dr}function Ca(p){return"symbol"==typeof p||Sr(p)&&Po(p)==Ya}var Oo=Dl?ai(Dl):function Ud(p){return Sr(p)&&sh(p.length)&&!!ni[Po(p)]},yc=Zf(Jr),_f=Zf(function(p,y){return p<=y});function dd(p){if(!p)return[];if(Pi(p))return ud(p)?Ts(p):ko(p);if(Vl&&p[Vl])return function nl(Ae){for(var Xe,Ge=[];!(Xe=Ae.next()).done;)Ge.push(Xe.value);return Ge}(p[Vl]());var y=fo(p);return(y==Br?Fl:y==yr?cc:yf)(p)}function vc(p){return p?(p=ql(p))===Yn||p===-Yn?17976931348623157e292*(p<0?-1:1):p==p?p:0:0===p?p:0}function Cn(p){var y=vc(p),D=y%1;return y==y?D?y-D:y:0}function Hg(p){return p?ll(Cn(p),0,Ps):0}function ql(p){if("number"==typeof p)return p;if(Ca(p))return NaN;if(ui(p)){var y="function"==typeof p.valueOf?p.valueOf():p;p=ui(y)?y+"":y}if("string"!=typeof p)return 0===p?p:+p;p=Ll(p);var D=Ve.test(p);return D||Mt.test(p)?_n(p.slice(2),D?2:8):et.test(p)?NaN:+p}function Gg(p){return pc(p,ml(p))}function cr(p){return null==p?"":ul(p)}var v0=Nc(function(p,y){if(Ju(y)||Pi(y))pc(y,_o(y),p);else for(var D in y)Ki.call(y,D)&&Lr(p,D,y[D])}),vy=Nc(function(p,y){pc(y,ml(y),p)}),Mu=Nc(function(p,y,D,B){pc(y,ml(y),p,B)}),b0=Nc(function(p,y,D,B){pc(y,_o(y),p,B)}),x0=zc(Fa),wM=Tn(function(p,y){p=Bi(p);var D=-1,B=y.length,X=B>2?y[2]:me;for(X&&$s(y[0],y[1],X)&&(B=1);++D<B;)for(var ae=y[D],be=ml(ae),Se=-1,Le=be.length;++Se<Le;){var rt=be[Se],tt=p[rt];(tt===me||lr(tt,Sc[rt])&&!Ki.call(p,rt))&&(p[rt]=ae[rt])}return p}),Wg=Tn(function(p){return p.push(me,Xh),An(Ty,me,p)});function Zg(p,y,D){var B=null==p?me:rr(p,y);return B===me?D:B}function Xg(p,y){return null!=p&&Ns(p,y,qu)}var wy=vg(function(p,y,D){null!=y&&"function"!=typeof y.toString&&(y=gu.call(y)),p[y]=D},ky(Ua)),Im=vg(function(p,y,D){null!=y&&"function"!=typeof y.toString&&(y=gu.call(y)),Ki.call(p,y)?p[y].push(D):p[y]=[D]},dn),Mw=Tn(Bh);function _o(p){return Pi(p)?wr(p):Zp(p)}function ml(p){return Pi(p)?wr(p,!0):function Fs(p){if(!ui(p))return function cy(p){var y=[];if(null!=p)for(var D in Bi(p))y.push(D);return y}(p);var y=Ju(p),D=[];for(var B in p)"constructor"==B&&(y||!Ki.call(p,B))||D.push(B);return D}(p)}var Ey=Nc(function(p,y,D){Ba(p,y,D)}),Ty=Nc(function(p,y,D,B){Ba(p,y,D,B)}),EM=zc(function(p,y){var D={};if(null==p)return D;var B=!1;y=jt(y,function(ae){return ae=ea(ae,p),B||(B=ae.length>1),ae}),pc(p,Eu(p),D),B&&(D=lo(D,7,am));for(var X=y.length;X--;)Gd(D,y[X]);return D}),Dw=zc(function(p,y){return null==p?{}:function Gf(p,y){return Wf(p,y,function(D,B){return Xg(p,B)})}(p,y)});function Cy(p,y){if(null==p)return{};var D=jt(Eu(p),function(B){return[B]});return y=dn(y),Wf(p,D,function(B,X){return y(B,X[0])})}var A0=wu(_o),Sy=wu(ml);function yf(p){return null==p?[]:ac(p,_o(p))}var Li=za(function(p,y,D){return y=y.toLowerCase(),p+(D?My(y):y)});function My(p){return _p(cr(p).toLowerCase())}function Ay(p){return(p=cr(p))&&p.replace(Wt,fu).replace(zf,"")}var Uw=za(function(p,y,D){return p+(D?"-":"")+y.toLowerCase()}),I0=za(function(p,y,D){return p+(D?" ":"")+y.toLowerCase()}),jw=Zd("toLowerCase"),Dy=za(function(p,y,D){return p+(D?"_":"")+y.toLowerCase()}),Ww=za(function(p,y,D){return p+(D?" ":"")+_p(y)}),L0=za(function(p,y,D){return p+(D?" ":"")+y.toUpperCase()}),_p=Zd("toUpperCase");function O0(p,y,D){return p=cr(p),(y=D?me:y)===me?function So(Ae){return sc.test(Ae)}(p)?function so(Ae){return Ae.match(Hp)||[]}(p):function Jt(Ae){return Ae.match(Te)||[]}(p):p.match(y)||[]}var Py=Tn(function(p,y){try{return An(p,me,y)}catch(D){return Ta(D)?D:new Ln(D)}}),Xw=zc(function(p,y){return eo(y,function(D){D=ta(D),Io(p,D,De(p[D],p))}),p});function ky(p){return function(){return p}}var F0=$h(),Qw=$h(!0);function Ua(p){return p}function Yg(p){return qp("function"==typeof p?p:lo(p,1))}var Ly=Tn(function(p,y){return function(D){return Bh(D,p,y)}}),e1=Tn(function(p,y){return function(D){return Bh(p,D,y)}});function N0(p,y,D){var B=_o(y),X=Nh(y,B);null==D&&(!ui(y)||!X.length&&B.length)&&(D=y,y=p,p=this,X=Nh(y,_o(y)));var ae=!(ui(D)&&"chain"in D&&!D.chain),be=Qr(p);return eo(X,function(Se){var Le=y[Se];p[Se]=Le,be&&(p.prototype[Se]=function(){var rt=this.__chain__;if(ae||rt){var tt=p(this.__wrapped__),at=tt.__actions__=ko(this.__actions__);return at.push({func:Le,args:arguments,thisArg:p}),tt.__chain__=rt,tt}return Le.apply(p,kl([this.value()],arguments))})}),p}function Kg(){}var Jg=Yd(jt),Xc=Yd(uu),z0=Yd(un);function V0(p){return Uc(p)?ws(ta(p)):function Vh(p){return function(y){return rr(y,p)}}(p)}var ch=qh(),Fy=qh(!0);function Qg(){return[]}function Pm(){return!1}var By=nt(function(p,y){return p+y},0),zy=Yu("ceil"),kM=nt(function(p,y){return p/y},1),t1=Yu("floor"),LM=nt(function(p,y){return p*y},1),H0=Yu("round"),G0=nt(function(p,y){return p-y},0);return I.after=function pe(p,y){if("function"!=typeof y)throw new pa(Fn);return p=Cn(p),function(){if(--p<1)return y.apply(this,arguments)}},I.ary=Pe,I.assign=v0,I.assignIn=vy,I.assignInWith=Mu,I.assignWith=b0,I.at=x0,I.before=ze,I.bind=De,I.bindAll=Xw,I.bindKey=Oe,I.castArray=function Fr(){if(!arguments.length)return[];var p=arguments[0];return Qt(p)?p:[p]},I.chain=Sm,I.chunk=function hy(p,y,D){y=(D?$s(p,y,D):y===me)?1:mt(Cn(y),0);var B=null==p?0:p.length;if(!B||y<1)return[];for(var X=0,ae=0,be=Ge(Ac(B/y));X<B;)be[ae++]=ba(p,X,X+=y);return be},I.compact=function af(p){for(var y=-1,D=null==p?0:p.length,B=0,X=[];++y<D;){var ae=p[y];ae&&(X[B++]=ae)}return X},I.concat=function gc(){var p=arguments.length;if(!p)return[];for(var y=Ge(p-1),D=arguments[0],B=p;B--;)y[B-1]=arguments[B];return kl(Qt(D)?ko(D):[D],Er(y,1))},I.cond=function Yw(p){var y=null==p?0:p.length,D=dn();return p=y?jt(p,function(B){if("function"!=typeof B[1])throw new pa(Fn);return[D(B[0]),B[1]]}):[],Tn(function(B){for(var X=-1;++X<y;){var ae=p[X];if(An(ae[0],this,B))return An(ae[1],this,B)}})},I.conforms=function Kw(p){return function hc(p){var y=_o(p);return function(D){return co(D,p,y)}}(lo(p,1))},I.constant=ky,I.countBy=od,I.create=function Cw(p,y){var D=H(p);return null==y?D:Ko(D,y)},I.curry=function Ke(p,y,D){var B=mc(p,8,me,me,me,me,me,y=D?me:y);return B.placeholder=Ke.placeholder,B},I.curryRight=function Ze(p,y,D){var B=mc(p,16,me,me,me,me,me,y=D?me:y);return B.placeholder=Ze.placeholder,B},I.debounce=Tt,I.defaults=wM,I.defaultsDeep=Wg,I.defer=kt,I.delay=bt,I.difference=lf,I.differenceBy=mm,I.differenceWith=gm,I.drop=function np(p,y,D){var B=null==p?0:p.length;return B?ba(p,(y=D||y===me?1:Cn(y))<0?0:y,B):[]},I.dropRight=function Tg(p,y,D){var B=null==p?0:p.length;return B?ba(p,0,(y=B-(y=D||y===me?1:Cn(y)))<0?0:y):[]},I.dropRightWhile=function p0(p,y){return p&&p.length?Jp(p,dn(y,3),!0,!0):[]},I.dropWhile=function m0(p,y){return p&&p.length?Jp(p,dn(y,3),!0):[]},I.fill=function ip(p,y,D,B){var X=null==p?0:p.length;return X?(D&&"number"!=typeof D&&$s(p,y,D)&&(D=0,B=X),function Oh(p,y,D,B){var X=p.length;for((D=Cn(D))<0&&(D=-D>X?0:X+D),(B=B===me||B>X?X:Cn(B))<0&&(B+=X),B=D>B?0:Hg(B);D<B;)p[D++]=y;return p}(p,y,D,B)):[]},I.filter=function ih(p,y){return(Qt(p)?Rr:Ic)(p,dn(y,3))},I.flatMap=function _0(p,y){return Er(m(p,y),1)},I.flatMapDeep=function rh(p,y){return Er(m(p,y),Yn)},I.flatMapDepth=function _c(p,y,D){return D=D===me?1:Cn(D),Er(m(p,y),D)},I.flatten=Su,I.flattenDeep=function _m(p){return null!=p&&p.length?Er(p,Yn):[]},I.flattenDepth=function Sg(p,y){return null!=p&&p.length?Er(p,y=y===me?1:Cn(y)):[]},I.flip=function ft(p){return mc(p,512)},I.flow=F0,I.flowRight=Qw,I.fromPairs=function Mg(p){for(var y=-1,D=null==p?0:p.length,B={};++y<D;){var X=p[y];B[X[0]]=X[1]}return B},I.functions=function $g(p){return null==p?[]:Nh(p,_o(p))},I.functionsIn=function qg(p){return null==p?[]:Nh(p,ml(p))},I.groupBy=ld,I.initial=function Ag(p){return null!=p&&p.length?ba(p,0,-1):[]},I.intersection=cf,I.intersectionBy=vm,I.intersectionWith=rp,I.invert=wy,I.invertBy=Im,I.invokeMap=o,I.iteratee=Yg,I.keyBy=h,I.keys=_o,I.keysIn=ml,I.map=m,I.mapKeys=function Aw(p,y){var D={};return y=dn(y,3),uo(p,function(B,X,ae){Io(D,y(B,X,ae),B)}),D},I.mapValues=function S0(p,y){var D={};return y=dn(y,3),uo(p,function(B,X,ae){Io(D,X,y(B,X,ae))}),D},I.matches=function Ry(p){return jd(lo(p,1))},I.matchesProperty=function DM(p,y){return Hf(p,lo(y,1))},I.memoize=ct,I.merge=Ey,I.mergeWith=Ty,I.method=Ly,I.methodOf=e1,I.mixin=N0,I.negate=gt,I.nthArg=function B0(p){return p=Cn(p),Tn(function(y){return Ws(y,p)})},I.omit=EM,I.omitBy=function M0(p,y){return Cy(p,gt(dn(y)))},I.once=function _t(p){return ze(2,p)},I.orderBy=function b(p,y,D,B){return null==p?[]:(Qt(y)||(y=null==y?[]:[y]),Qt(D=B?me:D)||(D=null==D?[]:[D]),Hd(p,y,D))},I.over=Jg,I.overArgs=ot,I.overEvery=Xc,I.overSome=z0,I.partial=Vt,I.partialRight=Ot,I.partition=T,I.pick=Dw,I.pickBy=Cy,I.property=V0,I.propertyOf=function Oy(p){return function(y){return null==p?me:rr(p,y)}},I.pull=uf,I.pullAll=bm,I.pullAllBy=function fy(p,y,D){return p&&p.length&&y&&y.length?Lc(p,y,dn(D,2)):p},I.pullAllWith=function py(p,y,D){return p&&p.length&&y&&y.length?Lc(p,y,me,D):p},I.pullAt=my,I.range=ch,I.rangeRight=Fy,I.rearg=Bn,I.reject=function O(p,y){return(Qt(p)?Rr:Ic)(p,gt(dn(y,3)))},I.remove=function td(p,y){var D=[];if(!p||!p.length)return D;var B=-1,X=[],ae=p.length;for(y=dn(y,3);++B<ae;){var be=p[B];y(be,B,p)&&(D.push(be),X.push(B))}return Zu(p,X),D},I.rest=function or(p,y){if("function"!=typeof p)throw new pa(Fn);return Tn(p,y=y===me?y:Cn(y))},I.reverse=hf,I.sampleSize=function j(p,y,D){return y=(D?$s(p,y,D):y===me)?1:Cn(y),(Qt(p)?Zn:gg)(p,y)},I.set=function Pw(p,y,D){return null==p?p:Lt(p,y,D)},I.setWith=function qc(p,y,D,B){return B="function"==typeof B?B:me,null==p?p:Lt(p,y,D,B)},I.shuffle=function W(p){return(Qt(p)?On:Kp)(p)},I.slice=function gy(p,y,D){var B=null==p?0:p.length;return B?(D&&"number"!=typeof D&&$s(p,y,D)?(y=0,D=B):(y=null==y?0:Cn(y),D=D===me?B:Cn(D)),ba(p,y,D)):[]},I.sortBy=ne,I.sortedUniq=function _y(p){return p&&p.length?jh(p):[]},I.sortedUniqBy=function Pg(p,y){return p&&p.length?jh(p,dn(y,2)):[]},I.split=function Iy(p,y,D){return D&&"number"!=typeof D&&$s(p,y,D)&&(y=D=me),(D=D===me?Ps:D>>>0)?(p=cr(p))&&("string"==typeof y||null!=y&&!mp(y))&&!(y=ul(y))&&Zo(p)?Hl(Ts(p),0,D):p.split(y,D):[]},I.spread=function ar(p,y){if("function"!=typeof p)throw new pa(Fn);return y=null==y?0:mt(Cn(y),0),Tn(function(D){var B=D[y],X=Hl(D,0,y);return B&&kl(X,B),An(p,this,X)})},I.tail=function ff(p){var y=null==p?0:p.length;return y?ba(p,1,y):[]},I.take=function pf(p,y,D){return p&&p.length?ba(p,0,(y=D||y===me?1:Cn(y))<0?0:y):[]},I.takeRight=function g0(p,y,D){var B=null==p?0:p.length;return B?ba(p,(y=B-(y=D||y===me?1:Cn(y)))<0?0:y,B):[]},I.takeRightWhile=function Em(p,y){return p&&p.length?Jp(p,dn(y,3),!1,!0):[]},I.takeWhile=function mf(p,y){return p&&p.length?Jp(p,dn(y,3)):[]},I.tap=function Og(p,y){return y(p),p},I.throttle=function hs(p,y,D){var B=!0,X=!0;if("function"!=typeof p)throw new pa(Fn);return ui(D)&&(B="leading"in D?!!D.leading:B,X="trailing"in D?!!D.trailing:X),Tt(p,y,{leading:B,maxWait:y,trailing:X})},I.thru=gf,I.toArray=dd,I.toPairs=A0,I.toPairsIn=Sy,I.toPath=function t_(p){return Qt(p)?jt(p,ta):Ca(p)?[p]:ko(rf(cr(p)))},I.toPlainObject=Gg,I.transform=function kw(p,y,D){var B=Qt(p),X=B||Ar(p)||Oo(p);if(y=dn(y,4),null==D){var ae=p&&p.constructor;D=X?B?new ae:[]:ui(p)&&Qr(ae)?H(Cs(p)):{}}return(X?eo:uo)(p,function(be,Se,Le){return y(D,be,Se,Le)}),D},I.unary=function Va(p){return Pe(p,1)},I.union=eh,I.unionBy=kg,I.unionWith=Gc,I.uniq=function Rg(p){return p&&p.length?Tr(p):[]},I.uniqBy=function nd(p,y){return p&&p.length?Tr(p,dn(y,2)):[]},I.uniqWith=function id(p,y){return y="function"==typeof y?y:me,p&&p.length?Tr(p,me,y):[]},I.unset=function Rw(p,y){return null==p||Gd(p,y)},I.unzip=Tm,I.unzipWith=lp,I.update=function Lw(p,y,D){return null==p?p:Hh(p,y,sr(D))},I.updateWith=function Ow(p,y,D,B){return B="function"==typeof B?B:me,null==p?p:Hh(p,y,sr(D),B)},I.values=yf,I.valuesIn=function Fw(p){return null==p?[]:ac(p,ml(p))},I.without=cp,I.words=O0,I.wrap=function Vi(p,y){return Vt(sr(y),p)},I.xor=rd,I.xorBy=Lg,I.xorWith=up,I.zip=Or,I.zipObject=function th(p,y){return Qo(p||[],y||[],Lr)},I.zipObjectDeep=function Cm(p,y){return Qo(p||[],y||[],Lt)},I.zipWith=nh,I.entries=A0,I.entriesIn=Sy,I.extend=vy,I.extendWith=Mu,N0(I,I),I.add=By,I.attempt=Py,I.camelCase=Li,I.capitalize=My,I.ceil=zy,I.clamp=function Nw(p,y,D){return D===me&&(D=y,y=me),D!==me&&(D=(D=ql(D))==D?D:0),y!==me&&(y=(y=ql(y))==y?y:0),ll(ql(p),y,D)},I.clone=function ds(p){return lo(p,4)},I.cloneDeep=function Ui(p){return lo(p,5)},I.cloneDeepWith=function Bs(p,y){return lo(p,5,y="function"==typeof y?y:me)},I.cloneWith=function Ss(p,y){return lo(p,4,y="function"==typeof y?y:me)},I.conformsTo=function qr(p,y){return null==y||co(p,y,_o(y))},I.deburr=Ay,I.defaultTo=function Jw(p,y){return null==p||p!=p?y:p},I.divide=kM,I.endsWith=function zw(p,y,D){p=cr(p),y=ul(y);var B=p.length,X=D=D===me?B:ll(Cn(D),0,B);return(D-=y.length)>=0&&p.slice(D,X)==y},I.eq=lr,I.escape=function Vw(p){return(p=cr(p))&&Xr.test(p)?p.replace(Aa,lc):p},I.escapeRegExp=function D0(p){return(p=cr(p))&&le.test(p)?p.replace(ha,"\\$&"):p},I.every=function zg(p,y,D){var B=Qt(p)?uu:Fd;return D&&$s(p,y,D)&&(y=me),B(p,dn(y,3))},I.find=us,I.findIndex=dl,I.findKey=function Sw(p,y){return to(p,dn(y,3),uo)},I.findLast=Vg,I.findLastIndex=Cg,I.findLastKey=function w0(p,y){return to(p,dn(y,3),Fh)},I.floor=t1,I.forEach=ad,I.forEachRight=fp,I.forIn=function E0(p,y){return null==p?p:Na(p,dn(y,3),ml)},I.forInRight=function T0(p,y){return null==p?p:Uf(p,dn(y,3),ml)},I.forOwn=function by(p,y){return p&&uo(p,dn(y,3))},I.forOwnRight=function C0(p,y){return p&&Fh(p,dn(y,3))},I.get=Zg,I.gt=po,I.gte=mo,I.has=function xy(p,y){return null!=p&&Ns(p,y,kc)},I.hasIn=Xg,I.head=ym,I.identity=Ua,I.includes=function c(p,y,D,B){p=Pi(p)?p:yf(p),D=D&&!B?Cn(D):0;var X=p.length;return D<0&&(D=mt(X+D,0)),ud(p)?D<=X&&p.indexOf(y,D)>-1:!!X&&Ur(p,y,D)>-1},I.indexOf=function dy(p,y,D){var B=null==p?0:p.length;if(!B)return-1;var X=null==D?0:Cn(D);return X<0&&(X=mt(B+X,0)),Ur(p,y,X)},I.inRange=function Bw(p,y,D){return y=vc(y),D===me?(D=y,y=0):D=vc(D),function fg(p,y,D){return p>=Gr(y,D)&&p<mt(y,D)}(p=ql(p),y,D)},I.invoke=Mw,I.isArguments=fs,I.isArray=Qt,I.isArrayBuffer=Cr,I.isArrayLike=Pi,I.isArrayLikeObject=qt,I.isBoolean=function Ea(p){return!0===p||!1===p||Sr(p)&&Po(p)==Kn},I.isBuffer=Ar,I.isDate=go,I.isElement=function fl(p){return Sr(p)&&1===p.nodeType&&!ah(p)},I.isEmpty=function Lo(p){if(null==p)return!0;if(Pi(p)&&(Qt(p)||"string"==typeof p||"function"==typeof p.splice||Ar(p)||Oo(p)||fs(p)))return!p.length;var y=fo(p);if(y==Br||y==yr)return!p.size;if(Ju(p))return!Zp(p).length;for(var D in p)if(Ki.call(p,D))return!1;return!0},I.isEqual=function zs(p,y){return Rc(p,y)},I.isEqualWith=function Wc(p,y,D){var B=(D="function"==typeof D?D:me)?D(p,y):me;return B===me?Rc(p,y,me,D):!!B},I.isError=Ta,I.isFinite=function pl(p){return"number"==typeof p&&Ra(p)},I.isFunction=Qr,I.isInteger=$l,I.isLength=sh,I.isMap=cd,I.isMatch=function $c(p,y){return p===y||jl(p,y,cm(y))},I.isMatchWith=function Am(p,y,D){return D="function"==typeof D?D:me,jl(p,y,cm(y),D)},I.isNaN=function Dm(p){return pp(p)&&p!=+p},I.isNative=function oh(p){if(Qf(p))throw new Ln("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return mg(p)},I.isNil=function yy(p){return null==p},I.isNull=function Ug(p){return null===p},I.isNumber=pp,I.isObject=ui,I.isObjectLike=Sr,I.isPlainObject=ah,I.isRegExp=mp,I.isSafeInteger=function y0(p){return $l(p)&&p>=-vs&&p<=vs},I.isSet=lh,I.isString=ud,I.isSymbol=Ca,I.isTypedArray=Oo,I.isUndefined=function hd(p){return p===me},I.isWeakMap=function jg(p){return Sr(p)&&fo(p)==He},I.isWeakSet=function na(p){return Sr(p)&&"[object WeakSet]"==Po(p)},I.join=function sp(p,y){return null==p?"":Rh.call(p,y)},I.kebabCase=Uw,I.last=Gn,I.lastIndexOf=function op(p,y,D){var B=null==p?0:p.length;if(!B)return-1;var X=B;return D!==me&&(X=(X=Cn(D))<0?mt(B+X,0):Gr(X,B-1)),y==y?function pu(Ae,Xe,Ge){for(var Rt=Ge+1;Rt--;)if(Ae[Rt]===Xe)return Rt;return Rt}(p,y,X):Ai(p,Rl,X,!0)},I.lowerCase=I0,I.lowerFirst=jw,I.lt=yc,I.lte=_f,I.max=function n1(p){return p&&p.length?vu(p,Ua,va):me},I.maxBy=function r1(p,y){return p&&p.length?vu(p,dn(y,2),va):me},I.mean=function s1(p){return xs(p,Ua)},I.meanBy=function j0(p,y){return xs(p,dn(y,2))},I.min=function RM(p){return p&&p.length?vu(p,Ua,Jr):me},I.minBy=function o1(p,y){return p&&p.length?vu(p,dn(y,2),Jr):me},I.stubArray=Qg,I.stubFalse=Pm,I.stubObject=function IM(){return{}},I.stubString=function U0(){return""},I.stubTrue=function PM(){return!0},I.multiply=LM,I.nth=function ap(p,y){return p&&p.length?Ws(p,Cn(y)):me},I.noConflict=function Ye(){return Wi._===this&&(Wi._=dg),this},I.noop=Kg,I.now=ge,I.pad=function Hw(p,y,D){p=cr(p);var B=(y=Cn(y))?Mo(p):0;if(!y||B>=y)return p;var X=(y-B)/2;return Gl(Wu(X),D)+p+Gl(Ac(X),D)},I.padEnd=function TM(p,y,D){p=cr(p);var B=(y=Cn(y))?Mo(p):0;return y&&B<y?p+Gl(y-B,D):p},I.padStart=function P0(p,y,D){p=cr(p);var B=(y=Cn(y))?Mo(p):0;return y&&B<y?Gl(y-B,D)+p:p},I.parseInt=function k0(p,y,D){return D||null==y?y=0:y&&(y=+y),Yo(cr(p).replace(U,""),y||0)},I.random=function Xn(p,y,D){if(D&&"boolean"!=typeof D&&$s(p,y,D)&&(y=D=me),D===me&&("boolean"==typeof y?(D=y,y=me):"boolean"==typeof p&&(D=p,p=me)),p===me&&y===me?(p=0,y=1):(p=vc(p),y===me?(y=p,p=0):y=vc(y)),p>y){var B=p;p=y,y=B}if(D||p%1||y%1){var X=zi();return Gr(p+X*(y-p+Th("1e-"+((X+"").length-1))),y)}return fc(p,y)},I.reduce=function S(p,y,D){var B=Qt(p)?Un:Dn,X=arguments.length<3;return B(p,dn(y,4),D,X,Dc)},I.reduceRight=function k(p,y,D){var B=Qt(p)?mi:Dn,X=arguments.length<3;return B(p,dn(y,4),D,X,Lh)},I.repeat=function Zc(p,y,D){return y=(D?$s(p,y,D):y===me)?1:Cn(y),Xu(cr(p),y)},I.replace=function Gw(){var p=arguments,y=cr(p[0]);return p.length<3?y:y.replace(p[1],p[2])},I.result=function Iw(p,y,D){var B=-1,X=(y=ea(y,p)).length;for(X||(X=1,p=me);++B<X;){var ae=null==p?me:p[ta(y[B])];ae===me&&(B=X,ae=D),p=Qr(ae)?ae.call(p):ae}return p},I.round=H0,I.runInContext=Ae,I.sample=function z(p){return(Qt(p)?_a:cl)(p)},I.size=function J(p){if(null==p)return 0;if(Pi(p))return ud(p)?Mo(p):p.length;var y=fo(p);return y==Br||y==yr?p.size:Zp(p).length},I.snakeCase=Dy,I.some=function te(p,y,D){var B=Qt(p)?un:ny;return D&&$s(p,y,D)&&(y=me),B(p,dn(y,3))},I.sortedIndex=function Dg(p,y){return Oc(p,y)},I.sortedIndexBy=function df(p,y,D){return Uh(p,y,dn(D,2))},I.sortedIndexOf=function Hc(p,y){var D=null==p?0:p.length;if(D){var B=Oc(p,y);if(B<D&&lr(p[B],y))return B}return-1},I.sortedLastIndex=function xm(p,y){return Oc(p,y,!0)},I.sortedLastIndexBy=function wm(p,y,D){return Uh(p,y,dn(D,2),!0)},I.sortedLastIndexOf=function Ig(p,y){if(null!=p&&p.length){var B=Oc(p,y,!0)-1;if(lr(p[B],y))return B}return-1},I.startCase=Ww,I.startsWith=function CM(p,y,D){return p=cr(p),D=null==D?0:ll(Cn(D),0,p.length),y=ul(y),p.slice(D,D+y.length)==y},I.subtract=G0,I.sum=function a1(p){return p&&p.length?Es(p,Ua):0},I.sumBy=function Vy(p,y){return p&&p.length?Es(p,dn(y,2)):0},I.template=function SM(p,y,D){var B=I.templateSettings;D&&$s(p,y,D)&&(y=me),p=cr(p),y=Mu({},y,B,Zh);var Se,Le,X=Mu({},y.imports,B.imports,Zh),ae=_o(X),be=ac(X,ae),rt=0,tt=y.interpolate||$t,at="__p += '",It=il((y.escape||$t).source+"|"+tt.source+"|"+(tt===Wo?Ce:$t).source+"|"+(y.evaluate||$t).source+"|$","g"),Yt="//# sourceURL="+(Ki.call(y,"sourceURL")?(y.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Pd+"]")+"\n";p.replace(It,function(vn,Ti,ei,gl,ja,Zl){return ei||(ei=gl),at+=p.slice(rt,Zl).replace(Qn,Ls),Ti&&(Se=!0,at+="' +\n__e("+Ti+") +\n'"),ja&&(Le=!0,at+="';\n"+ja+";\n__p += '"),ei&&(at+="' +\n((__t = ("+ei+")) == null ? '' : __t) +\n'"),rt=Zl+vn.length,vn}),at+="';\n";var yn=Ki.call(y,"variable")&&y.variable;if(yn){if(we.test(yn))throw new Ln("Invalid `variable` option passed into `_.template`")}else at="with (obj) {\n"+at+"\n}\n";at=(Le?at.replace(Ma,""):at).replace(tn,"$1").replace(ua,"$1;"),at="function("+(yn||"obj")+") {\n"+(yn?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(Se?", __e = _.escape":"")+(Le?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+at+"return __p\n}";var ri=Py(function(){return Ni(ae,Yt+"return "+at).apply(me,be)});if(ri.source=at,Ta(ri))throw ri;return ri},I.times=function e_(p,y){if((p=Cn(p))<1||p>vs)return[];var D=Ps,B=Gr(p,Ps);y=dn(y),p-=Ps;for(var X=fa(B,y);++D<p;)y(D);return X},I.toFinite=vc,I.toInteger=Cn,I.toLength=Hg,I.toLower=function MM(p){return cr(p).toLowerCase()},I.toNumber=ql,I.toSafeInteger=function Tw(p){return p?ll(Cn(p),-vs,vs):0===p?p:0},I.toString=cr,I.toUpper=function $w(p){return cr(p).toUpperCase()},I.trim=function R0(p,y,D){if((p=cr(p))&&(D||y===me))return Ll(p);if(!p||!(y=ul(y)))return p;var B=Ts(p),X=Ts(y);return Hl(B,In(B,X),tl(B,X)+1).join("")},I.trimEnd=function AM(p,y,D){if((p=cr(p))&&(D||y===me))return p.slice(0,jr(p)+1);if(!p||!(y=ul(y)))return p;var B=Ts(p);return Hl(B,0,tl(B,Ts(y))+1).join("")},I.trimStart=function qw(p,y,D){if((p=cr(p))&&(D||y===me))return p.replace(U,"");if(!p||!(y=ul(y)))return p;var B=Ts(p);return Hl(B,In(B,Ts(y))).join("")},I.truncate=function gp(p,y){var D=30,B="...";if(ui(y)){var X="separator"in y?y.separator:X;D="length"in y?Cn(y.length):D,B="omission"in y?ul(y.omission):B}var ae=(p=cr(p)).length;if(Zo(p)){var be=Ts(p);ae=be.length}if(D>=ae)return p;var Se=D-Mo(B);if(Se<1)return B;var Le=be?Hl(be,0,Se).join(""):p.slice(0,Se);if(X===me)return Le+B;if(be&&(Se+=Le.length-Se),mp(X)){if(p.slice(Se).search(X)){var rt,tt=Le;for(X.global||(X=il(X.source,cr(je.exec(X))+"g")),X.lastIndex=0;rt=X.exec(tt);)var at=rt.index;Le=Le.slice(0,at===me?Se:at)}}else if(p.indexOf(ul(X),Se)!=Se){var It=Le.lastIndexOf(X);It>-1&&(Le=Le.slice(0,It))}return Le+B},I.unescape=function Zw(p){return(p=cr(p))&&vr.test(p)?p.replace(zr,ju):p},I.uniqueId=function Ny(p){var y=++Vf;return cr(p)+y},I.upperCase=L0,I.upperFirst=_p,I.each=ad,I.eachRight=fp,I.first=ym,N0(I,function(){var p={};return uo(I,function(y,D){Ki.call(I.prototype,D)||(p[D]=y)}),p}(),{chain:!1}),I.VERSION="4.17.21",eo(["bind","bindKey","curry","curryRight","partial","partialRight"],function(p){I[p].placeholder=I}),eo(["drop","take"],function(p,y){ce.prototype[p]=function(D){D=D===me?1:mt(Cn(D),0);var B=this.__filtered__&&!y?new ce(this):this.clone();return B.__filtered__?B.__takeCount__=Gr(D,B.__takeCount__):B.__views__.push({size:Gr(D,Ps),type:p+(B.__dir__<0?"Right":"")}),B},ce.prototype[p+"Right"]=function(D){return this.reverse()[p](D).reverse()}}),eo(["filter","map","takeWhile"],function(p,y){var D=y+1,B=1==D||3==D;ce.prototype[p]=function(X){var ae=this.clone();return ae.__iteratees__.push({iteratee:dn(X,3),type:D}),ae.__filtered__=ae.__filtered__||B,ae}}),eo(["head","last"],function(p,y){var D="take"+(y?"Right":"");ce.prototype[p]=function(){return this[D](1).value()[0]}}),eo(["initial","tail"],function(p,y){var D="drop"+(y?"":"Right");ce.prototype[p]=function(){return this.__filtered__?new ce(this):this[D](1)}}),ce.prototype.compact=function(){return this.filter(Ua)},ce.prototype.find=function(p){return this.filter(p).head()},ce.prototype.findLast=function(p){return this.reverse().find(p)},ce.prototype.invokeMap=Tn(function(p,y){return"function"==typeof p?new ce(this):this.map(function(D){return Bh(D,p,y)})}),ce.prototype.reject=function(p){return this.filter(gt(dn(p)))},ce.prototype.slice=function(p,y){p=Cn(p);var D=this;return D.__filtered__&&(p>0||y<0)?new ce(D):(p<0?D=D.takeRight(-p):p&&(D=D.drop(p)),y!==me&&(D=(y=Cn(y))<0?D.dropRight(-y):D.take(y-p)),D)},ce.prototype.takeRightWhile=function(p){return this.reverse().takeWhile(p).reverse()},ce.prototype.toArray=function(){return this.take(Ps)},uo(ce.prototype,function(p,y){var D=/^(?:filter|find|map|reject)|While$/.test(y),B=/^(?:head|last)$/.test(y),X=I[B?"take"+("last"==y?"Right":""):y],ae=B||/^find/.test(y);!X||(I.prototype[y]=function(){var be=this.__wrapped__,Se=B?[1]:arguments,Le=be instanceof ce,rt=Se[0],tt=Le||Qt(be),at=function(Ti){var ei=X.apply(I,kl([Ti],Se));return B&&It?ei[0]:ei};tt&&D&&"function"==typeof rt&&1!=rt.length&&(Le=tt=!1);var It=this.__chain__,Yt=!!this.__actions__.length,yn=ae&&!It,ri=Le&&!Yt;if(!ae&&tt){be=ri?be:new ce(this);var vn=p.apply(be,Se);return vn.__actions__.push({func:gf,args:[at],thisArg:me}),new Q(vn,It)}return yn&&ri?p.apply(this,Se):(vn=this.thru(at),yn?B?vn.value()[0]:vn.value():vn)})}),eo(["pop","push","shift","sort","splice","unshift"],function(p){var y=Bl[p],D=/^(?:push|sort|unshift)$/.test(p)?"tap":"thru",B=/^(?:pop|shift)$/.test(p);I.prototype[p]=function(){var X=arguments;if(B&&!this.__chain__){var ae=this.value();return y.apply(Qt(ae)?ae:[],X)}return this[D](function(be){return y.apply(Qt(be)?be:[],X)})}}),uo(ce.prototype,function(p,y){var D=I[y];if(D){var B=D.name+"";Ki.call(v,B)||(v[B]=[]),v[B].push({name:y,func:D})}}),v[Bc(me,2).name]=[{name:"wrapper",func:me}],ce.prototype.clone=function ue(){var p=new ce(this.__wrapped__);return p.__actions__=ko(this.__actions__),p.__dir__=this.__dir__,p.__filtered__=this.__filtered__,p.__iteratees__=ko(this.__iteratees__),p.__takeCount__=this.__takeCount__,p.__views__=ko(this.__views__),p},ce.prototype.reverse=function he(){if(this.__filtered__){var p=new ce(this);p.__dir__=-1,p.__filtered__=!0}else(p=this.clone()).__dir__*=-1;return p},ce.prototype.value=function Ee(){var p=this.__wrapped__.value(),y=this.__dir__,D=Qt(p),B=y<0,X=D?p.length:0,ae=function ay(p,y,D){for(var B=-1,X=D.length;++B<X;){var ae=D[B],be=ae.size;switch(ae.type){case"drop":p+=be;break;case"dropRight":y-=be;break;case"take":y=Gr(y,p+be);break;case"takeRight":p=mt(p,y-be)}}return{start:p,end:y}}(0,X,this.__views__),be=ae.start,Se=ae.end,Le=Se-be,rt=B?Se:be-1,tt=this.__iteratees__,at=tt.length,It=0,Yt=Gr(Le,this.__takeCount__);if(!D||!B&&X==Le&&Yt==Le)return $f(p,this.__actions__);var yn=[];e:for(;Le--&&It<Yt;){for(var ri=-1,vn=p[rt+=y];++ri<at;){var Ti=tt[ri],gl=Ti.type,ja=(0,Ti.iteratee)(vn);if(2==gl)vn=ja;else if(!ja){if(1==gl)continue e;break e}}yn[It++]=vn}return yn},I.prototype.at=Mm,I.prototype.chain=function sd(){return Sm(this)},I.prototype.commit=function Fg(){return new Q(this.value(),this.__chain__)},I.prototype.next=function hp(){this.__values__===me&&(this.__values__=dd(this.value()));var p=this.__index__>=this.__values__.length;return{done:p,value:p?me:this.__values__[this.__index__++]}},I.prototype.plant=function wa(p){for(var y,D=this;D instanceof q;){var B=sf(D);B.__index__=0,B.__values__=me,y?X.__wrapped__=B:y=B;var X=B;D=D.__wrapped__}return X.__wrapped__=p,y},I.prototype.reverse=function dp(){var p=this.__wrapped__;if(p instanceof ce){var y=p;return this.__actions__.length&&(y=new ce(this)),(y=y.reverse()).__actions__.push({func:gf,args:[hf],thisArg:me}),new Q(y,this.__chain__)}return this.thru(hf)},I.prototype.toJSON=I.prototype.valueOf=I.prototype.value=function Bg(){return $f(this.__wrapped__,this.__actions__)},I.prototype.first=I.prototype.head,Vl&&(I.prototype[Vl]=function Ng(){return this}),I}();Wi._=Ao,(Wn=function(){return Ao}.call(_s,ns,_s,Uo))!==me&&(Uo.exports=Wn)}.call(this)},521:()=>{},249:()=>{},943:function(Uo){Uo.exports=function(){"use strict";var _s,ns,Wn;function me(w,Gt){if(_s)if(ns){var Fn="var sharedChunk = {}; ("+_s+")(sharedChunk); ("+ns+")(sharedChunk);",yi={};_s(yi),Wn=Gt(yi),typeof window<"u"&&(Wn.workerUrl=window.URL.createObjectURL(new Blob([Fn],{type:"text/javascript"})))}else ns=Gt;else _s=Gt}return me(0,function(w){var Gt=Fn;function Fn(c,o,h,m){this.cx=3*c,this.bx=3*(h-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(m-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=o,this.p2x=h,this.p2y=m}function yi(c,o,h,m){const b=new Gt(c,o,h,m);return function(T){return b.solve(T)}}Fn.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,o){if(void 0===o&&(o=1e-6),c<0)return 0;if(c>1)return 1;for(var h=c,m=0;m<8;m++){var b=this.sampleCurveX(h)-c;if(Math.abs(b)<o)return h;var T=this.sampleCurveDerivativeX(h);if(Math.abs(T)<1e-6)break;h-=b/T}var S=0,k=1;for(h=c,m=0;m<20&&(b=this.sampleCurveX(h),!(Math.abs(b-c)<o));m++)c>b?S=h:k=h,h=.5*(k-S)+S;return h},solve:function(c,o){return this.sampleCurveY(this.solveCurveX(c,o))}};const en=yi(.25,.1,.25,1);function Ne(c,o,h){return Math.min(h,Math.max(o,c))}function wn(c,o,h){const m=h-o,b=((c-o)%m+m)%m+o;return b===o?h:b}function sn(c,...o){for(const h of o)for(const m in h)c[m]=h[m];return c}let vt=1;function Mn(c,o){c.forEach(h=>{o[h]&&(o[h]=o[h].bind(o))})}function di(c,o,h){const m={};for(const b in c)m[b]=o.call(h||this,c[b],b,c);return m}function Jn(c,o,h){const m={};for(const b in c)o.call(h||this,c[b],b,c)&&(m[b]=c[b]);return m}function xn(c){return Array.isArray(c)?c.map(xn):"object"==typeof c&&c?di(c,xn):c}const er={};function Ci(c){er[c]||(typeof console<"u"&&console.warn(c),er[c]=!0)}function si(c,o,h){return(h.y-c.y)*(o.x-c.x)>(o.y-c.y)*(h.x-c.x)}function is(c){let o=0;for(let h,m,b=0,T=c.length,S=T-1;b<T;S=b++)h=c[b],m=c[S],o+=(m.x-h.x)*(h.y+m.y);return o}function hr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function xo(c){const o={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(h,m,b,T)=>{const S=b||T;return o[m]=!S||S.toLowerCase(),""}),o["max-age"]){const h=parseInt(o["max-age"],10);isNaN(h)?delete o["max-age"]:o["max-age"]=h}return o}let Ir,Zr,Is=null;function wo(c){if(null==Is){const o=c.navigator?c.navigator.userAgent:null;Is=!!c.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return Is}function Xs(c){return typeof ImageBitmap<"u"&&c instanceof ImageBitmap}const Ys={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(c){const o=requestAnimationFrame(c);return{cancel:()=>cancelAnimationFrame(o)}},getImageData(c,o=0){const h=window.document.createElement("canvas"),m=h.getContext("2d");if(!m)throw new Error("failed to create canvas 2d context");return h.width=c.width,h.height=c.height,m.drawImage(c,0,0,c.width,c.height),m.getImageData(-o,-o,c.width+2*o,c.height+2*o)},resolveURL:c=>(Ir||(Ir=document.createElement("a")),Ir.href=c,Ir.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(null==Zr&&(Zr=matchMedia("(prefers-reduced-motion: reduce)")),Zr.matches)}};var Zt=ys;function ys(c,o){this.x=c,this.y=o}ys.prototype={clone:function(){return new ys(this.x,this.y)},add:function(c){return this.clone()._add(c)},sub:function(c){return this.clone()._sub(c)},multByPoint:function(c){return this.clone()._multByPoint(c)},divByPoint:function(c){return this.clone()._divByPoint(c)},mult:function(c){return this.clone()._mult(c)},div:function(c){return this.clone()._div(c)},rotate:function(c){return this.clone()._rotate(c)},rotateAround:function(c,o){return this.clone()._rotateAround(c,o)},matMult:function(c){return this.clone()._matMult(c)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(c){return this.x===c.x&&this.y===c.y},dist:function(c){return Math.sqrt(this.distSqr(c))},distSqr:function(c){var o=c.x-this.x,h=c.y-this.y;return o*o+h*h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith:function(c){return this.angleWithSep(c.x,c.y)},angleWithSep:function(c,o){return Math.atan2(this.x*o-this.y*c,this.x*c+this.y*o)},_matMult:function(c){var o=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=o,this},_add:function(c){return this.x+=c.x,this.y+=c.y,this},_sub:function(c){return this.x-=c.x,this.y-=c.y,this},_mult:function(c){return this.x*=c,this.y*=c,this},_div:function(c){return this.x/=c,this.y/=c,this},_multByPoint:function(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint:function(c){return this.x/=c.x,this.y/=c.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var c=this.y;return this.y=this.x,this.x=-c,this},_rotate:function(c){var o=Math.cos(c),h=Math.sin(c),m=h*this.x+o*this.y;return this.x=o*this.x-h*this.y,this.y=m,this},_rotateAround:function(c,o){var h=Math.cos(c),m=Math.sin(c),b=o.y+m*(this.x-o.x)+h*(this.y-o.y);return this.x=o.x+h*(this.x-o.x)-m*(this.y-o.y),this.y=b,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ys.convert=function(c){return c instanceof ys?c:Array.isArray(c)?new ys(c[0],c[1]):c};const jo={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},Eo="mapbox-tiles";let Yn,tc=500,aa=50;function Ps(){typeof caches>"u"||Yn||(Yn=caches.open(Eo))}let Fi=1/0;const Ks={supported:!1,testSupport:function(c){!vi&&ki&&(nc?Kn(c):Za=c)}};let Za,ki,vi=!1,nc=!1;function Kn(c){const o=c.createTexture();c.bindTexture(c.TEXTURE_2D,o);try{if(c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,ki),c.isContextLost())return;Ks.supported=!0}catch{}c.deleteTexture(o),vi=!0}typeof document<"u"&&(ki=document.createElement("img"),ki.onload=function(){Za&&Kn(Za),Za=null,nc=!0},ki.onerror=function(){vi=!0,Za=null},ki.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Mr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Mr);class bi extends Error{constructor(o,h,m,b){super(`AJAXError: ${h} (${o}): ${m}`),this.status=o,this.statusText=h,this.url=m,this.body=b}}const _r=hr()?()=>self.worker&&self.worker.referrer:()=>("blob:"===window.location.protocol?window.parent:window).location.href;function Js(c,o){const h=new AbortController,m=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:_r(),signal:h.signal});let b=!1,T=!1;return"json"===c.type&&m.headers.set("Accept","application/json"),((S,k,O)=>{if(T)return;const z=Date.now();fetch(m).then(j=>{return j.ok?(W=j,null,z,void("arrayBuffer"===c.type?W.arrayBuffer():"json"===c.type?W.json():W.text()).then(ne=>{T||(b=!0,o(null,ne,W.headers.get("Cache-Control"),W.headers.get("Expires")))}).catch(ne=>{T||o(new Error(ne.message))})):j.blob().then(W=>o(new bi(j.status,j.statusText,c.url,W)));var W}).catch(j=>{20!==j.code&&o(new Error(j.message))})})(),{cancel:()=>{T=!0,b||h.abort()}}}const la=function(c,o){if(/:\/\//.test(c.url)&&!/^https?:|^file:/.test(c.url)){if(hr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",c,o);if(!hr()){const m=c.url.substring(0,c.url.indexOf("://"));return(jo.REGISTERED_PROTOCOLS[m]||Js)(c,o)}}if(!(/^file:/.test(h=c.url)||/^file:/.test(_r())&&!/^\w+:/.test(h))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Js(c,o);if(hr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",c,o,void 0,!0)}var h;return function(m,b){const T=new XMLHttpRequest;T.open(m.method||"GET",m.url,!0),"arrayBuffer"===m.type&&(T.responseType="arraybuffer");for(const S in m.headers)T.setRequestHeader(S,m.headers[S]);return"json"===m.type&&(T.responseType="text",T.setRequestHeader("Accept","application/json")),T.withCredentials="include"===m.credentials,T.onerror=()=>{b(new Error(T.statusText))},T.onload=()=>{if((T.status>=200&&T.status<300||0===T.status)&&null!==T.response){let S=T.response;if("json"===m.type)try{S=JSON.parse(T.response)}catch(k){return b(k)}b(null,S,T.getResponseHeader("Cache-Control"),T.getResponseHeader("Expires"))}else{const S=new Blob([T.response],{type:T.getResponseHeader("Content-Type")});b(new bi(T.status,T.statusText,m.url,S))}},T.send(m.body),{cancel:()=>T.abort()}}(c,o)},Br=function(c,o){return la(sn(c,{type:"arrayBuffer"}),o)};function To(c){const o=window.document.createElement("a");return o.href=c,o.protocol===window.document.location.protocol&&o.host===window.document.location.host}const Vn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Zi,bs;Zi=[],bs=0;const Xa=function(c,o){if(Ks.supported&&(c.headers||(c.headers={}),c.headers.accept="image/webp,*/*"),bs>=jo.MAX_PARALLEL_IMAGE_REQUESTS){const T={requestParameters:c,callback:o,cancelled:!1,cancel(){this.cancelled=!0}};return Zi.push(T),T}bs++;let h=!1;const m=()=>{if(!h)for(h=!0,bs--;Zi.length&&bs<jo.MAX_PARALLEL_IMAGE_REQUESTS;){const T=Zi.shift(),{requestParameters:S,callback:k,cancelled:O}=T;O||(T.cancel=Xa(S,k).cancel)}},b=Br(c,(T,S,k,O)=>{var z,j;m(),T?o(T):S&&(z=S,j=(z,j)=>{null!=z?o(z):null!=j&&o(null,j,{cacheControl:k,expires:O})},"function"==typeof createImageBitmap?function(W,J){const te=new Blob([new Uint8Array(W)],{type:"image/png"});createImageBitmap(te).then(ne=>{J(null,ne)}).catch(ne=>{J(new Error(`Could not load image because of ${ne.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(z,j):function(W,J){const te=new Image;te.onload=()=>{J(null,te),URL.revokeObjectURL(te.src),te.onload=null,window.requestAnimationFrame(()=>{te.src=Vn})},te.onerror=()=>J(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const ne=new Blob([new Uint8Array(W)],{type:"image/png"});te.src=W.byteLength?URL.createObjectURL(ne):Vn}(z,j))});return{cancel:()=>{b.cancel(),m()}}};function Ho(c,o,h){h[c]&&-1!==h[c].indexOf(o)||(h[c]=h[c]||[],h[c].push(o))}function yr(c,o,h){if(h&&h[c]){const m=h[c].indexOf(o);-1!==m&&h[c].splice(m,1)}}class dr{constructor(o,h={}){sn(this,h),this.type=o}}class Ya extends dr{constructor(o,h={}){super("error",sn({error:o},h))}}class Ka{on(o,h){return this._listeners=this._listeners||{},Ho(o,h,this._listeners),this}off(o,h){return yr(o,h,this._listeners),yr(o,h,this._oneTimeListeners),this}once(o,h){return this._oneTimeListeners=this._oneTimeListeners||{},Ho(o,h,this._oneTimeListeners),this}fire(o,h){"string"==typeof o&&(o=new dr(o,h||{}));const m=o.type;if(this.listens(m)){o.target=this;const b=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];for(const k of b)k.call(this,o);const T=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];for(const k of T)yr(m,k,this._oneTimeListeners),k.call(this,o);const S=this._eventedParent;S&&(sn(o,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),S.fire(o))}else o instanceof Ya&&console.error(o.error);return this}listens(o){return this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o)}setEventedParent(o,h){return this._eventedParent=o,this._eventedParentData=h,this}}var He={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class pt{constructor(o,h,m,b){this.message=(o?`${o}: `:"")+m,b&&(this.identifier=b),null!=h&&h.__line__&&(this.line=h.__line__)}}function ca(c){const o=c.value;return o?[new pt(c.key,o,"constants have been deprecated as of v8")]:[]}function rs(c,...o){for(const h of o)for(const m in h)c[m]=h[m];return c}function $n(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function ks(c){if(Array.isArray(c))return c.map(ks);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const o={};for(const h in c)o[h]=ks(c[h]);return o}return $n(c)}class Rs extends Error{constructor(o,h){super(h),this.message=h,this.key=o}}class ss{constructor(o,h=[]){this.parent=o,this.bindings={};for(const[m,b]of h)this.bindings[m]=b}concat(o){return new ss(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}const Go={kind:"null"},ut={kind:"number"},En={kind:"string"},on={kind:"boolean"},Pr={kind:"color"},Ma={kind:"object"},tn={kind:"value"},ua={kind:"collator"},zr={kind:"formatted"},Aa={kind:"padding"},vr={kind:"resolvedImage"};function Xr(c,o){return{kind:"array",itemType:c,N:o}}function xi(c){if("array"===c.kind){const o=xi(c.itemType);return"number"==typeof c.N?`array<${o}, ${c.N}>`:"value"===c.itemType.kind?"array":`array<${o}>`}return c.kind}const os=[Go,ut,En,on,Pr,zr,Ma,Xr(tn),Aa,vr];function Wo(c,o){if("error"===o.kind)return null;if("array"===c.kind){if("array"===o.kind&&(0===o.N&&"value"===o.itemType.kind||!Wo(c.itemType,o.itemType))&&("number"!=typeof c.N||c.N===o.N))return null}else{if(c.kind===o.kind)return null;if("value"===c.kind)for(const h of os)if(!Wo(h,o))return null}return`Expected ${xi(c)} but found ${xi(o)} instead.`}function Ja(c,o){return o.some(h=>h.kind===c.kind)}function Cl(c,o){return o.some(h=>"null"===h?null===c:"array"===h?Array.isArray(c):"object"===h?c&&!Array.isArray(c)&&"object"==typeof c:h===typeof c)}var ic,ha={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function le(c){return(c=Math.round(c))<0?0:c>255?255:c}function U(c){return le("%"===c[c.length-1]?parseFloat(c)/100*255:parseInt(c))}function $(c){return(o="%"===c[c.length-1]?parseFloat(c)/100:parseFloat(c))<0?0:o>1?1:o;var o}function ie(c,o,h){return h<0?h+=1:h>1&&(h-=1),6*h<1?c+(o-c)*h*6:2*h<1?o:3*h<2?c+(o-c)*(2/3-h)*6:c}try{ic={}.parseCSSColor=function(c){var o,h=c.replace(/ /g,"").toLowerCase();if(h in ha)return ha[h].slice();if("#"===h[0])return 4===h.length?(o=parseInt(h.substr(1),16))>=0&&o<=4095?[(3840&o)>>4|(3840&o)>>8,240&o|(240&o)>>4,15&o|(15&o)<<4,1]:null:7===h.length&&(o=parseInt(h.substr(1),16))>=0&&o<=16777215?[(16711680&o)>>16,(65280&o)>>8,255&o,1]:null;var m=h.indexOf("("),b=h.indexOf(")");if(-1!==m&&b+1===h.length){var T=h.substr(0,m),S=h.substr(m+1,b-(m+1)).split(","),k=1;switch(T){case"rgba":if(4!==S.length)return null;k=$(S.pop());case"rgb":return 3!==S.length?null:[U(S[0]),U(S[1]),U(S[2]),k];case"hsla":if(4!==S.length)return null;k=$(S.pop());case"hsl":if(3!==S.length)return null;var O=(parseFloat(S[0])%360+360)%360/360,z=$(S[1]),j=$(S[2]),W=j<=.5?j*(z+1):j+z-j*z,J=2*j-W;return[le(255*ie(J,W,O+1/3)),le(255*ie(J,W,O)),le(255*ie(J,W,O-1/3)),k];default:return null}}return null}}catch{}class re{constructor(o,h,m,b=1){this.r=o,this.g=h,this.b=m,this.a=b}static parse(o){if(!o)return;if(o instanceof re)return o;if("string"!=typeof o)return;const h=ic(o);return h?new re(h[0]/255*h[3],h[1]/255*h[3],h[2]/255*h[3],h[3]):void 0}toString(){const[o,h,m,b]=this.toArray();return`rgba(${Math.round(o)},${Math.round(h)},${Math.round(m)},${b})`}toArray(){const{r:o,g:h,b:m,a:b}=this;return 0===b?[0,0,0,0]:[255*o/b,255*h/b,255*m/b,b]}}re.black=new re(0,0,0,1),re.white=new re(1,1,1,1),re.transparent=new re(0,0,0,0),re.red=new re(1,0,0,1);class ye{constructor(o,h,m){this.sensitivity=o?h?"variant":"case":h?"accent":"base",this.locale=m,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,h){return this.collator.compare(o,h)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Te{constructor(o,h,m,b,T){this.text=o,this.image=h,this.scale=m,this.fontStack=b,this.textColor=T}}class we{constructor(o){this.sections=o}static fromString(o){return new we([new Te(o,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(o=>0!==o.text.length||o.image&&0!==o.image.name.length)}static factory(o){return o instanceof we?o:we.fromString(o)}toString(){return 0===this.sections.length?"":this.sections.map(o=>o.text).join("")}}class ve{constructor(o){this.values=o.slice()}static parse(o){if(o instanceof ve)return o;if("number"==typeof o)return new ve([o,o,o,o]);if(Array.isArray(o)&&!(o.length<1||o.length>4)){for(const h of o)if("number"!=typeof h)return;switch(o.length){case 1:o=[o[0],o[0],o[0],o[0]];break;case 2:o=[o[0],o[1],o[0],o[1]];break;case 3:o=[o[0],o[1],o[2],o[1]]}return new ve(o)}}toString(){return JSON.stringify(this.values)}}class Ce{constructor(o){this.name=o.name,this.available=o.available}toString(){return this.name}static fromString(o){return o?new Ce({name:o,available:!1}):null}}function je(c,o,h,m){return"number"==typeof c&&c>=0&&c<=255&&"number"==typeof o&&o>=0&&o<=255&&"number"==typeof h&&h>=0&&h<=255?void 0===m||"number"==typeof m&&m>=0&&m<=1?null:`Invalid rgba value [${[c,o,h,m].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof m?[c,o,h,m]:[c,o,h]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function et(c){if(null===c||"string"==typeof c||"boolean"==typeof c||"number"==typeof c||c instanceof re||c instanceof ye||c instanceof we||c instanceof ve||c instanceof Ce)return!0;if(Array.isArray(c)){for(const o of c)if(!et(o))return!1;return!0}if("object"==typeof c){for(const o in c)if(!et(c[o]))return!1;return!0}return!1}function Ve(c){if(null===c)return Go;if("string"==typeof c)return En;if("boolean"==typeof c)return on;if("number"==typeof c)return ut;if(c instanceof re)return Pr;if(c instanceof ye)return ua;if(c instanceof we)return zr;if(c instanceof ve)return Aa;if(c instanceof Ce)return vr;if(Array.isArray(c)){const o=c.length;let h;for(const m of c){const b=Ve(m);if(h){if(h===b)continue;h=tn;break}h=b}return Xr(h||tn,o)}return Ma}function Et(c){const o=typeof c;return null===c?"":"string"===o||"number"===o||"boolean"===o?String(c):c instanceof re||c instanceof we||c instanceof ve||c instanceof Ce?c.toString():JSON.stringify(c)}class Mt{constructor(o,h){this.type=o,this.value=h}static parse(o,h){if(2!==o.length)return h.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!et(o[1]))return h.error("invalid value");const m=o[1];let b=Ve(m);const T=h.expectedType;return"array"!==b.kind||0!==b.N||!T||"array"!==T.kind||"number"==typeof T.N&&0!==T.N||(b=T),new Mt(b,m)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class ht{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}}const Wt={string:En,number:ut,boolean:on,object:Ma};class $t{constructor(o,h){this.type=o,this.args=h}static parse(o,h){if(o.length<2)return h.error("Expected at least one argument.");let m,b=1;const T=o[0];if("array"===T){let k,O;if(o.length>2){const z=o[1];if("string"!=typeof z||!(z in Wt)||"object"===z)return h.error('The item type argument of "array" must be one of string, number, boolean',1);k=Wt[z],b++}else k=tn;if(o.length>3){if(null!==o[2]&&("number"!=typeof o[2]||o[2]<0||o[2]!==Math.floor(o[2])))return h.error('The length argument to "array" must be a positive integer literal',2);O=o[2],b++}m=Xr(k,O)}else{if(!Wt[T])throw new Error(`Types doesn't contain name = ${T}`);m=Wt[T]}const S=[];for(;b<o.length;b++){const k=h.parse(o[b],b,tn);if(!k)return null;S.push(k)}return new $t(m,S)}evaluate(o){for(let h=0;h<this.args.length;h++){const m=this.args[h].evaluate(o);if(!Wo(this.type,Ve(m)))return m;if(h===this.args.length-1)throw new ht(`Expected value to be of type ${xi(this.type)}, but found ${xi(Ve(m))} instead.`)}throw new Error}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}const Qn={"to-boolean":on,"to-color":Pr,"to-number":ut,"to-string":En};class nn{constructor(o,h){this.type=o,this.args=h}static parse(o,h){if(o.length<2)return h.error("Expected at least one argument.");const m=o[0];if(!Qn[m])throw new Error(`Can't parse ${m} as it is not part of the known types`);if(("to-boolean"===m||"to-string"===m)&&2!==o.length)return h.error("Expected one argument.");const b=Qn[m],T=[];for(let S=1;S<o.length;S++){const k=h.parse(o[S],S,tn);if(!k)return null;T.push(k)}return new nn(b,T)}evaluate(o){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(o));if("color"===this.type.kind){let h,m;for(const b of this.args){if(h=b.evaluate(o),m=null,h instanceof re)return h;if("string"==typeof h){const T=o.parseColor(h);if(T)return T}else if(Array.isArray(h)&&(m=h.length<3||h.length>4?`Invalid rbga value ${JSON.stringify(h)}: expected an array containing either three or four numeric values.`:je(h[0],h[1],h[2],h[3]),!m))return new re(h[0]/255,h[1]/255,h[2]/255,h[3])}throw new ht(m||`Could not parse color from value '${"string"==typeof h?h:JSON.stringify(h)}'`)}if("padding"===this.type.kind){let h;for(const m of this.args){h=m.evaluate(o);const b=ve.parse(h);if(b)return b}throw new ht(`Could not parse padding from value '${"string"==typeof h?h:JSON.stringify(h)}'`)}if("number"===this.type.kind){let h=null;for(const m of this.args){if(h=m.evaluate(o),null===h)return 0;const b=Number(h);if(!isNaN(b))return b}throw new ht(`Could not convert ${JSON.stringify(h)} to number.`)}return"formatted"===this.type.kind?we.fromString(Et(this.args[0].evaluate(o))):"resolvedImage"===this.type.kind?Ce.fromString(Et(this.args[0].evaluate(o))):Et(this.args[0].evaluate(o))}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}const fn=["Unknown","Point","LineString","Polygon"];class pn{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?fn[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(o){let h=this._parseColorCache[o];return h||(h=this._parseColorCache[o]=re.parse(o)),h}}class oi{constructor(o,h,m,b){this.name=o,this.type=h,this._evaluate=m,this.args=b}evaluate(o){return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}static parse(o,h){const m=o[0],b=oi.definitions[m];if(!b)return h.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0);const T=Array.isArray(b)?b[0]:b.type,S=Array.isArray(b)?[[b[1],b[2]]]:b.overloads,k=S.filter(([z])=>!Array.isArray(z)||z.length===o.length-1);let O=null;for(const[z,j]of k){O=new ee(h.registry,h.path,null,h.scope);const W=[];let J=!1;for(let te=1;te<o.length;te++){const ne=o[te],ge=Array.isArray(z)?z[te-1]:z.type,pe=O.parse(ne,1+W.length,ge);if(!pe){J=!0;break}W.push(pe)}if(!J)if(Array.isArray(z)&&z.length!==W.length)O.error(`Expected ${z.length} arguments, but found ${W.length} instead.`);else{for(let te=0;te<W.length;te++){const ne=Array.isArray(z)?z[te]:z.type,ge=W[te];O.concat(te+1).checkSubtype(ne,ge.type)}if(0===O.errors.length)return new oi(m,T,j,W)}}if(1===k.length)h.errors.push(...O.errors);else{const z=(k.length?k:S).map(([W])=>{return J=W,Array.isArray(J)?`(${J.map(xi).join(", ")})`:`(${xi(J.type)}...)`;var J}).join(" | "),j=[];for(let W=1;W<o.length;W++){const J=h.parse(o[W],1+j.length);if(!J)return null;j.push(xi(J.type))}h.error(`Expected arguments of type ${z}, but found (${j.join(", ")}) instead.`)}return null}static register(o,h){oi.definitions=h;for(const m in h)o[m]=oi}}class wi{constructor(o,h,m){this.type=ua,this.locale=m,this.caseSensitive=o,this.diacriticSensitive=h}static parse(o,h){if(2!==o.length)return h.error("Expected one argument.");const m=o[1];if("object"!=typeof m||Array.isArray(m))return h.error("Collator options argument must be an object.");const b=h.parse(void 0!==m["case-sensitive"]&&m["case-sensitive"],1,on);if(!b)return null;const T=h.parse(void 0!==m["diacritic-sensitive"]&&m["diacritic-sensitive"],1,on);if(!T)return null;let S=null;return m.locale&&(S=h.parse(m.locale,1,En),!S)?null:new wi(b,T,S)}evaluate(o){return new ye(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}}const ti=8192;function br(c,o){c[0]=Math.min(c[0],o[0]),c[1]=Math.min(c[1],o[1]),c[2]=Math.max(c[2],o[0]),c[3]=Math.max(c[3],o[1])}function as(c,o){return!(c[0]<=o[0]||c[2]>=o[2]||c[1]<=o[1]||c[3]>=o[3])}function Hn(c,o){const h=(180+c[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,b=Math.pow(2,o.z);return[Math.round(h*b*ti),Math.round(m*b*ti)]}function fi(c,o,h){const m=c[0]-o[0],b=c[1]-o[1],T=c[0]-h[0],S=c[1]-h[1];return m*S-T*b==0&&m*T<=0&&b*S<=0}function Si(c,o){let h=!1;for(let S=0,k=o.length;S<k;S++){const O=o[S];for(let z=0,j=O.length;z<j-1;z++){if(fi(c,O[z],O[z+1]))return!1;(b=O[z])[1]>(m=c)[1]!=(T=O[z+1])[1]>m[1]&&m[0]<(T[0]-b[0])*(m[1]-b[1])/(T[1]-b[1])+b[0]&&(h=!h)}}var m,b,T;return h}function Da(c,o){for(let h=0;h<o.length;h++)if(Si(c,o[h]))return!0;return!1}function Qs(c,o,h,m){const b=m[0]-h[0],T=m[1]-h[1],S=(c[0]-h[0])*T-b*(c[1]-h[1]),k=(o[0]-h[0])*T-b*(o[1]-h[1]);return S>0&&k<0||S<0&&k>0}function pi(c,o,h){for(const z of h)for(let j=0;j<z.length-1;++j)if((k=[(S=z[j+1])[0]-(T=z[j])[0],S[1]-T[1]])[0]*(O=[(b=o)[0]-(m=c)[0],b[1]-m[1]])[1]-k[1]*O[0]!=0&&Qs(m,b,T,S)&&Qs(T,S,m,b))return!0;var m,b,T,S,k,O;return!1}function Kt(c,o){for(let h=0;h<c.length;++h)if(!Si(c[h],o))return!1;for(let h=0;h<c.length-1;++h)if(pi(c[h],c[h+1],o))return!1;return!0}function Ec(c,o){for(let h=0;h<o.length;h++)if(Kt(c,o[h]))return!0;return!1}function rc(c,o,h){const m=[];for(let b=0;b<c.length;b++){const T=[];for(let S=0;S<c[b].length;S++){const k=Hn(c[b][S],h);br(o,k),T.push(k)}m.push(T)}return m}function st(c,o,h){const m=[];for(let b=0;b<c.length;b++){const T=rc(c[b],o,h);m.push(T)}return m}function Ia(c,o,h,m){if(c[0]<h[0]||c[0]>h[2]){const b=.5*m;let T=c[0]-h[0]>b?-m:h[0]-c[0]>b?m:0;0===T&&(T=c[0]-h[2]>b?-m:h[2]-c[0]>b?m:0),c[0]+=T}br(o,c)}function an(c,o,h,m){const b=Math.pow(2,m.z)*ti,T=[m.x*ti,m.y*ti],S=[];for(const k of c)for(const O of k){const z=[O.x+T[0],O.y+T[1]];Ia(z,o,h,b),S.push(z)}return S}function ci(c,o,h,m){const b=Math.pow(2,m.z)*ti,T=[m.x*ti,m.y*ti],S=[];for(const O of c){const z=[];for(const j of O){const W=[j.x+T[0],j.y+T[1]];br(o,W),z.push(W)}S.push(z)}if(o[2]-o[0]<=b/2){(k=o)[0]=k[1]=1/0,k[2]=k[3]=-1/0;for(const O of S)for(const z of O)Ia(z,o,h,b)}var k;return S}class Pa{constructor(o,h){this.type=on,this.geojson=o,this.geometries=h}static parse(o,h){if(2!==o.length)return h.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(et(o[1])){const m=o[1];if("FeatureCollection"===m.type)for(let b=0;b<m.features.length;++b){const T=m.features[b].geometry.type;if("Polygon"===T||"MultiPolygon"===T)return new Pa(m,m.features[b].geometry)}else if("Feature"===m.type){const b=m.geometry.type;if("Polygon"===b||"MultiPolygon"===b)return new Pa(m,m.geometry)}else if("Polygon"===m.type||"MultiPolygon"===m.type)return new Pa(m,m)}return h.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(null!=o.geometry()&&null!=o.canonicalID()){if("Point"===o.geometryType())return function(h,m){const b=[1/0,1/0,-1/0,-1/0],T=[1/0,1/0,-1/0,-1/0],S=h.canonicalID();if("Polygon"===m.type){const k=rc(m.coordinates,T,S),O=an(h.geometry(),b,T,S);if(!as(b,T))return!1;for(const z of O)if(!Si(z,k))return!1}if("MultiPolygon"===m.type){const k=st(m.coordinates,T,S),O=an(h.geometry(),b,T,S);if(!as(b,T))return!1;for(const z of O)if(!Da(z,k))return!1}return!0}(o,this.geometries);if("LineString"===o.geometryType())return function(h,m){const b=[1/0,1/0,-1/0,-1/0],T=[1/0,1/0,-1/0,-1/0],S=h.canonicalID();if("Polygon"===m.type){const k=rc(m.coordinates,T,S),O=ci(h.geometry(),b,T,S);if(!as(b,T))return!1;for(const z of O)if(!Kt(z,k))return!1}if("MultiPolygon"===m.type){const k=st(m.coordinates,T,S),O=ci(h.geometry(),b,T,S);if(!as(b,T))return!1;for(const z of O)if(!Ec(z,k))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function Qa(c){if(c instanceof oi&&("get"===c.name&&1===c.args.length||"feature-state"===c.name||"has"===c.name&&1===c.args.length||"properties"===c.name||"geometry-type"===c.name||"id"===c.name||/^filter-/.test(c.name))||c instanceof Pa)return!1;let o=!0;return c.eachChild(h=>{o&&!Qa(h)&&(o=!1)}),o}function Sl(c){if(c instanceof oi&&"feature-state"===c.name)return!1;let o=!0;return c.eachChild(h=>{o&&!Sl(h)&&(o=!1)}),o}function el(c,o){if(c instanceof oi&&o.indexOf(c.name)>=0)return!1;let h=!0;return c.eachChild(m=>{h&&!el(m,o)&&(h=!1)}),h}class Yr{constructor(o,h){this.type=h.type,this.name=o,this.boundExpression=h}static parse(o,h){if(2!==o.length||"string"!=typeof o[1])return h.error("'var' expression requires exactly one string literal argument.");const m=o[1];return h.scope.has(m)?new Yr(m,h.scope.get(m)):h.error(`Unknown variable "${m}". Make sure "${m}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}}class ee{constructor(o,h=[],m,b=new ss,T=[]){this.registry=o,this.path=h,this.key=h.map(S=>`[${S}]`).join(""),this.scope=b,this.errors=T,this.expectedType=m}parse(o,h,m,b,T={}){return h?this.concat(h,m,b)._parse(o,T):this._parse(o,T)}_parse(o,h){function m(b,T,S){return"assert"===S?new $t(T,[b]):"coerce"===S?new nn(T,[b]):b}if(null!==o&&"string"!=typeof o&&"boolean"!=typeof o&&"number"!=typeof o||(o=["literal",o]),Array.isArray(o)){if(0===o.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const b=o[0];if("string"!=typeof b)return this.error(`Expression name must be a string, but found ${typeof b} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const T=this.registry[b];if(T){let S=T.parse(o,this);if(!S)return null;if(this.expectedType){const k=this.expectedType,O=S.type;if("string"!==k.kind&&"number"!==k.kind&&"boolean"!==k.kind&&"object"!==k.kind&&"array"!==k.kind||"value"!==O.kind)if("color"!==k.kind&&"formatted"!==k.kind&&"resolvedImage"!==k.kind||"value"!==O.kind&&"string"!==O.kind)if("padding"!==k.kind||"value"!==O.kind&&"number"!==O.kind&&"array"!==O.kind){if(this.checkSubtype(k,O))return null}else S=m(S,k,h.typeAnnotation||"coerce");else S=m(S,k,h.typeAnnotation||"coerce");else S=m(S,k,h.typeAnnotation||"assert")}if(!(S instanceof Mt)&&"resolvedImage"!==S.type.kind&&oe(S)){const k=new pn;try{S=new Mt(S.type,S.evaluate(k))}catch(O){return this.error(O.message),null}}return S}return this.error(`Unknown expression "${b}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===o?"'undefined' value invalid. Use null instead.":"object"==typeof o?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,h,m){const b="number"==typeof o?this.path.concat(o):this.path,T=m?this.scope.concat(m):this.scope;return new ee(this.registry,b,h||null,T,this.errors)}error(o,...h){const m=`${this.key}${h.map(b=>`[${b}]`).join("")}`;this.errors.push(new Rs(m,o))}checkSubtype(o,h){const m=Wo(o,h);return m&&this.error(m),m}}function oe(c){if(c instanceof Yr)return oe(c.boundExpression);if(c instanceof oi&&"error"===c.name||c instanceof wi||c instanceof Pa)return!1;const o=c instanceof nn||c instanceof $t;let h=!0;return c.eachChild(m=>{h=o?h&&oe(m):h&&m instanceof Mt}),!!h&&Qa(c)&&el(c,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function xe(c,o){const h=c.length-1;let m,b,T=0,S=h,k=0;for(;T<=S;)if(k=Math.floor((T+S)/2),m=c[k],b=c[k+1],m<=o){if(k===h||o<b)return k;T=k+1}else{if(!(m>o))throw new ht("Input is not a number.");S=k-1}return 0}class Fe{constructor(o,h,m){this.type=o,this.input=h,this.labels=[],this.outputs=[];for(const[b,T]of m)this.labels.push(b),this.outputs.push(T)}static parse(o,h){if(o.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return h.error("Expected an even number of arguments.");const m=h.parse(o[1],1,ut);if(!m)return null;const b=[];let T=null;h.expectedType&&"value"!==h.expectedType.kind&&(T=h.expectedType);for(let S=1;S<o.length;S+=2){const k=1===S?-1/0:o[S],O=o[S+1],z=S,j=S+1;if("number"!=typeof k)return h.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(b.length&&b[b.length-1][0]>=k)return h.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',z);const W=h.parse(O,j,T);if(!W)return null;T=T||W.type,b.push([k,W])}return new Fe(T,m,b)}evaluate(o){const h=this.labels,m=this.outputs;if(1===h.length)return m[0].evaluate(o);const b=this.input.evaluate(o);if(b<=h[0])return m[0].evaluate(o);const T=h.length;return b>=h[T-1]?m[T-1].evaluate(o):m[xe(h,b)].evaluate(o)}eachChild(o){o(this.input);for(const h of this.outputs)o(h)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}}function Je(c,o,h){return c*(1-h)+o*h}var At=Object.freeze({__proto__:null,number:Je,color:function(c,o,h){return new re(Je(c.r,o.r,h),Je(c.g,o.g,h),Je(c.b,o.b,h),Je(c.a,o.a,h))},array:function(c,o,h){return c.map((m,b)=>Je(m,o[b],h))},padding:function(c,o,h){const m=c.values,b=o.values;return new ve([Je(m[0],b[0],h),Je(m[1],b[1],h),Je(m[2],b[2],h),Je(m[3],b[3],h)])}});const kr=4/29,ls=6/29,$o=3*ls*ls,hg=Math.PI/180,Co=180/Math.PI;function Mi(c){return c>.008856451679035631?Math.pow(c,1/3):c/$o+kr}function Nf(c){return c>ls?c*c*c:$o*(c-kr)}function Bf(c){return 255*(c<=.0031308?12.92*c:1.055*Math.pow(c,1/2.4)-.055)}function zf(c){return(c/=255)<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function lt(c){const o=zf(c.r),h=zf(c.g),m=zf(c.b),b=Mi((.4124564*o+.3575761*h+.1804375*m)/.95047),T=Mi((.2126729*o+.7151522*h+.072175*m)/1);return{l:116*T-16,a:500*(b-T),b:200*(T-Mi((.0193339*o+.119192*h+.9503041*m)/1.08883)),alpha:c.a}}function Hp(c){let o=(c.l+16)/116,h=isNaN(c.a)?o:o+c.a/500,m=isNaN(c.b)?o:o-c.b/200;return o=1*Nf(o),h=.95047*Nf(h),m=1.08883*Nf(m),new re(Bf(3.2404542*h-1.5371385*o-.4985314*m),Bf(-.969266*h+1.8760108*o+.041556*m),Bf(.0556434*h-.2040259*o+1.0572252*m),c.alpha)}function xr(c,o,h){const m=o-c;return c+h*(m>180||m<-180?m-360*Math.round(m/360):m)}const sc={forward:lt,reverse:Hp,interpolate:function(c,o,h){return{l:Je(c.l,o.l,h),a:Je(c.a,o.a,h),b:Je(c.b,o.b,h),alpha:Je(c.alpha,o.alpha,h)}}},wh={forward:function(c){const{l:o,a:h,b:m}=lt(c),b=Math.atan2(m,h)*Co;return{h:b<0?b+360:b,c:Math.sqrt(h*h+m*m),l:o,alpha:c.a}},reverse:function(c){const o=c.h*hg,h=c.c;return Hp({l:c.l,a:Math.cos(o)*h,b:Math.sin(o)*h,alpha:c.alpha})},interpolate:function(c,o,h){return{h:xr(c.h,o.h,h),c:Je(c.c,o.c,h),l:Je(c.l,o.l,h),alpha:Je(c.alpha,o.alpha,h)}}};var Pd=Object.freeze({__proto__:null,lab:sc,hcl:wh});class ni{constructor(o,h,m,b,T){this.type=o,this.operator=h,this.interpolation=m,this.input=b,this.labels=[],this.outputs=[];for(const[S,k]of T)this.labels.push(S),this.outputs.push(k)}static interpolationFactor(o,h,m,b){let T=0;if("exponential"===o.name)T=Xi(h,o.base,m,b);else if("linear"===o.name)T=Xi(h,1,m,b);else if("cubic-bezier"===o.name){const S=o.controlPoints;T=new Gt(S[0],S[1],S[2],S[3]).solve(Xi(h,1,m,b))}return T}static parse(o,h){let[m,b,T,...S]=o;if(!Array.isArray(b)||0===b.length)return h.error("Expected an interpolation type expression.",1);if("linear"===b[0])b={name:"linear"};else if("exponential"===b[0]){const z=b[1];if("number"!=typeof z)return h.error("Exponential interpolation requires a numeric base.",1,1);b={name:"exponential",base:z}}else{if("cubic-bezier"!==b[0])return h.error(`Unknown interpolation type ${String(b[0])}`,1,0);{const z=b.slice(1);if(4!==z.length||z.some(j=>"number"!=typeof j||j<0||j>1))return h.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);b={name:"cubic-bezier",controlPoints:z}}}if(o.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return h.error("Expected an even number of arguments.");if(T=h.parse(T,2,ut),!T)return null;const k=[];let O=null;"interpolate-hcl"===m||"interpolate-lab"===m?O=Pr:h.expectedType&&"value"!==h.expectedType.kind&&(O=h.expectedType);for(let z=0;z<S.length;z+=2){const j=S[z],W=S[z+1],J=z+3,te=z+4;if("number"!=typeof j)return h.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',J);if(k.length&&k[k.length-1][0]>=j)return h.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',J);const ne=h.parse(W,te,O);if(!ne)return null;O=O||ne.type,k.push([j,ne])}return"number"===O.kind||"color"===O.kind||"padding"===O.kind||"array"===O.kind&&"number"===O.itemType.kind&&"number"==typeof O.N?new ni(O,m,b,T,k):h.error(`Type ${xi(O)} is not interpolatable.`)}evaluate(o){const h=this.labels,m=this.outputs;if(1===h.length)return m[0].evaluate(o);const b=this.input.evaluate(o);if(b<=h[0])return m[0].evaluate(o);const T=h.length;if(b>=h[T-1])return m[T-1].evaluate(o);const S=xe(h,b),k=ni.interpolationFactor(this.interpolation,b,h[S],h[S+1]),O=m[S].evaluate(o),z=m[S+1].evaluate(o);return"interpolate"===this.operator?At[this.type.kind.toLowerCase()](O,z,k):"interpolate-hcl"===this.operator?wh.reverse(wh.interpolate(wh.forward(O),wh.forward(z),k)):sc.reverse(sc.interpolate(sc.forward(O),sc.forward(z),k))}eachChild(o){o(this.input);for(const h of this.outputs)o(h)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}}function Xi(c,o,h,m){const b=m-h,T=c-h;return 0===b?0:1===o?T/b:(Math.pow(o,T)-1)/(Math.pow(o,b)-1)}class zu{constructor(o,h){this.type=o,this.args=h}static parse(o,h){if(o.length<2)return h.error("Expectected at least one argument.");let m=null;const b=h.expectedType;b&&"value"!==b.kind&&(m=b);const T=[];for(const k of o.slice(1)){const O=h.parse(k,1+T.length,m,void 0,{typeAnnotation:"omit"});if(!O)return null;m=m||O.type,T.push(O)}if(!m)throw new Error("No output type");const S=b&&T.some(k=>Wo(b,k.type));return new zu(S?tn:m,T)}evaluate(o){let h,m=null,b=0;for(const T of this.args)if(b++,m=T.evaluate(o),m&&m instanceof Ce&&!m.available&&(h||(h=m.name),m=null,b===this.args.length&&(m=h)),null!==m)break;return m}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}class Tc{constructor(o,h){this.type=h.type,this.bindings=[].concat(o),this.result=h}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const h of this.bindings)o(h[1]);o(this.result)}static parse(o,h){if(o.length<4)return h.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const m=[];for(let T=1;T<o.length-1;T+=2){const S=o[T];if("string"!=typeof S)return h.error(`Expected string, but found ${typeof S} instead.`,T);if(/[^a-zA-Z0-9_]/.test(S))return h.error("Variable names must contain only alphanumeric characters or '_'.",T);const k=h.parse(o[T+1],T+1);if(!k)return null;m.push([S,k])}const b=h.parse(o[o.length-1],o.length-1,h.expectedType,m);return b?new Tc(m,b):null}outputDefined(){return this.result.outputDefined()}}class Vu{constructor(o,h,m){this.type=o,this.index=h,this.input=m}static parse(o,h){if(3!==o.length)return h.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const m=h.parse(o[1],1,ut),b=h.parse(o[2],2,Xr(h.expectedType||tn));return m&&b?new Vu(b.type.itemType,m,b):null}evaluate(o){const h=this.index.evaluate(o),m=this.input.evaluate(o);if(h<0)throw new ht(`Array index out of bounds: ${h} < 0.`);if(h>=m.length)throw new ht(`Array index out of bounds: ${h} > ${m.length-1}.`);if(h!==Math.floor(h))throw new ht(`Array index must be an integer, but found ${h} instead.`);return m[h]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}}class Eh{constructor(o,h){this.type=on,this.needle=o,this.haystack=h}static parse(o,h){if(3!==o.length)return h.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const m=h.parse(o[1],1,tn),b=h.parse(o[2],2,tn);return m&&b?Ja(m.type,[on,En,ut,Go,tn])?new Eh(m,b):h.error(`Expected first argument to be of type boolean, string, number or null, but found ${xi(m.type)} instead`):null}evaluate(o){const h=this.needle.evaluate(o),m=this.haystack.evaluate(o);if(!m)return!1;if(!Cl(h,["boolean","string","number","null"]))throw new ht(`Expected first argument to be of type boolean, string, number or null, but found ${xi(Ve(h))} instead.`);if(!Cl(m,["string","array"]))throw new ht(`Expected second argument to be of type array or string, but found ${xi(Ve(m))} instead.`);return m.indexOf(h)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}}class Th{constructor(o,h,m){this.type=ut,this.needle=o,this.haystack=h,this.fromIndex=m}static parse(o,h){if(o.length<=2||o.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const m=h.parse(o[1],1,tn),b=h.parse(o[2],2,tn);if(!m||!b)return null;if(!Ja(m.type,[on,En,ut,Go,tn]))return h.error(`Expected first argument to be of type boolean, string, number or null, but found ${xi(m.type)} instead`);if(4===o.length){const T=h.parse(o[3],3,ut);return T?new Th(m,b,T):null}return new Th(m,b)}evaluate(o){const h=this.needle.evaluate(o),m=this.haystack.evaluate(o);if(!Cl(h,["boolean","string","number","null"]))throw new ht(`Expected first argument to be of type boolean, string, number or null, but found ${xi(Ve(h))} instead.`);if(!Cl(m,["string","array"]))throw new ht(`Expected second argument to be of type array or string, but found ${xi(Ve(m))} instead.`);if(this.fromIndex){const b=this.fromIndex.evaluate(o);return m.indexOf(h,b)}return m.indexOf(h)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}}class _n{constructor(o,h,m,b,T,S){this.inputType=o,this.type=h,this.input=m,this.cases=b,this.outputs=T,this.otherwise=S}static parse(o,h){if(o.length<5)return h.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return h.error("Expected an even number of arguments.");let m,b;h.expectedType&&"value"!==h.expectedType.kind&&(b=h.expectedType);const T={},S=[];for(let z=2;z<o.length-1;z+=2){let j=o[z];const W=o[z+1];Array.isArray(j)||(j=[j]);const J=h.concat(z);if(0===j.length)return J.error("Expected at least one branch label.");for(const ne of j){if("number"!=typeof ne&&"string"!=typeof ne)return J.error("Branch labels must be numbers or strings.");if("number"==typeof ne&&Math.abs(ne)>Number.MAX_SAFE_INTEGER)return J.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof ne&&Math.floor(ne)!==ne)return J.error("Numeric branch labels must be integer values.");if(m){if(J.checkSubtype(m,Ve(ne)))return null}else m=Ve(ne);if(void 0!==T[String(ne)])return J.error("Branch labels must be unique.");T[String(ne)]=S.length}const te=h.parse(W,z,b);if(!te)return null;b=b||te.type,S.push(te)}const k=h.parse(o[1],1,tn);if(!k)return null;const O=h.parse(o[o.length-1],o.length-1,b);return O?"value"!==k.type.kind&&h.concat(1).checkSubtype(m,k.type)?null:new _n(m,b,k,T,S,O):null}evaluate(o){const h=this.input.evaluate(o);return(Ve(h)===this.inputType&&this.outputs[this.cases[h]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}}class cu{constructor(o,h,m){this.type=o,this.branches=h,this.otherwise=m}static parse(o,h){if(o.length<4)return h.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return h.error("Expected an odd number of arguments.");let m;h.expectedType&&"value"!==h.expectedType.kind&&(m=h.expectedType);const b=[];for(let S=1;S<o.length-1;S+=2){const k=h.parse(o[S],S,on);if(!k)return null;const O=h.parse(o[S+1],S+1,m);if(!O)return null;b.push([k,O]),m=m||O.type}const T=h.parse(o[o.length-1],o.length-1,m);if(!T)return null;if(!m)throw new Error("Can't infer output type");return new cu(m,b,T)}evaluate(o){for(const[h,m]of this.branches)if(h.evaluate(o))return m.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[h,m]of this.branches)o(h),o(m);o(this.otherwise)}outputDefined(){return this.branches.every(([o,h])=>h.outputDefined())&&this.otherwise.outputDefined()}}class Ch{constructor(o,h,m,b){this.type=o,this.input=h,this.beginIndex=m,this.endIndex=b}static parse(o,h){if(o.length<=2||o.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const m=h.parse(o[1],1,tn),b=h.parse(o[2],2,ut);if(!m||!b)return null;if(!Ja(m.type,[Xr(tn),En,tn]))return h.error(`Expected first argument to be of type array or string, but found ${xi(m.type)} instead`);if(4===o.length){const T=h.parse(o[3],3,ut);return T?new Ch(m.type,m,b,T):null}return new Ch(m.type,m,b)}evaluate(o){const h=this.input.evaluate(o),m=this.beginIndex.evaluate(o);if(!Cl(h,["string","array"]))throw new ht(`Expected first argument to be of type array or string, but found ${xi(Ve(h))} instead.`);if(this.endIndex){const b=this.endIndex.evaluate(o);return h.slice(m,b)}return h.slice(m)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}}function Wi(c,o){return"=="===c||"!="===c?"boolean"===o.kind||"string"===o.kind||"number"===o.kind||"null"===o.kind||"value"===o.kind:"string"===o.kind||"number"===o.kind||"value"===o.kind}function Sh(c,o,h,m){return 0===m.compare(o,h)}function Ml(c,o,h){const m="=="!==c&&"!="!==c;return class T3{constructor(T,S,k){this.type=on,this.lhs=T,this.rhs=S,this.collator=k,this.hasUntypedArgument="value"===T.type.kind||"value"===S.type.kind}static parse(T,S){if(3!==T.length&&4!==T.length)return S.error("Expected two or three arguments.");const k=T[0];let O=S.parse(T[1],1,tn);if(!O)return null;if(!Wi(k,O.type))return S.concat(1).error(`"${k}" comparisons are not supported for type '${xi(O.type)}'.`);let z=S.parse(T[2],2,tn);if(!z)return null;if(!Wi(k,z.type))return S.concat(2).error(`"${k}" comparisons are not supported for type '${xi(z.type)}'.`);if(O.type.kind!==z.type.kind&&"value"!==O.type.kind&&"value"!==z.type.kind)return S.error(`Cannot compare types '${xi(O.type)}' and '${xi(z.type)}'.`);m&&("value"===O.type.kind&&"value"!==z.type.kind?O=new $t(z.type,[O]):"value"!==O.type.kind&&"value"===z.type.kind&&(z=new $t(O.type,[z])));let j=null;if(4===T.length){if("string"!==O.type.kind&&"string"!==z.type.kind&&"value"!==O.type.kind&&"value"!==z.type.kind)return S.error("Cannot use collator to compare non-string types.");if(j=S.parse(T[3],3,ua),!j)return null}return new T3(O,z,j)}evaluate(T){const S=this.lhs.evaluate(T),k=this.rhs.evaluate(T);if(m&&this.hasUntypedArgument){const O=Ve(S),z=Ve(k);if(O.kind!==z.kind||"string"!==O.kind&&"number"!==O.kind)throw new ht(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${O.kind}, ${z.kind}) instead.`)}if(this.collator&&!m&&this.hasUntypedArgument){const O=Ve(S),z=Ve(k);if("string"!==O.kind||"string"!==z.kind)return o(T,S,k)}return this.collator?h(T,S,k,this.collator.evaluate(T)):o(T,S,k)}eachChild(T){T(this.lhs),T(this.rhs),this.collator&&T(this.collator)}outputDefined(){return!0}}}const Al=Ml("==",function(c,o,h){return o===h},Sh),qo=Ml("!=",function(c,o,h){return o!==h},function(c,o,h,m){return!Sh(0,o,h,m)}),ka=Ml("<",function(c,o,h){return o<h},function(c,o,h,m){return m.compare(o,h)<0}),Gp=Ml(">",function(c,o,h){return o>h},function(c,o,h,m){return m.compare(o,h)>0}),da=Ml("<=",function(c,o,h){return o<=h},function(c,o,h,m){return m.compare(o,h)<=0}),tr=Ml(">=",function(c,o,h){return o>=h},function(c,o,h,m){return m.compare(o,h)>=0});class kd{constructor(o,h,m,b,T){this.type=En,this.number=o,this.locale=h,this.currency=m,this.minFractionDigits=b,this.maxFractionDigits=T}static parse(o,h){if(3!==o.length)return h.error("Expected two arguments.");const m=h.parse(o[1],1,ut);if(!m)return null;const b=o[2];if("object"!=typeof b||Array.isArray(b))return h.error("NumberFormat options argument must be an object.");let T=null;if(b.locale&&(T=h.parse(b.locale,1,En),!T))return null;let S=null;if(b.currency&&(S=h.parse(b.currency,1,En),!S))return null;let k=null;if(b["min-fraction-digits"]&&(k=h.parse(b["min-fraction-digits"],1,ut),!k))return null;let O=null;return b["max-fraction-digits"]&&(O=h.parse(b["max-fraction-digits"],1,ut),!O)?null:new kd(m,T,S,k,O)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}}class Mh{constructor(o){this.type=zr,this.sections=o}static parse(o,h){if(o.length<2)return h.error("Expected at least one argument.");const m=o[1];if(!Array.isArray(m)&&"object"==typeof m)return h.error("First argument must be an image or text section.");const b=[];let T=!1;for(let S=1;S<=o.length-1;++S){const k=o[S];if(T&&"object"==typeof k&&!Array.isArray(k)){T=!1;let O=null;if(k["font-scale"]&&(O=h.parse(k["font-scale"],1,ut),!O))return null;let z=null;if(k["text-font"]&&(z=h.parse(k["text-font"],1,Xr(En)),!z))return null;let j=null;if(k["text-color"]&&(j=h.parse(k["text-color"],1,Pr),!j))return null;const W=b[b.length-1];W.scale=O,W.font=z,W.textColor=j}else{const O=h.parse(o[S],1,tn);if(!O)return null;const z=O.type.kind;if("string"!==z&&"value"!==z&&"null"!==z&&"resolvedImage"!==z)return h.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");T=!0,b.push({content:O,scale:null,font:null,textColor:null})}}return new Mh(b)}evaluate(o){return new we(this.sections.map(h=>{const m=h.content.evaluate(o);return Ve(m)===vr?new Te("",m,null,null,null):new Te(Et(m),null,h.scale?h.scale.evaluate(o):null,h.font?h.font.evaluate(o).join(","):null,h.textColor?h.textColor.evaluate(o):null)}))}eachChild(o){for(const h of this.sections)o(h.content),h.scale&&o(h.scale),h.font&&o(h.font),h.textColor&&o(h.textColor)}outputDefined(){return!1}}class Dl{constructor(o){this.type=vr,this.input=o}static parse(o,h){if(2!==o.length)return h.error("Expected two arguments.");const m=h.parse(o[1],1,En);return m?new Dl(m):h.error("No image name provided.")}evaluate(o){const h=this.input.evaluate(o),m=Ce.fromString(h);return m&&o.availableImages&&(m.available=o.availableImages.indexOf(h)>-1),m}eachChild(o){o(this.input)}outputDefined(){return!1}}class An{constructor(o){this.type=ut,this.input=o}static parse(o,h){if(2!==o.length)return h.error(`Expected 1 argument, but found ${o.length-1} instead.`);const m=h.parse(o[1],1);return m?"array"!==m.type.kind&&"string"!==m.type.kind&&"value"!==m.type.kind?h.error(`Expected argument of type string or array, but found ${xi(m.type)} instead.`):new An(m):null}evaluate(o){const h=this.input.evaluate(o);if("string"==typeof h||Array.isArray(h))return h.length;throw new ht(`Expected value to be of type string or array, but found ${xi(Ve(h))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}}const Il={"==":Al,"!=":qo,">":Gp,"<":ka,">=":tr,"<=":da,array:$t,at:Vu,boolean:$t,case:cu,coalesce:zu,collator:wi,format:Mh,image:Dl,in:Eh,"index-of":Th,interpolate:ni,"interpolate-hcl":ni,"interpolate-lab":ni,length:An,let:Tc,literal:Mt,match:_n,number:$t,"number-format":kd,object:$t,slice:Ch,step:Fe,string:$t,"to-boolean":nn,"to-color":nn,"to-number":nn,"to-string":nn,var:Yr,within:Pa};function eo(c,[o,h,m,b]){o=o.evaluate(c),h=h.evaluate(c),m=m.evaluate(c);const T=b?b.evaluate(c):1,S=je(o,h,m,T);if(S)throw new ht(S);return new re(o/255*T,h/255*T,m/255*T,T)}function Ah(c,o){return c in o}function uu(c,o){const h=o[c];return void 0===h?null:h}function Rr(c){return{type:c}}function Pl(c){return{result:"success",value:c}}function oc(c){return{result:"error",value:c}}function jt(c){return"data-driven"===c["property-type"]||"cross-faded-data-driven"===c["property-type"]}function kl(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function Un(c){return!!c.expression&&c.expression.interpolated}function mi(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":null===c?"null":typeof c}function un(c){return"object"==typeof c&&null!==c&&!Array.isArray(c)}function fr(c){return c}function hu(c,o){const h="color"===o.type,m=c.stops&&"object"==typeof c.stops[0][0],b=m||!(m||void 0!==c.property),T=c.type||(Un(o)?"exponential":"interval");if(h||"padding"===o.type){const z=h?re.parse:ve.parse;(c=rs({},c)).stops&&(c.stops=c.stops.map(j=>[j[0],z(j[1])])),c.default=z(c.default?c.default:o.default)}if(c.colorSpace&&"rgb"!==c.colorSpace&&!Pd[c.colorSpace])throw new Error(`Unknown color space: ${c.colorSpace}`);let S,k,O;if("exponential"===T)S=Ur;else if("interval"===T)S=Ai;else if("categorical"===T){S=to,k=Object.create(null);for(const z of c.stops)k[z[0]]=z[1];O=typeof c.stops[0][0]}else{if("identity"!==T)throw new Error(`Unknown function type "${T}"`);S=no}if(m){const z={},j=[];for(let te=0;te<c.stops.length;te++){const ne=c.stops[te],ge=ne[0].zoom;void 0===z[ge]&&(z[ge]={zoom:ge,type:c.type,property:c.property,default:c.default,stops:[]},j.push(ge)),z[ge].stops.push([ne[0].value,ne[1]])}const W=[];for(const te of j)W.push([z[te].zoom,hu(z[te],o)]);const J={name:"linear"};return{kind:"composite",interpolationType:J,interpolationFactor:ni.interpolationFactor.bind(void 0,J),zoomStops:W.map(te=>te[0]),evaluate:({zoom:te},ne)=>Ur({stops:W,base:c.base},o,te).evaluate(te,ne)}}if(b){const z="exponential"===T?{name:"exponential",base:void 0!==c.base?c.base:1}:null;return{kind:"camera",interpolationType:z,interpolationFactor:ni.interpolationFactor.bind(void 0,z),zoomStops:c.stops.map(j=>j[0]),evaluate:({zoom:j})=>S(c,o,j,k,O)}}return{kind:"source",evaluate(z,j){const W=j&&j.properties?j.properties[c.property]:void 0;return void 0===W?Jt(c.default,o.default):S(c,o,W,k,O)}}}function Jt(c,o,h){return void 0!==c?c:void 0!==o?o:void 0!==h?h:void 0}function to(c,o,h,m,b){return Jt(typeof h===b?m[h]:void 0,c.default,o.default)}function Ai(c,o,h){if("number"!==mi(h))return Jt(c.default,o.default);const m=c.stops.length;if(1===m||h<=c.stops[0][0])return c.stops[0][1];if(h>=c.stops[m-1][0])return c.stops[m-1][1];const b=xe(c.stops.map(T=>T[0]),h);return c.stops[b][1]}function Ur(c,o,h){const m=void 0!==c.base?c.base:1;if("number"!==mi(h))return Jt(c.default,o.default);const b=c.stops.length;if(1===b||h<=c.stops[0][0])return c.stops[0][1];if(h>=c.stops[b-1][0])return c.stops[b-1][1];const T=xe(c.stops.map(j=>j[0]),h),S=function(j,W,J,te){const ne=te-J,ge=j-J;return 0===ne?0:1===W?ge/ne:(Math.pow(W,ge)-1)/(Math.pow(W,ne)-1)}(h,m,c.stops[T][0],c.stops[T+1][0]),k=c.stops[T][1],O=c.stops[T+1][1];let z=At[o.type]||fr;if(c.colorSpace&&"rgb"!==c.colorSpace){const j=Pd[c.colorSpace];z=(W,J)=>j.reverse(j.interpolate(j.forward(W),j.forward(J),S))}return"function"==typeof k.evaluate?{evaluate(...j){const W=k.evaluate.apply(void 0,j),J=O.evaluate.apply(void 0,j);if(void 0!==W&&void 0!==J)return z(W,J,S)}}:z(k,O,S)}function no(c,o,h){switch(o.type){case"color":h=re.parse(h);break;case"formatted":h=we.fromString(h.toString());break;case"resolvedImage":h=Ce.fromString(h.toString());break;case"padding":h=ve.parse(h);break;default:mi(h)===o.type||"enum"===o.type&&o.values[h]||(h=void 0)}return Jt(h,c.default,o.default)}oi.register(Il,{error:[{kind:"error"},[En],(c,[o])=>{throw new ht(o.evaluate(c))}],typeof:[En,[tn],(c,[o])=>xi(Ve(o.evaluate(c)))],"to-rgba":[Xr(ut,4),[Pr],(c,[o])=>o.evaluate(c).toArray()],rgb:[Pr,[ut,ut,ut],eo],rgba:[Pr,[ut,ut,ut,ut],eo],has:{type:on,overloads:[[[En],(c,[o])=>Ah(o.evaluate(c),c.properties())],[[En,Ma],(c,[o,h])=>Ah(o.evaluate(c),h.evaluate(c))]]},get:{type:tn,overloads:[[[En],(c,[o])=>uu(o.evaluate(c),c.properties())],[[En,Ma],(c,[o,h])=>uu(o.evaluate(c),h.evaluate(c))]]},"feature-state":[tn,[En],(c,[o])=>uu(o.evaluate(c),c.featureState||{})],properties:[Ma,[],c=>c.properties()],"geometry-type":[En,[],c=>c.geometryType()],id:[tn,[],c=>c.id()],zoom:[ut,[],c=>c.globals.zoom],"heatmap-density":[ut,[],c=>c.globals.heatmapDensity||0],"line-progress":[ut,[],c=>c.globals.lineProgress||0],accumulated:[tn,[],c=>void 0===c.globals.accumulated?null:c.globals.accumulated],"+":[ut,Rr(ut),(c,o)=>{let h=0;for(const m of o)h+=m.evaluate(c);return h}],"*":[ut,Rr(ut),(c,o)=>{let h=1;for(const m of o)h*=m.evaluate(c);return h}],"-":{type:ut,overloads:[[[ut,ut],(c,[o,h])=>o.evaluate(c)-h.evaluate(c)],[[ut],(c,[o])=>-o.evaluate(c)]]},"/":[ut,[ut,ut],(c,[o,h])=>o.evaluate(c)/h.evaluate(c)],"%":[ut,[ut,ut],(c,[o,h])=>o.evaluate(c)%h.evaluate(c)],ln2:[ut,[],()=>Math.LN2],pi:[ut,[],()=>Math.PI],e:[ut,[],()=>Math.E],"^":[ut,[ut,ut],(c,[o,h])=>Math.pow(o.evaluate(c),h.evaluate(c))],sqrt:[ut,[ut],(c,[o])=>Math.sqrt(o.evaluate(c))],log10:[ut,[ut],(c,[o])=>Math.log(o.evaluate(c))/Math.LN10],ln:[ut,[ut],(c,[o])=>Math.log(o.evaluate(c))],log2:[ut,[ut],(c,[o])=>Math.log(o.evaluate(c))/Math.LN2],sin:[ut,[ut],(c,[o])=>Math.sin(o.evaluate(c))],cos:[ut,[ut],(c,[o])=>Math.cos(o.evaluate(c))],tan:[ut,[ut],(c,[o])=>Math.tan(o.evaluate(c))],asin:[ut,[ut],(c,[o])=>Math.asin(o.evaluate(c))],acos:[ut,[ut],(c,[o])=>Math.acos(o.evaluate(c))],atan:[ut,[ut],(c,[o])=>Math.atan(o.evaluate(c))],min:[ut,Rr(ut),(c,o)=>Math.min(...o.map(h=>h.evaluate(c)))],max:[ut,Rr(ut),(c,o)=>Math.max(...o.map(h=>h.evaluate(c)))],abs:[ut,[ut],(c,[o])=>Math.abs(o.evaluate(c))],round:[ut,[ut],(c,[o])=>{const h=o.evaluate(c);return h<0?-Math.round(-h):Math.round(h)}],floor:[ut,[ut],(c,[o])=>Math.floor(o.evaluate(c))],ceil:[ut,[ut],(c,[o])=>Math.ceil(o.evaluate(c))],"filter-==":[on,[En,tn],(c,[o,h])=>c.properties()[o.value]===h.value],"filter-id-==":[on,[tn],(c,[o])=>c.id()===o.value],"filter-type-==":[on,[En],(c,[o])=>c.geometryType()===o.value],"filter-<":[on,[En,tn],(c,[o,h])=>{const m=c.properties()[o.value],b=h.value;return typeof m==typeof b&&m<b}],"filter-id-<":[on,[tn],(c,[o])=>{const h=c.id(),m=o.value;return typeof h==typeof m&&h<m}],"filter->":[on,[En,tn],(c,[o,h])=>{const m=c.properties()[o.value],b=h.value;return typeof m==typeof b&&m>b}],"filter-id->":[on,[tn],(c,[o])=>{const h=c.id(),m=o.value;return typeof h==typeof m&&h>m}],"filter-<=":[on,[En,tn],(c,[o,h])=>{const m=c.properties()[o.value],b=h.value;return typeof m==typeof b&&m<=b}],"filter-id-<=":[on,[tn],(c,[o])=>{const h=c.id(),m=o.value;return typeof h==typeof m&&h<=m}],"filter->=":[on,[En,tn],(c,[o,h])=>{const m=c.properties()[o.value],b=h.value;return typeof m==typeof b&&m>=b}],"filter-id->=":[on,[tn],(c,[o])=>{const h=c.id(),m=o.value;return typeof h==typeof m&&h>=m}],"filter-has":[on,[tn],(c,[o])=>o.value in c.properties()],"filter-has-id":[on,[],c=>null!==c.id()&&void 0!==c.id()],"filter-type-in":[on,[Xr(En)],(c,[o])=>o.value.indexOf(c.geometryType())>=0],"filter-id-in":[on,[Xr(tn)],(c,[o])=>o.value.indexOf(c.id())>=0],"filter-in-small":[on,[En,Xr(tn)],(c,[o,h])=>h.value.indexOf(c.properties()[o.value])>=0],"filter-in-large":[on,[En,Xr(tn)],(c,[o,h])=>function(m,b,T,S){for(;T<=S;){const k=T+S>>1;if(b[k]===m)return!0;b[k]>m?S=k-1:T=k+1}return!1}(c.properties()[o.value],h.value,0,h.value.length-1)],all:{type:on,overloads:[[[on,on],(c,[o,h])=>o.evaluate(c)&&h.evaluate(c)],[Rr(on),(c,o)=>{for(const h of o)if(!h.evaluate(c))return!1;return!0}]]},any:{type:on,overloads:[[[on,on],(c,[o,h])=>o.evaluate(c)||h.evaluate(c)],[Rr(on),(c,o)=>{for(const h of o)if(h.evaluate(c))return!0;return!1}]]},"!":[on,[on],(c,[o])=>!o.evaluate(c)],"is-supported-script":[on,[En],(c,[o])=>{const h=c.globals&&c.globals.isSupportedScript;return!h||h(o.evaluate(c))}],upcase:[En,[En],(c,[o])=>o.evaluate(c).toUpperCase()],downcase:[En,[En],(c,[o])=>o.evaluate(c).toLowerCase()],concat:[En,Rr(tn),(c,o)=>o.map(h=>Et(h.evaluate(c))).join("")],"resolved-locale":[En,[ua],(c,[o])=>o.evaluate(c).resolvedLocale()]});class Rl{constructor(o,h){var m;this.expression=o,this._warningHistory={},this._evaluator=new pn,this._defaultValue=h?"color"===(m=h).type&&un(m.default)?new re(0,0,0,0):"color"===m.type?re.parse(m.default)||null:"padding"===m.type?ve.parse(m.default)||null:void 0===m.default?null:m.default:null,this._enumValues=h&&"enum"===h.type?h.values:null}evaluateWithoutErrorHandling(o,h,m,b,T,S){return this._evaluator.globals=o,this._evaluator.feature=h,this._evaluator.featureState=m,this._evaluator.canonical=b,this._evaluator.availableImages=T||null,this._evaluator.formattedSection=S,this.expression.evaluate(this._evaluator)}evaluate(o,h,m,b,T,S){this._evaluator.globals=o,this._evaluator.feature=h||null,this._evaluator.featureState=m||null,this._evaluator.canonical=b,this._evaluator.availableImages=T||null,this._evaluator.formattedSection=S||null;try{const k=this.expression.evaluate(this._evaluator);if(null==k||"number"==typeof k&&k!=k)return this._defaultValue;if(this._enumValues&&!(k in this._enumValues))throw new ht(`Expected value to be one of ${Object.keys(this._enumValues).map(O=>JSON.stringify(O)).join(", ")}, but found ${JSON.stringify(k)} instead.`);return k}catch(k){return this._warningHistory[k.message]||(this._warningHistory[k.message]=!0,typeof console<"u"&&console.warn(k.message)),this._defaultValue}}}function xs(c){return Array.isArray(c)&&c.length>0&&"string"==typeof c[0]&&c[0]in Il}function ws(c,o){const h=new ee(Il,[],o?function(b){const T={color:Pr,string:En,number:ut,enum:En,boolean:on,formatted:zr,padding:Aa,resolvedImage:vr};return"array"===b.type?Xr(T[b.value]||tn,b.length):T[b.type]}(o):void 0),m=h.parse(c,void 0,void 0,void 0,o&&"string"===o.type?{typeAnnotation:"coerce"}:void 0);return m?Pl(new Rl(m,o)):oc(h.errors)}class xt{constructor(o,h){this.kind=o,this._styleExpression=h,this.isStateDependent="constant"!==o&&!Sl(h.expression)}evaluateWithoutErrorHandling(o,h,m,b,T,S){return this._styleExpression.evaluateWithoutErrorHandling(o,h,m,b,T,S)}evaluate(o,h,m,b,T,S){return this._styleExpression.evaluate(o,h,m,b,T,S)}}class Dn{constructor(o,h,m,b){this.kind=o,this.zoomStops=m,this._styleExpression=h,this.isStateDependent="camera"!==o&&!Sl(h.expression),this.interpolationType=b}evaluateWithoutErrorHandling(o,h,m,b,T,S){return this._styleExpression.evaluateWithoutErrorHandling(o,h,m,b,T,S)}evaluate(o,h,m,b,T,S){return this._styleExpression.evaluate(o,h,m,b,T,S)}interpolationFactor(o,h,m){return this.interpolationType?ni.interpolationFactor(this.interpolationType,o,h,m):0}}function pr(c,o){const h=ws(c,o);if("error"===h.result)return h;const m=h.value.expression,b=Qa(m);if(!b&&!jt(o))return oc([new Rs("","data expressions not supported")]);const T=el(m,["zoom"]);if(!T&&!kl(o))return oc([new Rs("","zoom expressions not supported")]);const S=fa(m);return S||T?S instanceof Rs?oc([S]):S instanceof ni&&!Un(o)?oc([new Rs("",'"interpolate" expressions cannot be used with this property')]):Pl(S?new Dn(b?"camera":"composite",h.value,S.labels,S instanceof ni?S.interpolation:void 0):new xt(b?"constant":"source",h.value)):oc([new Rs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Es{constructor(o,h){this._parameters=o,this._specification=h,rs(this,hu(this._parameters,this._specification))}static deserialize(o){return new Es(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function fa(c){let o=null;if(c instanceof Tc)o=fa(c.result);else if(c instanceof zu){for(const h of c.args)if(o=fa(h),o)break}else(c instanceof Fe||c instanceof ni)&&c.input instanceof oi&&"zoom"===c.input.name&&(o=c);return o instanceof Rs||c.eachChild(h=>{const m=fa(h);m instanceof Rs?o=m:!o&&m?o=new Rs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):o&&m&&o!==m&&(o=new Rs("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}function Yi(c){const o=c.key,h=c.value,m=c.valueSpec||{},b=c.objectElementValidators||{},T=c.style,S=c.styleSpec;let k=[];const O=mi(h);if("object"!==O)return[new pt(o,h,`object expected, ${O} found`)];for(const z in h){const j=z.split(".")[0],W=m[j]||m["*"];let J;if(b[j])J=b[j];else if(m[j])J=so;else if(b["*"])J=b["*"];else{if(!m["*"]){k.push(new pt(o,h[z],`unknown property "${z}"`));continue}J=so}k=k.concat(J({key:(o&&`${o}.`)+z,value:h[z],valueSpec:W,style:T,styleSpec:S,object:h,objectKey:z},h))}for(const z in m)b[z]||m[z].required&&void 0===m[z].default&&void 0===h[z]&&k.push(new pt(o,h,`missing required property "${z}"`));return k}function Ll(c){const o=c.value,h=c.valueSpec,m=c.style,b=c.styleSpec,T=c.key,S=c.arrayElementValidator||so;if("array"!==mi(o))return[new pt(T,o,`array expected, ${mi(o)} found`)];if(h.length&&o.length!==h.length)return[new pt(T,o,`array length ${h.length} expected, length ${o.length} found`)];if(h["min-length"]&&o.length<h["min-length"])return[new pt(T,o,`array length at least ${h["min-length"]} expected, length ${o.length} found`)];let k={type:h.value,values:h.values};b.$version<7&&(k.function=h.function),"object"===mi(h.value)&&(k=h.value);let O=[];for(let z=0;z<o.length;z++)O=O.concat(S({array:o,arrayIndex:z,value:o[z],valueSpec:k,style:m,styleSpec:b,key:`${T}[${z}]`}));return O}function ai(c){const o=c.key,h=c.value,m=c.valueSpec;let b=mi(h);return"number"===b&&h!=h&&(b="NaN"),"number"!==b?[new pt(o,h,`number expected, ${b} found`)]:"minimum"in m&&h<m.minimum?[new pt(o,h,`${h} is less than the minimum value ${m.minimum}`)]:"maximum"in m&&h>m.maximum?[new pt(o,h,`${h} is greater than the maximum value ${m.maximum}`)]:[]}function ac(c){const o=c.valueSpec,h=$n(c.value.type);let m,b,T,S={};const k="categorical"!==h&&void 0===c.value.property,O=!k,z="array"===mi(c.value.stops)&&"array"===mi(c.value.stops[0])&&"object"===mi(c.value.stops[0][0]),j=Yi({key:c.key,value:c.value,valueSpec:c.styleSpec.function,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(te){if("identity"===h)return[new pt(te.key,te.value,'identity function may not have a "stops" property')];let ne=[];const ge=te.value;return ne=ne.concat(Ll({key:te.key,value:ge,valueSpec:te.valueSpec,style:te.style,styleSpec:te.styleSpec,arrayElementValidator:W})),"array"===mi(ge)&&0===ge.length&&ne.push(new pt(te.key,ge,"array must have at least one stop")),ne},default:function(te){return so({key:te.key,value:te.value,valueSpec:o,style:te.style,styleSpec:te.styleSpec})}}});return"identity"===h&&k&&j.push(new pt(c.key,c.value,'missing required property "property"')),"identity"===h||c.value.stops||j.push(new pt(c.key,c.value,'missing required property "stops"')),"exponential"===h&&c.valueSpec.expression&&!Un(c.valueSpec)&&j.push(new pt(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(O&&!jt(c.valueSpec)?j.push(new pt(c.key,c.value,"property functions not supported")):k&&!kl(c.valueSpec)&&j.push(new pt(c.key,c.value,"zoom functions not supported"))),"categorical"!==h&&!z||void 0!==c.value.property||j.push(new pt(c.key,c.value,'"property" property is required')),j;function W(te){let ne=[];const ge=te.value,pe=te.key;if("array"!==mi(ge))return[new pt(pe,ge,`array expected, ${mi(ge)} found`)];if(2!==ge.length)return[new pt(pe,ge,`array length 2 expected, length ${ge.length} found`)];if(z){if("object"!==mi(ge[0]))return[new pt(pe,ge,`object expected, ${mi(ge[0])} found`)];if(void 0===ge[0].zoom)return[new pt(pe,ge,"object stop key must have zoom")];if(void 0===ge[0].value)return[new pt(pe,ge,"object stop key must have value")];if(T&&T>$n(ge[0].zoom))return[new pt(pe,ge[0].zoom,"stop zoom values must appear in ascending order")];$n(ge[0].zoom)!==T&&(T=$n(ge[0].zoom),b=void 0,S={}),ne=ne.concat(Yi({key:`${pe}[0]`,value:ge[0],valueSpec:{zoom:{}},style:te.style,styleSpec:te.styleSpec,objectElementValidators:{zoom:ai,value:J}}))}else ne=ne.concat(J({key:`${pe}[0]`,value:ge[0],valueSpec:{},style:te.style,styleSpec:te.styleSpec},ge));return xs(ks(ge[1]))?ne.concat([new pt(`${pe}[1]`,ge[1],"expressions are not allowed in function stops.")]):ne.concat(so({key:`${pe}[1]`,value:ge[1],valueSpec:o,style:te.style,styleSpec:te.styleSpec}))}function J(te,ne){const ge=mi(te.value),pe=$n(te.value),Pe=null!==te.value?te.value:ne;if(m){if(ge!==m)return[new pt(te.key,Pe,`${ge} stop domain type must match previous stop domain type ${m}`)]}else m=ge;if("number"!==ge&&"string"!==ge&&"boolean"!==ge)return[new pt(te.key,Pe,"stop domain value must be a number, string, or boolean")];if("number"!==ge&&"categorical"!==h){let ze=`number expected, ${ge} found`;return jt(o)&&void 0===h&&(ze+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new pt(te.key,Pe,ze)]}return"categorical"!==h||"number"!==ge||isFinite(pe)&&Math.floor(pe)===pe?"categorical"!==h&&"number"===ge&&void 0!==b&&pe<b?[new pt(te.key,Pe,"stop domain values must appear in ascending order")]:(b=pe,"categorical"===h&&pe in S?[new pt(te.key,Pe,"stop domain values must be unique")]:(S[pe]=!0,[])):[new pt(te.key,Pe,`integer expected, found ${pe}`)]}}function io(c){const o=("property"===c.expressionContext?pr:ws)(ks(c.value),c.valueSpec);if("error"===o.result)return o.value.map(m=>new pt(`${c.key}${m.key}`,c.value,m.message));const h=o.value.expression||o.value._styleExpression.expression;if("property"===c.expressionContext&&"text-font"===c.propertyKey&&!h.outputDefined())return[new pt(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===c.expressionContext&&"layout"===c.propertyType&&!Sl(h))return[new pt(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===c.expressionContext&&!Sl(h))return[new pt(c.key,c.value,'"feature-state" data expressions are not supported with filters.')];if(c.expressionContext&&0===c.expressionContext.indexOf("cluster")){if(!el(h,["zoom","feature-state"]))return[new pt(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===c.expressionContext&&!Qa(h))return[new pt(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function In(c){const o=c.key,h=c.value,m=c.valueSpec,b=[];return Array.isArray(m.values)?-1===m.values.indexOf($n(h))&&b.push(new pt(o,h,`expected one of [${m.values.join(", ")}], ${JSON.stringify(h)} found`)):-1===Object.keys(m.values).indexOf($n(h))&&b.push(new pt(o,h,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(h)} found`)),b}function tl(c){if(!0===c||!1===c)return!0;if(!Array.isArray(c)||0===c.length)return!1;switch(c[0]){case"has":return c.length>=2&&"$id"!==c[1]&&"$type"!==c[1];case"in":return c.length>=3&&("string"!=typeof c[1]||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==c.length||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const o of c.slice(1))if(!tl(o)&&"boolean"!=typeof o)return!1;return!0;default:return!0}}const du={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function fu(c){if(null==c)return{filter:()=>!0,needGeometry:!1};tl(c)||(c=Ol(c));const o=ws(c,du);if("error"===o.result)throw new Error(o.value.map(h=>`${h.key}: ${h.message}`).join(", "));return{filter:(h,m,b)=>o.value.evaluate(h,m,{},b),needGeometry:Ls(c)}}function lc(c,o){return c<o?-1:c>o?1:0}function Ls(c){if(!Array.isArray(c))return!1;if("within"===c[0])return!0;for(let o=1;o<c.length;o++)if(Ls(c[o]))return!0;return!1}function Ol(c){if(!c)return!0;const o=c[0];return c.length<=1?"any"!==o:"=="===o?Zo(c[1],c[2],"=="):"!="===o?Fl(Zo(c[1],c[2],"==")):"<"===o||">"===o||"<="===o||">="===o?Zo(c[1],c[2],o):"any"===o?(h=c.slice(1),["any"].concat(h.map(Ol))):"all"===o?["all"].concat(c.slice(1).map(Ol)):"none"===o?["all"].concat(c.slice(1).map(Ol).map(Fl)):"in"===o?So(c[1],c.slice(2)):"!in"===o?Fl(So(c[1],c.slice(2))):"has"===o?nl(c[1]):"!has"===o?Fl(nl(c[1])):"within"!==o||c;var h}function Zo(c,o,h){switch(c){case"$type":return[`filter-type-${h}`,o];case"$id":return[`filter-id-${h}`,o];default:return[`filter-${h}`,c,o]}}function So(c,o){if(0===o.length)return!1;switch(c){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(h=>typeof h!=typeof o[0])?["filter-in-large",c,["literal",o.sort(lc)]]:["filter-in-small",c,["literal",o]]}}function nl(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function Fl(c){return["!",c]}function Ri(c){return tl(ks(c.value))?io(rs({},c,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Nl(c)}function Nl(c){const o=c.value,h=c.key;if("array"!==mi(o))return[new pt(h,o,`array expected, ${mi(o)} found`)];const m=c.styleSpec;let b,T=[];if(o.length<1)return[new pt(h,o,"filter array must have at least 1 element")];switch(T=T.concat(In({key:`${h}[0]`,value:o[0],valueSpec:m.filter_operator,style:c.style,styleSpec:c.styleSpec})),$n(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&"$type"===$n(o[1])&&T.push(new pt(h,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":3!==o.length&&T.push(new pt(h,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(b=mi(o[1]),"string"!==b&&T.push(new pt(`${h}[1]`,o[1],`string expected, ${b} found`)));for(let S=2;S<o.length;S++)b=mi(o[S]),"$type"===$n(o[1])?T=T.concat(In({key:`${h}[${S}]`,value:o[S],valueSpec:m.geometry_type,style:c.style,styleSpec:c.styleSpec})):"string"!==b&&"number"!==b&&"boolean"!==b&&T.push(new pt(`${h}[${S}]`,o[S],`string, number, or boolean expected, ${b} found`));break;case"any":case"all":case"none":for(let S=1;S<o.length;S++)T=T.concat(Nl({key:`${h}[${S}]`,value:o[S],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":b=mi(o[1]),2!==o.length?T.push(new pt(h,o,`filter array for "${o[0]}" operator must have 2 elements`)):"string"!==b&&T.push(new pt(`${h}[1]`,o[1],`string expected, ${b} found`));break;case"within":b=mi(o[1]),2!==o.length?T.push(new pt(h,o,`filter array for "${o[0]}" operator must have 2 elements`)):"object"!==b&&T.push(new pt(`${h}[1]`,o[1],`object expected, ${b} found`))}return T}function cc(c,o){const h=c.key,m=c.style,b=c.styleSpec,T=c.value,S=c.objectKey,k=b[`${o}_${c.layerType}`];if(!k)return[];const O=S.match(/^(.*)-transition$/);if("paint"===o&&O&&k[O[1]]&&k[O[1]].transition)return so({key:h,value:T,valueSpec:b.transition,style:m,styleSpec:b});const z=c.valueSpec||k[S];if(!z)return[new pt(h,T,`unknown property "${S}"`)];let j;if("string"===mi(T)&&jt(z)&&!z.tokens&&(j=/^{([^}]+)}$/.exec(T)))return[new pt(h,T,`"${S}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(j[1])} }\`.`)];const W=[];return"symbol"===c.layerType&&("text-field"===S&&m&&!m.glyphs&&W.push(new pt(h,T,'use of "text-field" requires a style "glyphs" property')),"text-font"===S&&un(ks(T))&&"identity"===$n(T.type)&&W.push(new pt(h,T,'"text-font" does not support identity functions'))),W.concat(so({key:c.key,value:T,valueSpec:z,style:m,styleSpec:b,expressionContext:"property",propertyType:o,propertyKey:S}))}function Uu(c){return cc(c,"paint")}function Dh(c){return cc(c,"layout")}function pu(c){let o=[];const h=c.value,m=c.key,b=c.style,T=c.styleSpec;h.type||h.ref||o.push(new pt(m,h,'either "type" or "ref" is required'));let S=$n(h.type);const k=$n(h.ref);if(h.id){const O=$n(h.id);for(let z=0;z<c.arrayIndex;z++){const j=b.layers[z];$n(j.id)===O&&o.push(new pt(m,h.id,`duplicate layer id "${h.id}", previously used at line ${j.id.__line__}`))}}if("ref"in h){let O;["type","source","source-layer","filter","layout"].forEach(z=>{z in h&&o.push(new pt(m,h[z],`"${z}" is prohibited for ref layers`))}),b.layers.forEach(z=>{$n(z.id)===k&&(O=z)}),O?O.ref?o.push(new pt(m,h.ref,"ref cannot reference another ref layer")):S=$n(O.type):o.push(new pt(m,h.ref,`ref layer "${k}" not found`))}else if("background"!==S)if(h.source){const O=b.sources&&b.sources[h.source],z=O&&$n(O.type);O?"vector"===z&&"raster"===S?o.push(new pt(m,h.source,`layer "${h.id}" requires a raster source`)):"raster"===z&&"raster"!==S?o.push(new pt(m,h.source,`layer "${h.id}" requires a vector source`)):"vector"!==z||h["source-layer"]?"raster-dem"===z&&"hillshade"!==S?o.push(new pt(m,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==S||!h.paint||!h.paint["line-gradient"]||"geojson"===z&&O.lineMetrics||o.push(new pt(m,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new pt(m,h,`layer "${h.id}" must specify a "source-layer"`)):o.push(new pt(m,h.source,`source "${h.source}" not found`))}else o.push(new pt(m,h,'missing required property "source"'));return o=o.concat(Yi({key:m,value:h,valueSpec:T.layer,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{"*":()=>[],type:()=>so({key:`${m}.type`,value:h.type,valueSpec:T.layer.type,style:c.style,styleSpec:c.styleSpec,object:h,objectKey:"type"}),filter:Ri,layout:O=>Yi({layer:h,key:O.key,value:O.value,style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":z=>Dh(rs({layerType:S},z))}}),paint:O=>Yi({layer:h,key:O.key,value:O.value,style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":z=>Uu(rs({layerType:S},z))}})}})),o}function Mo(c){const o=c.value,h=c.key,m=mi(o);return"string"!==m?[new pt(h,o,`string expected, ${m} found`)]:[]}const Ts={promoteId:function({key:c,value:o}){if("string"===mi(o))return Mo({key:c,value:o});{const h=[];for(const m in o)h.push(...Mo({key:`${c}.${m}`,value:o[m]}));return h}}};function jr(c){const o=c.value,h=c.key,m=c.styleSpec,b=c.style;if(!o.type)return[new pt(h,o,'"type" is required')];const T=$n(o.type);let S;switch(T){case"vector":case"raster":case"raster-dem":return S=Yi({key:h,value:o,valueSpec:m[`source_${T.replace("-","_")}`],style:c.style,styleSpec:m,objectElementValidators:Ts}),S;case"geojson":if(S=Yi({key:h,value:o,valueSpec:m.source_geojson,style:b,styleSpec:m,objectElementValidators:Ts}),o.cluster)for(const k in o.clusterProperties){const[O,z]=o.clusterProperties[k],j="string"==typeof O?[O,["accumulated"],["get",k]]:O;S.push(...io({key:`${h}.${k}.map`,value:z,expressionContext:"cluster-map"})),S.push(...io({key:`${h}.${k}.reduce`,value:j,expressionContext:"cluster-reduce"}))}return S;case"video":return Yi({key:h,value:o,valueSpec:m.source_video,style:b,styleSpec:m});case"image":return Yi({key:h,value:o,valueSpec:m.source_image,style:b,styleSpec:m});case"canvas":return[new pt(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return In({key:`${h}.type`,value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:b,styleSpec:m})}}function ju(c){const o=c.value,h=c.styleSpec,m=h.light,b=c.style;let T=[];const S=mi(o);if(void 0===o)return T;if("object"!==S)return T=T.concat([new pt("light",o,`object expected, ${S} found`)]),T;for(const k in o){const O=k.match(/^(.*)-transition$/);T=T.concat(O&&m[O[1]]&&m[O[1]].transition?so({key:k,value:o[k],valueSpec:h.transition,style:b,styleSpec:h}):m[k]?so({key:k,value:o[k],valueSpec:m[k],style:b,styleSpec:h}):[new pt(k,o[k],`unknown property "${k}"`)])}return T}function nr(c){const o=c.value,h=c.styleSpec,m=h.terrain,b=c.style;let T=[];const S=mi(o);if(void 0===o)return T;if("object"!==S)return T=T.concat([new pt("terrain",o,`object expected, ${S} found`)]),T;for(const k in o)T=T.concat(m[k]?so({key:k,value:o[k],valueSpec:m[k],style:b,styleSpec:h}):[new pt(k,o[k],`unknown property "${k}"`)]);return T}const ro={"*":()=>[],array:Ll,boolean:function(c){const o=c.value,h=c.key,m=mi(o);return"boolean"!==m?[new pt(h,o,`boolean expected, ${m} found`)]:[]},number:ai,color:function(c){const o=c.key,h=c.value,m=mi(h);return"string"!==m?[new pt(o,h,`color expected, ${m} found`)]:null===ic(h)?[new pt(o,h,`color expected, "${h}" found`)]:[]},constants:ca,enum:In,filter:Ri,function:ac,layer:pu,object:Yi,source:jr,light:ju,terrain:nr,string:Mo,formatted:function(c){return 0===Mo(c).length?[]:io(c)},resolvedImage:function(c){return 0===Mo(c).length?[]:io(c)},padding:function(c){const o=c.key,h=c.value;if("array"===mi(h)){if(h.length<1||h.length>4)return[new pt(o,h,`padding requires 1 to 4 values; ${h.length} values found`)];const m={type:"number"};let b=[];for(let T=0;T<h.length;T++)b=b.concat(so({key:`${o}[${T}]`,value:h[T],valueSpec:m}));return b}return ai({key:o,value:h,valueSpec:{}})}};function so(c){const o=c.value,h=c.valueSpec,m=c.styleSpec;return h.expression&&un($n(o))?ac(c):h.expression&&xs(ks(o))?io(c):h.type&&ro[h.type]?ro[h.type](c):Yi(rs({},c,{valueSpec:h.type?m[h.type]:h}))}function Ih(c){const o=c.value,h=c.key,m=Mo(c);return m.length||(-1===o.indexOf("{fontstack}")&&m.push(new pt(h,o,'"glyphs" url must include a "{fontstack}" token')),-1===o.indexOf("{range}")&&m.push(new pt(h,o,'"glyphs" url must include a "{range}" token'))),m}function Ao(c,o=He){let h=[];return h=h.concat(so({key:"",value:c,valueSpec:o.$root,styleSpec:o,style:c,objectElementValidators:{glyphs:Ih,"*":()=>[]}})),c.constants&&(h=h.concat(ca({key:"constants",value:c.constants,style:c,styleSpec:o}))),Ae(h)}function Ae(c){return[].concat(c).sort((o,h)=>o.line-h.line)}function Xe(c){return function(...o){return Ae(c.apply(this,o))}}Ao.source=Xe(jr),Ao.light=Xe(ju),Ao.terrain=Xe(nr),Ao.layer=Xe(pu),Ao.filter=Xe(Ri),Ao.paintProperty=Xe(Uu),Ao.layoutProperty=Xe(Dh);const Ge=Ao,Rt=Ge.light,Ln=Ge.paintProperty,Ni=Ge.layoutProperty;function Hr(c,o){let h=!1;if(o&&o.length)for(const m of o)c.fire(new Ya(new Error(m.message))),h=!0;return h}class Bi{constructor(o,h,m){const b=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;const S=new Int32Array(this.arrayBuffer);o=S[0],this.d=(h=S[1])+2*(m=S[2]);for(let O=0;O<this.d*this.d;O++){const z=S[3+O],j=S[3+O+1];b.push(z===j?null:S.subarray(z,j))}const k=S[3+b.length+1];this.keys=S.subarray(S[3+b.length],k),this.bboxes=S.subarray(k),this.insert=this._insertReadonly}else{this.d=h+2*m;for(let S=0;S<this.d*this.d;S++)b.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=o,this.padding=m,this.scale=h/o,this.uid=0;const T=m/h*o;this.min=-T,this.max=o+T}insert(o,h,m,b,T){this._forEachCell(h,m,b,T,this._insertCell,this.uid++,void 0,void 0),this.keys.push(o),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(b),this.bboxes.push(T)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(o,h,m,b,T,S){this.cells[T].push(S)}query(o,h,m,b,T){const S=this.min,k=this.max;if(o<=S&&h<=S&&k<=m&&k<=b&&!T)return Array.prototype.slice.call(this.keys);{const O=[];return this._forEachCell(o,h,m,b,this._queryCell,O,{},T),O}}_queryCell(o,h,m,b,T,S,k,O){const z=this.cells[T];if(null!==z){const j=this.keys,W=this.bboxes;for(let J=0;J<z.length;J++){const te=z[J];if(void 0===k[te]){const ne=4*te;(O?O(W[ne+0],W[ne+1],W[ne+2],W[ne+3]):o<=W[ne+2]&&h<=W[ne+3]&&m>=W[ne+0]&&b>=W[ne+1])?(k[te]=!0,S.push(j[te])):k[te]=!1}}}}_forEachCell(o,h,m,b,T,S,k,O){const z=this._convertToCellCoord(o),j=this._convertToCellCoord(h),W=this._convertToCellCoord(m),J=this._convertToCellCoord(b);for(let te=z;te<=W;te++)for(let ne=j;ne<=J;ne++){const ge=this.d*ne+te;if((!O||O(this._convertFromCellCoord(te),this._convertFromCellCoord(ne),this._convertFromCellCoord(te+1),this._convertFromCellCoord(ne+1)))&&T.call(this,o,h,m,b,ge,S,k,O))return}}_convertFromCellCoord(o){return(o-this.padding)/this.scale}_convertToCellCoord(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const o=this.cells,h=3+this.cells.length+1+1;let m=0;for(let S=0;S<this.cells.length;S++)m+=this.cells[S].length;const b=new Int32Array(h+m+this.keys.length+this.bboxes.length);b[0]=this.extent,b[1]=this.n,b[2]=this.padding;let T=h;for(let S=0;S<o.length;S++){const k=o[S];b[3+S]=T,b.set(k,T),T+=k.length}return b[3+o.length]=T,b.set(this.keys,T),T+=this.keys.length,b[3+o.length+1]=T,b.set(this.bboxes,T),T+=this.bboxes.length,b.buffer}static serialize(o,h){const m=o.toArrayBuffer();return h&&h.push(m),{buffer:m}}static deserialize(o){return new Bi(o.buffer)}}const il={};function Dt(c,o,h={}){if(il[c])throw new Error(`${c} is already registered.`);Object.defineProperty(o,"_classRegistryKey",{value:c,writeable:!1}),il[c]={klass:o,omit:h.omit||[],shallow:h.shallow||[]}}Dt("Object",Object),Dt("TransferableGridIndex",Bi),Dt("Color",re),Dt("Error",Error),Dt("AJAXError",bi),Dt("ResolvedImage",Ce),Dt("StylePropertyFunction",Es),Dt("StyleExpression",Rl,{omit:["_evaluator"]}),Dt("ZoomDependentExpression",Dn),Dt("ZoomConstantExpression",xt),Dt("CompoundExpression",oi,{omit:["_evaluate"]});for(const c in Il)Il[c]._classRegistryKey||Dt(`Expression_${c}`,Il[c]);function pa(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&"ArrayBuffer"===c.constructor.name)}function Bl(c,o){if(null==c||"boolean"==typeof c||"number"==typeof c||"string"==typeof c||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob)return c;if(pa(c)||Xs(c))return o&&o.push(c),c;if(ArrayBuffer.isView(c)){const h=c;return o&&o.push(h.buffer),h}if(c instanceof ImageData)return o&&o.push(c.data.buffer),c;if(Array.isArray(c)){const h=[];for(const m of c)h.push(Bl(m,o));return h}if("object"==typeof c){const h=c.constructor,m=h._classRegistryKey;if(!m)throw new Error("can't serialize object of unregistered class");if(!il[m])throw new Error(`${m} is not registered.`);const b=h.serialize?h.serialize(c,o):{};if(h.serialize){if(o&&b===o[o.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const T in c){if(!c.hasOwnProperty(T)||il[m].omit.indexOf(T)>=0)continue;const S=c[T];b[T]=il[m].shallow.indexOf(T)>=0?S:Bl(S,o)}c instanceof Error&&(b.message=c.message)}if(b.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==m&&(b.$name=m),b}throw new Error("can't serialize object of type "+typeof c)}function Cc(c){if(null==c||"boolean"==typeof c||"number"==typeof c||"string"==typeof c||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||pa(c)||Xs(c)||ArrayBuffer.isView(c)||c instanceof ImageData)return c;if(Array.isArray(c))return c.map(Cc);if("object"==typeof c){const o=c.$name||"Object";if(!il[o])throw new Error(`can't deserialize unregistered class ${o}`);const{klass:h}=il[o];if(!h)throw new Error(`can't deserialize unregistered class ${o}`);if(h.deserialize)return h.deserialize(c);const m=Object.create(h.prototype);for(const b of Object.keys(c)){if("$name"===b)continue;const T=c[b];m[b]=il[o].shallow.indexOf(b)>=0?T:Cc(T)}return m}throw new Error("can't deserialize object of type "+typeof c)}class Sc{constructor(){this.first=!0}update(o,h){const m=Math.floor(o);return this.first?(this.first=!1,this.lastIntegerZoom=m,this.lastIntegerZoomTime=0,this.lastZoom=o,this.lastFloorZoom=m,!0):(this.lastFloorZoom>m?(this.lastIntegerZoom=m+1,this.lastIntegerZoomTime=h):this.lastFloorZoom<m&&(this.lastIntegerZoom=m,this.lastIntegerZoomTime=h),o!==this.lastZoom&&(this.lastZoom=o,this.lastFloorZoom=m,!0))}}const yt={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519};function mu(c){for(const o of c)if(Rd(o.charCodeAt(0)))return!0;return!1}function Ki(c){for(const o of c)if(!Vf(o.charCodeAt(0)))return!1;return!0}function Vf(c){return!(yt.Arabic(c)||yt["Arabic Supplement"](c)||yt["Arabic Extended-A"](c)||yt["Arabic Presentation Forms-A"](c)||yt["Arabic Presentation Forms-B"](c))}function Rd(c){return!(746!==c&&747!==c&&(c<4352||!(yt["Bopomofo Extended"](c)||yt.Bopomofo(c)||yt["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||yt["CJK Compatibility Ideographs"](c)||yt["CJK Compatibility"](c)||yt["CJK Radicals Supplement"](c)||yt["CJK Strokes"](c)||!(!yt["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||12336===c)||yt["CJK Unified Ideographs Extension A"](c)||yt["CJK Unified Ideographs"](c)||yt["Enclosed CJK Letters and Months"](c)||yt["Hangul Compatibility Jamo"](c)||yt["Hangul Jamo Extended-A"](c)||yt["Hangul Jamo Extended-B"](c)||yt["Hangul Jamo"](c)||yt["Hangul Syllables"](c)||yt.Hiragana(c)||yt["Ideographic Description Characters"](c)||yt.Kanbun(c)||yt["Kangxi Radicals"](c)||yt["Katakana Phonetic Extensions"](c)||yt.Katakana(c)&&12540!==c||!(!yt["Halfwidth and Fullwidth Forms"](c)||65288===c||65289===c||65293===c||c>=65306&&c<=65310||65339===c||65341===c||65343===c||c>=65371&&c<=65503||65507===c||c>=65512&&c<=65519)||!(!yt["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||yt["Unified Canadian Aboriginal Syllabics"](c)||yt["Unified Canadian Aboriginal Syllabics Extended"](c)||yt["Vertical Forms"](c)||yt["Yijing Hexagram Symbols"](c)||yt["Yi Syllables"](c)||yt["Yi Radicals"](c))))}function gu(c){return!(Rd(c)||(o=c,yt["Latin-1 Supplement"](o)&&(167===o||169===o||174===o||177===o||188===o||189===o||190===o||215===o||247===o)||yt["General Punctuation"](o)&&(8214===o||8224===o||8225===o||8240===o||8241===o||8251===o||8252===o||8258===o||8263===o||8264===o||8265===o||8273===o)||yt["Letterlike Symbols"](o)||yt["Number Forms"](o)||yt["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||9003===o||o>=9085&&o<=9114||o>=9150&&o<=9165||9167===o||o>=9169&&o<=9179||o>=9186&&o<=9215)||yt["Control Pictures"](o)&&9251!==o||yt["Optical Character Recognition"](o)||yt["Enclosed Alphanumerics"](o)||yt["Geometric Shapes"](o)||yt["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||yt["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||yt["CJK Symbols and Punctuation"](o)||yt.Katakana(o)||yt["Private Use Area"](o)||yt["CJK Compatibility Forms"](o)||yt["Small Form Variants"](o)||yt["Halfwidth and Fullwidth Forms"](o)||8734===o||8756===o||8757===o||o>=9984&&o<=10087||o>=10102&&o<=10131||65532===o||65533===o));var o}function Ph(c){return c>=1424&&c<=2303||yt["Arabic Presentation Forms-A"](c)||yt["Arabic Presentation Forms-B"](c)}function dg(c,o){return!(!o&&Ph(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||yt.Khmer(c))}function Wp(c){for(const o of c)if(Ph(o.charCodeAt(0)))return!0;return!1}const Hu="deferred",Gs="loading",_u="loaded";let Xo=null,Cs="unavailable",zl=null;const Ld=function(c){c&&"string"==typeof c&&c.indexOf("NetworkError")>-1&&(Cs="error"),Xo&&Xo(c)};function rl(){Gu.fire(new dr("pluginStateChange",{pluginStatus:Cs,pluginURL:zl}))}const Gu=new Ka,Vl=function(){return Cs},sl=function(){if(Cs!==Hu||!zl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Cs=Gs,rl(),zl&&Br({url:zl},c=>{c?Ld(c):(Cs=_u,rl())})},oo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Cs===_u||null!=oo.applyArabicShaping,isLoading:()=>Cs===Gs,setState(c){if(!hr())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Cs=c.pluginStatus,zl=c.pluginURL},isParsed(){if(!hr())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return null!=oo.applyArabicShaping&&null!=oo.processBidirectionalText&&null!=oo.processStyledBidirectionalText},getPluginURL(){if(!hr())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return zl}};class li{constructor(o,h){this.zoom=o,h?(this.now=h.now,this.fadeDuration=h.fadeDuration,this.zoomHistory=h.zoomHistory,this.transition=h.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Sc,this.transition={})}isSupportedScript(o){return function(h,m){for(const b of h)if(!dg(b.charCodeAt(0),m))return!1;return!0}(o,oo.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const o=this.zoom,h=o-Math.floor(o),m=this.crossFadingFactor();return o>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:h+(1-h)*m}:{fromScale:.5,toScale:1,t:1-(1-m)*h}}}class Mc{constructor(o,h){this.property=o,this.value=h,this.expression=function(m,b){if(un(m))return new Es(m,b);if(xs(m)){const T=pr(m,b);if("error"===T.result)throw new Error(T.value.map(S=>`${S.key}: ${S.message}`).join(", "));return T.value}{let T=m;return"color"===b.type&&"string"==typeof m?T=re.parse(m):"padding"!==b.type||"number"!=typeof m&&!Array.isArray(m)||(T=ve.parse(m)),{kind:"constant",evaluate:()=>T}}}(void 0===h?o.specification.default:h,o.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(o,h,m){return this.property.possiblyEvaluate(this,o,h,m)}}class kh{constructor(o){this.property=o,this.value=new Mc(o,void 0)}transitioned(o,h){return new Wu(this.property,this.value,h,sn({},o.transition,this.transition),o.now)}untransitioned(){return new Wu(this.property,this.value,null,{},0)}}class Ac{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)}getValue(o){return xn(this._values[o].value.value)}setValue(o,h){Object.prototype.hasOwnProperty.call(this._values,o)||(this._values[o]=new kh(this._values[o].property)),this._values[o].value=new Mc(this._values[o].property,null===h?void 0:xn(h))}getTransition(o){return xn(this._values[o].transition)}setTransition(o,h){Object.prototype.hasOwnProperty.call(this._values,o)||(this._values[o]=new kh(this._values[o].property)),this._values[o].transition=xn(h)||void 0}serialize(){const o={};for(const h of Object.keys(this._values)){const m=this.getValue(h);void 0!==m&&(o[h]=m);const b=this.getTransition(h);void 0!==b&&(o[`${h}-transition`]=b)}return o}transitioned(o,h){const m=new Od(this._properties);for(const b of Object.keys(this._values))m._values[b]=this._values[b].transitioned(o,h._values[b]);return m}untransitioned(){const o=new Od(this._properties);for(const h of Object.keys(this._values))o._values[h]=this._values[h].untransitioned();return o}}class Wu{constructor(o,h,m,b,T){this.property=o,this.value=h,this.begin=T+b.delay||0,this.end=this.begin+b.duration||0,o.specification.transition&&(b.delay||b.duration)&&(this.prior=m)}possiblyEvaluate(o,h,m){const b=o.now||0,T=this.value.possiblyEvaluate(o,h,m),S=this.prior;if(S){if(b>this.end)return this.prior=null,T;if(this.value.isDataDriven())return this.prior=null,T;if(b<this.begin)return S.possiblyEvaluate(o,h,m);{const k=(b-this.begin)/(this.end-this.begin);return this.property.interpolate(S.possiblyEvaluate(o,h,m),T,function(O){if(O<=0)return 0;if(O>=1)return 1;const z=O*O,j=z*O;return 4*(O<.5?j:3*(O-z)+j-.75)}(k))}}return T}}class Od{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,h,m){const b=new Rh(this._properties);for(const T of Object.keys(this._values))b._values[T]=this._values[T].possiblyEvaluate(o,h,m);return b}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class Kr{constructor(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)}getValue(o){return xn(this._values[o].value)}setValue(o,h){this._values[o]=new Mc(this._values[o].property,null===h?void 0:xn(h))}serialize(){const o={};for(const h of Object.keys(this._values)){const m=this.getValue(h);void 0!==m&&(o[h]=m)}return o}possiblyEvaluate(o,h,m){const b=new Rh(this._properties);for(const T of Object.keys(this._values))b._values[T]=this._values[T].possiblyEvaluate(o,h,m);return b}}class Ra{constructor(o,h,m){this.property=o,this.value=h,this.parameters=m}isConstant(){return"constant"===this.value.kind}constantOr(o){return"constant"===this.value.kind?this.value.value:o}evaluate(o,h,m,b){return this.property.evaluate(this.value,this.parameters,o,h,m,b)}}class Rh{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class Pt{constructor(o){this.specification=o}possiblyEvaluate(o,h){if(o.isDataDriven())throw new Error("Value should not be data driven");return o.expression.evaluate(h)}interpolate(o,h,m){const b=At[this.specification.type];return b?b(o,h,m):o}}class mt{constructor(o,h){this.specification=o,this.overrides=h}possiblyEvaluate(o,h,m,b){return new Ra(this,"constant"===o.expression.kind||"camera"===o.expression.kind?{kind:"constant",value:o.expression.evaluate(h,null,{},m,b)}:o.expression,h)}interpolate(o,h,m){if("constant"!==o.value.kind||"constant"!==h.value.kind)return o;if(void 0===o.value.value||void 0===h.value.value)return new Ra(this,{kind:"constant",value:void 0},o.parameters);const b=At[this.specification.type];return b?new Ra(this,{kind:"constant",value:b(o.value.value,h.value.value,m)},o.parameters):o}evaluate(o,h,m,b,T,S){return"constant"===o.kind?o.value:o.evaluate(h,m,b,T,S)}}class Gr extends mt{possiblyEvaluate(o,h,m,b){if(void 0===o.value)return new Ra(this,{kind:"constant",value:void 0},h);if("constant"===o.expression.kind){const T=o.expression.evaluate(h,null,{},m,b),S="resolvedImage"===o.property.specification.type&&"string"!=typeof T?T.name:T,k=this._calculate(S,S,S,h);return new Ra(this,{kind:"constant",value:k},h)}if("camera"===o.expression.kind){const T=this._calculate(o.expression.evaluate({zoom:h.zoom-1}),o.expression.evaluate({zoom:h.zoom}),o.expression.evaluate({zoom:h.zoom+1}),h);return new Ra(this,{kind:"constant",value:T},h)}return new Ra(this,o.expression,h)}evaluate(o,h,m,b,T,S){if("source"===o.kind){const k=o.evaluate(h,m,b,T,S);return this._calculate(k,k,k,h)}return"composite"===o.kind?this._calculate(o.evaluate({zoom:Math.floor(h.zoom)-1},m,b),o.evaluate({zoom:Math.floor(h.zoom)},m,b),o.evaluate({zoom:Math.floor(h.zoom)+1},m,b),h):o.value}_calculate(o,h,m,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:o,to:h}:{from:m,to:h}}interpolate(o){return o}}class $u{constructor(o){this.specification=o}possiblyEvaluate(o,h,m,b){if(void 0!==o.value){if("constant"===o.expression.kind){const T=o.expression.evaluate(h,null,{},m,b);return this._calculate(T,T,T,h)}return this._calculate(o.expression.evaluate(new li(Math.floor(h.zoom-1),h)),o.expression.evaluate(new li(Math.floor(h.zoom),h)),o.expression.evaluate(new li(Math.floor(h.zoom+1),h)),h)}}_calculate(o,h,m,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:o,to:h}:{from:m,to:h}}interpolate(o){return o}}class Yo{constructor(o){this.specification=o}possiblyEvaluate(o,h,m,b){return!!o.expression.evaluate(h,null,{},m,b)}interpolate(){return!1}}class zi{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const h in o){const m=o[h];m.specification.overridable&&this.overridableProperties.push(h);const b=this.defaultPropertyValues[h]=new Mc(m,void 0),T=this.defaultTransitionablePropertyValues[h]=new kh(m);this.defaultTransitioningPropertyValues[h]=T.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=b.possiblyEvaluate({})}}}Dt("DataDrivenProperty",mt),Dt("DataConstantProperty",Pt),Dt("CrossFadedDataDrivenProperty",Gr),Dt("CrossFadedProperty",$u),Dt("ColorRampProperty",Yo);const uc="-transition";class ao extends Ka{constructor(o,h){if(super(),this.id=o.id,this.type=o.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==o.type&&(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,"background"!==o.type&&(this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter),h.layout&&(this._unevaluatedLayout=new Kr(h.layout)),h.paint)){this._transitionablePaint=new Ac(h.paint);for(const m in o.paint)this.setPaintProperty(m,o.paint[m],{validate:!1});for(const m in o.layout)this.setLayoutProperty(m,o.layout[m],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Rh(h.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(o){return"visibility"===o?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,h,m={}){null!=h&&this._validate(Ni,`layers.${this.id}.layout.${o}`,o,h,m)||("visibility"!==o?this._unevaluatedLayout.setValue(o,h):this.visibility=h)}getPaintProperty(o){return o.endsWith(uc)?this._transitionablePaint.getTransition(o.slice(0,-uc.length)):this._transitionablePaint.getValue(o)}setPaintProperty(o,h,m={}){if(null!=h&&this._validate(Ln,`layers.${this.id}.paint.${o}`,o,h,m))return!1;if(o.endsWith(uc))return this._transitionablePaint.setTransition(o.slice(0,-uc.length),h||void 0),!1;{const b=this._transitionablePaint._values[o],T="cross-faded-data-driven"===b.property.specification["property-type"],S=b.value.isDataDriven(),k=b.value;this._transitionablePaint.setValue(o,h),this._handleSpecialPaintPropertyUpdate(o);const O=this._transitionablePaint._values[o].value;return O.isDataDriven()||S||T||this._handleOverridablePaintPropertyUpdate(o,k,O)}}_handleSpecialPaintPropertyUpdate(o){}_handleOverridablePaintPropertyUpdate(o,h,m){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||"none"===this.visibility}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,h){o.getCrossfadeParameters&&(this._crossfadeParameters=o.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,h)}serialize(){const o={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(o.layout=o.layout||{},o.layout.visibility=this.visibility),Jn(o,(h,m)=>!(void 0===h||"layout"===m&&!Object.keys(h).length||"paint"===m&&!Object.keys(h).length))}_validate(o,h,m,b,T={}){return(!T||!1!==T.validate)&&Hr(this,o.call(Ge,{key:h,layerType:this.type,objectKey:m,value:b,styleSpec:He,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const o in this.paint._values){const h=this.paint.get(o);if(h instanceof Ra&&jt(h.property.specification)&&("source"===h.value.kind||"composite"===h.value.kind)&&h.value.isStateDependent)return!0}return!1}}const yu={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Os{constructor(o,h){this._structArray=o,this._pos1=h*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ji{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,h){return o._trim(),h&&(o.isTransferred=!0,h.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const h=Object.create(this.prototype);return h.arrayBuffer=o.arrayBuffer,h.length=o.length,h.capacity=o.arrayBuffer.byteLength/h.bytesPerElement,h._refreshViews(),h}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const h=this.uint8;this._refreshViews(),h&&this.uint8.set(h)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function ir(c,o=1){let h=0,m=0;return{members:c.map(b=>{const T=yu[b.type].BYTES_PER_ELEMENT,S=h=hn(h,Math.max(o,T)),k=b.components||1;return m=Math.max(m,T),h+=T*k,{name:b.name,type:b.type,components:k,offset:S}}),size:hn(h,Math.max(m,o)),alignment:o}}function hn(c,o){return Math.ceil(c/o)*o}class La extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,h){const m=this.length;return this.resize(m+1),this.emplace(m,o,h)}emplace(o,h,m){const b=2*o;return this.int16[b+0]=h,this.int16[b+1]=m,o}}La.prototype.bytesPerElement=4,Dt("StructArrayLayout2i4",La);class v extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,h,m,b){const T=this.length;return this.resize(T+1),this.emplace(T,o,h,m,b)}emplace(o,h,m,b,T){const S=4*o;return this.int16[S+0]=h,this.int16[S+1]=m,this.int16[S+2]=b,this.int16[S+3]=T,o}}v.prototype.bytesPerElement=8,Dt("StructArrayLayout4i8",v);class l extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,h,m,b,T,S){const k=this.length;return this.resize(k+1),this.emplace(k,o,h,m,b,T,S)}emplace(o,h,m,b,T,S,k){const O=6*o;return this.int16[O+0]=h,this.int16[O+1]=m,this.int16[O+2]=b,this.int16[O+3]=T,this.int16[O+4]=S,this.int16[O+5]=k,o}}l.prototype.bytesPerElement=12,Dt("StructArrayLayout2i4i12",l);class d extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,h,m,b,T,S){const k=this.length;return this.resize(k+1),this.emplace(k,o,h,m,b,T,S)}emplace(o,h,m,b,T,S,k){const O=4*o,z=8*o;return this.int16[O+0]=h,this.int16[O+1]=m,this.uint8[z+4]=b,this.uint8[z+5]=T,this.uint8[z+6]=S,this.uint8[z+7]=k,o}}d.prototype.bytesPerElement=8,Dt("StructArrayLayout2i4ub8",d);class _ extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,h){const m=this.length;return this.resize(m+1),this.emplace(m,o,h)}emplace(o,h,m){const b=2*o;return this.float32[b+0]=h,this.float32[b+1]=m,o}}_.prototype.bytesPerElement=8,Dt("StructArrayLayout2f8",_);class x extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,h,m,b,T,S,k,O,z,j){const W=this.length;return this.resize(W+1),this.emplace(W,o,h,m,b,T,S,k,O,z,j)}emplace(o,h,m,b,T,S,k,O,z,j,W){const J=10*o;return this.uint16[J+0]=h,this.uint16[J+1]=m,this.uint16[J+2]=b,this.uint16[J+3]=T,this.uint16[J+4]=S,this.uint16[J+5]=k,this.uint16[J+6]=O,this.uint16[J+7]=z,this.uint16[J+8]=j,this.uint16[J+9]=W,o}}x.prototype.bytesPerElement=20,Dt("StructArrayLayout10ui20",x);class C extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,h,m,b,T,S,k,O,z,j,W,J){const te=this.length;return this.resize(te+1),this.emplace(te,o,h,m,b,T,S,k,O,z,j,W,J)}emplace(o,h,m,b,T,S,k,O,z,j,W,J,te){const ne=12*o;return this.int16[ne+0]=h,this.int16[ne+1]=m,this.int16[ne+2]=b,this.int16[ne+3]=T,this.uint16[ne+4]=S,this.uint16[ne+5]=k,this.uint16[ne+6]=O,this.uint16[ne+7]=z,this.int16[ne+8]=j,this.int16[ne+9]=W,this.int16[ne+10]=J,this.int16[ne+11]=te,o}}C.prototype.bytesPerElement=24,Dt("StructArrayLayout4i4ui4i24",C);class P extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,h,m){const b=this.length;return this.resize(b+1),this.emplace(b,o,h,m)}emplace(o,h,m,b){const T=3*o;return this.float32[T+0]=h,this.float32[T+1]=m,this.float32[T+2]=b,o}}P.prototype.bytesPerElement=12,Dt("StructArrayLayout3f12",P);class L extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const h=this.length;return this.resize(h+1),this.emplace(h,o)}emplace(o,h){return this.uint32[1*o+0]=h,o}}L.prototype.bytesPerElement=4,Dt("StructArrayLayout1ul4",L);class N extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,h,m,b,T,S,k,O,z){const j=this.length;return this.resize(j+1),this.emplace(j,o,h,m,b,T,S,k,O,z)}emplace(o,h,m,b,T,S,k,O,z,j){const W=10*o,J=5*o;return this.int16[W+0]=h,this.int16[W+1]=m,this.int16[W+2]=b,this.int16[W+3]=T,this.int16[W+4]=S,this.int16[W+5]=k,this.uint32[J+3]=O,this.uint16[W+8]=z,this.uint16[W+9]=j,o}}N.prototype.bytesPerElement=20,Dt("StructArrayLayout6i1ul2ui20",N);class I extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,h,m,b,T,S){const k=this.length;return this.resize(k+1),this.emplace(k,o,h,m,b,T,S)}emplace(o,h,m,b,T,S,k){const O=6*o;return this.int16[O+0]=h,this.int16[O+1]=m,this.int16[O+2]=b,this.int16[O+3]=T,this.int16[O+4]=S,this.int16[O+5]=k,o}}I.prototype.bytesPerElement=12,Dt("StructArrayLayout2i2i2i12",I);class H extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,h,m,b,T){const S=this.length;return this.resize(S+1),this.emplace(S,o,h,m,b,T)}emplace(o,h,m,b,T,S){const k=4*o,O=8*o;return this.float32[k+0]=h,this.float32[k+1]=m,this.float32[k+2]=b,this.int16[O+6]=T,this.int16[O+7]=S,o}}H.prototype.bytesPerElement=16,Dt("StructArrayLayout2f1f2i16",H);class q extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,h,m,b){const T=this.length;return this.resize(T+1),this.emplace(T,o,h,m,b)}emplace(o,h,m,b,T){const S=12*o,k=3*o;return this.uint8[S+0]=h,this.uint8[S+1]=m,this.float32[k+1]=b,this.float32[k+2]=T,o}}q.prototype.bytesPerElement=12,Dt("StructArrayLayout2ub2f12",q);class Q extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,h,m){const b=this.length;return this.resize(b+1),this.emplace(b,o,h,m)}emplace(o,h,m,b){const T=3*o;return this.uint16[T+0]=h,this.uint16[T+1]=m,this.uint16[T+2]=b,o}}Q.prototype.bytesPerElement=6,Dt("StructArrayLayout3ui6",Q);class ce extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,h,m,b,T,S,k,O,z,j,W,J,te,ne,ge,pe,Pe){const ze=this.length;return this.resize(ze+1),this.emplace(ze,o,h,m,b,T,S,k,O,z,j,W,J,te,ne,ge,pe,Pe)}emplace(o,h,m,b,T,S,k,O,z,j,W,J,te,ne,ge,pe,Pe,ze){const De=24*o,Oe=12*o,Ke=48*o;return this.int16[De+0]=h,this.int16[De+1]=m,this.uint16[De+2]=b,this.uint16[De+3]=T,this.uint32[Oe+2]=S,this.uint32[Oe+3]=k,this.uint32[Oe+4]=O,this.uint16[De+10]=z,this.uint16[De+11]=j,this.uint16[De+12]=W,this.float32[Oe+7]=J,this.float32[Oe+8]=te,this.uint8[Ke+36]=ne,this.uint8[Ke+37]=ge,this.uint8[Ke+38]=pe,this.uint32[Oe+10]=Pe,this.int16[De+22]=ze,o}}ce.prototype.bytesPerElement=48,Dt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ce);class ue extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,h,m,b,T,S,k,O,z,j,W,J,te,ne,ge,pe,Pe,ze,De,Oe,Ke,Ze,Tt,kt,bt,ft,ct,gt){const _t=this.length;return this.resize(_t+1),this.emplace(_t,o,h,m,b,T,S,k,O,z,j,W,J,te,ne,ge,pe,Pe,ze,De,Oe,Ke,Ze,Tt,kt,bt,ft,ct,gt)}emplace(o,h,m,b,T,S,k,O,z,j,W,J,te,ne,ge,pe,Pe,ze,De,Oe,Ke,Ze,Tt,kt,bt,ft,ct,gt,_t){const ot=34*o,Vt=17*o;return this.int16[ot+0]=h,this.int16[ot+1]=m,this.int16[ot+2]=b,this.int16[ot+3]=T,this.int16[ot+4]=S,this.int16[ot+5]=k,this.int16[ot+6]=O,this.int16[ot+7]=z,this.uint16[ot+8]=j,this.uint16[ot+9]=W,this.uint16[ot+10]=J,this.uint16[ot+11]=te,this.uint16[ot+12]=ne,this.uint16[ot+13]=ge,this.uint16[ot+14]=pe,this.uint16[ot+15]=Pe,this.uint16[ot+16]=ze,this.uint16[ot+17]=De,this.uint16[ot+18]=Oe,this.uint16[ot+19]=Ke,this.uint16[ot+20]=Ze,this.uint16[ot+21]=Tt,this.uint16[ot+22]=kt,this.uint32[Vt+12]=bt,this.float32[Vt+13]=ft,this.float32[Vt+14]=ct,this.float32[Vt+15]=gt,this.float32[Vt+16]=_t,o}}ue.prototype.bytesPerElement=68,Dt("StructArrayLayout8i15ui1ul4f68",ue);class he extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const h=this.length;return this.resize(h+1),this.emplace(h,o)}emplace(o,h){return this.float32[1*o+0]=h,o}}he.prototype.bytesPerElement=4,Dt("StructArrayLayout1f4",he);class Ee extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,h,m){const b=this.length;return this.resize(b+1),this.emplace(b,o,h,m)}emplace(o,h,m,b){const T=3*o;return this.int16[T+0]=h,this.int16[T+1]=m,this.int16[T+2]=b,o}}Ee.prototype.bytesPerElement=6,Dt("StructArrayLayout3i6",Ee);class Me extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,h,m){const b=this.length;return this.resize(b+1),this.emplace(b,o,h,m)}emplace(o,h,m,b){const T=4*o;return this.uint32[2*o+0]=h,this.uint16[T+2]=m,this.uint16[T+3]=b,o}}Me.prototype.bytesPerElement=8,Dt("StructArrayLayout1ul2ui8",Me);class Re extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,h){const m=this.length;return this.resize(m+1),this.emplace(m,o,h)}emplace(o,h,m){const b=2*o;return this.uint16[b+0]=h,this.uint16[b+1]=m,o}}Re.prototype.bytesPerElement=4,Dt("StructArrayLayout2ui4",Re);class fe extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const h=this.length;return this.resize(h+1),this.emplace(h,o)}emplace(o,h){return this.uint16[1*o+0]=h,o}}fe.prototype.bytesPerElement=2,Dt("StructArrayLayout1ui2",fe);class Be extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,h,m,b){const T=this.length;return this.resize(T+1),this.emplace(T,o,h,m,b)}emplace(o,h,m,b,T){const S=4*o;return this.float32[S+0]=h,this.float32[S+1]=m,this.float32[S+2]=b,this.float32[S+3]=T,o}}Be.prototype.bytesPerElement=16,Dt("StructArrayLayout4f16",Be);class ke extends Os{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Zt(this.anchorPointX,this.anchorPointY)}}ke.prototype.size=20;class We extends N{get(o){return new ke(this,o)}}Dt("CollisionBoxArray",We);class $e extends Os{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(o){this._structArray.uint8[this._pos1+37]=o}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(o){this._structArray.uint8[this._pos1+38]=o}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(o){this._structArray.uint32[this._pos4+10]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}$e.prototype.size=48;class it extends ce{get(o){return new $e(this,o)}}Dt("PlacedSymbolArray",it);class Ue extends Os{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(o){this._structArray.uint32[this._pos4+12]=o}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}Ue.prototype.size=68;class wt extends ue{get(o){return new Ue(this,o)}}Dt("SymbolInstanceArray",wt);class dt extends he{getoffsetX(o){return this.float32[1*o+0]}}Dt("GlyphOffsetArray",dt);class St extends Ee{getx(o){return this.int16[3*o+0]}gety(o){return this.int16[3*o+1]}gettileUnitDistanceFromAnchor(o){return this.int16[3*o+2]}}Dt("SymbolLineVertexArray",St);class rn extends Os{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}rn.prototype.size=8;class Pn extends Me{get(o){return new rn(this,o)}}Dt("FeatureIndexArray",Pn);class Ht extends La{}class Di extends La{}class Ei extends La{}class ii extends l{}class Nn extends d{}class Ii extends _{}class cs extends x{}class Wr extends C{}class ma extends P{}class Oa extends L{}class ol extends I{}class ga extends q{}class Do extends Q{}class wr extends Re{}const _a=ir([{name:"a_pos",components:2,type:"Int16"}],4),{members:Zn}=_a;class On{constructor(o=[]){this.segments=o}prepareSegment(o,h,m,b){let T=this.segments[this.segments.length-1];return o>On.MAX_VERTEX_ARRAY_LENGTH&&Ci(`Max vertices per segment is ${On.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!T||T.vertexLength+o>On.MAX_VERTEX_ARRAY_LENGTH||T.sortKey!==b)&&(T={vertexOffset:h.length,primitiveOffset:m.length,vertexLength:0,primitiveLength:0},void 0!==b&&(T.sortKey=b),this.segments.push(T)),T}get(){return this.segments}destroy(){for(const o of this.segments)for(const h in o.vaos)o.vaos[h].destroy()}static simpleSegment(o,h,m,b){return new On([{vertexOffset:o,primitiveOffset:h,vertexLength:m,primitiveLength:b,vaos:{},sortKey:0}])}}function gi(c,o){return 256*(c=Ne(Math.floor(c),0,255))+Ne(Math.floor(o),0,255)}On.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Dt("SegmentVector",On);const Lr=ir([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var $r={exports:{}},al=function(c,o){var h,m,b,T,S,k,O,z;for(m=c.length-(h=3&c.length),b=o,S=3432918353,k=461845907,z=0;z<m;)O=255&c.charCodeAt(z)|(255&c.charCodeAt(++z))<<8|(255&c.charCodeAt(++z))<<16|(255&c.charCodeAt(++z))<<24,++z,b=27492+(65535&(T=5*(65535&(b=(b^=O=(65535&(O=(O=(65535&O)*S+(((O>>>16)*S&65535)<<16)&4294967295)<<15|O>>>17))*k+(((O>>>16)*k&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(T>>>16)&65535)<<16);switch(O=0,h){case 3:O^=(255&c.charCodeAt(z+2))<<16;case 2:O^=(255&c.charCodeAt(z+1))<<8;case 1:b^=O=(65535&(O=(O=(65535&(O^=255&c.charCodeAt(z)))*S+(((O>>>16)*S&65535)<<16)&4294967295)<<15|O>>>17))*k+(((O>>>16)*k&65535)<<16)&4294967295}return b^=c.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0},Io=function(c,o){for(var h,m=c.length,b=o^m,T=0;m>=4;)h=1540483477*(65535&(h=255&c.charCodeAt(T)|(255&c.charCodeAt(++T))<<8|(255&c.charCodeAt(++T))<<16|(255&c.charCodeAt(++T))<<24))+((1540483477*(h>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),m-=4,++T;switch(m){case 3:b^=(255&c.charCodeAt(T+2))<<16;case 2:b^=(255&c.charCodeAt(T+1))<<8;case 1:b=1540483477*(65535&(b^=255&c.charCodeAt(T)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0};$r.exports=al,$r.exports.murmur3=al,$r.exports.murmur2=Io;class Fa{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(o,h,m,b){this.ids.push(ll(o)),this.positions.push(h,m,b)}getPositions(o){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const h=ll(o);let m=0,b=this.ids.length-1;for(;m<b;){const S=m+b>>1;this.ids[S]>=h?b=S:m=S+1}const T=[];for(;this.ids[m]===h;)T.push({index:this.positions[3*m],start:this.positions[3*m+1],end:this.positions[3*m+2]}),m++;return T}static serialize(o,h){const m=new Float64Array(o.ids),b=new Uint32Array(o.positions);return lo(m,b,0,m.length-1),h&&h.push(m.buffer,b.buffer),{ids:m,positions:b}}static deserialize(o){const h=new Fa;return h.ids=o.ids,h.positions=o.positions,h.indexed=!0,h}}function ll(c){const o=+c;return!isNaN(o)&&o<=Number.MAX_SAFE_INTEGER?o:$r.exports(String(c))}function lo(c,o,h,m){for(;h<m;){const b=c[h+m>>1];let T=h-1,S=m+1;for(;;){do{T++}while(c[T]<b);do{S--}while(c[S]>b);if(T>=S)break;hc(c,T,S),hc(o,3*T,3*S),hc(o,3*T+1,3*S+1),hc(o,3*T+2,3*S+2)}S-h<m-S?(lo(c,o,h,S),h=S+1):(lo(c,o,S+1,m),m=S)}}function hc(c,o,h){const m=c[o];c[o]=c[h],c[h]=m}Dt("FeaturePositionMap",Fa);class co{constructor(o,h){this.gl=o.gl,this.location=h}}class ya extends co{constructor(o,h){super(o,h),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class dc extends co{constructor(o,h){super(o,h),this.current=[0,0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3]))}}class Dc extends co{constructor(o,h){super(o,h),this.current=re.transparent}set(o){o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a))}}const Lh=new Float32Array(16);function Fd(c){return[gi(255*c.r,255*c.g),gi(255*c.b,255*c.a)]}class vu{constructor(o,h,m){this.value=o,this.uniformNames=h.map(b=>`u_${b}`),this.type=m}setUniform(o,h,m){o.set(m.constantOr(this.value))}getBinding(o,h,m){return"color"===this.type?new Dc(o,h):new ya(o,h)}}class Oh{constructor(o,h){this.uniformNames=h.map(m=>`u_${m}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(o,h){this.pixelRatioFrom=h.pixelRatio,this.pixelRatioTo=o.pixelRatio,this.patternFrom=h.tlbr,this.patternTo=o.tlbr}setUniform(o,h,m,b){const T="u_pattern_to"===b?this.patternTo:"u_pattern_from"===b?this.patternFrom:"u_pixel_ratio_to"===b?this.pixelRatioTo:"u_pixel_ratio_from"===b?this.pixelRatioFrom:null;T&&o.set(T)}getBinding(o,h,m){return"u_pattern"===m.substr(0,9)?new dc(o,h):new ya(o,h)}}class Ic{constructor(o,h,m,b){this.expression=o,this.type=m,this.maxValue=0,this.paintVertexAttributes=h.map(T=>({name:`a_${T}`,type:"Float32",components:"color"===m?2:1,offset:0})),this.paintVertexArray=new b}populatePaintArray(o,h,m,b,T){const S=this.paintVertexArray.length,k=this.expression.evaluate(new li(0),h,{},b,[],T);this.paintVertexArray.resize(o),this._setPaintValue(S,o,k)}updatePaintArray(o,h,m,b){const T=this.expression.evaluate({zoom:0},m,b);this._setPaintValue(o,h,T)}_setPaintValue(o,h,m){if("color"===this.type){const b=Fd(m);for(let T=o;T<h;T++)this.paintVertexArray.emplace(T,b[0],b[1])}else{for(let b=o;b<h;b++)this.paintVertexArray.emplace(b,m);this.maxValue=Math.max(this.maxValue,Math.abs(m))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Er{constructor(o,h,m,b,T,S){this.expression=o,this.uniformNames=h.map(k=>`u_${k}_t`),this.type=m,this.useIntegerZoom=b,this.zoom=T,this.maxValue=0,this.paintVertexAttributes=h.map(k=>({name:`a_${k}`,type:"Float32",components:"color"===m?4:2,offset:0})),this.paintVertexArray=new S}populatePaintArray(o,h,m,b,T){const S=this.expression.evaluate(new li(this.zoom),h,{},b,[],T),k=this.expression.evaluate(new li(this.zoom+1),h,{},b,[],T),O=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(O,o,S,k)}updatePaintArray(o,h,m,b){const T=this.expression.evaluate({zoom:this.zoom},m,b),S=this.expression.evaluate({zoom:this.zoom+1},m,b);this._setPaintValue(o,h,T,S)}_setPaintValue(o,h,m,b){if("color"===this.type){const T=Fd(m),S=Fd(b);for(let k=o;k<h;k++)this.paintVertexArray.emplace(k,T[0],T[1],S[0],S[1])}else{for(let T=o;T<h;T++)this.paintVertexArray.emplace(T,m,b);this.maxValue=Math.max(this.maxValue,Math.abs(m),Math.abs(b))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,h){const m=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,b=Ne(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);o.set(b)}getBinding(o,h,m){return new ya(o,h)}}class Na{constructor(o,h,m,b,T,S){this.expression=o,this.type=h,this.useIntegerZoom=m,this.zoom=b,this.layerId=S,this.zoomInPaintVertexArray=new T,this.zoomOutPaintVertexArray=new T}populatePaintArray(o,h,m){const b=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(o),this.zoomOutPaintVertexArray.resize(o),this._setPaintValues(b,o,h.patterns&&h.patterns[this.layerId],m)}updatePaintArray(o,h,m,b,T){this._setPaintValues(o,h,m.patterns&&m.patterns[this.layerId],T)}_setPaintValues(o,h,m,b){if(!b||!m)return;const{min:T,mid:S,max:k}=m,O=b[T],z=b[S],j=b[k];if(O&&z&&j)for(let W=o;W<h;W++)this.zoomInPaintVertexArray.emplace(W,z.tl[0],z.tl[1],z.br[0],z.br[1],O.tl[0],O.tl[1],O.br[0],O.br[1],z.pixelRatio,O.pixelRatio),this.zoomOutPaintVertexArray.emplace(W,z.tl[0],z.tl[1],z.br[0],z.br[1],j.tl[0],j.tl[1],j.br[0],j.br[1],z.pixelRatio,j.pixelRatio)}upload(o){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=o.createVertexBuffer(this.zoomInPaintVertexArray,Lr.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=o.createVertexBuffer(this.zoomOutPaintVertexArray,Lr.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Uf{constructor(o,h,m){this.binders={},this._buffers=[];const b=[];for(const T in o.paint._values){if(!m(T))continue;const S=o.paint.get(T);if(!(S instanceof Ra&&jt(S.property.specification)))continue;const k=Fh(T,o.type),O=S.value,z=S.property.specification.type,j=S.property.useIntegerZoom,W=S.property.specification["property-type"],J="cross-faded"===W||"cross-faded-data-driven"===W;if("constant"===O.kind)this.binders[T]=J?new Oh(O.value,k):new vu(O.value,k,z),b.push(`/u_${T}`);else if("source"===O.kind||J){const te=Nh(T,z,"source");this.binders[T]=J?new Na(O,z,j,h,te,o.id):new Ic(O,k,z,te),b.push(`/a_${T}`)}else{const te=Nh(T,z,"composite");this.binders[T]=new Er(O,k,z,j,h,te),b.push(`/z_${T}`)}}this.cacheKey=b.sort().join("")}getMaxValue(o){const h=this.binders[o];return h instanceof Ic||h instanceof Er?h.maxValue:0}populatePaintArrays(o,h,m,b,T){for(const S in this.binders){const k=this.binders[S];(k instanceof Ic||k instanceof Er||k instanceof Na)&&k.populatePaintArray(o,h,m,b,T)}}setConstantPatternPositions(o,h){for(const m in this.binders){const b=this.binders[m];b instanceof Oh&&b.setConstantPatternPositions(o,h)}}updatePaintArrays(o,h,m,b,T){let S=!1;for(const k in o){const O=h.getPositions(k);for(const z of O){const j=m.feature(z.index);for(const W in this.binders){const J=this.binders[W];if((J instanceof Ic||J instanceof Er||J instanceof Na)&&!0===J.expression.isStateDependent){const te=b.paint.get(W);J.expression=te.value,J.updatePaintArray(z.start,z.end,j,o[k],T),S=!0}}}}return S}defines(){const o=[];for(const h in this.binders){const m=this.binders[h];(m instanceof vu||m instanceof Oh)&&o.push(...m.uniformNames.map(b=>`#define HAS_UNIFORM_${b}`))}return o}getBinderAttributes(){const o=[];for(const h in this.binders){const m=this.binders[h];if(m instanceof Ic||m instanceof Er)for(let b=0;b<m.paintVertexAttributes.length;b++)o.push(m.paintVertexAttributes[b].name);else if(m instanceof Na)for(let b=0;b<Lr.members.length;b++)o.push(Lr.members[b].name)}return o}getBinderUniforms(){const o=[];for(const h in this.binders){const m=this.binders[h];if(m instanceof vu||m instanceof Oh||m instanceof Er)for(const b of m.uniformNames)o.push(b)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o,h){const m=[];for(const b in this.binders){const T=this.binders[b];if(T instanceof vu||T instanceof Oh||T instanceof Er)for(const S of T.uniformNames)if(h[S]){const k=T.getBinding(o,h[S],S);m.push({name:S,property:b,binding:k})}}return m}setUniforms(o,h,m,b){for(const{name:T,property:S,binding:k}of h)this.binders[S].setUniform(k,b,m.get(S),T)}updatePaintBuffers(o){this._buffers=[];for(const h in this.binders){const m=this.binders[h];if(o&&m instanceof Na){const b=2===o.fromScale?m.zoomInPaintVertexBuffer:m.zoomOutPaintVertexBuffer;b&&this._buffers.push(b)}else(m instanceof Ic||m instanceof Er)&&m.paintVertexBuffer&&this._buffers.push(m.paintVertexBuffer)}}upload(o){for(const h in this.binders){const m=this.binders[h];(m instanceof Ic||m instanceof Er||m instanceof Na)&&m.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const h=this.binders[o];(h instanceof Ic||h instanceof Er||h instanceof Na)&&h.destroy()}}}class uo{constructor(o,h,m=(()=>!0)){this.programConfigurations={};for(const b of o)this.programConfigurations[b.id]=new Uf(b,h,m);this.needsUpload=!1,this._featureMap=new Fa,this._bufferOffset=0}populatePaintArrays(o,h,m,b,T,S){for(const k in this.programConfigurations)this.programConfigurations[k].populatePaintArrays(o,h,b,T,S);void 0!==h.id&&this._featureMap.add(h.id,m,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,h,m,b){for(const T of m)this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(o,this._featureMap,h,T,b)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const h in this.programConfigurations)this.programConfigurations[h].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}function Fh(c,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[c]||[c.replace(`${o}-`,"").replace(/-/g,"_")]}function Nh(c,o,h){const b={"line-pattern":{source:cs,composite:cs},"fill-pattern":{source:cs,composite:cs},"fill-extrusion-pattern":{source:cs,composite:cs}}[c];return b&&b[h]||{color:{source:_,composite:Be},number:{source:he,composite:_}}[o][h]}Dt("ConstantBinder",vu),Dt("CrossFadedConstantBinder",Oh),Dt("SourceExpressionBinder",Ic),Dt("CrossFadedCompositeBinder",Na),Dt("CompositeExpressionBinder",Er),Dt("ProgramConfiguration",Uf,{omit:["_buffers"]}),Dt("ProgramConfigurationSet",uo);var rr=8192;const Pc=Math.pow(2,14)-1,Po=-Pc-1;function va(c){const o=rr/c.extent,h=c.loadGeometry();for(let m=0;m<h.length;m++){const b=h[m];for(let T=0;T<b.length;T++){const S=b[T],k=Math.round(S.x*o),O=Math.round(S.y*o);S.x=Ne(k,Po,Pc),S.y=Ne(O,Po,Pc),(k<S.x||k>S.x+1||O<S.y||O>S.y+1)&&Ci("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return h}function kc(c,o){return{type:c.type,id:c.id,properties:c.properties,geometry:o?va(c):[]}}function qu(c,o,h,m,b){c.emplaceBack(2*o+(m+1)/2,2*h+(b+1)/2)}class fg{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(h=>h.id),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new Di,this.indexArray=new Do,this.segments=new On,this.programConfigurations=new uo(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(o,h,m){const b=this.layers[0],T=[];let S=null,k=!1;"circle"===b.type&&(S=b.layout.get("circle-sort-key"),k=!S.isConstant());for(const{feature:O,id:z,index:j,sourceLayerIndex:W}of o){const J=this.layers[0]._featureFilter.needGeometry,te=kc(O,J);if(!this.layers[0]._featureFilter.filter(new li(this.zoom),te,m))continue;const ne=k?S.evaluate(te,{},m):void 0,ge={id:z,properties:O.properties,type:O.type,sourceLayerIndex:W,index:j,geometry:J?te.geometry:va(O),patterns:{},sortKey:ne};T.push(ge)}k&&T.sort((O,z)=>O.sortKey-z.sortKey);for(const O of T){const{geometry:z,index:j,sourceLayerIndex:W}=O,J=o[j].feature;this.addFeature(O,z,j,m),h.featureIndex.insert(J,z,j,W,this.index)}}update(o,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,h,this.stateDependentLayers,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Zn),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,h,m,b){for(const T of h)for(const S of T){const k=S.x,O=S.y;if(k<0||k>=rr||O<0||O>=rr)continue;const z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),j=z.vertexLength;qu(this.layoutVertexArray,k,O,-1,-1),qu(this.layoutVertexArray,k,O,1,-1),qu(this.layoutVertexArray,k,O,1,1),qu(this.layoutVertexArray,k,O,-1,1),this.indexArray.emplaceBack(j,j+1,j+2),this.indexArray.emplaceBack(j,j+3,j+2),z.vertexLength+=4,z.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,m,{},b)}}function Nd(c,o){for(let h=0;h<c.length;h++)if(jl(o,c[h]))return!0;for(let h=0;h<o.length;h++)if(jl(c,o[h]))return!0;return!!$p(c,o)}function pg(c,o,h){return!!jl(c,o)||!!Rc(o,c,h)}function Bh(c,o){if(1===c.length)return zd(o,c[0]);for(let h=0;h<o.length;h++){const m=o[h];for(let b=0;b<m.length;b++)if(jl(c,m[b]))return!0}for(let h=0;h<c.length;h++)if(zd(o,c[h]))return!0;for(let h=0;h<o.length;h++)if($p(c,o[h]))return!0;return!1}function Ul(c,o,h){if(c.length>1){if($p(c,o))return!0;for(let m=0;m<o.length;m++)if(Rc(o[m],c,h))return!0}for(let m=0;m<c.length;m++)if(Rc(c[m],o,h))return!0;return!1}function $p(c,o){if(0===c.length||0===o.length)return!1;for(let h=0;h<c.length-1;h++){const m=c[h],b=c[h+1];for(let T=0;T<o.length-1;T++)if(Bd(m,b,o[T],o[T+1]))return!0}return!1}function Bd(c,o,h,m){return si(c,h,m)!==si(o,h,m)&&si(c,o,h)!==si(c,o,m)}function Rc(c,o,h){const m=h*h;if(1===o.length)return c.distSqr(o[0])<m;for(let b=1;b<o.length;b++)if(jf(c,o[b-1],o[b])<m)return!0;return!1}function jf(c,o,h){const m=o.distSqr(h);if(0===m)return c.distSqr(o);const b=((c.x-o.x)*(h.x-o.x)+(c.y-o.y)*(h.y-o.y))/m;return c.distSqr(b<0?o:b>1?h:h.sub(o)._mult(b)._add(o))}function zd(c,o){let h,m,b,T=!1;for(let S=0;S<c.length;S++){h=c[S];for(let k=0,O=h.length-1;k<h.length;O=k++)m=h[k],b=h[O],m.y>o.y!=b.y>o.y&&o.x<(b.x-m.x)*(o.y-m.y)/(b.y-m.y)+m.x&&(T=!T)}return T}function jl(c,o){let h=!1;for(let m=0,b=c.length-1;m<c.length;b=m++){const T=c[m],S=c[b];T.y>o.y!=S.y>o.y&&o.x<(S.x-T.x)*(o.y-T.y)/(S.y-T.y)+T.x&&(h=!h)}return h}function mg(c,o,h){const m=h[0],b=h[2];if(c.x<m.x&&o.x<m.x||c.x>b.x&&o.x>b.x||c.y<m.y&&o.y<m.y||c.y>b.y&&o.y>b.y)return!1;const T=si(c,o,h[0]);return T!==si(c,o,h[1])||T!==si(c,o,h[2])||T!==si(c,o,h[3])}function zh(c,o,h){const m=o.paint.get(c).value;return"constant"===m.kind?m.value:h.programConfigurations.get(o.id).getMaxValue(c)}function Vd(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function Ud(c,o,h,m,b){if(!o[0]&&!o[1])return c;const T=Zt.convert(o)._mult(b);"viewport"===h&&T._rotate(-m);const S=[];for(let k=0;k<c.length;k++)S.push(c[k].sub(T));return S}Dt("CircleBucket",fg,{omit:["layers"]});const qp=new zi({"circle-sort-key":new mt(He.layout_circle["circle-sort-key"])});var Zp={paint:new zi({"circle-radius":new mt(He.paint_circle["circle-radius"]),"circle-color":new mt(He.paint_circle["circle-color"]),"circle-blur":new mt(He.paint_circle["circle-blur"]),"circle-opacity":new mt(He.paint_circle["circle-opacity"]),"circle-translate":new Pt(He.paint_circle["circle-translate"]),"circle-translate-anchor":new Pt(He.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Pt(He.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Pt(He.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new mt(He.paint_circle["circle-stroke-width"]),"circle-stroke-color":new mt(He.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new mt(He.paint_circle["circle-stroke-opacity"])}),layout:qp},Fs=1e-6,Jr=typeof Float32Array<"u"?Float32Array:Array;function Xp(){var c=new Jr(9);return Jr!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[5]=0,c[6]=0,c[7]=0),c[0]=1,c[4]=1,c[8]=1,c}function jd(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function Hf(c,o,h){var m=o[0],b=o[1],T=o[2],S=o[3],k=o[4],O=o[5],z=o[6],j=o[7],W=o[8],J=o[9],te=o[10],ne=o[11],ge=o[12],pe=o[13],Pe=o[14],ze=o[15],De=h[0],Oe=h[1],Ke=h[2],Ze=h[3];return c[0]=De*m+Oe*k+Ke*W+Ze*ge,c[1]=De*b+Oe*O+Ke*J+Ze*pe,c[2]=De*T+Oe*z+Ke*te+Ze*Pe,c[3]=De*S+Oe*j+Ke*ne+Ze*ze,c[4]=(De=h[4])*m+(Oe=h[5])*k+(Ke=h[6])*W+(Ze=h[7])*ge,c[5]=De*b+Oe*O+Ke*J+Ze*pe,c[6]=De*T+Oe*z+Ke*te+Ze*Pe,c[7]=De*S+Oe*j+Ke*ne+Ze*ze,c[8]=(De=h[8])*m+(Oe=h[9])*k+(Ke=h[10])*W+(Ze=h[11])*ge,c[9]=De*b+Oe*O+Ke*J+Ze*pe,c[10]=De*T+Oe*z+Ke*te+Ze*Pe,c[11]=De*S+Oe*j+Ke*ne+Ze*ze,c[12]=(De=h[12])*m+(Oe=h[13])*k+(Ke=h[14])*W+(Ze=h[15])*ge,c[13]=De*b+Oe*O+Ke*J+Ze*pe,c[14]=De*T+Oe*z+Ke*te+Ze*Pe,c[15]=De*S+Oe*j+Ke*ne+Ze*ze,c}Math.hypot||(Math.hypot=function(){for(var c=0,o=arguments.length;o--;)c+=arguments[o]*arguments[o];return Math.sqrt(c)});var Ba,c,ey=Hf;function Ws(){var c=new Jr(3);return Jr!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c}function Hd(c,o,h){var m=new Jr(3);return m[0]=c,m[1]=o,m[2]=h,m}function Gf(c,o,h){var m=o[0],b=o[1],T=o[2],S=o[3];return c[0]=h[0]*m+h[4]*b+h[8]*T+h[12]*S,c[1]=h[1]*m+h[5]*b+h[9]*T+h[13]*S,c[2]=h[2]*m+h[6]*b+h[10]*T+h[14]*S,c[3]=h[3]*m+h[7]*b+h[11]*T+h[15]*S,c}function Wf(){var c=new Jr(4);return Jr!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c[3]=1,c}function Vh(c,o){const h=Gf([],[c.x,c.y,0,1],o);return new Zt(h[0]/h[3],h[1]/h[3])}Ws(),Ba=new Jr(4),Jr!=Float32Array&&(Ba[0]=0,Ba[1]=0,Ba[2]=0,Ba[3]=0),Ws(),Hd(1,0,0),Hd(0,1,0),Wf(),Wf(),Xp(),c=new Jr(2),Jr!=Float32Array&&(c[0]=0,c[1]=0);class Lc extends fg{}Dt("HeatmapBucket",Lc,{omit:["layers"]});var Zu={paint:new zi({"heatmap-radius":new mt(He.paint_heatmap["heatmap-radius"]),"heatmap-weight":new mt(He.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Pt(He.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Yo(He.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Pt(He.paint_heatmap["heatmap-opacity"])})};function fc(c,{width:o,height:h},m,b){if(b){if(b instanceof Uint8ClampedArray)b=new Uint8Array(b.buffer);else if(b.length!==o*h*m)throw new RangeError(`mismatched image size. expected: ${b.length} but got: ${o*h*m}`)}else b=new Uint8Array(o*h*m);return c.width=o,c.height=h,c.data=b,c}function Yp(c,{width:o,height:h},m){if(o===c.width&&h===c.height)return;const b=fc({},{width:o,height:h},m);Xu(c,b,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,o),height:Math.min(c.height,h)},m),c.width=o,c.height=h,c.data=b.data}function Xu(c,o,h,m,b,T){if(0===b.width||0===b.height)return o;if(b.width>c.width||b.height>c.height||h.x>c.width-b.width||h.y>c.height-b.height)throw new RangeError("out of range source coordinates for image copy");if(b.width>o.width||b.height>o.height||m.x>o.width-b.width||m.y>o.height-b.height)throw new RangeError("out of range destination coordinates for image copy");const S=c.data,k=o.data;if(S===k)throw new Error("srcData equals dstData, so image is already copied");for(let O=0;O<b.height;O++){const z=((h.y+O)*c.width+h.x)*T,j=((m.y+O)*o.width+m.x)*T;for(let W=0;W<b.width*T;W++)k[j+W]=S[z+W]}return o}class Tn{constructor(o,h){fc(this,o,1,h)}resize(o){Yp(this,o,1)}clone(){return new Tn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,h,m,b,T){Xu(o,h,m,b,T,1)}}class cl{constructor(o,h){fc(this,o,4,h)}resize(o){Yp(this,o,4)}replace(o,h){h?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new cl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,h,m,b,T){Xu(o,h,m,b,T,4)}}function gg(c){const o={},h=c.resolution||256,m=c.clips?c.clips.length:1,b=c.image||new cl({width:h,height:m});if(Math.log(h)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${h}`);const T=(S,k,O)=>{o[c.evaluationKey]=O;const z=c.expression.evaluate(o);b.data[S+k+0]=Math.floor(255*z.r/z.a),b.data[S+k+1]=Math.floor(255*z.g/z.a),b.data[S+k+2]=Math.floor(255*z.b/z.a),b.data[S+k+3]=Math.floor(255*z.a)};if(c.clips)for(let S=0,k=0;S<m;++S,k+=4*h)for(let O=0,z=0;O<h;O++,z+=4){const j=O/(h-1),{start:W,end:J}=c.clips[S];T(k,z,W*(1-j)+J*j)}else for(let S=0,k=0;S<h;S++,k+=4)T(0,k,S/(h-1));return b}Dt("AlphaImage",Tn),Dt("RGBAImage",cl);var Lt={paint:new zi({"hillshade-illumination-direction":new Pt(He.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Pt(He.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Pt(He.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Pt(He.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Pt(He.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Pt(He.paint_hillshade["hillshade-accent-color"])})};const ty=ir([{name:"a_pos",components:2,type:"Int16"}],4),{members:f0}=ty;var Kp={exports:{}};function ba(c,o,h){h=h||2;var m,b,T,S,k,O,z,j=o&&o.length,W=j?o[0]*h:c.length,J=ny(c,0,W,h,!0),te=[];if(!J||J.next===J.prev)return te;if(j&&(J=function(ge,pe,Pe,ze){var De,Oe,Ke,Ze=[];for(De=0,Oe=pe.length;De<Oe;De++)(Ke=ny(ge,pe[De]*ze,De<Oe-1?pe[De+1]*ze:ge.length,ze,!1))===Ke.next&&(Ke.steiner=!0),Ze.push(Jo(Ke));for(Ze.sort(Gd),De=0;De<Ze.length;De++)Pe=Hh(Ze[De],Pe);return Pe}(c,o,J,h)),c.length>80*h){m=T=c[0],b=S=c[1];for(var ne=h;ne<W;ne+=h)(k=c[ne])<m&&(m=k),(O=c[ne+1])<b&&(b=O),k>T&&(T=k),O>S&&(S=O);z=0!==(z=Math.max(T-m,S-b))?32767/z:0}return Uh(J,te,h,m,b,z,0),te}function ny(c,o,h,m,b){var T,S;if(b===Fc(c,o,h,m)>0)for(T=o;T<h;T+=m)S=tm(T,c[T],c[T+1],S);else for(T=h-m;T>=o;T-=m)S=tm(T,c[T],c[T+1],S);return S&&ea(S,S.next)&&(ho(S),S=S.next),S}function Oc(c,o){if(!c)return c;o||(o=c);var h,m=c;do{if(h=!1,m.steiner||!ea(m,m.next)&&0!==sr(m.prev,m,m.next))m=m.next;else{if(ho(m),(m=o=m.prev)===m.next)break;h=!0}}while(h||m!==o);return o}function Uh(c,o,h,m,b,T,S){if(c){!S&&T&&function(j,W,J,te){var ne=j;do{0===ne.z&&(ne.z=$f(ne.x,ne.y,W,J,te)),ne.prevZ=ne.prev,ne.nextZ=ne.next,ne=ne.next}while(ne!==j);ne.prevZ.nextZ=null,ne.prevZ=null,function(ge){var pe,Pe,ze,De,Oe,Ke,Ze,Tt,kt=1;do{for(Pe=ge,ge=null,Oe=null,Ke=0;Pe;){for(Ke++,ze=Pe,Ze=0,pe=0;pe<kt&&(Ze++,ze=ze.nextZ);pe++);for(Tt=kt;Ze>0||Tt>0&&ze;)0!==Ze&&(0===Tt||!ze||Pe.z<=ze.z)?(De=Pe,Pe=Pe.nextZ,Ze--):(De=ze,ze=ze.nextZ,Tt--),Oe?Oe.nextZ=De:ge=De,De.prevZ=Oe,Oe=De;Pe=ze}Oe.nextZ=null,kt*=2}while(Ke>1)}(ne)}(c,m,b,T);for(var k,O,z=c;c.prev!==c.next;)if(k=c.prev,O=c.next,T?iy(c,m,b,T):jh(c))o.push(k.i/h|0),o.push(c.i/h|0),o.push(O.i/h|0),ho(c),c=O.next,z=O.next;else if((c=O)===z){S?1===S?Uh(c=ul(Oc(c),o,h),o,h,m,b,T,2):2===S&&Tr(c,o,h,m,b,T):Uh(Oc(c),o,h,m,b,T,1);break}}}function jh(c){var o=c.prev,h=c,m=c.next;if(sr(o,h,m)>=0)return!1;for(var b=o.x,T=h.x,S=m.x,k=o.y,O=h.y,z=m.y,j=b<T?b<S?b:S:T<S?T:S,W=k<O?k<z?k:z:O<z?O:z,J=b>T?b>S?b:S:T>S?T:S,te=k>O?k>z?k:z:O>z?O:z,ne=m.next;ne!==o;){if(ne.x>=j&&ne.x<=J&&ne.y>=W&&ne.y<=te&&Qo(b,k,T,O,S,z,ne.x,ne.y)&&sr(ne.prev,ne,ne.next)>=0)return!1;ne=ne.next}return!0}function iy(c,o,h,m){var b=c.prev,T=c,S=c.next;if(sr(b,T,S)>=0)return!1;for(var k=b.x,O=T.x,z=S.x,j=b.y,W=T.y,J=S.y,te=k<O?k<z?k:z:O<z?O:z,ne=j<W?j<J?j:J:W<J?W:J,ge=k>O?k>z?k:z:O>z?O:z,pe=j>W?j>J?j:J:W>J?W:J,Pe=$f(te,ne,o,h,m),ze=$f(ge,pe,o,h,m),De=c.prevZ,Oe=c.nextZ;De&&De.z>=Pe&&Oe&&Oe.z<=ze;){if(De.x>=te&&De.x<=ge&&De.y>=ne&&De.y<=pe&&De!==b&&De!==S&&Qo(k,j,O,W,z,J,De.x,De.y)&&sr(De.prev,De,De.next)>=0||(De=De.prevZ,Oe.x>=te&&Oe.x<=ge&&Oe.y>=ne&&Oe.y<=pe&&Oe!==b&&Oe!==S&&Qo(k,j,O,W,z,J,Oe.x,Oe.y)&&sr(Oe.prev,Oe,Oe.next)>=0))return!1;Oe=Oe.nextZ}for(;De&&De.z>=Pe;){if(De.x>=te&&De.x<=ge&&De.y>=ne&&De.y<=pe&&De!==b&&De!==S&&Qo(k,j,O,W,z,J,De.x,De.y)&&sr(De.prev,De,De.next)>=0)return!1;De=De.prevZ}for(;Oe&&Oe.z<=ze;){if(Oe.x>=te&&Oe.x<=ge&&Oe.y>=ne&&Oe.y<=pe&&Oe!==b&&Oe!==S&&Qo(k,j,O,W,z,J,Oe.x,Oe.y)&&sr(Oe.prev,Oe,Oe.next)>=0)return!1;Oe=Oe.nextZ}return!0}function ul(c,o,h){var m=c;do{var b=m.prev,T=m.next.next;!ea(b,T)&&Qp(b,m,m.next,T)&&$d(b,T)&&$d(T,b)&&(o.push(b.i/h|0),o.push(m.i/h|0),o.push(T.i/h|0),ho(m),ho(m.next),m=c=T),m=m.next}while(m!==c);return Oc(m)}function Tr(c,o,h,m,b,T){var S=c;do{for(var k=S.next.next;k!==S.prev;){if(S.i!==k.i&&qf(S,k)){var O=em(S,k);return S=Oc(S,S.next),O=Oc(O,O.next),Uh(S,o,h,m,b,T,0),void Uh(O,o,h,m,b,T,0)}k=k.next}S=S.next}while(S!==c)}function Gd(c,o){return c.x-o.x}function Hh(c,o){var h=function(b,T){var S,k=T,O=b.x,z=b.y,j=-1/0;do{if(z<=k.y&&z>=k.next.y&&k.next.y!==k.y){var W=k.x+(z-k.y)*(k.next.x-k.x)/(k.next.y-k.y);if(W<=O&&W>j&&(j=W,S=k.x<k.next.x?k:k.next,W===O))return S}k=k.next}while(k!==T);if(!S)return null;var J,te=S,ne=S.x,ge=S.y,pe=1/0;k=S;do{O>=k.x&&k.x>=ne&&O!==k.x&&Qo(z<ge?O:j,z,ne,ge,z<ge?j:O,z,k.x,k.y)&&(J=Math.abs(z-k.y)/(O-k.x),$d(k,b)&&(J<pe||J===pe&&(k.x>S.x||k.x===S.x&&Jp(S,k)))&&(S=k,pe=J)),k=k.next}while(k!==te);return S}(c,o);if(!h)return o;var m=em(h,c);return Oc(m,m.next),Oc(h,h.next)}function Jp(c,o){return sr(c.prev,c,o.prev)<0&&sr(o.next,c,c.next)<0}function $f(c,o,h,m,b){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-h)*b|0)|c<<8))|c<<4))|c<<2))|c<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-m)*b|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function Jo(c){var o=c,h=c;do{(o.x<h.x||o.x===h.x&&o.y<h.y)&&(h=o),o=o.next}while(o!==c);return h}function Qo(c,o,h,m,b,T,S,k){return(b-S)*(o-k)>=(c-S)*(T-k)&&(c-S)*(m-k)>=(h-S)*(o-k)&&(h-S)*(T-k)>=(b-S)*(m-k)}function qf(c,o){return c.next.i!==o.i&&c.prev.i!==o.i&&!function(h,m){var b=h;do{if(b.i!==h.i&&b.next.i!==h.i&&b.i!==m.i&&b.next.i!==m.i&&Qp(b,b.next,h,m))return!0;b=b.next}while(b!==h);return!1}(c,o)&&($d(c,o)&&$d(o,c)&&function(h,m){var b=h,T=!1,S=(h.x+m.x)/2,k=(h.y+m.y)/2;do{b.y>k!=b.next.y>k&&b.next.y!==b.y&&S<(b.next.x-b.x)*(k-b.y)/(b.next.y-b.y)+b.x&&(T=!T),b=b.next}while(b!==h);return T}(c,o)&&(sr(c.prev,c,o.prev)||sr(c,o.prev,o))||ea(c,o)&&sr(c.prev,c,c.next)>0&&sr(o.prev,o,o.next)>0)}function sr(c,o,h){return(o.y-c.y)*(h.x-o.x)-(o.x-c.x)*(h.y-o.y)}function ea(c,o){return c.x===o.x&&c.y===o.y}function Qp(c,o,h,m){var b=Wd(sr(c,o,h)),T=Wd(sr(c,o,m)),S=Wd(sr(h,m,c)),k=Wd(sr(h,m,o));return b!==T&&S!==k||!(0!==b||!Hl(c,h,o))||!(0!==T||!Hl(c,m,o))||!(0!==S||!Hl(h,c,m))||!(0!==k||!Hl(h,o,m))}function Hl(c,o,h){return o.x<=Math.max(c.x,h.x)&&o.x>=Math.min(c.x,h.x)&&o.y<=Math.max(c.y,h.y)&&o.y>=Math.min(c.y,h.y)}function Wd(c){return c>0?1:c<0?-1:0}function $d(c,o){return sr(c.prev,c,c.next)<0?sr(c,o,c.next)>=0&&sr(c,c.prev,o)>=0:sr(c,o,c.prev)<0||sr(c,c.next,o)<0}function em(c,o){var h=new qd(c.i,c.x,c.y),m=new qd(o.i,o.x,o.y),b=c.next,T=o.prev;return c.next=o,o.prev=c,h.next=b,b.prev=h,m.next=h,h.prev=m,T.next=m,m.prev=T,m}function tm(c,o,h,m){var b=new qd(c,o,h);return m?(b.next=m.next,b.prev=m,m.next.prev=b,m.next=b):(b.prev=b,b.next=b),b}function ho(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function qd(c,o,h){this.i=c,this.x=o,this.y=h,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Fc(c,o,h,m){for(var b=0,T=o,S=h-m;T<h;T+=m)b+=(c[S]-c[T])*(c[T+1]+c[S+1]),S=T;return b}function ry(c,o,h,m,b){nm(c,o,h||0,m||c.length-1,b||_g)}function nm(c,o,h,m,b){for(;m>h;){if(m-h>600){var T=m-h+1,S=o-h+1,k=Math.log(T),O=.5*Math.exp(2*k/3),z=.5*Math.sqrt(k*O*(T-O)/T)*(S-T/2<0?-1:1);nm(c,o,Math.max(h,Math.floor(o-S*O/T+z)),Math.min(m,Math.floor(o+(T-S)*O/T+z)),b)}var j=c[o],W=h,J=m;for(Gh(c,h,o),b(c[m],j)>0&&Gh(c,h,m);W<J;){for(Gh(c,W,J),W++,J--;b(c[W],j)<0;)W++;for(;b(c[J],j)>0;)J--}0===b(c[h],j)?Gh(c,h,J):Gh(c,++J,m),J<=o&&(h=J+1),o<=J&&(m=J-1)}}function Gh(c,o,h){var m=c[o];c[o]=c[h],c[h]=m}function _g(c,o){return c<o?-1:c>o?1:0}function ko(c,o){const h=c.length;if(h<=1)return[c];const m=[];let b,T;for(let S=0;S<h;S++){const k=is(c[S]);0!==k&&(c[S].area=Math.abs(k),void 0===T&&(T=k<0),T===k<0?(b&&m.push(b),b=[c[S]]):b.push(c[S]))}if(b&&m.push(b),o>1)for(let S=0;S<m.length;S++)m[S].length<=o||(ry(m[S],o,1,m[S].length-1,pc),m[S]=m[S].slice(0,o));return m}function pc(c,o){return o.area-c.area}function im(c,o,h){const m=h.patternDependencies;let b=!1;for(const T of o){const S=T.paint.get(`${c}-pattern`);S.isConstant()||(b=!0);const k=S.constantOr(null);k&&(b=!0,m[k.to]=!0,m[k.from]=!0)}return b}function rm(c,o,h,m,b){const T=b.patternDependencies;for(const S of o){const k=S.paint.get(`${c}-pattern`).value;if("constant"!==k.kind){let O=k.evaluate({zoom:m-1},h,{},b.availableImages),z=k.evaluate({zoom:m},h,{},b.availableImages),j=k.evaluate({zoom:m+1},h,{},b.availableImages);O=O&&O.name?O.name:O,z=z&&z.name?z.name:z,j=j&&j.name?j.name:j,T[O]=!0,T[z]=!0,T[j]=!0,h.patterns[S.id]={min:O,mid:z,max:j}}}return h}Kp.exports=ba,Kp.exports.default=ba,ba.deviation=function(c,o,h,m){var b=o&&o.length,T=Math.abs(Fc(c,0,b?o[0]*h:c.length,h));if(b)for(var S=0,k=o.length;S<k;S++)T-=Math.abs(Fc(c,o[S]*h,S<k-1?o[S+1]*h:c.length,h));var O=0;for(S=0;S<m.length;S+=3){var z=m[S]*h,j=m[S+1]*h,W=m[S+2]*h;O+=Math.abs((c[z]-c[W])*(c[j+1]-c[z+1])-(c[z]-c[j])*(c[W+1]-c[z+1]))}return 0===T&&0===O?0:Math.abs((O-T)/T)},ba.flatten=function(c){for(var o=c[0][0].length,h={vertices:[],holes:[],dimensions:o},m=0,b=0;b<c.length;b++){for(var T=0;T<c[b].length;T++)for(var S=0;S<o;S++)h.vertices.push(c[b][T][S]);b>0&&h.holes.push(m+=c[b-1].length)}return h};class bu{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(h=>h.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ei,this.indexArray=new Do,this.indexArray2=new wr,this.programConfigurations=new uo(o.layers,o.zoom),this.segments=new On,this.segments2=new On,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(o,h,m){this.hasPattern=im("fill",this.layers,h);const b=this.layers[0].layout.get("fill-sort-key"),T=!b.isConstant(),S=[];for(const{feature:k,id:O,index:z,sourceLayerIndex:j}of o){const W=this.layers[0]._featureFilter.needGeometry,J=kc(k,W);if(!this.layers[0]._featureFilter.filter(new li(this.zoom),J,m))continue;const te=T?b.evaluate(J,{},m,h.availableImages):void 0,ne={id:O,properties:k.properties,type:k.type,sourceLayerIndex:j,index:z,geometry:W?J.geometry:va(k),patterns:{},sortKey:te};S.push(ne)}T&&S.sort((k,O)=>k.sortKey-O.sortKey);for(const k of S){const{geometry:O,index:z,sourceLayerIndex:j}=k;if(this.hasPattern){const W=rm("fill",this.layers,k,this.zoom,h);this.patternFeatures.push(W)}else this.addFeature(k,O,z,m,{});h.featureIndex.insert(o[z].feature,O,z,j,this.index)}}update(o,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,h,this.stateDependentLayers,m)}addFeatures(o,h,m){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,h,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,f0),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(o,h,m,b,T){for(const S of ko(h,500)){let k=0;for(const te of S)k+=te.length;const O=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray),z=O.vertexLength,j=[],W=[];for(const te of S){if(0===te.length)continue;te!==S[0]&&W.push(j.length/2);const ne=this.segments2.prepareSegment(te.length,this.layoutVertexArray,this.indexArray2),ge=ne.vertexLength;this.layoutVertexArray.emplaceBack(te[0].x,te[0].y),this.indexArray2.emplaceBack(ge+te.length-1,ge),j.push(te[0].x),j.push(te[0].y);for(let pe=1;pe<te.length;pe++)this.layoutVertexArray.emplaceBack(te[pe].x,te[pe].y),this.indexArray2.emplaceBack(ge+pe-1,ge+pe),j.push(te[pe].x),j.push(te[pe].y);ne.vertexLength+=te.length,ne.primitiveLength+=te.length}const J=Kp.exports(j,W);for(let te=0;te<J.length;te+=3)this.indexArray.emplaceBack(z+J[te],z+J[te+1],z+J[te+2]);O.vertexLength+=k,O.primitiveLength+=J.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,m,T,b)}}Dt("FillBucket",bu,{omit:["layers","patternFeatures"]});const Nc=new zi({"fill-sort-key":new mt(He.layout_fill["fill-sort-key"])});var sy={paint:new zi({"fill-antialias":new Pt(He.paint_fill["fill-antialias"]),"fill-opacity":new mt(He.paint_fill["fill-opacity"]),"fill-color":new mt(He.paint_fill["fill-color"]),"fill-outline-color":new mt(He.paint_fill["fill-outline-color"]),"fill-translate":new Pt(He.paint_fill["fill-translate"]),"fill-translate-anchor":new Pt(He.paint_fill["fill-translate-anchor"]),"fill-pattern":new Gr(He.paint_fill["fill-pattern"])}),layout:Nc};const Wh=ir([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),sm=ir([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Zd}=Wh;var za={},Xd=Zt,yg=xu;function xu(c,o,h,m,b){this.properties={},this.extent=h,this.type=0,this._pbf=c,this._geometry=-1,this._keys=m,this._values=b,c.readFields($h,this,o)}function $h(c,o,h){1==c?o.id=h.readVarint():2==c?function(m,b){for(var T=m.readVarint()+m.pos;m.pos<T;){var S=b._keys[m.readVarint()],k=b._values[m.readVarint()];b.properties[S]=k}}(h,o):3==c?o.type=h.readVarint():4==c&&(o._geometry=h.pos)}function Bc(c){for(var o,h,m=0,b=0,T=c.length,S=T-1;b<T;S=b++)m+=((h=c[S]).x-(o=c[b]).x)*(o.y+h.y);return m}xu.types=["Unknown","Point","LineString","Polygon"],xu.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var o,h=c.readVarint()+c.pos,m=1,b=0,T=0,S=0,k=[];c.pos<h;){if(b<=0){var O=c.readVarint();m=7&O,b=O>>3}if(b--,1===m||2===m)T+=c.readSVarint(),S+=c.readSVarint(),1===m&&(o&&k.push(o),o=[]),o.push(new Xd(T,S));else{if(7!==m)throw new Error("unknown command "+m);o&&o.push(o[0].clone())}}return o&&k.push(o),k},xu.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var o=c.readVarint()+c.pos,h=1,m=0,b=0,T=0,S=1/0,k=-1/0,O=1/0,z=-1/0;c.pos<o;){if(m<=0){var j=c.readVarint();h=7&j,m=j>>3}if(m--,1===h||2===h)(b+=c.readSVarint())<S&&(S=b),b>k&&(k=b),(T+=c.readSVarint())<O&&(O=T),T>z&&(z=T);else if(7!==h)throw new Error("unknown command "+h)}return[S,O,k,z]},xu.prototype.toGeoJSON=function(c,o,h){var m,b,T=this.extent*Math.pow(2,h),S=this.extent*c,k=this.extent*o,O=this.loadGeometry(),z=xu.types[this.type];function j(te){for(var ne=0;ne<te.length;ne++){var ge=te[ne];te[ne]=[360*(ge.x+S)/T-180,360/Math.PI*Math.atan(Math.exp((180-360*(ge.y+k)/T)*Math.PI/180))-90]}}switch(this.type){case 1:var W=[];for(m=0;m<O.length;m++)W[m]=O[m][0];j(O=W);break;case 2:for(m=0;m<O.length;m++)j(O[m]);break;case 3:for(O=function(te){var ne=te.length;if(ne<=1)return[te];for(var ge,pe,Pe=[],ze=0;ze<ne;ze++){var De=Bc(te[ze]);0!==De&&(void 0===pe&&(pe=De<0),pe===De<0?(ge&&Pe.push(ge),ge=[te[ze]]):ge.push(te[ze]))}return ge&&Pe.push(ge),Pe}(O),m=0;m<O.length;m++)for(b=0;b<O[m].length;b++)j(O[m][b])}1===O.length?O=O[0]:z="Multi"+z;var J={type:"Feature",geometry:{type:z,coordinates:O},properties:this.properties};return"id"in this&&(J.id=this.id),J};var vg=yg,nt=Yd;function Yd(c,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(Gl,this,o),this.length=this._features.length}function Gl(c,o,h){15===c?o.version=h.readVarint():1===c?o.name=h.readString():5===c?o.extent=h.readVarint():2===c?o._features.push(h.pos):3===c?o._keys.push(h.readString()):4===c&&o._values.push(function(m){for(var b=null,T=m.readVarint()+m.pos;m.pos<T;){var S=m.readVarint()>>3;b=1===S?m.readString():2===S?m.readFloat():3===S?m.readDouble():4===S?m.readVarint64():5===S?m.readVarint():6===S?m.readSVarint():7===S?m.readBoolean():null}return b}(h))}Yd.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var o=this._pbf.readVarint()+this._pbf.pos;return new vg(this._pbf,o,this.extent,this._keys,this._values)};var om=nt;function qh(c,o,h){if(3===c){var m=new om(h,h.readVarint()+h.pos);m.length&&(o[m.name]=m)}}za.VectorTile=function(c,o){this.layers=c.readFields(qh,{},o)},za.VectorTileFeature=yg,za.VectorTileLayer=nt;const Zf=za.VectorTileFeature.types,Xf=Math.pow(2,13);function Yu(c,o,h,m,b,T,S,k){c.emplaceBack(o,h,2*Math.floor(m*Xf)+S,b*Xf*2,T*Xf*2,Math.round(k))}class Kd{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(h=>h.id),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new ii,this.centroidVertexArray=new Ht,this.indexArray=new Do,this.programConfigurations=new uo(o.layers,o.zoom),this.segments=new On,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(o,h,m){this.features=[],this.hasPattern=im("fill-extrusion",this.layers,h);for(const{feature:b,id:T,index:S,sourceLayerIndex:k}of o){const O=this.layers[0]._featureFilter.needGeometry,z=kc(b,O);if(!this.layers[0]._featureFilter.filter(new li(this.zoom),z,m))continue;const j={id:T,sourceLayerIndex:k,index:S,geometry:O?z.geometry:va(b),properties:b.properties,type:b.type,patterns:{}};this.hasPattern?this.features.push(rm("fill-extrusion",this.layers,j,this.zoom,h)):this.addFeature(j,j.geometry,S,m,{}),h.featureIndex.insert(b,j.geometry,S,k,this.index,!0)}}addFeatures(o,h,m){for(const b of this.features){const{geometry:T}=b;this.addFeature(b,T,b.index,h,m)}}update(o,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,h,this.stateDependentLayers,m)}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.centroidVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Zd),this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,sm.members,!0),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(o,h,m,b,T){const S={x:0,y:0,vertexCount:0};for(const k of ko(h,500)){let O=0;for(const ne of k)O+=ne.length;let z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const ne of k){if(0===ne.length||mc(ne))continue;let ge=0;for(let pe=0;pe<ne.length;pe++){const Pe=ne[pe];if(pe>=1){const ze=ne[pe-1];if(!wu(Pe,ze)){z.vertexLength+4>On.MAX_VERTEX_ARRAY_LENGTH&&(z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const De=Pe.sub(ze)._perp()._unit(),Oe=ze.dist(Pe);ge+Oe>32768&&(ge=0),Yu(this.layoutVertexArray,Pe.x,Pe.y,De.x,De.y,0,0,ge),Yu(this.layoutVertexArray,Pe.x,Pe.y,De.x,De.y,0,1,ge),S.x+=2*Pe.x,S.y+=2*Pe.y,S.vertexCount+=2,ge+=Oe,Yu(this.layoutVertexArray,ze.x,ze.y,De.x,De.y,0,0,ge),Yu(this.layoutVertexArray,ze.x,ze.y,De.x,De.y,0,1,ge),S.x+=2*ze.x,S.y+=2*ze.y,S.vertexCount+=2;const Ke=z.vertexLength;this.indexArray.emplaceBack(Ke,Ke+2,Ke+1),this.indexArray.emplaceBack(Ke+1,Ke+2,Ke+3),z.vertexLength+=4,z.primitiveLength+=2}}}}if(z.vertexLength+O>On.MAX_VERTEX_ARRAY_LENGTH&&(z=this.segments.prepareSegment(O,this.layoutVertexArray,this.indexArray)),"Polygon"!==Zf[o.type])continue;const j=[],W=[],J=z.vertexLength;for(const ne of k)if(0!==ne.length){ne!==k[0]&&W.push(j.length/2);for(let ge=0;ge<ne.length;ge++){const pe=ne[ge];Yu(this.layoutVertexArray,pe.x,pe.y,0,0,1,1,0),S.x+=pe.x,S.y+=pe.y,S.vertexCount+=1,j.push(pe.x),j.push(pe.y)}}const te=Kp.exports(j,W);for(let ne=0;ne<te.length;ne+=3)this.indexArray.emplaceBack(J+te[ne],J+te[ne+2],J+te[ne+1]);z.primitiveLength+=te.length/3,z.vertexLength+=O}for(let k=0;k<S.vertexCount;k++)this.centroidVertexArray.emplaceBack(Math.floor(S.x/S.vertexCount),Math.floor(S.y/S.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,m,T,b)}}function wu(c,o){return c.x===o.x&&(c.x<0||c.x>rr)||c.y===o.y&&(c.y<0||c.y>rr)}function mc(c){return c.every(o=>o.x<0)||c.every(o=>o.x>rr)||c.every(o=>o.y<0)||c.every(o=>o.y>rr)}Dt("FillExtrusionBucket",Kd,{omit:["layers","features"]});var Zh={paint:new zi({"fill-extrusion-opacity":new Pt(He["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new mt(He["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Pt(He["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Pt(He["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Gr(He["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new mt(He["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new mt(He["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Pt(He["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Xh(c,o){return c.x*o.x+c.y*o.y}function am(c,o){if(1===c.length){let h=0;const m=o[h++];let b;for(;!b||m.equals(b);)if(b=o[h++],!b)return 1/0;for(;h<o.length;h++){const T=o[h],S=c[0],k=b.sub(m),O=T.sub(m),z=S.sub(m),j=Xh(k,k),W=Xh(k,O),J=Xh(O,O),te=Xh(z,k),ne=Xh(z,O),ge=j*J-W*W,pe=(J*te-W*ne)/ge,Pe=(j*ne-W*te)/ge,ze=m.z*(1-pe-Pe)+b.z*pe+T.z*Pe;if(isFinite(ze))return ze}return 1/0}{let h=1/0;for(const m of o)h=Math.min(h,m.z);return h}}const Yh=ir([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Yf}=Yh,bg=ir([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:zc}=bg,lm=za.VectorTileFeature.types,Eu=Math.cos(Math.PI/180*37.5),Tu=Math.pow(2,14)/.5;class Kh{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(h=>h.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(h=>{this.gradients[h.id]={}}),this.layoutVertexArray=new Nn,this.layoutVertexArray2=new Ii,this.indexArray=new Do,this.programConfigurations=new uo(o.layers,o.zoom),this.segments=new On,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(o,h,m){this.hasPattern=im("line",this.layers,h);const b=this.layers[0].layout.get("line-sort-key"),T=!b.isConstant(),S=[];for(const{feature:k,id:O,index:z,sourceLayerIndex:j}of o){const W=this.layers[0]._featureFilter.needGeometry,J=kc(k,W);if(!this.layers[0]._featureFilter.filter(new li(this.zoom),J,m))continue;const te=T?b.evaluate(J,{},m):void 0,ne={id:O,properties:k.properties,type:k.type,sourceLayerIndex:j,index:z,geometry:W?J.geometry:va(k),patterns:{},sortKey:te};S.push(ne)}T&&S.sort((k,O)=>k.sortKey-O.sortKey);for(const k of S){const{geometry:O,index:z,sourceLayerIndex:j}=k;if(this.hasPattern){const W=rm("line",this.layers,k,this.zoom,h);this.patternFeatures.push(W)}else this.addFeature(k,O,z,m,{});h.featureIndex.insert(o[z].feature,O,z,j,this.index)}}update(o,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,h,this.stateDependentLayers,m)}addFeatures(o,h,m){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,h,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,zc)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Yf),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&Object.prototype.hasOwnProperty.call(o.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(o.properties,"mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,h,m,b,T){const S=this.layers[0].layout,k=S.get("line-join").evaluate(o,{}),O=S.get("line-cap"),z=S.get("line-miter-limit"),j=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(const W of h)this.addLine(W,o,k,O,z,j);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,m,T,b)}addLine(o,h,m,b,T,S){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Pe=0;Pe<o.length-1;Pe++)this.totalDistance+=o[Pe].dist(o[Pe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const k="Polygon"===lm[h.type];let O=o.length;for(;O>=2&&o[O-1].equals(o[O-2]);)O--;let z=0;for(;z<O-1&&o[z].equals(o[z+1]);)z++;if(O<(k?3:2))return;"bevel"===m&&(T=1.05);const j=this.overscaling<=16?122880/(512*this.overscaling):0,W=this.segments.prepareSegment(10*O,this.layoutVertexArray,this.indexArray);let J,te,ne,ge,pe;this.e1=this.e2=-1,k&&(J=o[O-2],pe=o[z].sub(J)._unit()._perp());for(let Pe=z;Pe<O;Pe++){if(ne=Pe===O-1?k?o[z+1]:void 0:o[Pe+1],ne&&o[Pe].equals(ne))continue;pe&&(ge=pe),J&&(te=J),J=o[Pe],pe=ne?ne.sub(J)._unit()._perp():ge,ge=ge||pe;let ze=ge.add(pe);0===ze.x&&0===ze.y||ze._unit();const De=ge.x*pe.x+ge.y*pe.y,Oe=ze.x*pe.x+ze.y*pe.y,Ke=0!==Oe?1/Oe:1/0,Ze=2*Math.sqrt(2-2*Oe),Tt=Oe<Eu&&te&&ne,kt=ge.x*pe.y-ge.y*pe.x>0;if(Tt&&Pe>z){const ct=J.dist(te);if(ct>2*j){const gt=J.sub(J.sub(te)._mult(j/ct)._round());this.updateDistance(te,gt),this.addCurrentVertex(gt,ge,0,0,W),te=gt}}const bt=te&&ne;let ft=bt?m:k?"butt":b;if(bt&&"round"===ft&&(Ke<S?ft="miter":Ke<=2&&(ft="fakeround")),"miter"===ft&&Ke>T&&(ft="bevel"),"bevel"===ft&&(Ke>2&&(ft="flipbevel"),Ke<T&&(ft="miter")),te&&this.updateDistance(te,J),"miter"===ft)ze._mult(Ke),this.addCurrentVertex(J,ze,0,0,W);else if("flipbevel"===ft){if(Ke>100)ze=pe.mult(-1);else{const ct=Ke*ge.add(pe).mag()/ge.sub(pe).mag();ze._perp()._mult(ct*(kt?-1:1))}this.addCurrentVertex(J,ze,0,0,W),this.addCurrentVertex(J,ze.mult(-1),0,0,W)}else if("bevel"===ft||"fakeround"===ft){const ct=-Math.sqrt(Ke*Ke-1),gt=kt?ct:0,_t=kt?0:ct;if(te&&this.addCurrentVertex(J,ge,gt,_t,W),"fakeround"===ft){const ot=Math.round(180*Ze/Math.PI/20);for(let Vt=1;Vt<ot;Vt++){let Ot=Vt/ot;if(.5!==Ot){const or=Ot-.5;Ot+=Ot*or*(Ot-1)*((1.0904+De*(De*(3.55645-1.43519*De)-3.2452))*or*or+(.848013+De*(.215638*De-1.06021)))}const Bn=pe.sub(ge)._mult(Ot)._add(ge)._unit()._mult(kt?-1:1);this.addHalfVertex(J,Bn.x,Bn.y,!1,kt,0,W)}}ne&&this.addCurrentVertex(J,pe,-gt,-_t,W)}else if("butt"===ft)this.addCurrentVertex(J,ze,0,0,W);else if("square"===ft){const ct=te?1:-1;this.addCurrentVertex(J,ze,ct,ct,W)}else"round"===ft&&(te&&(this.addCurrentVertex(J,ge,0,0,W),this.addCurrentVertex(J,ge,1,1,W,!0)),ne&&(this.addCurrentVertex(J,pe,-1,-1,W,!0),this.addCurrentVertex(J,pe,0,0,W)));if(Tt&&Pe<O-1){const ct=J.dist(ne);if(ct>2*j){const gt=J.add(ne.sub(J)._mult(j/ct)._round());this.updateDistance(J,gt),this.addCurrentVertex(gt,pe,0,0,W),J=gt}}}}addCurrentVertex(o,h,m,b,T,S=!1){const k=h.y*b-h.x,O=-h.y-h.x*b;this.addHalfVertex(o,h.x+h.y*m,h.y-h.x*m,S,!1,m,T),this.addHalfVertex(o,k,O,S,!0,-b,T),this.distance>Tu/2&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(o,h,m,b,T,S))}addHalfVertex({x:o,y:h},m,b,T,S,k,O){const z=.5*(this.lineClips?this.scaledDistance*(Tu-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((o<<1)+(T?1:0),(h<<1)+(S?1:0),Math.round(63*m)+128,Math.round(63*b)+128,1+(0===k?0:k<0?-1:1)|(63&z)<<2,z>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const j=O.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,j),O.primitiveLength++),S?this.e2=j:this.e1=j}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(o,h){this.distance+=o.dist(h),this.updateScaledDistance()}}Dt("LineBucket",Kh,{omit:["layers","patternFeatures"]});const Jd=new zi({"line-cap":new Pt(He.layout_line["line-cap"]),"line-join":new mt(He.layout_line["line-join"]),"line-miter-limit":new Pt(He.layout_line["line-miter-limit"]),"line-round-limit":new Pt(He.layout_line["line-round-limit"]),"line-sort-key":new mt(He.layout_line["line-sort-key"])});var dn={paint:new zi({"line-opacity":new mt(He.paint_line["line-opacity"]),"line-color":new mt(He.paint_line["line-color"]),"line-translate":new Pt(He.paint_line["line-translate"]),"line-translate-anchor":new Pt(He.paint_line["line-translate-anchor"]),"line-width":new mt(He.paint_line["line-width"]),"line-gap-width":new mt(He.paint_line["line-gap-width"]),"line-offset":new mt(He.paint_line["line-offset"]),"line-blur":new mt(He.paint_line["line-blur"]),"line-dasharray":new $u(He.paint_line["line-dasharray"]),"line-pattern":new Gr(He.paint_line["line-pattern"]),"line-gradient":new Yo(He.paint_line["line-gradient"])}),layout:Jd};const Qd=new class extends mt{possiblyEvaluate(c,o){return o=new li(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,zoomHistory:o.zoomHistory,transition:o.transition}),super.possiblyEvaluate(c,o)}evaluate(c,o,h,m){return o=sn({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(c,o,h,m)}}(dn.paint.properties["line-width"].specification);function cm(c,o){return o>0?o+2*c:c}Qd.useIntegerZoom=!0;const Ku=ir([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),oy=ir([{name:"a_projected_pos",components:3,type:"Float32"}],4);ir([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const um=ir([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);ir([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Jh=ir([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),fo=ir([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function ay(c,o,h){return c.sections.forEach(m=>{m.text=function(b,T,S){const k=T.layout.get("text-transform").evaluate(S,{});return"uppercase"===k?b=b.toLocaleUpperCase():"lowercase"===k&&(b=b.toLocaleLowerCase()),oo.applyArabicShaping&&(b=oo.applyArabicShaping(b)),b}(m.text,o,h)}),c}ir([{name:"triangle",components:3,type:"Uint16"}]),ir([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ir([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ir([{type:"Float32",name:"offsetX"}]),ir([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Qh={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};var Kf=$i,xg=function(c,o,h,m,b){var T,S,k=8*b-m-1,O=(1<<k)-1,z=O>>1,j=-7,W=h?b-1:0,J=h?-1:1,te=c[o+W];for(W+=J,T=te&(1<<-j)-1,te>>=-j,j+=k;j>0;T=256*T+c[o+W],W+=J,j-=8);for(S=T&(1<<-j)-1,T>>=-j,j+=m;j>0;S=256*S+c[o+W],W+=J,j-=8);if(0===T)T=1-z;else{if(T===O)return S?NaN:1/0*(te?-1:1);S+=Math.pow(2,m),T-=z}return(te?-1:1)*S*Math.pow(2,T-m)},Jf=function(c,o,h,m,b,T){var S,k,O,z=8*T-b-1,j=(1<<z)-1,W=j>>1,J=23===b?Math.pow(2,-24)-Math.pow(2,-77):0,te=m?0:T-1,ne=m?1:-1,ge=o<0||0===o&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(k=isNaN(o)?1:0,S=j):(S=Math.floor(Math.log(o)/Math.LN2),o*(O=Math.pow(2,-S))<1&&(S--,O*=2),(o+=S+W>=1?J/O:J*Math.pow(2,1-W))*O>=2&&(S++,O/=2),S+W>=j?(k=0,S=j):S+W>=1?(k=(o*O-1)*Math.pow(2,b),S+=W):(k=o*Math.pow(2,W-1)*Math.pow(2,b),S=0));b>=8;c[h+te]=255&k,te+=ne,k/=256,b-=8);for(S=S<<b|k,z+=b;z>0;c[h+te]=255&S,te+=ne,S/=256,z-=8);c[h+te-ne]|=128*ge};function $i(c){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(c)?c:new Uint8Array(c||0),this.pos=0,this.type=0,this.length=this.buf.length}$i.Varint=0,$i.Fixed64=1,$i.Bytes=2,$i.Fixed32=5;var Vc,xa=4294967296,$s=1/xa,Uc=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function jc(c){return c.type===$i.Bytes?c.readVarint()+c.pos:c.pos+1}function ly(c,o,h){var m=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));h.realloc(m);for(var b=h.pos-1;b>=c;b--)h.buf[b+m]=h.buf[b]}function Qf(c,o){for(var h=0;h<c.length;h++)o.writeVarint(c[h])}function Ju(c,o){for(var h=0;h<c.length;h++)o.writeSVarint(c[h])}function hm(c,o){for(var h=0;h<c.length;h++)o.writeFloat(c[h])}function dm(c,o){for(var h=0;h<c.length;h++)o.writeDouble(c[h])}function wg(c,o){for(var h=0;h<c.length;h++)o.writeBoolean(c[h])}function Qu(c,o){for(var h=0;h<c.length;h++)o.writeFixed32(c[h])}function cy(c,o){for(var h=0;h<c.length;h++)o.writeSFixed32(c[h])}function uy(c,o){for(var h=0;h<c.length;h++)o.writeFixed64(c[h])}function Eg(c,o){for(var h=0;h<c.length;h++)o.writeSFixed64(c[h])}function ef(c,o){return(c[o]|c[o+1]<<8|c[o+2]<<16)+16777216*c[o+3]}function ed(c,o,h){c[h]=o,c[h+1]=o>>>8,c[h+2]=o>>>16,c[h+3]=o>>>24}function Ro(c,o){return(c[o]|c[o+1]<<8|c[o+2]<<16)+(c[o+3]<<24)}function Wl(c,o,h){1===c&&h.readMessage(tf,o)}function tf(c,o,h){if(3===c){const{id:m,bitmap:b,width:T,height:S,left:k,top:O,advance:z}=h.readMessage(fm,{});o.push({id:m,bitmap:new Tn({width:T+6,height:S+6},b),metrics:{width:T,height:S,left:k,top:O,advance:z}})}}function fm(c,o,h){1===c?o.id=h.readVarint():2===c?o.bitmap=h.readBytes():3===c?o.width=h.readVarint():4===c?o.height=h.readVarint():5===c?o.left=h.readSVarint():6===c?o.top=h.readSVarint():7===c&&(o.advance=h.readVarint())}function pm(c){let o=0,h=0;for(const S of c)o+=S.w*S.h,h=Math.max(h,S.w);c.sort((S,k)=>k.h-S.h);const m=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),h),h:1/0}];let b=0,T=0;for(const S of c)for(let k=m.length-1;k>=0;k--){const O=m[k];if(!(S.w>O.w||S.h>O.h)){if(S.x=O.x,S.y=O.y,T=Math.max(T,S.y+S.h),b=Math.max(b,S.x+S.w),S.w===O.w&&S.h===O.h){const z=m.pop();k<m.length&&(m[k]=z)}else S.h===O.h?(O.x+=S.w,O.w-=S.w):S.w===O.w?(O.y+=S.h,O.h-=S.h):(m.push({x:O.x+S.w,y:O.y,w:O.w-S.w,h:S.h}),O.y+=S.h,O.h-=S.h);break}}return{w:b,h:T,fill:o/(b*T)||0}}$i.prototype={destroy:function(){this.buf=null},readFields:function(c,o,h){for(h=h||this.length;this.pos<h;){var m=this.readVarint(),b=m>>3,T=this.pos;this.type=7&m,c(b,o,this),this.pos===T&&this.skip(m)}return o},readMessage:function(c,o){return this.readFields(c,o,this.readVarint()+this.pos)},readFixed32:function(){var c=ef(this.buf,this.pos);return this.pos+=4,c},readSFixed32:function(){var c=Ro(this.buf,this.pos);return this.pos+=4,c},readFixed64:function(){var c=ef(this.buf,this.pos)+ef(this.buf,this.pos+4)*xa;return this.pos+=8,c},readSFixed64:function(){var c=ef(this.buf,this.pos)+Ro(this.buf,this.pos+4)*xa;return this.pos+=8,c},readFloat:function(){var c=xg(this.buf,this.pos,!0,23,4);return this.pos+=4,c},readDouble:function(){var c=xg(this.buf,this.pos,!0,52,8);return this.pos+=8,c},readVarint:function(c){var o,h,m=this.buf;return o=127&(h=m[this.pos++]),h<128?o:(o|=(127&(h=m[this.pos++]))<<7,h<128?o:(o|=(127&(h=m[this.pos++]))<<14,h<128?o:(o|=(127&(h=m[this.pos++]))<<21,h<128?o:function(b,T,S){var k,O,z=S.buf;if(k=(112&(O=z[S.pos++]))>>4,O<128||(k|=(127&(O=z[S.pos++]))<<3,O<128)||(k|=(127&(O=z[S.pos++]))<<10,O<128)||(k|=(127&(O=z[S.pos++]))<<17,O<128)||(k|=(127&(O=z[S.pos++]))<<24,O<128)||(k|=(1&(O=z[S.pos++]))<<31,O<128))return function Cu(c,o,h){return h?4294967296*o+(c>>>0):4294967296*(o>>>0)+(c>>>0)}(b,k,T);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(h=m[this.pos]))<<28,c,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var c=this.readVarint();return c%2==1?(c+1)/-2:c/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var c=this.readVarint()+this.pos,o=this.pos;return this.pos=c,c-o>=12&&Uc?Uc.decode(this.buf.subarray(o,c)):function(h,m,b){for(var T="",S=m;S<b;){var k,O,z,j=h[S],W=null,J=j>239?4:j>223?3:j>191?2:1;if(S+J>b)break;1===J?j<128&&(W=j):2===J?128==(192&(k=h[S+1]))&&(W=(31&j)<<6|63&k)<=127&&(W=null):3===J?(O=h[S+2],128==(192&(k=h[S+1]))&&128==(192&O)&&((W=(15&j)<<12|(63&k)<<6|63&O)<=2047||W>=55296&&W<=57343)&&(W=null)):4===J&&(O=h[S+2],z=h[S+3],128==(192&(k=h[S+1]))&&128==(192&O)&&128==(192&z)&&((W=(15&j)<<18|(63&k)<<12|(63&O)<<6|63&z)<=65535||W>=1114112)&&(W=null)),null===W?(W=65533,J=1):W>65535&&(W-=65536,T+=String.fromCharCode(W>>>10&1023|55296),W=56320|1023&W),T+=String.fromCharCode(W),S+=J}return T}(this.buf,o,c)},readBytes:function(){var c=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,c);return this.pos=c,o},readPackedVarint:function(c,o){if(this.type!==$i.Bytes)return c.push(this.readVarint(o));var h=jc(this);for(c=c||[];this.pos<h;)c.push(this.readVarint(o));return c},readPackedSVarint:function(c){if(this.type!==$i.Bytes)return c.push(this.readSVarint());var o=jc(this);for(c=c||[];this.pos<o;)c.push(this.readSVarint());return c},readPackedBoolean:function(c){if(this.type!==$i.Bytes)return c.push(this.readBoolean());var o=jc(this);for(c=c||[];this.pos<o;)c.push(this.readBoolean());return c},readPackedFloat:function(c){if(this.type!==$i.Bytes)return c.push(this.readFloat());var o=jc(this);for(c=c||[];this.pos<o;)c.push(this.readFloat());return c},readPackedDouble:function(c){if(this.type!==$i.Bytes)return c.push(this.readDouble());var o=jc(this);for(c=c||[];this.pos<o;)c.push(this.readDouble());return c},readPackedFixed32:function(c){if(this.type!==$i.Bytes)return c.push(this.readFixed32());var o=jc(this);for(c=c||[];this.pos<o;)c.push(this.readFixed32());return c},readPackedSFixed32:function(c){if(this.type!==$i.Bytes)return c.push(this.readSFixed32());var o=jc(this);for(c=c||[];this.pos<o;)c.push(this.readSFixed32());return c},readPackedFixed64:function(c){if(this.type!==$i.Bytes)return c.push(this.readFixed64());var o=jc(this);for(c=c||[];this.pos<o;)c.push(this.readFixed64());return c},readPackedSFixed64:function(c){if(this.type!==$i.Bytes)return c.push(this.readSFixed64());var o=jc(this);for(c=c||[];this.pos<o;)c.push(this.readSFixed64());return c},skip:function(c){var o=7&c;if(o===$i.Varint)for(;this.buf[this.pos++]>127;);else if(o===$i.Bytes)this.pos=this.readVarint()+this.pos;else if(o===$i.Fixed32)this.pos+=4;else{if(o!==$i.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(c,o){this.writeVarint(c<<3|o)},realloc:function(c){for(var o=this.length||16;o<this.pos+c;)o*=2;if(o!==this.length){var h=new Uint8Array(o);h.set(this.buf),this.buf=h,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(c){this.realloc(4),ed(this.buf,c,this.pos),this.pos+=4},writeSFixed32:function(c){this.realloc(4),ed(this.buf,c,this.pos),this.pos+=4},writeFixed64:function(c){this.realloc(8),ed(this.buf,-1&c,this.pos),ed(this.buf,Math.floor(c*$s),this.pos+4),this.pos+=8},writeSFixed64:function(c){this.realloc(8),ed(this.buf,-1&c,this.pos),ed(this.buf,Math.floor(c*$s),this.pos+4),this.pos+=8},writeVarint:function(c){(c=+c||0)>268435455||c<0?function(o,h){var m,b,T,k;if(o>=0?(m=o%4294967296|0,b=o/4294967296|0):(b=~(-o/4294967296),4294967295^(m=~(-o%4294967296))?m=m+1|0:(m=0,b=b+1|0)),o>=0x10000000000000000||o<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");h.realloc(10),T=m,(k=h).buf[k.pos++]=127&T|128,T>>>=7,k.buf[k.pos++]=127&T|128,T>>>=7,k.buf[k.pos++]=127&T|128,T>>>=7,k.buf[k.pos++]=127&T|128,k.buf[k.pos]=127&(T>>>=7),function(T,S){var k=(7&T)<<4;S.buf[S.pos++]|=k|((T>>>=3)?128:0),T&&(S.buf[S.pos++]=127&T|((T>>>=7)?128:0),T&&(S.buf[S.pos++]=127&T|((T>>>=7)?128:0),T&&(S.buf[S.pos++]=127&T|((T>>>=7)?128:0),T&&(S.buf[S.pos++]=127&T|((T>>>=7)?128:0),T&&(S.buf[S.pos++]=127&T)))))}(b,h)}(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))},writeSVarint:function(c){this.writeVarint(c<0?2*-c-1:2*c)},writeBoolean:function(c){this.writeVarint(Boolean(c))},writeString:function(c){c=String(c),this.realloc(4*c.length),this.pos++;var o=this.pos;this.pos=function(m,b,T){for(var S,k,O=0;O<b.length;O++){if((S=b.charCodeAt(O))>55295&&S<57344){if(!k){S>56319||O+1===b.length?(m[T++]=239,m[T++]=191,m[T++]=189):k=S;continue}if(S<56320){m[T++]=239,m[T++]=191,m[T++]=189,k=S;continue}S=k-55296<<10|S-56320|65536,k=null}else k&&(m[T++]=239,m[T++]=191,m[T++]=189,k=null);S<128?m[T++]=S:(S<2048?m[T++]=S>>6|192:(S<65536?m[T++]=S>>12|224:(m[T++]=S>>18|240,m[T++]=S>>12&63|128),m[T++]=S>>6&63|128),m[T++]=63&S|128)}return T}(this.buf,c,this.pos);var h=this.pos-o;h>=128&&ly(o,h,this),this.pos=o-1,this.writeVarint(h),this.pos+=h},writeFloat:function(c){this.realloc(4),Jf(this.buf,c,this.pos,!0,23,4),this.pos+=4},writeDouble:function(c){this.realloc(8),Jf(this.buf,c,this.pos,!0,52,8),this.pos+=8},writeBytes:function(c){var o=c.length;this.writeVarint(o),this.realloc(o);for(var h=0;h<o;h++)this.buf[this.pos++]=c[h]},writeRawMessage:function(c,o){this.pos++;var h=this.pos;c(o,this);var m=this.pos-h;m>=128&&ly(h,m,this),this.pos=h-1,this.writeVarint(m),this.pos+=m},writeMessage:function(c,o,h){this.writeTag(c,$i.Bytes),this.writeRawMessage(o,h)},writePackedVarint:function(c,o){o.length&&this.writeMessage(c,Qf,o)},writePackedSVarint:function(c,o){o.length&&this.writeMessage(c,Ju,o)},writePackedBoolean:function(c,o){o.length&&this.writeMessage(c,wg,o)},writePackedFloat:function(c,o){o.length&&this.writeMessage(c,hm,o)},writePackedDouble:function(c,o){o.length&&this.writeMessage(c,dm,o)},writePackedFixed32:function(c,o){o.length&&this.writeMessage(c,Qu,o)},writePackedSFixed32:function(c,o){o.length&&this.writeMessage(c,cy,o)},writePackedFixed64:function(c,o){o.length&&this.writeMessage(c,uy,o)},writePackedSFixed64:function(c,o){o.length&&this.writeMessage(c,Eg,o)},writeBytesField:function(c,o){this.writeTag(c,$i.Bytes),this.writeBytes(o)},writeFixed32Field:function(c,o){this.writeTag(c,$i.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(c,o){this.writeTag(c,$i.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(c,o){this.writeTag(c,$i.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(c,o){this.writeTag(c,$i.Fixed64),this.writeSFixed64(o)},writeVarintField:function(c,o){this.writeTag(c,$i.Varint),this.writeVarint(o)},writeSVarintField:function(c,o){this.writeTag(c,$i.Varint),this.writeSVarint(o)},writeStringField:function(c,o){this.writeTag(c,$i.Bytes),this.writeString(o)},writeFloatField:function(c,o){this.writeTag(c,$i.Fixed32),this.writeFloat(o)},writeDoubleField:function(c,o){this.writeTag(c,$i.Fixed64),this.writeDouble(o)},writeBooleanField:function(c,o){this.writeVarintField(c,Boolean(o))}};class ep{constructor(o,{pixelRatio:h,version:m,stretchX:b,stretchY:T,content:S}){this.paddedRect=o,this.pixelRatio=h,this.stretchX=b,this.stretchY=T,this.content=S,this.version=m}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class nf{constructor(o,h){const m={},b={};this.haveRenderCallbacks=[];const T=[];this.addImages(o,m,T),this.addImages(h,b,T);const{w:S,h:k}=pm(T),O=new cl({width:S||1,height:k||1});for(const z in o){const j=o[z],W=m[z].paddedRect;cl.copy(j.data,O,{x:0,y:0},{x:W.x+1,y:W.y+1},j.data)}for(const z in h){const j=h[z],W=b[z].paddedRect,J=W.x+1,te=W.y+1,ne=j.data.width,ge=j.data.height;cl.copy(j.data,O,{x:0,y:0},{x:J,y:te},j.data),cl.copy(j.data,O,{x:0,y:ge-1},{x:J,y:te-1},{width:ne,height:1}),cl.copy(j.data,O,{x:0,y:0},{x:J,y:te+ge},{width:ne,height:1}),cl.copy(j.data,O,{x:ne-1,y:0},{x:J-1,y:te},{width:1,height:ge}),cl.copy(j.data,O,{x:0,y:0},{x:J+ne,y:te},{width:1,height:ge})}this.image=O,this.iconPositions=m,this.patternPositions=b}addImages(o,h,m){for(const b in o){const T=o[b],S={x:0,y:0,w:T.data.width+2,h:T.data.height+2};m.push(S),h[b]=new ep(S,T),T.hasRenderCallback&&this.haveRenderCallbacks.push(b)}}patchUpdatedImages(o,h){o.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const m in o.updatedImages)this.patchUpdatedImage(this.iconPositions[m],o.getImage(m),h),this.patchUpdatedImage(this.patternPositions[m],o.getImage(m),h)}patchUpdatedImage(o,h,m){if(!o||!h||o.version===h.version)return;o.version=h.version;const[b,T]=o.tl;m.update(h.data,void 0,{x:b,y:T})}}Dt("ImagePosition",ep),Dt("ImageAtlas",nf),w.WritingMode=void 0,(Vc=w.WritingMode||(w.WritingMode={}))[Vc.none=0]="none",Vc[Vc.horizontal=1]="horizontal",Vc[Vc.vertical=2]="vertical",Vc[Vc.horizontalOnly=3]="horizontalOnly";class ta{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(o,h){const m=new ta;return m.scale=o||1,m.fontStack=h,m}static forImage(o){const h=new ta;return h.imageName=o,h}}class hl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,h){const m=new hl;for(let b=0;b<o.sections.length;b++){const T=o.sections[b];T.image?m.addImageSection(T):m.addTextSection(T,h)}return m}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSectionIndex(o){return this.sectionIndex[o]}getCharCode(o){return this.text.charCodeAt(o)}verticalizePunctuation(){this.text=function(o){let h="";for(let m=0;m<o.length;m++){const b=o.charCodeAt(m+1)||null,T=o.charCodeAt(m-1)||null;h+=b&&gu(b)&&!Qh[o[m+1]]||T&&gu(T)&&!Qh[o[m-1]]||!Qh[o[m]]?o[m]:Qh[o[m]]}return h}(this.text)}trim(){let o=0;for(let m=0;m<this.text.length&&sf[this.text.charCodeAt(m)];m++)o++;let h=this.text.length;for(let m=this.text.length-1;m>=0&&m>=o&&sf[this.text.charCodeAt(m)];m--)h--;this.text=this.text.substring(o,h),this.sectionIndex=this.sectionIndex.slice(o,h)}substring(o,h){const m=new hl;return m.text=this.text.substring(o,h),m.sectionIndex=this.sectionIndex.slice(o,h),m.sections=this.sections,m}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,h)=>Math.max(o,this.sections[h].scale),0)}addTextSection(o,h){this.text+=o.text,this.sections.push(ta.forText(o.scale,o.fontStack||h));const m=this.sections.length-1;for(let b=0;b<o.text.length;++b)this.sectionIndex.push(m)}addImageSection(o){const h=o.image?o.image.name:"";if(0===h.length)return void Ci("Can't add FormattedSection with an empty image.");const m=this.getNextImageSectionCharCode();m?(this.text+=String.fromCharCode(m),this.sections.push(ta.forImage(h)),this.sectionIndex.push(this.sections.length-1)):Ci("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function tp(c,o,h,m,b,T,S,k,O,z,j,W,J,te,ne,ge){const pe=hl.fromFeature(c,b);let Pe;W===w.WritingMode.vertical&&pe.verticalizePunctuation();const{processBidirectionalText:ze,processStyledBidirectionalText:De}=oo;if(ze&&1===pe.sections.length){Pe=[];const Ze=ze(pe.toString(),np(pe,z,T,o,m,te,ne));for(const Tt of Ze){const kt=new hl;kt.text=Tt,kt.sections=pe.sections;for(let bt=0;bt<Tt.length;bt++)kt.sectionIndex.push(0);Pe.push(kt)}}else if(De){Pe=[];const Ze=De(pe.text,pe.sectionIndex,np(pe,z,T,o,m,te,ne));for(const Tt of Ze){const kt=new hl;kt.text=Tt[0],kt.sectionIndex=Tt[1],kt.sections=pe.sections,Pe.push(kt)}}else Pe=function(Ze,Tt){const kt=[],bt=Ze.text;let ft=0;for(const ct of Tt)kt.push(Ze.substring(ft,ct)),ft=ct;return ft<bt.length&&kt.push(Ze.substring(ft,bt.length)),kt}(pe,np(pe,z,T,o,m,te,ne));const Oe=[],Ke={positionedLines:Oe,text:pe.toString(),top:j[1],bottom:j[1],left:j[0],right:j[0],writingMode:W,iconsInText:!1,verticalizable:!1};return function(Ze,Tt,kt,bt,ft,ct,gt,_t,ot,Vt,Ot,Bn){let or=0,ar=-17,hs=0,Va=0;const Vi="right"===_t?1:"left"===_t?0:.5;let Fr=0;for(const qr of ft){qr.trim();const lr=qr.getMaxScale(),po=24*(lr-1),mo={positionedGlyphs:[],lineOffset:0};Ze.positionedLines[Fr]=mo;const fs=mo.positionedGlyphs;let Qt=0;if(!qr.length()){ar+=ct,++Fr;continue}for(let Pi=0;Pi<qr.length();Pi++){const qt=qr.getSection(Pi),Ea=qr.getSectionIndex(Pi),Ar=qr.getCharCode(Pi);let go=0,fl=null,Lo=null,zs=null,Wc=24;const Ta=!(ot===w.WritingMode.horizontal||!Ot&&!Rd(Ar)||Ot&&(sf[Ar]||(ds=Ar,yt.Arabic(ds)||yt["Arabic Supplement"](ds)||yt["Arabic Extended-A"](ds)||yt["Arabic Presentation Forms-A"](ds)||yt["Arabic Presentation Forms-B"](ds))));if(qt.imageName){const pl=bt[qt.imageName];if(!pl)continue;zs=qt.imageName,Ze.iconsInText=Ze.iconsInText||!0,Lo=pl.paddedRect;const Qr=pl.displaySize;qt.scale=24*qt.scale/Bn,fl={width:Qr[0],height:Qr[1],left:1,top:-3,advance:Ta?Qr[1]:Qr[0]},go=po+(24-Qr[1]*qt.scale),Wc=fl.advance;const $l=Ta?Qr[0]*qt.scale-24*lr:Qr[1]*qt.scale-24*lr;$l>0&&$l>Qt&&(Qt=$l)}else{const pl=kt[qt.fontStack],Qr=pl&&pl[Ar];if(Qr&&Qr.rect)Lo=Qr.rect,fl=Qr.metrics;else{const $l=Tt[qt.fontStack],sh=$l&&$l[Ar];if(!sh)continue;fl=sh.metrics}go=24*(lr-qt.scale)}Ta?(Ze.verticalizable=!0,fs.push({glyph:Ar,imageName:zs,x:or,y:ar+go,vertical:Ta,scale:qt.scale,fontStack:qt.fontStack,sectionIndex:Ea,metrics:fl,rect:Lo}),or+=Wc*qt.scale+Vt):(fs.push({glyph:Ar,imageName:zs,x:or,y:ar+go,vertical:Ta,scale:qt.scale,fontStack:qt.fontStack,sectionIndex:Ea,metrics:fl,rect:Lo}),or+=fl.advance*qt.scale+Vt)}0!==fs.length&&(hs=Math.max(or-Vt,hs),p0(fs,0,fs.length-1,Vi,Qt)),or=0;const Cr=ct*lr+Qt;mo.lineOffset=Math.max(Qt,po),ar+=Cr,Va=Math.max(Cr,Va),++Fr}var ds;const Ss=ar- -17,{horizontalAlign:Ui,verticalAlign:Bs}=Tg(gt);(function(qr,lr,po,mo,fs,Qt,Cr,Pi,qt){const Ea=(lr-po)*fs;let Ar=0;Ar=Qt!==Cr?-Pi*mo- -17:(-mo*qt+.5)*Cr;for(const go of qr)for(const fl of go.positionedGlyphs)fl.x+=Ea,fl.y+=Ar})(Ze.positionedLines,Vi,Ui,Bs,hs,Va,ct,Ss,ft.length),Ze.top+=-Bs*Ss,Ze.bottom=Ze.top+Ss,Ze.left+=-Ui*hs,Ze.right=Ze.left+hs}(Ke,o,h,m,Pe,S,k,O,W,z,J,ge),!function(Ze){for(const Tt of Ze)if(0!==Tt.positionedGlyphs.length)return!1;return!0}(Oe)&&Ke}const sf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},hy={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function af(c,o,h,m,b,T){if(o.imageName){const S=m[o.imageName];return S?S.displaySize[0]*o.scale*24/T+b:0}{const S=h[o.fontStack],k=S&&S[c];return k?k.metrics.advance*o.scale+b:0}}function gc(c,o,h,m){const b=Math.pow(c-o,2);return m?c<o?b/2:2*b:b+Math.abs(h)*h}function lf(c,o,h){let m=0;return 10===c&&(m-=1e4),h&&(m+=150),40!==c&&65288!==c||(m+=50),41!==o&&65289!==o||(m+=50),m}function mm(c,o,h,m,b,T){let S=null,k=gc(o,h,b,T);for(const O of m){const z=gc(o-O.x,h,b,T)+O.badness;z<=k&&(S=O,k=z)}return{index:c,x:o,priorBreak:S,badness:k}}function gm(c){return c?gm(c.priorBreak).concat(c.index):[]}function np(c,o,h,m,b,T,S){if("point"!==T)return[];if(!c)return[];const k=[],O=function(J,te,ne,ge,pe,Pe){let ze=0;for(let De=0;De<J.length();De++){const Oe=J.getSection(De);ze+=af(J.getCharCode(De),Oe,ge,pe,te,Pe)}return ze/Math.max(1,Math.ceil(ze/ne))}(c,o,h,m,b,S),z=c.text.indexOf("\u200b")>=0;let j=0;for(let J=0;J<c.length();J++){const te=c.getSection(J),ne=c.getCharCode(J);if(sf[ne]||(j+=af(ne,te,m,b,o,S)),J<c.length()-1){const ge=!((W=ne)<11904||!(yt["Bopomofo Extended"](W)||yt.Bopomofo(W)||yt["CJK Compatibility Forms"](W)||yt["CJK Compatibility Ideographs"](W)||yt["CJK Compatibility"](W)||yt["CJK Radicals Supplement"](W)||yt["CJK Strokes"](W)||yt["CJK Symbols and Punctuation"](W)||yt["CJK Unified Ideographs Extension A"](W)||yt["CJK Unified Ideographs"](W)||yt["Enclosed CJK Letters and Months"](W)||yt["Halfwidth and Fullwidth Forms"](W)||yt.Hiragana(W)||yt["Ideographic Description Characters"](W)||yt["Kangxi Radicals"](W)||yt["Katakana Phonetic Extensions"](W)||yt.Katakana(W)||yt["Vertical Forms"](W)||yt["Yi Radicals"](W)||yt["Yi Syllables"](W)));(hy[ne]||ge||te.imageName)&&k.push(mm(J+1,j,O,k,lf(ne,c.getCharCode(J+1),ge&&z),!1))}}var W;return gm(mm(c.length(),j,O,k,0,!0))}function Tg(c){let o=.5,h=.5;switch(c){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":h=1;break;case"top":case"top-right":case"top-left":h=0}return{horizontalAlign:o,verticalAlign:h}}function p0(c,o,h,m,b){if(!m&&!b)return;const T=c[h],S=(c[h].x+T.metrics.advance*T.scale)*m;for(let k=o;k<=h;k++)c[k].x-=S,c[k].y+=b}function m0(c,o,h){const{horizontalAlign:m,verticalAlign:b}=Tg(h),T=o[0]-c.displaySize[0]*m,S=o[1]-c.displaySize[1]*b;return{image:c,top:S,bottom:S+c.displaySize[1],left:T,right:T+c.displaySize[0]}}function ip(c,o,h,m,b,T){const S=c.image;let k;if(S.content){const pe=S.content,Pe=S.pixelRatio||1;k=[pe[0]/Pe,pe[1]/Pe,S.displaySize[0]-pe[2]/Pe,S.displaySize[1]-pe[3]/Pe]}const O=o.left*T,z=o.right*T;let j,W,J,te;"width"===h||"both"===h?(te=b[0]+O-m[3],W=b[0]+z+m[1]):(te=b[0]+(O+z-S.displaySize[0])/2,W=te+S.displaySize[0]);const ne=o.top*T,ge=o.bottom*T;return"height"===h||"both"===h?(j=b[1]+ne-m[0],J=b[1]+ge+m[2]):(j=b[1]+(ne+ge-S.displaySize[1])/2,J=j+S.displaySize[1]),{image:S,top:j,right:W,bottom:J,left:te,collisionPadding:k}}const dl=128;function Cg(c,o){const{expression:h}=o;if("constant"===h.kind)return{kind:"constant",layoutSize:h.evaluate(new li(c+1))};if("source"===h.kind)return{kind:"source"};{const{zoomStops:m,interpolationType:b}=h;let T=0;for(;T<m.length&&m[T]<=c;)T++;T=Math.max(0,T-1);let S=T;for(;S<m.length&&m[S]<c+1;)S++;S=Math.min(m.length-1,S);const k=m[T],O=m[S];return"composite"===h.kind?{kind:"composite",minZoom:k,maxZoom:O,interpolationType:b}:{kind:"camera",minZoom:k,maxZoom:O,minSize:h.evaluate(new li(k)),maxSize:h.evaluate(new li(O)),interpolationType:b}}}class Su extends Zt{constructor(o,h,m,b){super(o,h),this.angle=m,void 0!==b&&(this.segment=b)}clone(){return new Su(this.x,this.y,this.angle,this.segment)}}function _m(c,o,h,m,b){if(void 0===o.segment)return!0;let T=o,S=o.segment+1,k=0;for(;k>-h/2;){if(S--,S<0)return!1;k-=c[S].dist(T),T=c[S]}k+=c[S].dist(c[S+1]),S++;const O=[];let z=0;for(;k<h/2;){const j=c[S],W=c[S+1];if(!W)return!1;let J=c[S-1].angleTo(j)-j.angleTo(W);for(J=Math.abs((J+3*Math.PI)%(2*Math.PI)-Math.PI),O.push({distance:k,angleDelta:J}),z+=J;k-O[0].distance>m;)z-=O.shift().angleDelta;if(z>b)return!1;S++,k+=j.dist(W)}return!0}function Sg(c){let o=0;for(let h=0;h<c.length-1;h++)o+=c[h].dist(c[h+1]);return o}function Mg(c,o,h){return c?.6*o*h:0}function ym(c,o){return Math.max(c?c.right-c.left:0,o?o.right-o.left:0)}function dy(c,o,h,m,b,T){const S=Mg(h,b,T),k=ym(h,m)*T;let O=0;const z=Sg(c)/2;for(let j=0;j<c.length-1;j++){const W=c[j],J=c[j+1],te=W.dist(J);if(O+te>z){const ne=(z-O)/te,ge=Je(W.x,J.x,ne),pe=Je(W.y,J.y,ne),Pe=new Su(ge,pe,J.angleTo(W),j);return Pe._round(),!S||_m(c,Pe,k,S,o)?Pe:void 0}O+=te}}function Ag(c,o,h,m,b,T,S,k,O){const z=Mg(m,T,S),j=ym(m,b),W=j*S,J=0===c[0].x||c[0].x===O||0===c[0].y||c[0].y===O;return o-W<o/4&&(o=W+o/4),cf(c,J?o/2*k%o:(j/2+2*T)*S*k%o,o,z,h,W,J,!1,O)}function cf(c,o,h,m,b,T,S,k,O){const z=T/2,j=Sg(c);let W=0,J=o-h,te=[];for(let ne=0;ne<c.length-1;ne++){const ge=c[ne],pe=c[ne+1],Pe=ge.dist(pe),ze=pe.angleTo(ge);for(;J+h<W+Pe;){J+=h;const De=(J-W)/Pe,Oe=Je(ge.x,pe.x,De),Ke=Je(ge.y,pe.y,De);if(Oe>=0&&Oe<O&&Ke>=0&&Ke<O&&J-z>=0&&J+z<=j){const Ze=new Su(Oe,Ke,ze,ne);Ze._round(),m&&!_m(c,Ze,T,m,b)||te.push(Ze)}}W+=Pe}return k||te.length||S||(te=cf(c,W/2,h,m,b,T,S,!0,O)),te}function vm(c,o,h,m,b){const T=[];for(let S=0;S<c.length;S++){const k=c[S];let O;for(let z=0;z<k.length-1;z++){let j=k[z],W=k[z+1];j.x<o&&W.x<o||(j.x<o?j=new Zt(o,j.y+(o-j.x)/(W.x-j.x)*(W.y-j.y))._round():W.x<o&&(W=new Zt(o,j.y+(o-j.x)/(W.x-j.x)*(W.y-j.y))._round()),j.y<h&&W.y<h||(j.y<h?j=new Zt(j.x+(h-j.y)/(W.y-j.y)*(W.x-j.x),h)._round():W.y<h&&(W=new Zt(j.x+(h-j.y)/(W.y-j.y)*(W.x-j.x),h)._round()),j.x>=m&&W.x>=m||(j.x>=m?j=new Zt(m,j.y+(m-j.x)/(W.x-j.x)*(W.y-j.y))._round():W.x>=m&&(W=new Zt(m,j.y+(m-j.x)/(W.x-j.x)*(W.y-j.y))._round()),j.y>=b&&W.y>=b||(j.y>=b?j=new Zt(j.x+(b-j.y)/(W.y-j.y)*(W.x-j.x),b)._round():W.y>=b&&(W=new Zt(j.x+(b-j.y)/(W.y-j.y)*(W.x-j.x),b)._round()),O&&j.equals(O[O.length-1])||(O=[j],T.push(O)),O.push(W)))))}}return T}function rp(c,o,h,m){const b=[],T=c.image,S=T.pixelRatio,k=T.paddedRect.w-2,O=T.paddedRect.h-2,z=c.right-c.left,j=c.bottom-c.top,W=T.stretchX||[[0,k]],J=T.stretchY||[[0,O]],te=(ct,gt)=>ct+gt[1]-gt[0],ne=W.reduce(te,0),ge=J.reduce(te,0),pe=k-ne,Pe=O-ge;let ze=0,De=ne,Oe=0,Ke=ge,Ze=0,Tt=pe,kt=0,bt=Pe;if(T.content&&m){const ct=T.content;ze=sp(W,0,ct[0]),Oe=sp(J,0,ct[1]),De=sp(W,ct[0],ct[2]),Ke=sp(J,ct[1],ct[3]),Ze=ct[0]-ze,kt=ct[1]-Oe,Tt=ct[2]-ct[0]-De,bt=ct[3]-ct[1]-Ke}const ft=(ct,gt,_t,ot)=>{const Vt=op(ct.stretch-ze,De,z,c.left),Ot=ap(ct.fixed-Ze,Tt,ct.stretch,ne),Bn=op(gt.stretch-Oe,Ke,j,c.top),or=ap(gt.fixed-kt,bt,gt.stretch,ge),ar=op(_t.stretch-ze,De,z,c.left),hs=ap(_t.fixed-Ze,Tt,_t.stretch,ne),Va=op(ot.stretch-Oe,Ke,j,c.top),Vi=ap(ot.fixed-kt,bt,ot.stretch,ge),Fr=new Zt(Vt,Bn),ds=new Zt(ar,Bn),Ss=new Zt(ar,Va),Ui=new Zt(Vt,Va),Bs=new Zt(Ot/S,or/S),qr=new Zt(hs/S,Vi/S),lr=o*Math.PI/180;if(lr){const fs=Math.sin(lr),Qt=Math.cos(lr),Cr=[Qt,-fs,fs,Qt];Fr._matMult(Cr),ds._matMult(Cr),Ui._matMult(Cr),Ss._matMult(Cr)}const po=ct.stretch+ct.fixed,mo=gt.stretch+gt.fixed;return{tl:Fr,tr:ds,bl:Ui,br:Ss,tex:{x:T.paddedRect.x+1+po,y:T.paddedRect.y+1+mo,w:_t.stretch+_t.fixed-po,h:ot.stretch+ot.fixed-mo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Bs,pixelOffsetBR:qr,minFontScaleX:Tt/S/z,minFontScaleY:bt/S/j,isSDF:h}};if(m&&(T.stretchX||T.stretchY)){const ct=Gn(W,pe,ne),gt=Gn(J,Pe,ge);for(let _t=0;_t<ct.length-1;_t++){const ot=ct[_t],Vt=ct[_t+1];for(let Ot=0;Ot<gt.length-1;Ot++)b.push(ft(ot,gt[Ot],Vt,gt[Ot+1]))}}else b.push(ft({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:k+1},{fixed:0,stretch:O+1}));return b}function sp(c,o,h){let m=0;for(const b of c)m+=Math.max(o,Math.min(h,b[1]))-Math.max(o,Math.min(h,b[0]));return m}function Gn(c,o,h){const m=[{fixed:-1,stretch:0}];for(const[b,T]of c){const S=m[m.length-1];m.push({fixed:b-S.stretch,stretch:S.stretch}),m.push({fixed:b-S.stretch,stretch:S.stretch+(T-b)})}return m.push({fixed:o+1,stretch:h}),m}function op(c,o,h,m){return c/o*h+m}function ap(c,o,h,m){return c-o*h/m}Dt("Anchor",Su);class uf{constructor(o,h,m,b,T,S,k,O,z,j){if(this.boxStartIndex=o.length,z){let W=S.top,J=S.bottom;const te=S.collisionPadding;te&&(W-=te[1],J+=te[3]);let ne=J-W;ne>0&&(ne=Math.max(10,ne),this.circleDiameter=ne)}else{let W=S.top*k-O[0],J=S.bottom*k+O[2],te=S.left*k-O[3],ne=S.right*k+O[1];const ge=S.collisionPadding;if(ge&&(te-=ge[0]*k,W-=ge[1]*k,ne+=ge[2]*k,J+=ge[3]*k),j){const pe=new Zt(te,W),Pe=new Zt(ne,W),ze=new Zt(te,J),De=new Zt(ne,J),Oe=j*Math.PI/180;pe._rotate(Oe),Pe._rotate(Oe),ze._rotate(Oe),De._rotate(Oe),te=Math.min(pe.x,Pe.x,ze.x,De.x),ne=Math.max(pe.x,Pe.x,ze.x,De.x),W=Math.min(pe.y,Pe.y,ze.y,De.y),J=Math.max(pe.y,Pe.y,ze.y,De.y)}o.emplaceBack(h.x,h.y,te,W,ne,J,m,b,T)}this.boxEndIndex=o.length}}class bm{constructor(o=[],h=fy){if(this.data=o,this.length=this.data.length,this.compare=h,this.length>0)for(let m=(this.length>>1)-1;m>=0;m--)this._down(m)}push(o){this.data.push(o),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const o=this.data[0],h=this.data.pop();return this.length--,this.length>0&&(this.data[0]=h,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:h,compare:m}=this,b=h[o];for(;o>0;){const T=o-1>>1,S=h[T];if(m(b,S)>=0)break;h[o]=S,o=T}h[o]=b}_down(o){const{data:h,compare:m}=this,b=this.length>>1,T=h[o];for(;o<b;){let S=1+(o<<1),k=h[S];const O=S+1;if(O<this.length&&m(h[O],k)<0&&(S=O,k=h[O]),m(k,T)>=0)break;h[o]=k,o=S}h[o]=T}}function fy(c,o){return c<o?-1:c>o?1:0}function py(c,o=1,h=!1){let m=1/0,b=1/0,T=-1/0,S=-1/0;const k=c[0];for(let te=0;te<k.length;te++){const ne=k[te];(!te||ne.x<m)&&(m=ne.x),(!te||ne.y<b)&&(b=ne.y),(!te||ne.x>T)&&(T=ne.x),(!te||ne.y>S)&&(S=ne.y)}const O=Math.min(T-m,S-b);let z=O/2;const j=new bm([],my);if(0===O)return new Zt(m,b);for(let te=m;te<T;te+=O)for(let ne=b;ne<S;ne+=O)j.push(new td(te+z,ne+z,z,c));let W=function(te){let ne=0,ge=0,pe=0;const Pe=te[0];for(let ze=0,De=Pe.length,Oe=De-1;ze<De;Oe=ze++){const Ke=Pe[ze],Ze=Pe[Oe],Tt=Ke.x*Ze.y-Ze.x*Ke.y;ge+=(Ke.x+Ze.x)*Tt,pe+=(Ke.y+Ze.y)*Tt,ne+=3*Tt}return new td(ge/ne,pe/ne,0,te)}(c),J=j.length;for(;j.length;){const te=j.pop();(te.d>W.d||!W.d)&&(W=te,h&&console.log("found best %d after %d probes",Math.round(1e4*te.d)/1e4,J)),te.max-W.d<=o||(z=te.h/2,j.push(new td(te.p.x-z,te.p.y-z,z,c)),j.push(new td(te.p.x+z,te.p.y-z,z,c)),j.push(new td(te.p.x-z,te.p.y+z,z,c)),j.push(new td(te.p.x+z,te.p.y+z,z,c)),J+=4)}return h&&(console.log(`num probes: ${J}`),console.log(`best distance: ${W.d}`)),W.p}function my(c,o){return o.max-c.max}function td(c,o,h,m){this.p=new Zt(c,o),this.h=h,this.d=function(b,T){let S=!1,k=1/0;for(let O=0;O<T.length;O++){const z=T[O];for(let j=0,W=z.length,J=W-1;j<W;J=j++){const te=z[j],ne=z[J];te.y>b.y!=ne.y>b.y&&b.x<(ne.x-te.x)*(b.y-te.y)/(ne.y-te.y)+te.x&&(S=!S),k=Math.min(k,jf(b,te,ne))}}return(S?1:-1)*Math.sqrt(k)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}const hf=Number.POSITIVE_INFINITY;function gy(c,o){return o[1]!==hf?function(h,m,b){let T=0,S=0;switch(m=Math.abs(m),b=Math.abs(b),h){case"top-right":case"top-left":case"top":S=b-7;break;case"bottom-right":case"bottom-left":case"bottom":S=7-b}switch(h){case"top-right":case"bottom-right":case"right":T=-m;break;case"top-left":case"bottom-left":case"left":T=m}return[T,S]}(c,o[0],o[1]):function(h,m){let b=0,T=0;m<0&&(m=0);const S=m/Math.sqrt(2);switch(h){case"top-right":case"top-left":T=S-7;break;case"bottom-right":case"bottom-left":T=7-S;break;case"bottom":T=7-m;break;case"top":T=m-7}switch(h){case"top-right":case"bottom-right":b=-S;break;case"top-left":case"bottom-left":b=S;break;case"left":b=m;break;case"right":b=-m}return[b,T]}(c,o[0])}function Dg(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function df(c,o,h,m,b,T,S,k,O,z,j){let W=T.textMaxSize.evaluate(o,{});void 0===W&&(W=S);const J=c.layers[0].layout,te=J.get("icon-offset").evaluate(o,{},j),ne=wm(h.horizontal),ge=S/24,pe=c.tilePixelRatio*ge,Pe=c.tilePixelRatio*W/24,ze=c.tilePixelRatio*k,De=c.tilePixelRatio*J.get("symbol-spacing"),Oe=J.get("text-padding")*c.tilePixelRatio,Ke=function(ot,Vt,Ot,Bn=1){const or=ot.get("icon-padding").evaluate(Vt,{},Ot),ar=or&&or.values;return[ar[0]*Bn,ar[1]*Bn,ar[2]*Bn,ar[3]*Bn]}(J,o,j,c.tilePixelRatio),Ze=J.get("text-max-angle")/180*Math.PI,Tt="viewport"!==J.get("text-rotation-alignment")&&"point"!==J.get("symbol-placement"),kt="map"===J.get("icon-rotation-alignment")&&"point"!==J.get("symbol-placement"),bt=J.get("symbol-placement"),ft=De/2,ct=J.get("icon-text-fit");let gt;m&&"none"!==ct&&(c.allowVerticalPlacement&&h.vertical&&(gt=ip(m,h.vertical,ct,J.get("icon-text-fit-padding"),te,ge)),ne&&(m=ip(m,ne,ct,J.get("icon-text-fit-padding"),te,ge)));const _t=(ot,Vt)=>{Vt.x<0||Vt.x>=rr||Vt.y<0||Vt.y>=rr||function(Ot,Bn,or,ar,hs,Va,Vi,Fr,ds,Ss,Ui,Bs,qr,lr,po,mo,fs,Qt,Cr,Pi,qt,Ea,Ar,go,fl){const Lo=Ot.addToLineVertexArray(Bn,or);let zs,Wc,Ta,pl,Qr=0,$l=0,sh=0,ui=0,Sr=-1,cd=-1;const $c={};let Am=$r.exports(""),Dm=0,oh=0;if(void 0===Fr._unevaluatedLayout.getValue("text-radial-offset")?[Dm,oh]=Fr.layout.get("text-offset").evaluate(qt,{},go).map(na=>24*na):(Dm=24*Fr.layout.get("text-radial-offset").evaluate(qt,{},go),oh=hf),Ot.allowVerticalPlacement&&ar.vertical){const na=Fr.layout.get("text-rotate").evaluate(qt,{},go)+90;Ta=new uf(ds,Bn,Ss,Ui,Bs,ar.vertical,qr,lr,po,na),Vi&&(pl=new uf(ds,Bn,Ss,Ui,Bs,Vi,fs,Qt,po,na))}if(hs){const na=Fr.layout.get("icon-rotate").evaluate(qt,{}),yc="none"!==Fr.layout.get("icon-text-fit"),_f=rp(hs,na,Ar,yc),dd=Vi?rp(Vi,na,Ar,yc):void 0;Wc=new uf(ds,Bn,Ss,Ui,Bs,hs,fs,Qt,!1,na),Qr=4*_f.length;const vc=Ot.iconSizeData;let Cn=null;"source"===vc.kind?(Cn=[dl*Fr.layout.get("icon-size").evaluate(qt,{})],Cn[0]>Hc&&Ci(`${Ot.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===vc.kind&&(Cn=[dl*Ea.compositeIconSizes[0].evaluate(qt,{},go),dl*Ea.compositeIconSizes[1].evaluate(qt,{},go)],(Cn[0]>Hc||Cn[1]>Hc)&&Ci(`${Ot.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Ot.addSymbols(Ot.icon,_f,Cn,Pi,Cr,qt,w.WritingMode.none,Bn,Lo.lineStartIndex,Lo.lineLength,-1,go),Sr=Ot.icon.placedSymbolArray.length-1,dd&&($l=4*dd.length,Ot.addSymbols(Ot.icon,dd,Cn,Pi,Cr,qt,w.WritingMode.vertical,Bn,Lo.lineStartIndex,Lo.lineLength,-1,go),cd=Ot.icon.placedSymbolArray.length-1)}const Ug=Object.keys(ar.horizontal);for(const na of Ug){const yc=ar.horizontal[na];if(!zs){Am=$r.exports(yc.text);const dd=Fr.layout.get("text-rotate").evaluate(qt,{},go);zs=new uf(ds,Bn,Ss,Ui,Bs,yc,qr,lr,po,dd)}const _f=1===yc.positionedLines.length;if(sh+=xm(Ot,Bn,yc,Va,Fr,po,qt,mo,Lo,ar.vertical?w.WritingMode.horizontal:w.WritingMode.horizontalOnly,_f?Ug:[na],$c,Sr,Ea,go),_f)break}ar.vertical&&(ui+=xm(Ot,Bn,ar.vertical,Va,Fr,po,qt,mo,Lo,w.WritingMode.vertical,["vertical"],$c,cd,Ea,go));const yy=zs?zs.boxStartIndex:Ot.collisionBoxArray.length,pp=zs?zs.boxEndIndex:Ot.collisionBoxArray.length,ah=Ta?Ta.boxStartIndex:Ot.collisionBoxArray.length,mp=Ta?Ta.boxEndIndex:Ot.collisionBoxArray.length,y0=Wc?Wc.boxStartIndex:Ot.collisionBoxArray.length,lh=Wc?Wc.boxEndIndex:Ot.collisionBoxArray.length,ud=pl?pl.boxStartIndex:Ot.collisionBoxArray.length,Ca=pl?pl.boxEndIndex:Ot.collisionBoxArray.length;let Oo=-1;const hd=(na,yc)=>na&&na.circleDiameter?Math.max(na.circleDiameter,yc):yc;Oo=hd(zs,Oo),Oo=hd(Ta,Oo),Oo=hd(Wc,Oo),Oo=hd(pl,Oo);const jg=Oo>-1?1:0;jg&&(Oo*=fl/24),Ot.glyphOffsetArray.length>=eh.MAX_GLYPHS&&Ci("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==qt.sortKey&&Ot.addToSortKeyRanges(Ot.symbolInstances.length,qt.sortKey),Ot.symbolInstances.emplaceBack(Bn.x,Bn.y,$c.right>=0?$c.right:-1,$c.center>=0?$c.center:-1,$c.left>=0?$c.left:-1,$c.vertical||-1,Sr,cd,Am,yy,pp,ah,mp,y0,lh,ud,Ca,Ss,sh,ui,Qr,$l,jg,0,qr,Dm,oh,Oo)}(c,Vt,ot,h,m,b,gt,c.layers[0],c.collisionBoxArray,o.index,o.sourceLayerIndex,c.index,pe,[Oe,Oe,Oe,Oe],Tt,O,ze,Ke,kt,te,o,T,z,j,S)};if("line"===bt)for(const ot of vm(o.geometry,0,0,rr,rr)){const Vt=Ag(ot,De,Ze,h.vertical||ne,m,24,Pe,c.overscaling,rr);for(const Ot of Vt){const Bn=ne;Bn&&Ig(c,Bn.text,ft,Ot)||_t(ot,Ot)}}else if("line-center"===bt){for(const ot of o.geometry)if(ot.length>1){const Vt=dy(ot,Ze,h.vertical||ne,m,24,Pe);Vt&&_t(ot,Vt)}}else if("Polygon"===o.type)for(const ot of ko(o.geometry,0)){const Vt=py(ot,16);_t(ot[0],new Su(Vt.x,Vt.y,0))}else if("LineString"===o.type)for(const ot of o.geometry)_t(ot,new Su(ot[0].x,ot[0].y,0));else if("Point"===o.type)for(const ot of o.geometry)for(const Vt of ot)_t([Vt],new Su(Vt.x,Vt.y,0))}const Hc=32640;function xm(c,o,h,m,b,T,S,k,O,z,j,W,J,te,ne){const ge=function(ze,De,Oe,Ke,Ze,Tt,kt,bt){const ft=Ke.layout.get("text-rotate").evaluate(Tt,{})*Math.PI/180,ct=[];for(const gt of De.positionedLines)for(const _t of gt.positionedGlyphs){if(!_t.rect)continue;const ot=_t.rect||{};let Vt=4,Ot=!0,Bn=1,or=0;const ar=(Ze||bt)&&_t.vertical,hs=_t.metrics.advance*_t.scale/2;if(bt&&De.verticalizable){const Cr=24*(_t.scale-1),Pi=(24-_t.metrics.width*_t.scale)/2;or=gt.lineOffset/2-(_t.imageName?-Pi:Cr)}if(_t.imageName){const Cr=kt[_t.imageName];Ot=Cr.sdf,Bn=Cr.pixelRatio,Vt=1/Bn}const Va=Ze?[_t.x+hs,_t.y]:[0,0];let Vi=Ze?[0,0]:[_t.x+hs+Oe[0],_t.y+Oe[1]-or],Fr=[0,0];ar&&(Fr=Vi,Vi=[0,0]);const ds=(_t.metrics.left-Vt)*_t.scale-hs+Vi[0],Ss=(-_t.metrics.top-Vt)*_t.scale+Vi[1],Ui=ds+ot.w*_t.scale/Bn,Bs=Ss+ot.h*_t.scale/Bn,qr=new Zt(ds,Ss),lr=new Zt(Ui,Ss),po=new Zt(ds,Bs),mo=new Zt(Ui,Bs);if(ar){const Cr=new Zt(-hs,hs- -17),Pi=-Math.PI/2,qt=12-hs,Ea=new Zt(22-qt,-(_t.imageName?qt:0)),Ar=new Zt(...Fr);qr._rotateAround(Pi,Cr)._add(Ea)._add(Ar),lr._rotateAround(Pi,Cr)._add(Ea)._add(Ar),po._rotateAround(Pi,Cr)._add(Ea)._add(Ar),mo._rotateAround(Pi,Cr)._add(Ea)._add(Ar)}if(ft){const Cr=Math.sin(ft),Pi=Math.cos(ft),qt=[Pi,-Cr,Cr,Pi];qr._matMult(qt),lr._matMult(qt),po._matMult(qt),mo._matMult(qt)}const fs=new Zt(0,0),Qt=new Zt(0,0);ct.push({tl:qr,tr:lr,bl:po,br:mo,tex:ot,writingMode:De.writingMode,glyphOffset:Va,sectionIndex:_t.sectionIndex,isSDF:Ot,pixelOffsetTL:fs,pixelOffsetBR:Qt,minFontScaleX:0,minFontScaleY:0})}return ct}(0,h,k,b,T,S,m,c.allowVerticalPlacement),pe=c.textSizeData;let Pe=null;"source"===pe.kind?(Pe=[dl*b.layout.get("text-size").evaluate(S,{})],Pe[0]>Hc&&Ci(`${c.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===pe.kind&&(Pe=[dl*te.compositeTextSizes[0].evaluate(S,{},ne),dl*te.compositeTextSizes[1].evaluate(S,{},ne)],(Pe[0]>Hc||Pe[1]>Hc)&&Ci(`${c.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),c.addSymbols(c.text,ge,Pe,k,T,S,z,o,O.lineStartIndex,O.lineLength,J,ne);for(const ze of j)W[ze]=c.text.placedSymbolArray.length-1;return 4*ge.length}function wm(c){for(const o in c)return c[o];return null}function Ig(c,o,h,m){const b=c.compareText;if(o in b){const T=b[o];for(let S=T.length-1;S>=0;S--)if(m.dist(T[S])<h)return!0}else b[o]=[];return b[o].push(m),!1}const _y=za.VectorTileFeature.types,Pg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ff(c,o,h,m,b,T,S,k,O,z,j,W,J){const te=k?Math.min(Hc,Math.round(k[0])):0,ne=k?Math.min(Hc,Math.round(k[1])):0;c.emplaceBack(o,h,Math.round(32*m),Math.round(32*b),T,S,(te<<1)+(O?1:0),ne,16*z,16*j,256*W,256*J)}function pf(c,o,h){c.emplaceBack(o.x,o.y,h),c.emplaceBack(o.x,o.y,h),c.emplaceBack(o.x,o.y,h),c.emplaceBack(o.x,o.y,h)}function g0(c){for(const o of c.sections)if(Wp(o.text))return!0;return!1}class Em{constructor(o){this.layoutVertexArray=new Wr,this.indexArray=new Do,this.programConfigurations=o,this.segments=new On,this.dynamicLayoutVertexArray=new ma,this.opacityVertexArray=new Oa,this.placedSymbolArray=new it}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(o,h,m,b){this.isEmpty()||(m&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Ku.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,h),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,oy.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,Pg,!0),this.opacityVertexBuffer.itemSize=1),(m||b)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Dt("SymbolBuffers",Em);class mf{constructor(o,h,m){this.layoutVertexArray=new o,this.layoutAttributes=h,this.indexArray=new m,this.segments=new On,this.collisionVertexArray=new ga}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,um.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Dt("CollisionBuffers",mf);class eh{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(S=>S.id),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=jd([]),this.placementViewportMatrix=jd([]);const h=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Cg(this.zoom,h["text-size"]),this.iconSizeData=Cg(this.zoom,h["icon-size"]);const m=this.layers[0].layout,b=m.get("symbol-sort-key"),T=m.get("symbol-z-order");this.canOverlap="never"!==id(m,"text-overlap","text-allow-overlap")||"never"!==id(m,"icon-overlap","icon-allow-overlap")||m.get("text-ignore-placement")||m.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==T&&!b.isConstant(),this.sortFeaturesByY=("viewport-y"===T||"auto"===T&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===m.get("symbol-placement")&&(this.writingModes=m.get("text-writing-mode").map(S=>w.WritingMode[S])),this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id),this.sourceID=o.sourceID}createArrays(){this.text=new Em(new uo(this.layers,this.zoom,o=>/^text/.test(o))),this.icon=new Em(new uo(this.layers,this.zoom,o=>/^icon/.test(o))),this.glyphOffsetArray=new dt,this.lineVertexArray=new St,this.symbolInstances=new wt}calculateGlyphDependencies(o,h,m,b,T){for(let S=0;S<o.length;S++)if(h[o.charCodeAt(S)]=!0,(m||b)&&T){const k=Qh[o.charAt(S)];k&&(h[k.charCodeAt(0)]=!0)}}populate(o,h,m){const b=this.layers[0],T=b.layout,S=T.get("text-font"),k=T.get("text-field"),O=T.get("icon-image"),z=("constant"!==k.value.kind||k.value.value instanceof we&&!k.value.value.isEmpty()||k.value.value.toString().length>0)&&("constant"!==S.value.kind||S.value.value.length>0),j="constant"!==O.value.kind||!!O.value.value||Object.keys(O.parameters).length>0,W=T.get("symbol-sort-key");if(this.features=[],!z&&!j)return;const J=h.iconDependencies,te=h.glyphDependencies,ne=h.availableImages,ge=new li(this.zoom);for(const{feature:pe,id:Pe,index:ze,sourceLayerIndex:De}of o){const Oe=b._featureFilter.needGeometry,Ke=kc(pe,Oe);if(!b._featureFilter.filter(ge,Ke,m))continue;let Ze,Tt;if(Oe||(Ke.geometry=va(pe)),z){const bt=b.getValueAndResolveTokens("text-field",Ke,m,ne),ft=we.factory(bt);g0(ft)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Vl()||this.hasRTLText&&oo.isParsed())&&(Ze=ay(ft,b,Ke))}if(j){const bt=b.getValueAndResolveTokens("icon-image",Ke,m,ne);Tt=bt instanceof Ce?bt:Ce.fromString(bt)}if(!Ze&&!Tt)continue;const kt=this.sortFeaturesByKey?W.evaluate(Ke,{},m):void 0;if(this.features.push({id:Pe,text:Ze,icon:Tt,index:ze,sourceLayerIndex:De,geometry:Ke.geometry,properties:pe.properties,type:_y[pe.type],sortKey:kt}),Tt&&(J[Tt.name]=!0),Ze){const bt=S.evaluate(Ke,{},m).join(","),ft="viewport"!==T.get("text-rotation-alignment")&&"point"!==T.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(w.WritingMode.vertical)>=0;for(const ct of Ze.sections)if(ct.image)J[ct.image.name]=!0;else{const gt=mu(Ze.toString()),_t=ct.fontStack||bt,ot=te[_t]=te[_t]||{};this.calculateGlyphDependencies(ct.text,ot,ft,this.allowVerticalPlacement,gt)}}}"line"===T.get("symbol-placement")&&(this.features=function(pe){const Pe={},ze={},De=[];let Oe=0;function Ke(bt){De.push(pe[bt]),Oe++}function Ze(bt,ft,ct){const gt=ze[bt];return delete ze[bt],ze[ft]=gt,De[gt].geometry[0].pop(),De[gt].geometry[0]=De[gt].geometry[0].concat(ct[0]),gt}function Tt(bt,ft,ct){const gt=Pe[ft];return delete Pe[ft],Pe[bt]=gt,De[gt].geometry[0].shift(),De[gt].geometry[0]=ct[0].concat(De[gt].geometry[0]),gt}function kt(bt,ft,ct){const gt=ct?ft[0][ft[0].length-1]:ft[0][0];return`${bt}:${gt.x}:${gt.y}`}for(let bt=0;bt<pe.length;bt++){const ft=pe[bt],ct=ft.geometry,gt=ft.text?ft.text.toString():null;if(!gt){Ke(bt);continue}const _t=kt(gt,ct),ot=kt(gt,ct,!0);if(_t in ze&&ot in Pe&&ze[_t]!==Pe[ot]){const Vt=Tt(_t,ot,ct),Ot=Ze(_t,ot,De[Vt].geometry);delete Pe[_t],delete ze[ot],ze[kt(gt,De[Ot].geometry,!0)]=Ot,De[Vt].geometry=null}else _t in ze?Ze(_t,ot,ct):ot in Pe?Tt(_t,ot,ct):(Ke(bt),Pe[_t]=Oe-1,ze[ot]=Oe-1)}return De.filter(bt=>bt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((pe,Pe)=>pe.sortKey-Pe.sortKey)}update(o,h,m){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,h,this.layers,m),this.icon.programConfigurations.updatePaintArrays(o,h,this.layers,m))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,h){const m=this.lineVertexArray.length;if(void 0!==o.segment){let b=o.dist(h[o.segment+1]),T=o.dist(h[o.segment]);const S={};for(let k=o.segment+1;k<h.length;k++)S[k]={x:h[k].x,y:h[k].y,tileUnitDistanceFromAnchor:b},k<h.length-1&&(b+=h[k+1].dist(h[k]));for(let k=o.segment||0;k>=0;k--)S[k]={x:h[k].x,y:h[k].y,tileUnitDistanceFromAnchor:T},k>0&&(T+=h[k-1].dist(h[k]));for(let k=0;k<h.length;k++){const O=S[k];this.lineVertexArray.emplaceBack(O.x,O.y,O.tileUnitDistanceFromAnchor)}}return{lineStartIndex:m,lineLength:this.lineVertexArray.length-m}}addSymbols(o,h,m,b,T,S,k,O,z,j,W,J){const te=o.indexArray,ne=o.layoutVertexArray,ge=o.segments.prepareSegment(4*h.length,ne,te,this.canOverlap?S.sortKey:void 0),pe=this.glyphOffsetArray.length,Pe=ge.vertexLength,ze=this.allowVerticalPlacement&&k===w.WritingMode.vertical?Math.PI/2:0,De=S.text&&S.text.sections;for(let Oe=0;Oe<h.length;Oe++){const{tl:Ke,tr:Ze,bl:Tt,br:kt,tex:bt,pixelOffsetTL:ft,pixelOffsetBR:ct,minFontScaleX:gt,minFontScaleY:_t,glyphOffset:ot,isSDF:Vt,sectionIndex:Ot}=h[Oe],Bn=ge.vertexLength,or=ot[1];ff(ne,O.x,O.y,Ke.x,or+Ke.y,bt.x,bt.y,m,Vt,ft.x,ft.y,gt,_t),ff(ne,O.x,O.y,Ze.x,or+Ze.y,bt.x+bt.w,bt.y,m,Vt,ct.x,ft.y,gt,_t),ff(ne,O.x,O.y,Tt.x,or+Tt.y,bt.x,bt.y+bt.h,m,Vt,ft.x,ct.y,gt,_t),ff(ne,O.x,O.y,kt.x,or+kt.y,bt.x+bt.w,bt.y+bt.h,m,Vt,ct.x,ct.y,gt,_t),pf(o.dynamicLayoutVertexArray,O,ze),te.emplaceBack(Bn,Bn+1,Bn+2),te.emplaceBack(Bn+1,Bn+2,Bn+3),ge.vertexLength+=4,ge.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ot[0]),Oe!==h.length-1&&Ot===h[Oe+1].sectionIndex||o.programConfigurations.populatePaintArrays(ne.length,S,S.index,{},J,De&&De[Ot])}o.placedSymbolArray.emplaceBack(O.x,O.y,pe,this.glyphOffsetArray.length-pe,Pe,z,j,O.segment,m?m[0]:0,m?m[1]:0,b[0],b[1],k,0,!1,0,W)}_addCollisionDebugVertex(o,h,m,b,T,S){return h.emplaceBack(0,0),o.emplaceBack(m.x,m.y,b,T,Math.round(S.x),Math.round(S.y))}addCollisionDebugVertices(o,h,m,b,T,S,k){const O=T.segments.prepareSegment(4,T.layoutVertexArray,T.indexArray),z=O.vertexLength,j=T.layoutVertexArray,W=T.collisionVertexArray,J=k.anchorX,te=k.anchorY;this._addCollisionDebugVertex(j,W,S,J,te,new Zt(o,h)),this._addCollisionDebugVertex(j,W,S,J,te,new Zt(m,h)),this._addCollisionDebugVertex(j,W,S,J,te,new Zt(m,b)),this._addCollisionDebugVertex(j,W,S,J,te,new Zt(o,b)),O.vertexLength+=4;const ne=T.indexArray;ne.emplaceBack(z,z+1),ne.emplaceBack(z+1,z+2),ne.emplaceBack(z+2,z+3),ne.emplaceBack(z+3,z),O.primitiveLength+=4}addDebugCollisionBoxes(o,h,m,b){for(let T=o;T<h;T++){const S=this.collisionBoxArray.get(T);this.addCollisionDebugVertices(S.x1,S.y1,S.x2,S.y2,b?this.textCollisionBox:this.iconCollisionBox,S.anchorPoint,m)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new mf(ol,Jh.members,wr),this.iconCollisionBox=new mf(ol,Jh.members,wr);for(let o=0;o<this.symbolInstances.length;o++){const h=this.symbolInstances.get(o);this.addDebugCollisionBoxes(h.textBoxStartIndex,h.textBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.iconBoxStartIndex,h.iconBoxEndIndex,h,!1),this.addDebugCollisionBoxes(h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h,!1)}}_deserializeCollisionBoxesForSymbol(o,h,m,b,T,S,k,O,z){const j={};for(let W=h;W<m;W++){const J=o.get(W);j.textBox={x1:J.x1,y1:J.y1,x2:J.x2,y2:J.y2,anchorPointX:J.anchorPointX,anchorPointY:J.anchorPointY},j.textFeatureIndex=J.featureIndex;break}for(let W=b;W<T;W++){const J=o.get(W);j.verticalTextBox={x1:J.x1,y1:J.y1,x2:J.x2,y2:J.y2,anchorPointX:J.anchorPointX,anchorPointY:J.anchorPointY},j.verticalTextFeatureIndex=J.featureIndex;break}for(let W=S;W<k;W++){const J=o.get(W);j.iconBox={x1:J.x1,y1:J.y1,x2:J.x2,y2:J.y2,anchorPointX:J.anchorPointX,anchorPointY:J.anchorPointY},j.iconFeatureIndex=J.featureIndex;break}for(let W=O;W<z;W++){const J=o.get(W);j.verticalIconBox={x1:J.x1,y1:J.y1,x2:J.x2,y2:J.y2,anchorPointX:J.anchorPointX,anchorPointY:J.anchorPointY},j.verticalIconFeatureIndex=J.featureIndex;break}return j}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let h=0;h<this.symbolInstances.length;h++){const m=this.symbolInstances.get(h);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,m.textBoxStartIndex,m.textBoxEndIndex,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m.iconBoxStartIndex,m.iconBoxEndIndex,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(o,h){const m=o.placedSymbolArray.get(h),b=m.vertexStartIndex+4*m.numGlyphs;for(let T=m.vertexStartIndex;T<b;T+=4)o.indexArray.emplaceBack(T,T+1,T+2),o.indexArray.emplaceBack(T+1,T+2,T+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const h=Math.sin(o),m=Math.cos(o),b=[],T=[],S=[];for(let k=0;k<this.symbolInstances.length;++k){S.push(k);const O=this.symbolInstances.get(k);b.push(0|Math.round(h*O.anchorX+m*O.anchorY)),T.push(O.featureIndex)}return S.sort((k,O)=>b[k]-b[O]||T[O]-T[k]),S}addToSortKeyRanges(o,h){const m=this.sortKeyRanges[this.sortKeyRanges.length-1];m&&m.sortKey===h?m.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:h,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const h of this.symbolInstanceIndexes){const m=this.symbolInstances.get(h);this.featureSortOrder.push(m.featureIndex),[m.rightJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.leftJustifiedTextSymbolIndex].forEach((b,T,S)=>{b>=0&&S.indexOf(b)===T&&this.addIndicesForPlacedSymbol(this.text,b)}),m.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,m.verticalPlacedTextSymbolIndex),m.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.placedIconSymbolIndex),m.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Dt("SymbolBucket",eh,{omit:["layers","collisionBoxArray","features","compareText"]}),eh.MAX_GLYPHS=65535,eh.addDynamicAttributes=pf;const kg=new zi({"symbol-placement":new Pt(He.layout_symbol["symbol-placement"]),"symbol-spacing":new Pt(He.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Pt(He.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new mt(He.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Pt(He.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Pt(He.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Pt(He.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Pt(He.layout_symbol["icon-ignore-placement"]),"icon-optional":new Pt(He.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Pt(He.layout_symbol["icon-rotation-alignment"]),"icon-size":new mt(He.layout_symbol["icon-size"]),"icon-text-fit":new Pt(He.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Pt(He.layout_symbol["icon-text-fit-padding"]),"icon-image":new mt(He.layout_symbol["icon-image"]),"icon-rotate":new mt(He.layout_symbol["icon-rotate"]),"icon-padding":new mt(He.layout_symbol["icon-padding"]),"icon-keep-upright":new Pt(He.layout_symbol["icon-keep-upright"]),"icon-offset":new mt(He.layout_symbol["icon-offset"]),"icon-anchor":new mt(He.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Pt(He.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Pt(He.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Pt(He.layout_symbol["text-rotation-alignment"]),"text-field":new mt(He.layout_symbol["text-field"]),"text-font":new mt(He.layout_symbol["text-font"]),"text-size":new mt(He.layout_symbol["text-size"]),"text-max-width":new mt(He.layout_symbol["text-max-width"]),"text-line-height":new Pt(He.layout_symbol["text-line-height"]),"text-letter-spacing":new mt(He.layout_symbol["text-letter-spacing"]),"text-justify":new mt(He.layout_symbol["text-justify"]),"text-radial-offset":new mt(He.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Pt(He.layout_symbol["text-variable-anchor"]),"text-anchor":new mt(He.layout_symbol["text-anchor"]),"text-max-angle":new Pt(He.layout_symbol["text-max-angle"]),"text-writing-mode":new Pt(He.layout_symbol["text-writing-mode"]),"text-rotate":new mt(He.layout_symbol["text-rotate"]),"text-padding":new Pt(He.layout_symbol["text-padding"]),"text-keep-upright":new Pt(He.layout_symbol["text-keep-upright"]),"text-transform":new mt(He.layout_symbol["text-transform"]),"text-offset":new mt(He.layout_symbol["text-offset"]),"text-allow-overlap":new Pt(He.layout_symbol["text-allow-overlap"]),"text-overlap":new Pt(He.layout_symbol["text-overlap"]),"text-ignore-placement":new Pt(He.layout_symbol["text-ignore-placement"]),"text-optional":new Pt(He.layout_symbol["text-optional"])});var Gc={paint:new zi({"icon-opacity":new mt(He.paint_symbol["icon-opacity"]),"icon-color":new mt(He.paint_symbol["icon-color"]),"icon-halo-color":new mt(He.paint_symbol["icon-halo-color"]),"icon-halo-width":new mt(He.paint_symbol["icon-halo-width"]),"icon-halo-blur":new mt(He.paint_symbol["icon-halo-blur"]),"icon-translate":new Pt(He.paint_symbol["icon-translate"]),"icon-translate-anchor":new Pt(He.paint_symbol["icon-translate-anchor"]),"text-opacity":new mt(He.paint_symbol["text-opacity"]),"text-color":new mt(He.paint_symbol["text-color"],{runtimeType:Pr,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new mt(He.paint_symbol["text-halo-color"]),"text-halo-width":new mt(He.paint_symbol["text-halo-width"]),"text-halo-blur":new mt(He.paint_symbol["text-halo-blur"]),"text-translate":new Pt(He.paint_symbol["text-translate"]),"text-translate-anchor":new Pt(He.paint_symbol["text-translate-anchor"])}),layout:kg};class Rg{constructor(o){if(void 0===o.property.overrides)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=o.property.overrides?o.property.overrides.runtimeType:Go,this.defaultValue=o}evaluate(o){if(o.formattedSection){const h=this.defaultValue.property.overrides;if(h&&h.hasOverride(o.formattedSection))return h.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Dt("FormatSectionOverride",Rg,{omit:["defaultValue"]});class nd extends ao{constructor(o){super(o,Gc)}recalculate(o,h){if(super.recalculate(o,h),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]="map"===this.layout.get("text-rotation-alignment")?"map":"viewport"),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){const m=this.layout.get("text-writing-mode");if(m){const b=[];for(const T of m)b.indexOf(T)<0&&b.push(T);this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(o,h,m,b){const T=this.layout.get(o).evaluate(h,{},m,b),S=this._unevaluatedLayout._values[o];return S.isDataDriven()||xs(S.value)||!T?T:(k=h.properties,T.replace(/{([^{}]+)}/g,(z,j)=>j in k?String(k[j]):""));var k}createBucket(o){return new eh(o)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const o of Gc.paint.overridableProperties){if(!nd.hasPaintOverride(this.layout,o))continue;const h=this.paint.get(o),m=new Rg(h),b=new Rl(m,h.property.specification);let T=null;T="constant"===h.value.kind||"source"===h.value.kind?new xt("source",b):new Dn("composite",b,h.value.zoomStops),this.paint._values[o]=new Ra(h.property,T,h.parameters)}}_handleOverridablePaintPropertyUpdate(o,h,m){return!(!this.layout||h.isDataDriven()||m.isDataDriven())&&nd.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,h){const m=o.get("text-field"),b=Gc.paint.properties[h];let T=!1;const S=k=>{for(const O of k)if(b.overrides&&b.overrides.hasOverride(O))return void(T=!0)};if("constant"===m.value.kind&&m.value.value instanceof we)S(m.value.value.sections);else if("source"===m.value.kind){const k=z=>{T||(z instanceof Mt&&Ve(z.value)===zr?S(z.value.sections):z instanceof Mh?S(z.sections):z.eachChild(k))},O=m.value;O._styleExpression&&k(O._styleExpression.expression)}return T}}function id(c,o,h){let m="never";const b=c.get(o);return b?m=b:c.get(h)&&(m="always"),m}var Tm={paint:new zi({"background-color":new Pt(He.paint_background["background-color"]),"background-pattern":new $u(He.paint_background["background-pattern"]),"background-opacity":new Pt(He.paint_background["background-opacity"])})},lp={paint:new zi({"raster-opacity":new Pt(He.paint_raster["raster-opacity"]),"raster-hue-rotate":new Pt(He.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Pt(He.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Pt(He.paint_raster["raster-brightness-max"]),"raster-saturation":new Pt(He.paint_raster["raster-saturation"]),"raster-contrast":new Pt(He.paint_raster["raster-contrast"]),"raster-resampling":new Pt(He.paint_raster["raster-resampling"]),"raster-fade-duration":new Pt(He.paint_raster["raster-fade-duration"])})};class cp extends ao{constructor(o){super(o,{}),this.onAdd=h=>{this.implementation.onAdd&&this.implementation.onAdd(h,h.painter.context.gl)},this.onRemove=h=>{this.implementation.onRemove&&this.implementation.onRemove(h,h.painter.context.gl)},this.implementation=o}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const rd={circle:class extends ao{constructor(c){super(c,Zp)}createBucket(c){return new fg(c)}queryRadius(c){const o=c;return zh("circle-radius",this,o)+zh("circle-stroke-width",this,o)+Vd(this.paint.get("circle-translate"))}queryIntersectsFeature(c,o,h,m,b,T,S,k){const O=Ud(c,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),T.angle,S),z=this.paint.get("circle-radius").evaluate(o,h)+this.paint.get("circle-stroke-width").evaluate(o,h),j="map"===this.paint.get("circle-pitch-alignment"),W=j?O:(ne=k,O.map(ge=>Vh(ge,ne))),J=j?z*S:z;var ne;for(const te of m)for(const ne of te){const ge=j?ne:Vh(ne,k);let pe=J;const Pe=Gf([],[ne.x,ne.y,0,1],k);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?pe*=Pe[3]/T.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(pe*=T.cameraToCenterDistance/Pe[3]),pg(W,ge,pe))return!0}return!1}},heatmap:class extends ao{constructor(c){super(c,Zu),this._updateColorRamp()}createBucket(c){return new Lc(c)}_handleSpecialPaintPropertyUpdate(c){"heatmap-color"===c&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=gg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}},hillshade:class extends ao{constructor(c){super(c,Lt)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}},fill:class extends ao{constructor(c){super(c,sy)}recalculate(c,o){super.recalculate(c,o);const h=this.paint._values["fill-outline-color"];"constant"===h.value.kind&&void 0===h.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new bu(c)}queryRadius(){return Vd(this.paint.get("fill-translate"))}queryIntersectsFeature(c,o,h,m,b,T,S){return Bh(Ud(c,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),T.angle,S),m)}isTileClipped(){return!0}},"fill-extrusion":class extends ao{constructor(c){super(c,Zh)}createBucket(c){return new Kd(c)}queryRadius(){return Vd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(c,o,h,m,b,T,S,k){const O=Ud(c,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),T.angle,S),z=this.paint.get("fill-extrusion-height").evaluate(o,h),j=this.paint.get("fill-extrusion-base").evaluate(o,h),W=function(te,ne,ge,pe){const Pe=[];for(const ze of te){const De=[ze.x,ze.y,0,1];Gf(De,De,ne),Pe.push(new Zt(De[0]/De[3],De[1]/De[3]))}return Pe}(O,k),J=function(te,ne,ge,pe){const Pe=[],ze=[],De=pe[8]*ne,Oe=pe[9]*ne,Ke=pe[10]*ne,Ze=pe[11]*ne,Tt=pe[8]*ge,kt=pe[9]*ge,bt=pe[10]*ge,ft=pe[11]*ge;for(const ct of te){const gt=[],_t=[];for(const ot of ct){const Vt=ot.x,Ot=ot.y,Bn=pe[0]*Vt+pe[4]*Ot+pe[12],or=pe[1]*Vt+pe[5]*Ot+pe[13],ar=pe[2]*Vt+pe[6]*Ot+pe[14],hs=pe[3]*Vt+pe[7]*Ot+pe[15],Va=ar+Ke,Vi=hs+Ze,Fr=Bn+Tt,ds=or+kt,Ss=ar+bt,Ui=hs+ft,Bs=new Zt((Bn+De)/Vi,(or+Oe)/Vi);Bs.z=Va/Vi,gt.push(Bs);const qr=new Zt(Fr/Ui,ds/Ui);qr.z=Ss/Ui,_t.push(qr)}Pe.push(gt),ze.push(_t)}return[Pe,ze]}(m,j,z,k);return function(te,ne,ge){let pe=1/0;Bh(ge,ne)&&(pe=am(ge,ne[0]));for(let Pe=0;Pe<ne.length;Pe++){const ze=ne[Pe],De=te[Pe];for(let Oe=0;Oe<ze.length-1;Oe++){const Ke=ze[Oe],Ze=[Ke,ze[Oe+1],De[Oe+1],De[Oe],Ke];Nd(ge,Ze)&&(pe=Math.min(pe,am(ge,Ze)))}}return pe!==1/0&&pe}(J[0],J[1],W)}},line:class extends ao{constructor(c){super(c,dn),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(c){"line-gradient"===c&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Fe,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(c,o){super.recalculate(c,o),this.paint._values["line-floorwidth"]=Qd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new Kh(c)}queryRadius(c){const o=c,h=cm(zh("line-width",this,o),zh("line-gap-width",this,o)),m=zh("line-offset",this,o);return h/2+Math.abs(m)+Vd(this.paint.get("line-translate"))}queryIntersectsFeature(c,o,h,m,b,T,S){const k=Ud(c,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),T.angle,S),O=S/2*cm(this.paint.get("line-width").evaluate(o,h),this.paint.get("line-gap-width").evaluate(o,h)),z=this.paint.get("line-offset").evaluate(o,h);return z&&(m=function(j,W){const J=[];for(let te=0;te<j.length;te++){const ne=j[te],ge=[];for(let pe=0;pe<ne.length;pe++){const Pe=ne[pe-1],ze=ne[pe],De=ne[pe+1],Oe=0===pe?new Zt(0,0):ze.sub(Pe)._unit()._perp(),Ke=pe===ne.length-1?new Zt(0,0):De.sub(ze)._unit()._perp(),Ze=Oe._add(Ke)._unit(),Tt=Ze.x*Ke.x+Ze.y*Ke.y;0!==Tt&&Ze._mult(1/Tt),ge.push(Ze._mult(W)._add(ze))}J.push(ge)}return J}(m,z*S)),function(j,W,J){for(let te=0;te<W.length;te++){const ne=W[te];if(j.length>=3)for(let ge=0;ge<ne.length;ge++)if(jl(j,ne[ge]))return!0;if(Ul(j,ne,J))return!0}return!1}(k,m,O)}isTileClipped(){return!0}},symbol:nd,background:class extends ao{constructor(c){super(c,Tm)}},raster:class extends ao{constructor(c){super(c,lp)}}};class Lg{constructor(o){this._callback=o,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const up=6371008.8;class Or{constructor(o,h){if(isNaN(o)||isNaN(h))throw new Error(`Invalid LngLat object: (${o}, ${h})`);if(this.lng=+o,this.lat=+h,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Or(wn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const h=Math.PI/180,m=this.lat*h,b=o.lat*h,T=Math.sin(m)*Math.sin(b)+Math.cos(m)*Math.cos(b)*Math.cos((o.lng-this.lng)*h);return up*Math.acos(Math.min(T,1))}toBounds(o=0){const h=360*o/40075017,m=h/Math.cos(Math.PI/180*this.lat);return new th(new Or(this.lng-m,this.lat-h),new Or(this.lng+m,this.lat+h))}static convert(o){if(o instanceof Or)return o;if(Array.isArray(o)&&(2===o.length||3===o.length))return new Or(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&"object"==typeof o&&null!==o)return new Or(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class th{constructor(o,h){o&&(h?this.setSouthWest(o).setNorthEast(h):4===o.length?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1]))}setNorthEast(o){return this._ne=o instanceof Or?new Or(o.lng,o.lat):Or.convert(o),this}setSouthWest(o){return this._sw=o instanceof Or?new Or(o.lng,o.lat):Or.convert(o),this}extend(o){const h=this._sw,m=this._ne;let b,T;if(o instanceof Or)b=o,T=o;else{if(!(o instanceof th))return Array.isArray(o)?4===o.length||o.every(Array.isArray)?this.extend(th.convert(o)):this.extend(Or.convert(o)):this;if(b=o._sw,T=o._ne,!b||!T)return this}return h||m?(h.lng=Math.min(b.lng,h.lng),h.lat=Math.min(b.lat,h.lat),m.lng=Math.max(T.lng,m.lng),m.lat=Math.max(T.lat,m.lat)):(this._sw=new Or(b.lng,b.lat),this._ne=new Or(T.lng,T.lat)),this}getCenter(){return new Or((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Or(this.getWest(),this.getNorth())}getSouthEast(){return new Or(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:h,lat:m}=Or.convert(o);let b=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(b=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&b}static convert(o){return o instanceof th?o:o&&new th(o)}}const Cm=2*Math.PI*up;function nh(c){return Cm*Math.cos(c*Math.PI/180)}function Sm(c){return(180+c)/360}function Og(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function gf(c,o){return c/nh(o)}function Mm(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}class sd{constructor(o,h,m=0){this.x=+o,this.y=+h,this.z=+m}static fromLngLat(o,h=0){const m=Or.convert(o);return new sd(Sm(m.lng),Og(m.lat),gf(h,m.lat))}toLngLat(){return new Or(360*this.x-180,Mm(this.y))}toAltitude(){return this.z*nh(Mm(this.y))}meterInMercatorCoordinateUnits(){return 1/Cm*(o=Mm(this.y),1/Math.cos(o*Math.PI/180));var o}}function Fg(c,o,h){var m=2*Math.PI*6378137/256/Math.pow(2,h);return[c*m-2*Math.PI*6378137/2,o*m-2*Math.PI*6378137/2]}class hp{constructor(o,h,m){if(o<0||o>25||m<0||m>=Math.pow(2,o)||h<0||h>=Math.pow(2,o))throw new Error(`x=${h}, y=${m}, z=${o} outside of bounds. 0<=x<${Math.pow(2,o)}, 0<=y<${Math.pow(2,o)} 0<=z<=25 `);this.z=o,this.x=h,this.y=m,this.key=dp(0,o,o,h,m)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,h,m){const b=(S=this.y,k=this.z,O=Fg(256*(T=this.x),256*(S=Math.pow(2,k)-S-1),k),z=Fg(256*(T+1),256*(S+1),k),O[0]+","+O[1]+","+z[0]+","+z[1]);var T,S,k,O,z;const j=function(W,J,te){let ne,ge="";for(let pe=W;pe>0;pe--)ne=1<<pe-1,ge+=(J&ne?1:0)+(te&ne?2:0);return ge}(this.z,this.x,this.y);return o[(this.x+this.y)%o.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===m?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,h>1?"@2x":"").replace(/{quadkey}/g,j).replace(/{bbox-epsg-3857}/g,b)}isChildOf(o){const h=this.z-o.z;return h>0&&o.x===this.x>>h&&o.y===this.y>>h}getTilePoint(o){const h=Math.pow(2,this.z);return new Zt((o.x*h-this.x)*rr,(o.y*h-this.y)*rr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ng{constructor(o,h){this.wrap=o,this.canonical=h,this.key=dp(o,h.z,h.z,h.x,h.y)}}class wa{constructor(o,h,m,b,T){if(o<m)throw new Error(`overscaledZ should be >= z; overscaledZ = ${o}; z = ${m}`);this.overscaledZ=o,this.wrap=h,this.canonical=new hp(m,+b,+T),this.key=dp(h,o,m,b,T)}clone(){return new wa(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){if(o>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${o}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-o;return o>this.canonical.z?new wa(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new wa(o,this.wrap,o,this.canonical.x>>h,this.canonical.y>>h)}calculateScaledKey(o,h){if(o>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${o}; overscaledZ = ${this.overscaledZ}`);const m=this.canonical.z-o;return o>this.canonical.z?dp(this.wrap*+h,o,this.canonical.z,this.canonical.x,this.canonical.y):dp(this.wrap*+h,o,o,this.canonical.x>>m,this.canonical.y>>m)}isChildOf(o){if(o.wrap!==this.wrap)return!1;const h=this.canonical.z-o.canonical.z;return 0===o.overscaledZ||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>h&&o.canonical.y===this.canonical.y>>h}children(o){if(this.overscaledZ>=o)return[new wa(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const h=this.canonical.z+1,m=2*this.canonical.x,b=2*this.canonical.y;return[new wa(h,this.wrap,h,m,b),new wa(h,this.wrap,h,m+1,b),new wa(h,this.wrap,h,m,b+1),new wa(h,this.wrap,h,m+1,b+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new wa(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new wa(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ng(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(o){return this.canonical.getTilePoint(new sd(o.x-this.wrap,o.y))}}function dp(c,o,h,m,b){(c*=2)<0&&(c=-1*c-1);const T=1<<h;return(T*T*c+T*b+m).toString(36)+h.toString(36)+o.toString(36)}Dt("CanonicalTileID",hp),Dt("OverscaledTileID",wa,{omit:["posMatrix"]});class Bg{constructor(o,h,m){if(this.uid=o,h.height!==h.width)throw new RangeError("DEM tiles must be square");if(m&&"mapbox"!==m&&"terrarium"!==m)return void Ci(`"${m}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=h.height;const b=this.dim=h.height-2;this.data=new Uint32Array(h.data.buffer),this.encoding=m||"mapbox";for(let T=0;T<b;T++)this.data[this._idx(-1,T)]=this.data[this._idx(0,T)],this.data[this._idx(b,T)]=this.data[this._idx(b-1,T)],this.data[this._idx(T,-1)]=this.data[this._idx(T,0)],this.data[this._idx(T,b)]=this.data[this._idx(T,b-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(b,-1)]=this.data[this._idx(b-1,0)],this.data[this._idx(-1,b)]=this.data[this._idx(0,b-1)],this.data[this._idx(b,b)]=this.data[this._idx(b-1,b-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let T=0;T<b;T++)for(let S=0;S<b;S++){const k=this.get(T,S);k>this.max&&(this.max=k),k<this.min&&(this.min=k)}}get(o,h){const m=new Uint8Array(this.data.buffer),b=4*this._idx(o,h);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(m[b],m[b+1],m[b+2])}getUnpackVector(){return"terrarium"===this.encoding?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(o,h){if(o<-1||o>=this.dim+1||h<-1||h>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(h+1)*this.stride+(o+1)}_unpackMapbox(o,h,m){return(256*o*256+256*h+m)/10-1e4}_unpackTerrarium(o,h,m){return 256*o+h+m/256-32768}getPixels(){return new cl({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(o,h,m){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let b=h*this.dim,T=h*this.dim+this.dim,S=m*this.dim,k=m*this.dim+this.dim;switch(h){case-1:b=T-1;break;case 1:T=b+1}switch(m){case-1:S=k-1;break;case 1:k=S+1}const O=-h*this.dim,z=-m*this.dim;for(let j=S;j<k;j++)for(let W=b;W<T;W++)this.data[this._idx(W,j)]=o.data[this._idx(W+O,j+z)]}}Dt("DEMData",Bg);class od{constructor(o){this._stringToNumber={},this._numberToString=[];for(let h=0;h<o.length;h++){const m=o[h];this._stringToNumber[m]=h,this._numberToString[h]=m}}encode(o){return this._stringToNumber[o]}decode(o){if(o>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${o} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[o]}}class zg{constructor(o,h,m,b,T){this.type="Feature",this._vectorTileFeature=o,o._z=h,o._x=m,o._y=b,this.properties=o.properties,this.id=T}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={geometry:this.geometry};for(const h in this)"_geometry"!==h&&"_vectorTileFeature"!==h&&(o[h]=this[h]);return o}}class ih{constructor(o,h){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new Bi(rr,16,0),this.grid3D=new Bi(rr,16,0),this.featureIndexArray=new Pn,this.promoteId=h}insert(o,h,m,b,T,S){const k=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(m,b,T);const O=S?this.grid3D:this.grid;for(let z=0;z<h.length;z++){const j=h[z],W=[1/0,1/0,-1/0,-1/0];for(let J=0;J<j.length;J++){const te=j[J];W[0]=Math.min(W[0],te.x),W[1]=Math.min(W[1],te.y),W[2]=Math.max(W[2],te.x),W[3]=Math.max(W[3],te.y)}W[0]<rr&&W[1]<rr&&W[2]>=0&&W[3]>=0&&O.insert(k,W[0],W[1],W[2],W[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new za.VectorTile(new Kf(this.rawTileData)).layers,this.sourceLayerCoder=new od(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(o,h,m,b){this.loadVTLayers();const T=o.params||{},S=rr/o.tileSize/o.scale,k=fu(T.filter),O=o.queryGeometry,z=o.queryPadding*S,j=Vg(O),W=this.grid.query(j.minX-z,j.minY-z,j.maxX+z,j.maxY+z),J=Vg(o.cameraQueryGeometry),te=this.grid3D.query(J.minX-z,J.minY-z,J.maxX+z,J.maxY+z,(pe,Pe,ze,De)=>function(Oe,Ke,Ze,Tt,kt){for(const ft of Oe)if(Ke<=ft.x&&Ze<=ft.y&&Tt>=ft.x&&kt>=ft.y)return!0;const bt=[new Zt(Ke,Ze),new Zt(Ke,kt),new Zt(Tt,kt),new Zt(Tt,Ze)];if(Oe.length>2)for(const ft of bt)if(jl(Oe,ft))return!0;for(let ft=0;ft<Oe.length-1;ft++)if(mg(Oe[ft],Oe[ft+1],bt))return!0;return!1}(o.cameraQueryGeometry,pe-z,Pe-z,ze+z,De+z));for(const pe of te)W.push(pe);W.sort(_0);const ne={};let ge;for(let pe=0;pe<W.length;pe++){const Pe=W[pe];if(Pe===ge)continue;ge=Pe;const ze=this.featureIndexArray.get(Pe);let De=null;this.loadMatchingFeature(ne,ze.bucketIndex,ze.sourceLayerIndex,ze.featureIndex,k,T.layers,T.availableImages,h,m,b,(Oe,Ke,Ze)=>(De||(De=va(Oe)),Ke.queryIntersectsFeature(O,Oe,Ze,De,this.z,o.transform,S,o.pixelPosMatrix)))}return ne}loadMatchingFeature(o,h,m,b,T,S,k,O,z,j,W){const J=this.bucketLayerIDs[h];if(S&&!function(pe,Pe){for(let ze=0;ze<pe.length;ze++)if(Pe.indexOf(pe[ze])>=0)return!0;return!1}(S,J))return;const te=this.sourceLayerCoder.decode(m),ne=this.vtLayers[te].feature(b);if(T.needGeometry){const pe=kc(ne,!0);if(!T.filter(new li(this.tileID.overscaledZ),pe,this.tileID.canonical))return}else if(!T.filter(new li(this.tileID.overscaledZ),ne))return;const ge=this.getId(ne,te);for(let pe=0;pe<J.length;pe++){const Pe=J[pe];if(S&&S.indexOf(Pe)<0)continue;const ze=O[Pe];if(!ze)continue;let De={};ge&&j&&(De=j.getState(ze.sourceLayer||"_geojsonTileLayer",ge));const Oe=sn({},z[Pe]);Oe.paint=us(Oe.paint,ze.paint,ne,De,k),Oe.layout=us(Oe.layout,ze.layout,ne,De,k);const Ke=!W||W(ne,ze,De);if(!Ke)continue;const Ze=new zg(ne,this.z,this.x,this.y,ge);Ze.layer=Oe;let Tt=o[Pe];void 0===Tt&&(Tt=o[Pe]=[]),Tt.push({featureIndex:b,feature:Ze,intersectionZ:Ke})}}lookupSymbolFeatures(o,h,m,b,T,S,k,O){const z={};this.loadVTLayers();const j=fu(T);for(const W of o)this.loadMatchingFeature(z,m,b,W,j,S,k,O,h);return z}hasLayer(o){for(const h of this.bucketLayerIDs)for(const m of h)if(o===m)return!0;return!1}getId(o,h){let m=o.id;return this.promoteId&&(m=o.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[h]],"boolean"==typeof m&&(m=Number(m))),m}}function us(c,o,h,m,b){return di(c,(T,S)=>{const k=o instanceof Rh?o.get(S):null;return k&&k.evaluate?k.evaluate(h,m,b):k})}function Vg(c){let o=1/0,h=1/0,m=-1/0,b=-1/0;for(const T of c)o=Math.min(o,T.x),h=Math.min(h,T.y),m=Math.max(m,T.x),b=Math.max(b,T.y);return{minX:o,minY:h,maxX:m,maxY:b}}function _0(c,o){return o-c}var rh;Dt("FeatureIndex",ih,{omit:["rawTileData","sourceLayerCoder"]}),w.PerformanceMarkers=void 0,(rh=w.PerformanceMarkers||(w.PerformanceMarkers={})).create="create",rh.load="load",rh.fullLoad="fullLoad";let _c=null,ad=[];const fp=1e3/30,ld={mark(c){performance.mark(c)},frame(c){const o=c;null!=_c&&ad.push(o-_c),_c=o},clearMetrics(){_c=null,ad=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const c in w.PerformanceMarkers)performance.clearMarks(w.PerformanceMarkers[c])},getPerformanceMetrics(){performance.measure("loadTime",w.PerformanceMarkers.create,w.PerformanceMarkers.load),performance.measure("fullLoadTime",w.PerformanceMarkers.create,w.PerformanceMarkers.fullLoad);const c=performance.getEntriesByName("loadTime")[0].duration,o=performance.getEntriesByName("fullLoadTime")[0].duration,h=ad.length,m=1/(ad.reduce((T,S)=>T+S,0)/h/1e3),b=ad.filter(T=>T>fp).reduce((T,S)=>T+(S-fp)/fp,0);return{loadTime:c,fullLoadTime:o,fps:m,percentDroppedFrames:b/(h+b)*100}}};w.AJAXError=bi,w.ARRAY_TYPE=Jr,w.Actor=class{constructor(c,o,h){this.target=c,this.parent=o,this.mapId=h,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Mn(["receive","process"],this),this.invoker=new Lg(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=hr()?c:window}send(c,o,h,m,b=!1){const T=Math.round(1e18*Math.random()).toString(36).substring(0,10);h&&(this.callbacks[T]=h);const S=wo(this.globalScope)?void 0:[];return this.target.postMessage({id:T,type:c,hasCallback:!!h,targetMapId:m,mustQueue:b,sourceMapId:this.mapId,data:Bl(o,S)},S),{cancel:()=>{h&&delete this.callbacks[T],this.target.postMessage({id:T,type:"<cancel>",targetMapId:m,sourceMapId:this.mapId})}}}receive(c){const o=c.data,h=o.id;if(h&&(!o.targetMapId||this.mapId===o.targetMapId))if("<cancel>"===o.type){delete this.tasks[h];const m=this.cancelCallbacks[h];delete this.cancelCallbacks[h],m&&m()}else hr()||o.mustQueue?(this.tasks[h]=o,this.taskQueue.push(h),this.invoker.trigger()):this.processTask(h,o)}process(){if(!this.taskQueue.length)return;const c=this.taskQueue.shift(),o=this.tasks[c];delete this.tasks[c],this.taskQueue.length&&this.invoker.trigger(),o&&this.processTask(c,o)}processTask(c,o){if("<response>"===o.type){const h=this.callbacks[c];delete this.callbacks[c],h&&(o.error?h(Cc(o.error)):h(null,Cc(o.data)))}else{let h=!1;const m=wo(this.globalScope)?void 0:[],b=o.hasCallback?(k,O)=>{h=!0,delete this.cancelCallbacks[c],this.target.postMessage({id:c,type:"<response>",sourceMapId:this.mapId,error:k?Bl(k):null,data:Bl(O,m)},m)}:k=>{h=!0};let T=null;const S=Cc(o.data);if(this.parent[o.type])T=this.parent[o.type](o.sourceMapId,S,b);else if(this.parent.getWorkerSource){const k=o.type.split(".");T=this.parent.getWorkerSource(o.sourceMapId,k[0],S.source)[k[1]](S,b)}else b(new Error(`Could not find function ${o.type}`));!h&&T&&T.cancel&&(this.cancelCallbacks[c]=T.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},w.AlphaImage=Tn,w.CanonicalTileID=hp,w.CollisionBoxArray=We,w.CollisionCircleLayoutArray=class extends H{},w.Color=re,w.DEMData=Bg,w.DataConstantProperty=Pt,w.DictionaryCoder=od,w.EXTENT=rr,w.ErrorEvent=Ya,w.EvaluationParameters=li,w.Event=dr,w.Evented=Ka,w.FeatureIndex=ih,w.FillBucket=bu,w.FillExtrusionBucket=Kd,w.GeoJSONFeature=zg,w.ImageAtlas=nf,w.ImagePosition=ep,w.LineBucket=Kh,w.LineStripIndexArray=class extends fe{},w.LngLat=Or,w.LngLatBounds=th,w.MercatorCoordinate=sd,w.ONE_EM=24,w.OverscaledTileID=wa,w.PerformanceUtils=ld,w.PosArray=Ht,w.Properties=zi,w.QuadTriangleArray=class extends Q{},w.RGBAImage=cl,w.RasterBoundsArray=class extends v{},w.RequestPerformance=class{constructor(c){this._marks={start:[c.url,"start"].join("#"),end:[c.url,"end"].join("#"),measure:c.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let c=performance.getEntriesByName(this._marks.measure);return 0===c.length&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),c=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),c}},w.ResourceType=Mr,w.SegmentVector=On,w.SymbolBucket=eh,w.Transitionable=Ac,w.TriangleIndexArray=Do,w.Uniform1f=ya,w.Uniform1i=class extends co{constructor(c,o){super(c,o),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}},w.Uniform2f=class extends co{constructor(c,o){super(c,o),this.current=[0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))}},w.Uniform3f=class extends co{constructor(c,o){super(c,o),this.current=[0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))}},w.Uniform4f=dc,w.UniformColor=Dc,w.UniformMatrix4f=class extends co{constructor(c,o){super(c,o),this.current=Lh}set(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let o=1;o<16;o++)if(c[o]!==this.current[o]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}},w.UnwrappedTileID=Ng,w.ValidationError=pt,w.ZoomHistory=Sc,w.add=function(c,o,h){return c[0]=o[0]+h[0],c[1]=o[1]+h[1],c[2]=o[2]+h[2],c},w.addDynamicAttributes=pf,w.asyncAll=function(c,o,h){if(!c.length)return h(null,[]);let m=c.length;const b=new Array(c.length);let T=null;c.forEach((S,k)=>{o(S,(O,z)=>{O&&(T=O),b[k]=z,0==--m&&h(T,b)})})},w.bezier=yi,w.bindAll=Mn,w.cacheEntryPossiblyAdded=function(c){Fi++,Fi>aa&&(c.getActor().send("enforceCacheSizeLimit",tc),Fi=0)},w.clamp=Ne,w.clearTileCache=function(c){const o=caches.delete(Eo);c&&o.catch(c).then(()=>c())},w.clipLine=vm,w.clone=function(c){var o=new Jr(16);return o[0]=c[0],o[1]=c[1],o[2]=c[2],o[3]=c[3],o[4]=c[4],o[5]=c[5],o[6]=c[6],o[7]=c[7],o[8]=c[8],o[9]=c[9],o[10]=c[10],o[11]=c[11],o[12]=c[12],o[13]=c[13],o[14]=c[14],o[15]=c[15],o},w.clone$1=xn,w.clone$2=function(c){var o=new Jr(3);return o[0]=c[0],o[1]=c[1],o[2]=c[2],o},w.collisionCircleLayout=fo,w.config=jo,w.copy=function(c,o){return c[0]=o[0],c[1]=o[1],c[2]=o[2],c[3]=o[3],c[4]=o[4],c[5]=o[5],c[6]=o[6],c[7]=o[7],c[8]=o[8],c[9]=o[9],c[10]=o[10],c[11]=o[11],c[12]=o[12],c[13]=o[13],c[14]=o[14],c[15]=o[15],c},w.create=function(){var c=new Jr(16);return Jr!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},w.create$1=Xp,w.createExpression=ws,w.createFilter=fu,w.createLayout=ir,w.createStyleLayer=function(c){return"custom"===c.type?new cp(c):new rd[c.type](c)},w.cross=function(c,o,h){var m=o[0],b=o[1],T=o[2],S=h[0],k=h[1],O=h[2];return c[0]=b*O-T*k,c[1]=T*S-m*O,c[2]=m*k-b*S,c},w.dot=function(c,o){return c[0]*o[0]+c[1]*o[1]+c[2]*o[2]},w.dot$1=function(c,o){return c[0]*o[0]+c[1]*o[1]+c[2]*o[2]+c[3]*o[3]},w.ease=en,w.emitValidationErrors=Hr,w.enforceCacheSizeLimit=function(c){Ps(),Yn&&Yn.then(o=>{o.keys().then(h=>{for(let m=0;m<h.length-c;m++)o.delete(h[m])})})},w.equals=function(c,o){var h=c[0],m=c[1],b=c[2],T=c[3],S=c[4],k=c[5],O=c[6],z=c[7],j=c[8],W=c[9],J=c[10],te=c[11],ne=c[12],ge=c[13],pe=c[14],Pe=c[15],ze=o[0],De=o[1],Oe=o[2],Ke=o[3],Ze=o[4],Tt=o[5],kt=o[6],bt=o[7],ft=o[8],ct=o[9],gt=o[10],_t=o[11],ot=o[12],Vt=o[13],Ot=o[14],Bn=o[15];return Math.abs(h-ze)<=Fs*Math.max(1,Math.abs(h),Math.abs(ze))&&Math.abs(m-De)<=Fs*Math.max(1,Math.abs(m),Math.abs(De))&&Math.abs(b-Oe)<=Fs*Math.max(1,Math.abs(b),Math.abs(Oe))&&Math.abs(T-Ke)<=Fs*Math.max(1,Math.abs(T),Math.abs(Ke))&&Math.abs(S-Ze)<=Fs*Math.max(1,Math.abs(S),Math.abs(Ze))&&Math.abs(k-Tt)<=Fs*Math.max(1,Math.abs(k),Math.abs(Tt))&&Math.abs(O-kt)<=Fs*Math.max(1,Math.abs(O),Math.abs(kt))&&Math.abs(z-bt)<=Fs*Math.max(1,Math.abs(z),Math.abs(bt))&&Math.abs(j-ft)<=Fs*Math.max(1,Math.abs(j),Math.abs(ft))&&Math.abs(W-ct)<=Fs*Math.max(1,Math.abs(W),Math.abs(ct))&&Math.abs(J-gt)<=Fs*Math.max(1,Math.abs(J),Math.abs(gt))&&Math.abs(te-_t)<=Fs*Math.max(1,Math.abs(te),Math.abs(_t))&&Math.abs(ne-ot)<=Fs*Math.max(1,Math.abs(ne),Math.abs(ot))&&Math.abs(ge-Vt)<=Fs*Math.max(1,Math.abs(ge),Math.abs(Vt))&&Math.abs(pe-Ot)<=Fs*Math.max(1,Math.abs(pe),Math.abs(Ot))&&Math.abs(Pe-Bn)<=Fs*Math.max(1,Math.abs(Pe),Math.abs(Bn))},w.evaluateSizeForFeature=function(c,{uSize:o,uSizeT:h},{lowerSize:m,upperSize:b}){return"source"===c.kind?m/dl:"composite"===c.kind?Je(m/dl,b/dl,h):o},w.evaluateSizeForZoom=function(c,o){let h=0,m=0;if("constant"===c.kind)m=c.layoutSize;else if("source"!==c.kind){const{interpolationType:b,minZoom:T,maxZoom:S}=c,k=b?Ne(ni.interpolationFactor(b,o,T,S),0,1):0;"camera"===c.kind?m=Je(c.minSize,c.maxSize,k):h=k}return{uSizeT:h,uSize:m}},w.evaluateVariableOffset=gy,w.evented=Gu,w.exported=Ys,w.exported$1=Ks,w.extend=sn,w.filterObject=Jn,w.fromRotation=function(c,o){var h=Math.sin(o),m=Math.cos(o);return c[0]=m,c[1]=h,c[2]=0,c[3]=-h,c[4]=m,c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},w.fromScaling=function(c,o){return c[0]=o[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=o[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=o[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},w.getAnchorAlignment=Tg,w.getAnchorJustification=Dg,w.getArrayBuffer=Br,w.getImage=Xa,w.getJSON=function(c,o){return la(sn(c,{type:"json"}),o)},w.getOverlapMode=id,w.getRTLTextPluginStatus=Vl,w.getReferrer=_r,w.getVideo=function(c,o){const h=window.document.createElement("video");h.muted=!0,h.onloadstart=function(){o(null,h)};for(let m=0;m<c.length;m++){const b=window.document.createElement("source");To(c[m])||(h.crossOrigin="Anonymous"),b.src=c[m],h.appendChild(b)}return{cancel:()=>{}}},w.identity=jd,w.invert=function(c,o){var h=o[0],m=o[1],b=o[2],T=o[3],S=o[4],k=o[5],O=o[6],z=o[7],j=o[8],W=o[9],J=o[10],te=o[11],ne=o[12],ge=o[13],pe=o[14],Pe=o[15],ze=h*k-m*S,De=h*O-b*S,Oe=h*z-T*S,Ke=m*O-b*k,Ze=m*z-T*k,Tt=b*z-T*O,kt=j*ge-W*ne,bt=j*pe-J*ne,ft=j*Pe-te*ne,ct=W*pe-J*ge,gt=W*Pe-te*ge,_t=J*Pe-te*pe,ot=ze*_t-De*gt+Oe*ct+Ke*ft-Ze*bt+Tt*kt;return ot?(c[0]=(k*_t-O*gt+z*ct)*(ot=1/ot),c[1]=(b*gt-m*_t-T*ct)*ot,c[2]=(ge*Tt-pe*Ze+Pe*Ke)*ot,c[3]=(J*Ze-W*Tt-te*Ke)*ot,c[4]=(O*ft-S*_t-z*bt)*ot,c[5]=(h*_t-b*ft+T*bt)*ot,c[6]=(pe*Oe-ne*Tt-Pe*De)*ot,c[7]=(j*Tt-J*Oe+te*De)*ot,c[8]=(S*gt-k*ft+z*kt)*ot,c[9]=(m*ft-h*gt-T*kt)*ot,c[10]=(ne*Ze-ge*Oe+Pe*ze)*ot,c[11]=(W*Oe-j*Ze-te*ze)*ot,c[12]=(k*bt-S*ct-O*kt)*ot,c[13]=(h*ct-m*bt+b*kt)*ot,c[14]=(ge*De-ne*Ke-pe*ze)*ot,c[15]=(j*Ke-W*De+J*ze)*ot,c):null},w.isImageBitmap=Xs,w.isSafari=wo,w.isWorker=hr,w.keysDifference=function(c,o){const h=[];for(const m in c)m in o||h.push(m);return h},w.lazyLoadRTLTextPlugin=function(){oo.isLoading()||oo.isLoaded()||"deferred"!==Vl()||sl()},w.makeRequest=la,w.mapObject=di,w.mercatorXfromLng=Sm,w.mercatorYfromLat=Og,w.mercatorZfromAltitude=gf,w.mul=ey,w.mul$1=function(c,o,h){return c[0]=o[0]*h[0],c[1]=o[1]*h[1],c[2]=o[2]*h[2],c[3]=o[3]*h[3],c},w.multiply=Hf,w.nextPowerOfTwo=function(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))},w.normalize=function(c,o){var h=o[0],m=o[1],b=o[2],T=h*h+m*m+b*b;return T>0&&(T=1/Math.sqrt(T)),c[0]=o[0]*T,c[1]=o[1]*T,c[2]=o[2]*T,c},w.number=Je,w.ortho=function(c,o,h,m,b,T,S){var k=1/(o-h),O=1/(m-b),z=1/(T-S);return c[0]=-2*k,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*O,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*z,c[11]=0,c[12]=(o+h)*k,c[13]=(b+m)*O,c[14]=(S+T)*z,c[15]=1,c},w.parseCacheControl=xo,w.parseGlyphPbf=function(c){return new Kf(c).readFields(Wl,[])},w.pbf=Kf,w.performSymbolLayout=function(c){c.bucket.createArrays(),c.bucket.tilePixelRatio=rr/(512*c.bucket.overscaling),c.bucket.compareText={},c.bucket.iconsNeedLinear=!1;const o=c.bucket.layers[0].layout,h=c.bucket.layers[0]._unevaluatedLayout._values,m={layoutIconSize:h["icon-size"].possiblyEvaluate(new li(c.bucket.zoom+1),c.canonical),layoutTextSize:h["text-size"].possiblyEvaluate(new li(c.bucket.zoom+1),c.canonical),textMaxSize:h["text-size"].possiblyEvaluate(new li(18))};if("composite"===c.bucket.textSizeData.kind){const{minZoom:O,maxZoom:z}=c.bucket.textSizeData;m.compositeTextSizes=[h["text-size"].possiblyEvaluate(new li(O),c.canonical),h["text-size"].possiblyEvaluate(new li(z),c.canonical)]}if("composite"===c.bucket.iconSizeData.kind){const{minZoom:O,maxZoom:z}=c.bucket.iconSizeData;m.compositeIconSizes=[h["icon-size"].possiblyEvaluate(new li(O),c.canonical),h["icon-size"].possiblyEvaluate(new li(z),c.canonical)]}const b=24*o.get("text-line-height"),T="viewport"!==o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement"),S=o.get("text-keep-upright"),k=o.get("text-size");for(const O of c.bucket.features){const z=o.get("text-font").evaluate(O,{},c.canonical).join(","),j=k.evaluate(O,{},c.canonical),W=m.layoutTextSize.evaluate(O,{},c.canonical),J=m.layoutIconSize.evaluate(O,{},c.canonical),te={horizontal:{},vertical:void 0},ne=O.text;let ge,pe=[0,0];if(ne){const De=ne.toString(),Oe=24*o.get("text-letter-spacing").evaluate(O,{},c.canonical),Ke=Ki(De)?Oe:0,Ze=o.get("text-anchor").evaluate(O,{},c.canonical),Tt=o.get("text-variable-anchor");if(!Tt){const gt=o.get("text-radial-offset").evaluate(O,{},c.canonical);pe=gt?gy(Ze,[24*gt,hf]):o.get("text-offset").evaluate(O,{},c.canonical).map(_t=>24*_t)}let kt=T?"center":o.get("text-justify").evaluate(O,{},c.canonical);const bt=o.get("symbol-placement"),ft="point"===bt?24*o.get("text-max-width").evaluate(O,{},c.canonical):0,ct=()=>{c.bucket.allowVerticalPlacement&&mu(De)&&(te.vertical=tp(ne,c.glyphMap,c.glyphPositions,c.imagePositions,z,ft,b,Ze,"left",Ke,pe,w.WritingMode.vertical,!0,bt,W,j))};if(!T&&Tt){const gt="auto"===kt?Tt.map(ot=>Dg(ot)):[kt];let _t=!1;for(let ot=0;ot<gt.length;ot++){const Vt=gt[ot];if(!te.horizontal[Vt])if(_t)te.horizontal[Vt]=te.horizontal[0];else{const Ot=tp(ne,c.glyphMap,c.glyphPositions,c.imagePositions,z,ft,b,"center",Vt,Ke,pe,w.WritingMode.horizontal,!1,bt,W,j);Ot&&(te.horizontal[Vt]=Ot,_t=1===Ot.positionedLines.length)}}ct()}else{"auto"===kt&&(kt=Dg(Ze));const gt=tp(ne,c.glyphMap,c.glyphPositions,c.imagePositions,z,ft,b,Ze,kt,Ke,pe,w.WritingMode.horizontal,!1,bt,W,j);gt&&(te.horizontal[kt]=gt),ct(),mu(De)&&T&&S&&(te.vertical=tp(ne,c.glyphMap,c.glyphPositions,c.imagePositions,z,ft,b,Ze,kt,Ke,pe,w.WritingMode.vertical,!1,bt,W,j))}}let Pe=!1;if(O.icon&&O.icon.name){const De=c.imageMap[O.icon.name];De&&(ge=m0(c.imagePositions[O.icon.name],o.get("icon-offset").evaluate(O,{},c.canonical),o.get("icon-anchor").evaluate(O,{},c.canonical)),Pe=!!De.sdf,void 0===c.bucket.sdfIcons?c.bucket.sdfIcons=Pe:c.bucket.sdfIcons!==Pe&&Ci("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(De.pixelRatio!==c.bucket.pixelRatio||0!==o.get("icon-rotate").constantOr(1))&&(c.bucket.iconsNeedLinear=!0))}const ze=wm(te.horizontal)||te.vertical;c.bucket.iconsInText=!!ze&&ze.iconsInText,(ze||ge)&&df(c.bucket,O,te,ge,c.imageMap,m,W,J,pe,Pe,c.canonical)}c.showCollisionBoxes&&c.bucket.generateCollisionDebugBuffers()},w.perspective=function(c,o,h,m,b){var T,S=1/Math.tan(o/2);return c[0]=S/h,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=S,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,null!=b&&b!==1/0?(c[10]=(b+m)*(T=1/(m-b)),c[14]=2*b*m*T):(c[10]=-1,c[14]=-2*m),c},w.pick=function(c,o){const h={};for(let m=0;m<o.length;m++){const b=o[m];b in c&&(h[b]=c[b])}return h},w.plugin=oo,w.pointGeometry=Zt,w.polygonIntersectsPolygon=Nd,w.potpack=pm,w.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],w.register=Dt,w.registerForPluginStateChange=function(c){return c({pluginStatus:Cs,pluginURL:zl}),Gu.on("pluginStateChange",c),c},w.renderColorRamp=gg,w.rotateX=function(c,o,h){var m=Math.sin(h),b=Math.cos(h),T=o[4],S=o[5],k=o[6],O=o[7],z=o[8],j=o[9],W=o[10],J=o[11];return o!==c&&(c[0]=o[0],c[1]=o[1],c[2]=o[2],c[3]=o[3],c[12]=o[12],c[13]=o[13],c[14]=o[14],c[15]=o[15]),c[4]=T*b+z*m,c[5]=S*b+j*m,c[6]=k*b+W*m,c[7]=O*b+J*m,c[8]=z*b-T*m,c[9]=j*b-S*m,c[10]=W*b-k*m,c[11]=J*b-O*m,c},w.rotateZ=function(c,o,h){var m=Math.sin(h),b=Math.cos(h),T=o[0],S=o[1],k=o[2],O=o[3],z=o[4],j=o[5],W=o[6],J=o[7];return o!==c&&(c[8]=o[8],c[9]=o[9],c[10]=o[10],c[11]=o[11],c[12]=o[12],c[13]=o[13],c[14]=o[14],c[15]=o[15]),c[0]=T*b+z*m,c[1]=S*b+j*m,c[2]=k*b+W*m,c[3]=O*b+J*m,c[4]=z*b-T*m,c[5]=j*b-S*m,c[6]=W*b-k*m,c[7]=J*b-O*m,c},w.scale=function(c,o,h){var m=h[0],b=h[1],T=h[2];return c[0]=o[0]*m,c[1]=o[1]*m,c[2]=o[2]*m,c[3]=o[3]*m,c[4]=o[4]*b,c[5]=o[5]*b,c[6]=o[6]*b,c[7]=o[7]*b,c[8]=o[8]*T,c[9]=o[9]*T,c[10]=o[10]*T,c[11]=o[11]*T,c[12]=o[12],c[13]=o[13],c[14]=o[14],c[15]=o[15],c},w.scale$1=function(c,o,h){return c[0]=o[0]*h,c[1]=o[1]*h,c[2]=o[2]*h,c},w.setCacheLimits=function(c,o){tc=c,aa=o},w.setRTLTextPlugin=function(c,o,h=!1){if(Cs===Hu||Cs===Gs||Cs===_u)throw new Error("setRTLTextPlugin cannot be called multiple times.");zl=Ys.resolveURL(c),Cs=Hu,Xo=o,rl(),h||sl()},w.spec=He,w.sphericalToCartesian=function([c,o,h]){return o+=90,o*=Math.PI/180,h*=Math.PI/180,{x:c*Math.cos(o)*Math.sin(h),y:c*Math.sin(o)*Math.sin(h),z:c*Math.cos(h)}},w.sqrLen=function(c){var o=c[0],h=c[1];return o*o+h*h},w.sub=function(c,o,h){return c[0]=o[0]-h[0],c[1]=o[1]-h[1],c[2]=o[2]-h[2],c},w.toEvaluationFeature=kc,w.transformMat3=function(c,o,h){var m=o[0],b=o[1],T=o[2];return c[0]=m*h[0]+b*h[3]+T*h[6],c[1]=m*h[1]+b*h[4]+T*h[7],c[2]=m*h[2]+b*h[5]+T*h[8],c},w.transformMat4=Gf,w.transformMat4$1=function(c,o,h){var m=o[0],b=o[1];return c[0]=h[0]*m+h[4]*b+h[12],c[1]=h[1]*m+h[5]*b+h[13],c},w.translate=function(c,o,h){var m,b,T,S,k,O,z,j,W,J,te,ne,ge=h[0],pe=h[1],Pe=h[2];return o===c?(c[12]=o[0]*ge+o[4]*pe+o[8]*Pe+o[12],c[13]=o[1]*ge+o[5]*pe+o[9]*Pe+o[13],c[14]=o[2]*ge+o[6]*pe+o[10]*Pe+o[14],c[15]=o[3]*ge+o[7]*pe+o[11]*Pe+o[15]):(b=o[1],T=o[2],S=o[3],k=o[4],O=o[5],z=o[6],j=o[7],W=o[8],J=o[9],te=o[10],ne=o[11],c[0]=m=o[0],c[1]=b,c[2]=T,c[3]=S,c[4]=k,c[5]=O,c[6]=z,c[7]=j,c[8]=W,c[9]=J,c[10]=te,c[11]=ne,c[12]=m*ge+k*pe+W*Pe+o[12],c[13]=b*ge+O*pe+J*Pe+o[13],c[14]=T*ge+z*pe+te*Pe+o[14],c[15]=S*ge+j*pe+ne*Pe+o[15]),c},w.triggerPluginCompletionEvent=Ld,w.unicodeBlockLookup=yt,w.uniqueId=function(){return vt++},w.validateCustomStyleLayer=function(c){const o=[],h=c.id;return void 0===h&&o.push({message:`layers.${h}: missing required property "id"`}),void 0===c.render&&o.push({message:`layers.${h}: missing required method "render"`}),c.renderingMode&&"2d"!==c.renderingMode&&"3d"!==c.renderingMode&&o.push({message:`layers.${h}: property "renderingMode" must be either "2d" or "3d"`}),o},w.validateLight=Rt,w.validateStyle=Ge,w.vectorTile=za,w.warnOnce=Ci,w.wrap=wn}),me(0,function(w){function Gt(le){const U=typeof le;if("number"===U||"boolean"===U||"string"===U||null==le)return JSON.stringify(le);if(Array.isArray(le)){let re="[";for(const ye of le)re+=`${Gt(ye)},`;return`${re}]`}const $=Object.keys(le).sort();let ie="{";for(let re=0;re<$.length;re++)ie+=`${JSON.stringify($[re])}:${Gt(le[$[re]])},`;return`${ie}}`}function Fn(le){let U="";for(const $ of w.refProperties)U+=`/${Gt(le[$])}`;return U}class yi{constructor(U){this.keyCache={},U&&this.replace(U)}replace(U){this._layerConfigs={},this._layers={},this.update(U,[])}update(U,$){for(const re of U){this._layerConfigs[re.id]=re;const ye=this._layers[re.id]=w.createStyleLayer(re);ye._featureFilter=w.createFilter(ye.filter),this.keyCache[re.id]&&delete this.keyCache[re.id]}for(const re of $)delete this.keyCache[re],delete this._layerConfigs[re],delete this._layers[re];this.familiesBySource={};const ie=function(re,ye){const Te={};for(let ve=0;ve<re.length;ve++){const Ce=ye&&ye[re[ve].id]||Fn(re[ve]);ye&&(ye[re[ve].id]=Ce);let je=Te[Ce];je||(je=Te[Ce]=[]),je.push(re[ve])}const we=[];for(const ve in Te)we.push(Te[ve]);return we}(Object.values(this._layerConfigs),this.keyCache);for(const re of ie){const ye=re.map(et=>this._layers[et.id]),Te=ye[0];if("none"===Te.visibility)continue;const we=Te.source||"";let ve=this.familiesBySource[we];ve||(ve=this.familiesBySource[we]={});const Ce=Te.sourceLayer||"_geojsonTileLayer";let je=ve[Ce];je||(je=ve[Ce]=[]),je.push(ye)}}}class en{constructor(U){const $={},ie=[];for(const we in U){const ve=U[we],Ce=$[we]={};for(const je in ve){const et=ve[+je];if(!et||0===et.bitmap.width||0===et.bitmap.height)continue;const Ve={x:0,y:0,w:et.bitmap.width+2,h:et.bitmap.height+2};ie.push(Ve),Ce[je]={rect:Ve,metrics:et.metrics}}}const{w:re,h:ye}=w.potpack(ie),Te=new w.AlphaImage({width:re||1,height:ye||1});for(const we in U){const ve=U[we];for(const Ce in ve){const je=ve[+Ce];if(!je||0===je.bitmap.width||0===je.bitmap.height)continue;const et=$[we][Ce].rect;w.AlphaImage.copy(je.bitmap,Te,{x:0,y:0},{x:et.x+1,y:et.y+1},je.bitmap)}}this.image=Te,this.positions=$}}w.register("GlyphAtlas",en);class Ne{constructor(U){this.tileID=new w.OverscaledTileID(U.tileID.overscaledZ,U.tileID.wrap,U.tileID.canonical.z,U.tileID.canonical.x,U.tileID.canonical.y),this.uid=U.uid,this.zoom=U.zoom,this.pixelRatio=U.pixelRatio,this.tileSize=U.tileSize,this.source=U.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=U.showCollisionBoxes,this.collectResourceTiming=!!U.collectResourceTiming,this.returnDependencies=!!U.returnDependencies,this.promoteId=U.promoteId}parse(U,$,ie,re,ye){this.status="parsing",this.data=U,this.collisionBoxArray=new w.CollisionBoxArray;const Te=new w.DictionaryCoder(Object.keys(U.layers).sort()),we=new w.FeatureIndex(this.tileID,this.promoteId);we.bucketLayerIDs=[];const ve={},Ce={featureIndex:we,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ie},je=$.familiesBySource[this.source];for(const nn in je){const fn=U.layers[nn];if(!fn)continue;1===fn.version&&w.warnOnce(`Vector tile source "${this.source}" layer "${nn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const pn=Te.encode(nn),oi=[];for(let wi=0;wi<fn.length;wi++){const ti=fn.feature(wi),br=we.getId(ti,nn);oi.push({feature:ti,id:br,index:wi,sourceLayerIndex:pn})}for(const wi of je[nn]){const ti=wi[0];ti.source!==this.source&&w.warnOnce(`layer.source = ${ti.source} does not equal this.source = ${this.source}`),ti.minzoom&&this.zoom<Math.floor(ti.minzoom)||ti.maxzoom&&this.zoom>=ti.maxzoom||"none"!==ti.visibility&&(wn(wi,this.zoom,ie),(ve[ti.id]=ti.createBucket({index:we.bucketLayerIDs.length,layers:wi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:pn,sourceID:this.source})).populate(oi,Ce,this.tileID.canonical),we.bucketLayerIDs.push(wi.map(br=>br.id)))}}let et,Ve,Et,Mt;const ht=w.mapObject(Ce.glyphDependencies,nn=>Object.keys(nn).map(Number));Object.keys(ht).length?re.send("getGlyphs",{uid:this.uid,stacks:ht},(nn,fn)=>{et||(et=nn,Ve=fn,Qn.call(this))}):Ve={};const Wt=Object.keys(Ce.iconDependencies);Wt.length?re.send("getImages",{icons:Wt,source:this.source,tileID:this.tileID,type:"icons"},(nn,fn)=>{et||(et=nn,Et=fn,Qn.call(this))}):Et={};const $t=Object.keys(Ce.patternDependencies);function Qn(){if(et)return ye(et);if(Ve&&Et&&Mt){const nn=new en(Ve),fn=new w.ImageAtlas(Et,Mt);for(const pn in ve){const oi=ve[pn];oi instanceof w.SymbolBucket?(wn(oi.layers,this.zoom,ie),w.performSymbolLayout({bucket:oi,glyphMap:Ve,glyphPositions:nn.positions,imageMap:Et,imagePositions:fn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):oi.hasPattern&&(oi instanceof w.LineBucket||oi instanceof w.FillBucket||oi instanceof w.FillExtrusionBucket)&&(wn(oi.layers,this.zoom,ie),oi.addFeatures(Ce,this.tileID.canonical,fn.patternPositions))}this.status="done",ye(null,{buckets:Object.values(ve).filter(pn=>!pn.isEmpty()),featureIndex:we,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:nn.image,imageAtlas:fn,glyphMap:this.returnDependencies?Ve:null,iconMap:this.returnDependencies?Et:null,glyphPositions:this.returnDependencies?nn.positions:null})}}$t.length?re.send("getImages",{icons:$t,source:this.source,tileID:this.tileID,type:"patterns"},(nn,fn)=>{et||(et=nn,Mt=fn,Qn.call(this))}):Mt={},Qn.call(this)}}function wn(le,U,$){const ie=new w.EvaluationParameters(U);for(const re of le)re.recalculate(ie,$)}function sn(le,U){const $=w.getArrayBuffer(le.request,(ie,re,ye,Te)=>{ie?U(ie):re&&U(null,{vectorTile:new w.vectorTile.VectorTile(new w.pbf(re)),rawData:re,cacheControl:ye,expires:Te})});return()=>{$.cancel(),U()}}class vt{constructor(U,$,ie,re){this.actor=U,this.layerIndex=$,this.availableImages=ie,this.loadVectorData=re||sn,this.loading={},this.loaded={}}loadTile(U,$){const ie=U.uid;this.loading||(this.loading={});const re=!!(U&&U.request&&U.request.collectResourceTiming)&&new w.RequestPerformance(U.request),ye=this.loading[ie]=new Ne(U);ye.abort=this.loadVectorData(U,(Te,we)=>{if(delete this.loading[ie],Te||!we)return ye.status="done",this.loaded[ie]=ye,$(Te);const ve=we.rawData,Ce={};we.expires&&(Ce.expires=we.expires),we.cacheControl&&(Ce.cacheControl=we.cacheControl);const je={};if(re){const et=re.finish();et&&(je.resourceTiming=JSON.parse(JSON.stringify(et)))}ye.vectorTile=we.vectorTile,ye.parse(we.vectorTile,this.layerIndex,this.availableImages,this.actor,(et,Ve)=>{if(et||!Ve)return $(et);$(null,w.extend({rawTileData:ve.slice(0)},Ve,Ce,je))}),this.loaded=this.loaded||{},this.loaded[ie]=ye})}reloadTile(U,$){const ie=this.loaded,re=U.uid,ye=this;if(ie&&ie[re]){const Te=ie[re];Te.showCollisionBoxes=U.showCollisionBoxes;const we=(ve,Ce)=>{const je=Te.reloadCallback;je&&(delete Te.reloadCallback,Te.parse(Te.vectorTile,ye.layerIndex,this.availableImages,ye.actor,je)),$(ve,Ce)};"parsing"===Te.status?Te.reloadCallback=we:"done"===Te.status&&(Te.vectorTile?Te.parse(Te.vectorTile,this.layerIndex,this.availableImages,this.actor,we):we())}}abortTile(U,$){const ie=this.loading,re=U.uid;ie&&ie[re]&&ie[re].abort&&(ie[re].abort(),delete ie[re]),$()}removeTile(U,$){const ie=this.loaded,re=U.uid;ie&&ie[re]&&delete ie[re],$()}}class Mn{constructor(){this.loaded={}}loadTile(U,$){const{uid:ie,encoding:re,rawImageData:ye}=U,Te=w.isImageBitmap(ye)?this.getImageData(ye):ye,we=new w.DEMData(ie,Te,re);this.loaded=this.loaded||{},this.loaded[ie]=we,$(null,we)}getImageData(U){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(U.width,U.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=U.width,this.offscreenCanvas.height=U.height,this.offscreenCanvasContext.drawImage(U,0,0,U.width,U.height);const $=this.offscreenCanvasContext.getImageData(-1,-1,U.width+2,U.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new w.RGBAImage({width:$.width,height:$.height},$.data)}removeTile(U){const $=this.loaded,ie=U.uid;$&&$[ie]&&delete $[ie]}}var di=function le(U,$){var ie,re=U&&U.type;if("FeatureCollection"===re)for(ie=0;ie<U.features.length;ie++)le(U.features[ie],$);else if("GeometryCollection"===re)for(ie=0;ie<U.geometries.length;ie++)le(U.geometries[ie],$);else if("Feature"===re)le(U.geometry,$);else if("Polygon"===re)Jn(U.coordinates,$);else if("MultiPolygon"===re)for(ie=0;ie<U.coordinates.length;ie++)Jn(U.coordinates[ie],$);return U};function Jn(le,U){if(0!==le.length){xn(le[0],U);for(var $=1;$<le.length;$++)xn(le[$],!U)}}function xn(le,U){for(var $=0,ie=0,re=0,ye=le.length,Te=ye-1;re<ye;Te=re++){var we=(le[re][0]-le[Te][0])*(le[Te][1]+le[re][1]),ve=$+we;ie+=Math.abs($)>=Math.abs(we)?$-ve+we:we-ve+$,$=ve}$+ie>=0!=!!U&&le.reverse()}const er=w.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Ci{constructor(U){this._feature=U,this.extent=w.EXTENT,this.type=U.type,this.properties=U.tags,"id"in U&&!isNaN(U.id)&&(this.id=parseInt(U.id,10))}loadGeometry(){if(1===this._feature.type){const U=[];for(const $ of this._feature.geometry)U.push([new w.pointGeometry($[0],$[1])]);return U}{const U=[];for(const $ of this._feature.geometry){const ie=[];for(const re of $)ie.push(new w.pointGeometry(re[0],re[1]));U.push(ie)}return U}}toGeoJSON(U,$,ie){return er.call(this,U,$,ie)}}class si{constructor(U){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=w.EXTENT,this.length=U.length,this._features=U}feature(U){return new Ci(this._features[U])}}var is={exports:{}},hr=w.pointGeometry,xo=w.vectorTile.VectorTileFeature,Ir=Zr;function Zr(le,U){this.options=U||{},this.features=le,this.length=le.length}function Is(le,U){this.id="number"==typeof le.id?le.id:void 0,this.type=le.type,this.rawGeometry=1===le.type?[le.geometry]:le.geometry,this.properties=le.tags,this.extent=U||4096}Zr.prototype.feature=function(le){return new Is(this.features[le],this.options.extent)},Is.prototype.loadGeometry=function(){var le=this.rawGeometry;this.geometry=[];for(var U=0;U<le.length;U++){for(var $=le[U],ie=[],re=0;re<$.length;re++)ie.push(new hr($[re][0],$[re][1]));this.geometry.push(ie)}return this.geometry},Is.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var le=this.geometry,U=1/0,$=-1/0,ie=1/0,re=-1/0,ye=0;ye<le.length;ye++)for(var Te=le[ye],we=0;we<Te.length;we++){var ve=Te[we];U=Math.min(U,ve.x),$=Math.max($,ve.x),ie=Math.min(ie,ve.y),re=Math.max(re,ve.y)}return[U,ie,$,re]},Is.prototype.toGeoJSON=xo.prototype.toGeoJSON;var wo=w.pbf,Xs=Ir;function Ys(le){var U=new wo;return function($,ie){for(var re in $.layers)ie.writeMessage(3,Zt,$.layers[re])}(le,U),U.finish()}function Zt(le,U){var $;U.writeVarintField(15,le.version||1),U.writeStringField(1,le.name||""),U.writeVarintField(5,le.extent||4096);var ie={keys:[],values:[],keycache:{},valuecache:{}};for($=0;$<le.length;$++)ie.feature=le.feature($),U.writeMessage(2,ys,ie);var re=ie.keys;for($=0;$<re.length;$++)U.writeStringField(3,re[$]);var ye=ie.values;for($=0;$<ye.length;$++)U.writeMessage(4,tc,ye[$])}function ys(le,U){var $=le.feature;void 0!==$.id&&U.writeVarintField(1,$.id),U.writeMessage(2,jo,le),U.writeVarintField(3,$.type),U.writeMessage(4,vs,$)}function jo(le,U){var $=le.feature,ie=le.keys,re=le.values,ye=le.keycache,Te=le.valuecache;for(var we in $.properties){var ve=$.properties[we],Ce=ye[we];if(null!==ve){void 0===Ce&&(ie.push(we),ye[we]=Ce=ie.length-1),U.writeVarint(Ce);var je=typeof ve;"string"!==je&&"boolean"!==je&&"number"!==je&&(ve=JSON.stringify(ve));var et=je+":"+ve,Ve=Te[et];void 0===Ve&&(re.push(ve),Te[et]=Ve=re.length-1),U.writeVarint(Ve)}}}function Eo(le,U){return(U<<3)+(7&le)}function Yn(le){return le<<1^le>>31}function vs(le,U){for(var $=le.loadGeometry(),ie=le.type,re=0,ye=0,Te=$.length,we=0;we<Te;we++){var ve=$[we],Ce=1;1===ie&&(Ce=ve.length),U.writeVarint(Eo(1,Ce));for(var je=3===ie?ve.length-1:ve.length,et=0;et<je;et++){1===et&&1!==ie&&U.writeVarint(Eo(2,je-1));var Ve=ve[et].x-re,Et=ve[et].y-ye;U.writeVarint(Yn(Ve)),U.writeVarint(Yn(Et)),re+=Ve,ye+=Et}3===ie&&U.writeVarint(Eo(7,1))}}function tc(le,U){var $=typeof le;"string"===$?U.writeStringField(1,le):"boolean"===$?U.writeBooleanField(7,le):"number"===$&&(le%1!=0?U.writeDoubleField(3,le):le<0?U.writeSVarintField(6,le):U.writeVarintField(5,le))}function aa(le,U,$,ie,re,ye){if(re-ie<=$)return;const Te=ie+re>>1;Ps(le,U,Te,ie,re,ye%2),aa(le,U,$,ie,Te-1,ye+1),aa(le,U,$,Te+1,re,ye+1)}function Ps(le,U,$,ie,re,ye){for(;re>ie;){if(re-ie>600){const Ce=re-ie+1,je=$-ie+1,et=Math.log(Ce),Ve=.5*Math.exp(2*et/3),Et=.5*Math.sqrt(et*Ve*(Ce-Ve)/Ce)*(je-Ce/2<0?-1:1);Ps(le,U,$,Math.max(ie,Math.floor($-je*Ve/Ce+Et)),Math.min(re,Math.floor($+(Ce-je)*Ve/Ce+Et)),ye)}const Te=U[2*$+ye];let we=ie,ve=re;for(Fi(le,U,ie,$),U[2*re+ye]>Te&&Fi(le,U,ie,re);we<ve;){for(Fi(le,U,we,ve),we++,ve--;U[2*we+ye]<Te;)we++;for(;U[2*ve+ye]>Te;)ve--}U[2*ie+ye]===Te?Fi(le,U,ie,ve):(ve++,Fi(le,U,ve,re)),ve<=$&&(ie=ve+1),$<=ve&&(re=ve-1)}}function Fi(le,U,$,ie){Ks(le,$,ie),Ks(U,2*$,2*ie),Ks(U,2*$+1,2*ie+1)}function Ks(le,U,$){const ie=le[U];le[U]=le[$],le[$]=ie}function Za(le,U,$,ie){const re=le-$,ye=U-ie;return re*re+ye*ye}is.exports=Ys,is.exports.fromVectorTileJs=Ys,is.exports.fromGeojsonVt=function(le,U){U=U||{};var $={};for(var ie in le)$[ie]=new Xs(le[ie].features,U),$[ie].name=ie,$[ie].version=U.version,$[ie].extent=U.extent;return Ys({layers:$})},is.exports.GeoJSONWrapper=Xs;const ki=le=>le[0],vi=le=>le[1];class nc{constructor(U,$=ki,ie=vi,re=64,ye=Float64Array){this.nodeSize=re,this.points=U;const Te=U.length<65536?Uint16Array:Uint32Array,we=this.ids=new Te(U.length),ve=this.coords=new ye(2*U.length);for(let Ce=0;Ce<U.length;Ce++)we[Ce]=Ce,ve[2*Ce]=$(U[Ce]),ve[2*Ce+1]=ie(U[Ce]);aa(we,ve,re,0,we.length-1,0)}range(U,$,ie,re){return function(ye,Te,we,ve,Ce,je,et){const Ve=[0,ye.length-1,0],Et=[];let Mt,ht;for(;Ve.length;){const Wt=Ve.pop(),$t=Ve.pop(),Qn=Ve.pop();if($t-Qn<=et){for(let pn=Qn;pn<=$t;pn++)Mt=Te[2*pn],ht=Te[2*pn+1],Mt>=we&&Mt<=Ce&&ht>=ve&&ht<=je&&Et.push(ye[pn]);continue}const nn=Math.floor((Qn+$t)/2);Mt=Te[2*nn],ht=Te[2*nn+1],Mt>=we&&Mt<=Ce&&ht>=ve&&ht<=je&&Et.push(ye[nn]);const fn=(Wt+1)%2;(0===Wt?we<=Mt:ve<=ht)&&(Ve.push(Qn),Ve.push(nn-1),Ve.push(fn)),(0===Wt?Ce>=Mt:je>=ht)&&(Ve.push(nn+1),Ve.push($t),Ve.push(fn))}return Et}(this.ids,this.coords,U,$,ie,re,this.nodeSize)}within(U,$,ie){return function(re,ye,Te,we,ve,Ce){const je=[0,re.length-1,0],et=[],Ve=ve*ve;for(;je.length;){const Et=je.pop(),Mt=je.pop(),ht=je.pop();if(Mt-ht<=Ce){for(let fn=ht;fn<=Mt;fn++)Za(ye[2*fn],ye[2*fn+1],Te,we)<=Ve&&et.push(re[fn]);continue}const Wt=Math.floor((ht+Mt)/2),$t=ye[2*Wt],Qn=ye[2*Wt+1];Za($t,Qn,Te,we)<=Ve&&et.push(re[Wt]);const nn=(Et+1)%2;(0===Et?Te-ve<=$t:we-ve<=Qn)&&(je.push(ht),je.push(Wt-1),je.push(nn)),(0===Et?Te+ve>=$t:we+ve>=Qn)&&(je.push(Wt+1),je.push(Mt),je.push(nn))}return et}(this.ids,this.coords,U,$,ie,this.nodeSize)}}const Kn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:le=>le},Mr=Math.fround||(bi=new Float32Array(1),le=>(bi[0]=+le,bi[0]));var bi;class _r{constructor(U){this.options=Xa(Object.create(Kn),U),this.trees=new Array(this.options.maxZoom+1)}load(U){const{log:$,minZoom:ie,maxZoom:re,nodeSize:ye}=this.options;$&&console.time("total time");const Te=`prepare ${U.length} points`;$&&console.time(Te),this.points=U;let we=[];for(let ve=0;ve<U.length;ve++)U[ve].geometry&&we.push(la(U[ve],ve));this.trees[re+1]=new nc(we,Ho,yr,ye,Float32Array),$&&console.timeEnd(Te);for(let ve=re;ve>=ie;ve--){const Ce=+Date.now();we=this._cluster(we,ve),this.trees[ve]=new nc(we,Ho,yr,ye,Float32Array),$&&console.log("z%d: %d clusters in %dms",ve,we.length,+Date.now()-Ce)}return $&&console.timeEnd("total time"),this}getClusters(U,$){let ie=((U[0]+180)%360+360)%360-180;const re=Math.max(-90,Math.min(90,U[1]));let ye=180===U[2]?180:((U[2]+180)%360+360)%360-180;const Te=Math.max(-90,Math.min(90,U[3]));if(U[2]-U[0]>=360)ie=-180,ye=180;else if(ie>ye){const je=this.getClusters([ie,re,180,Te],$),et=this.getClusters([-180,re,ye,Te],$);return je.concat(et)}const we=this.trees[this._limitZoom($)],ve=we.range(Vn(ie),Zi(Te),Vn(ye),Zi(re)),Ce=[];for(const je of ve){const et=we.points[je];Ce.push(et.numPoints?Br(et):this.points[et.index])}return Ce}getChildren(U){const $=this._getOriginId(U),ie=this._getOriginZoom(U),re="No cluster with the specified id.",ye=this.trees[ie];if(!ye)throw new Error(re);const Te=ye.points[$];if(!Te)throw new Error(re);const we=this.options.radius/(this.options.extent*Math.pow(2,ie-1)),ve=ye.within(Te.x,Te.y,we),Ce=[];for(const je of ve){const et=ye.points[je];et.parentId===U&&Ce.push(et.numPoints?Br(et):this.points[et.index])}if(0===Ce.length)throw new Error(re);return Ce}getLeaves(U,$,ie){const re=[];return this._appendLeaves(re,U,$=$||10,ie=ie||0,0),re}getTile(U,$,ie){const re=this.trees[this._limitZoom(U)],ye=Math.pow(2,U),{extent:Te,radius:we}=this.options,ve=we/Te,Ce=(ie-ve)/ye,je=(ie+1+ve)/ye,et={features:[]};return this._addTileFeatures(re.range(($-ve)/ye,Ce,($+1+ve)/ye,je),re.points,$,ie,ye,et),0===$&&this._addTileFeatures(re.range(1-ve/ye,Ce,1,je),re.points,ye,ie,ye,et),$===ye-1&&this._addTileFeatures(re.range(0,Ce,ve/ye,je),re.points,-1,ie,ye,et),et.features.length?et:null}getClusterExpansionZoom(U){let $=this._getOriginZoom(U)-1;for(;$<=this.options.maxZoom;){const ie=this.getChildren(U);if($++,1!==ie.length)break;U=ie[0].properties.cluster_id}return $}_appendLeaves(U,$,ie,re,ye){const Te=this.getChildren($);for(const we of Te){const ve=we.properties;if(ve&&ve.cluster?ye+ve.point_count<=re?ye+=ve.point_count:ye=this._appendLeaves(U,ve.cluster_id,ie,re,ye):ye<re?ye++:U.push(we),U.length===ie)break}return ye}_addTileFeatures(U,$,ie,re,ye,Te){for(const we of U){const ve=$[we],Ce=ve.numPoints;let je,et,Ve;if(Ce)je=To(ve),et=ve.x,Ve=ve.y;else{const ht=this.points[ve.index];je=ht.properties,et=Vn(ht.geometry.coordinates[0]),Ve=Zi(ht.geometry.coordinates[1])}const Et={type:1,geometry:[[Math.round(this.options.extent*(et*ye-ie)),Math.round(this.options.extent*(Ve*ye-re))]],tags:je};let Mt;Ce?Mt=ve.id:this.options.generateId?Mt=ve.index:this.points[ve.index].id&&(Mt=this.points[ve.index].id),void 0!==Mt&&(Et.id=Mt),Te.features.push(Et)}}_limitZoom(U){return Math.max(this.options.minZoom,Math.min(Math.floor(+U),this.options.maxZoom+1))}_cluster(U,$){const ie=[],{radius:re,extent:ye,reduce:Te,minPoints:we}=this.options,ve=re/(ye*Math.pow(2,$));for(let Ce=0;Ce<U.length;Ce++){const je=U[Ce];if(je.zoom<=$)continue;je.zoom=$;const et=this.trees[$+1],Ve=et.within(je.x,je.y,ve),Et=je.numPoints||1;let Mt=Et;for(const ht of Ve){const Wt=et.points[ht];Wt.zoom>$&&(Mt+=Wt.numPoints||1)}if(Mt>Et&&Mt>=we){let ht=je.x*Et,Wt=je.y*Et,$t=Te&&Et>1?this._map(je,!0):null;const Qn=(Ce<<5)+($+1)+this.points.length;for(const nn of Ve){const fn=et.points[nn];if(fn.zoom<=$)continue;fn.zoom=$;const pn=fn.numPoints||1;ht+=fn.x*pn,Wt+=fn.y*pn,fn.parentId=Qn,Te&&($t||($t=this._map(je,!0)),Te($t,this._map(fn)))}je.parentId=Qn,ie.push(Js(ht/Mt,Wt/Mt,Qn,Mt,$t))}else if(ie.push(je),Mt>1)for(const ht of Ve){const Wt=et.points[ht];Wt.zoom<=$||(Wt.zoom=$,ie.push(Wt))}}return ie}_getOriginId(U){return U-this.points.length>>5}_getOriginZoom(U){return(U-this.points.length)%32}_map(U,$){if(U.numPoints)return $?Xa({},U.properties):U.properties;const ie=this.points[U.index].properties,re=this.options.map(ie);return $&&re===ie?Xa({},re):re}}function Js(le,U,$,ie,re){return{x:Mr(le),y:Mr(U),zoom:1/0,id:$,parentId:-1,numPoints:ie,properties:re}}function la(le,U){const[$,ie]=le.geometry.coordinates;return{x:Mr(Vn($)),y:Mr(Zi(ie)),zoom:1/0,index:U,parentId:-1}}function Br(le){return{type:"Feature",id:le.id,properties:To(le),geometry:{type:"Point",coordinates:[(U=le.x,360*(U-.5)),bs(le.y)]}};var U}function To(le){const U=le.numPoints,$=U>=1e4?`${Math.round(U/1e3)}k`:U>=1e3?Math.round(U/100)/10+"k":U;return Xa(Xa({},le.properties),{cluster:!0,cluster_id:le.id,point_count:U,point_count_abbreviated:$})}function Vn(le){return le/360+.5}function Zi(le){const U=Math.sin(le*Math.PI/180),$=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return $<0?0:$>1?1:$}function bs(le){const U=(180-360*le)*Math.PI/180;return 360*Math.atan(Math.exp(U))/Math.PI-90}function Xa(le,U){for(const $ in U)le[$]=U[$];return le}function Ho(le){return le.x}function yr(le){return le.y}function dr(le,U,$,ie){for(var re,ye=ie,Te=$-U>>1,we=$-U,ve=le[U],Ce=le[U+1],je=le[$],et=le[$+1],Ve=U+3;Ve<$;Ve+=3){var Et=Ya(le[Ve],le[Ve+1],ve,Ce,je,et);if(Et>ye)re=Ve,ye=Et;else if(Et===ye){var Mt=Math.abs(Ve-Te);Mt<we&&(re=Ve,we=Mt)}}ye>ie&&(re-U>3&&dr(le,U,re,ie),le[re+2]=ye,$-re>3&&dr(le,re,$,ie))}function Ya(le,U,$,ie,re,ye){var Te=re-$,we=ye-ie;if(0!==Te||0!==we){var ve=((le-$)*Te+(U-ie)*we)/(Te*Te+we*we);ve>1?($=re,ie=ye):ve>0&&($+=Te*ve,ie+=we*ve)}return(Te=le-$)*Te+(we=U-ie)*we}function Ka(le,U,$,ie){var re={id:void 0===le?null:le,type:U,geometry:$,tags:ie,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ye){var Te=ye.geometry,we=ye.type;if("Point"===we||"MultiPoint"===we||"LineString"===we)He(ye,Te);else if("Polygon"===we||"MultiLineString"===we)for(var ve=0;ve<Te.length;ve++)He(ye,Te[ve]);else if("MultiPolygon"===we)for(ve=0;ve<Te.length;ve++)for(var Ce=0;Ce<Te[ve].length;Ce++)He(ye,Te[ve][Ce])}(re),re}function He(le,U){for(var $=0;$<U.length;$+=3)le.minX=Math.min(le.minX,U[$]),le.minY=Math.min(le.minY,U[$+1]),le.maxX=Math.max(le.maxX,U[$]),le.maxY=Math.max(le.maxY,U[$+1])}function pt(le,U,$,ie){if(U.geometry){var re=U.geometry.coordinates,ye=U.geometry.type,Te=Math.pow($.tolerance/((1<<$.maxZoom)*$.extent),2),we=[],ve=U.id;if($.promoteId?ve=U.properties[$.promoteId]:$.generateId&&(ve=ie||0),"Point"===ye)ca(re,we);else if("MultiPoint"===ye)for(var Ce=0;Ce<re.length;Ce++)ca(re[Ce],we);else if("LineString"===ye)rs(re,we,Te,!1);else if("MultiLineString"===ye){if($.lineMetrics){for(Ce=0;Ce<re.length;Ce++)rs(re[Ce],we=[],Te,!1),le.push(Ka(ve,"LineString",we,U.properties));return}$n(re,we,Te,!1)}else if("Polygon"===ye)$n(re,we,Te,!0);else{if("MultiPolygon"!==ye){if("GeometryCollection"===ye){for(Ce=0;Ce<U.geometry.geometries.length;Ce++)pt(le,{id:ve,geometry:U.geometry.geometries[Ce],properties:U.properties},$,ie);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ce=0;Ce<re.length;Ce++){var je=[];$n(re[Ce],je,Te,!0),we.push(je)}}le.push(Ka(ve,ye,we,U.properties))}}function ca(le,U){U.push(ks(le[0])),U.push(Rs(le[1])),U.push(0)}function rs(le,U,$,ie){for(var re,ye,Te=0,we=0;we<le.length;we++){var ve=ks(le[we][0]),Ce=Rs(le[we][1]);U.push(ve),U.push(Ce),U.push(0),we>0&&(Te+=ie?(re*Ce-ve*ye)/2:Math.sqrt(Math.pow(ve-re,2)+Math.pow(Ce-ye,2))),re=ve,ye=Ce}var je=U.length-3;U[2]=1,dr(U,0,je,$),U[je+2]=1,U.size=Math.abs(Te),U.start=0,U.end=U.size}function $n(le,U,$,ie){for(var re=0;re<le.length;re++){var ye=[];rs(le[re],ye,$,ie),U.push(ye)}}function ks(le){return le/360+.5}function Rs(le){var U=Math.sin(le*Math.PI/180),$=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return $<0?0:$>1?1:$}function ss(le,U,$,ie,re,ye,Te,we){if(ie/=U,ye>=($/=U)&&Te<ie)return le;if(Te<$||ye>=ie)return null;for(var ve=[],Ce=0;Ce<le.length;Ce++){var je=le[Ce],et=je.geometry,Ve=je.type,Et=0===re?je.minX:je.minY,Mt=0===re?je.maxX:je.maxY;if(Et>=$&&Mt<ie)ve.push(je);else if(!(Mt<$||Et>=ie)){var ht=[];if("Point"===Ve||"MultiPoint"===Ve)Go(et,ht,$,ie,re);else if("LineString"===Ve)ut(et,ht,$,ie,re,!1,we.lineMetrics);else if("MultiLineString"===Ve)on(et,ht,$,ie,re,!1);else if("Polygon"===Ve)on(et,ht,$,ie,re,!0);else if("MultiPolygon"===Ve)for(var Wt=0;Wt<et.length;Wt++){var $t=[];on(et[Wt],$t,$,ie,re,!0),$t.length&&ht.push($t)}if(ht.length){if(we.lineMetrics&&"LineString"===Ve){for(Wt=0;Wt<ht.length;Wt++)ve.push(Ka(je.id,Ve,ht[Wt],je.tags));continue}"LineString"!==Ve&&"MultiLineString"!==Ve||(1===ht.length?(Ve="LineString",ht=ht[0]):Ve="MultiLineString"),"Point"!==Ve&&"MultiPoint"!==Ve||(Ve=3===ht.length?"Point":"MultiPoint"),ve.push(Ka(je.id,Ve,ht,je.tags))}}}return ve.length?ve:null}function Go(le,U,$,ie,re){for(var ye=0;ye<le.length;ye+=3){var Te=le[ye+re];Te>=$&&Te<=ie&&(U.push(le[ye]),U.push(le[ye+1]),U.push(le[ye+2]))}}function ut(le,U,$,ie,re,ye,Te){for(var we,ve,Ce=En(le),je=0===re?Ma:tn,et=le.start,Ve=0;Ve<le.length-3;Ve+=3){var Et=le[Ve],Mt=le[Ve+1],ht=le[Ve+2],Wt=le[Ve+3],$t=le[Ve+4],Qn=0===re?Et:Mt,nn=0===re?Wt:$t,fn=!1;Te&&(we=Math.sqrt(Math.pow(Et-Wt,2)+Math.pow(Mt-$t,2))),Qn<$?nn>$&&(ve=je(Ce,Et,Mt,Wt,$t,$),Te&&(Ce.start=et+we*ve)):Qn>ie?nn<ie&&(ve=je(Ce,Et,Mt,Wt,$t,ie),Te&&(Ce.start=et+we*ve)):Pr(Ce,Et,Mt,ht),nn<$&&Qn>=$&&(ve=je(Ce,Et,Mt,Wt,$t,$),fn=!0),nn>ie&&Qn<=ie&&(ve=je(Ce,Et,Mt,Wt,$t,ie),fn=!0),!ye&&fn&&(Te&&(Ce.end=et+we*ve),U.push(Ce),Ce=En(le)),Te&&(et+=we)}var pn=le.length-3;Et=le[pn],Mt=le[pn+1],ht=le[pn+2],(Qn=0===re?Et:Mt)>=$&&Qn<=ie&&Pr(Ce,Et,Mt,ht),pn=Ce.length-3,ye&&pn>=3&&(Ce[pn]!==Ce[0]||Ce[pn+1]!==Ce[1])&&Pr(Ce,Ce[0],Ce[1],Ce[2]),Ce.length&&U.push(Ce)}function En(le){var U=[];return U.size=le.size,U.start=le.start,U.end=le.end,U}function on(le,U,$,ie,re,ye){for(var Te=0;Te<le.length;Te++)ut(le[Te],U,$,ie,re,ye,!1)}function Pr(le,U,$,ie){le.push(U),le.push($),le.push(ie)}function Ma(le,U,$,ie,re,ye){var Te=(ye-U)/(ie-U);return le.push(ye),le.push($+(re-$)*Te),le.push(1),Te}function tn(le,U,$,ie,re,ye){var Te=(ye-$)/(re-$);return le.push(U+(ie-U)*Te),le.push(ye),le.push(1),Te}function ua(le,U){for(var $=[],ie=0;ie<le.length;ie++){var re,ye=le[ie],Te=ye.type;if("Point"===Te||"MultiPoint"===Te||"LineString"===Te)re=zr(ye.geometry,U);else if("MultiLineString"===Te||"Polygon"===Te){re=[];for(var we=0;we<ye.geometry.length;we++)re.push(zr(ye.geometry[we],U))}else if("MultiPolygon"===Te)for(re=[],we=0;we<ye.geometry.length;we++){for(var ve=[],Ce=0;Ce<ye.geometry[we].length;Ce++)ve.push(zr(ye.geometry[we][Ce],U));re.push(ve)}$.push(Ka(ye.id,Te,re,ye.tags))}return $}function zr(le,U){var $=[];$.size=le.size,void 0!==le.start&&($.start=le.start,$.end=le.end);for(var ie=0;ie<le.length;ie+=3)$.push(le[ie]+U,le[ie+1],le[ie+2]);return $}function Aa(le,U){if(le.transformed)return le;var $,ie,re,ye=1<<le.z,Te=le.x,we=le.y;for($=0;$<le.features.length;$++){var ve=le.features[$],Ce=ve.geometry,je=ve.type;if(ve.geometry=[],1===je)for(ie=0;ie<Ce.length;ie+=2)ve.geometry.push(vr(Ce[ie],Ce[ie+1],U,ye,Te,we));else for(ie=0;ie<Ce.length;ie++){var et=[];for(re=0;re<Ce[ie].length;re+=2)et.push(vr(Ce[ie][re],Ce[ie][re+1],U,ye,Te,we));ve.geometry.push(et)}}return le.transformed=!0,le}function vr(le,U,$,ie,re,ye){return[Math.round($*(le*ie-re)),Math.round($*(U*ie-ye))]}function Xr(le,U,$,ie,re){for(var ye=U===re.maxZoom?0:re.tolerance/((1<<U)*re.extent),Te={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:$,y:ie,z:U,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},we=0;we<le.length;we++){Te.numFeatures++,xi(Te,le[we],ye,re);var ve=le[we].minX,Ce=le[we].minY,je=le[we].maxX,et=le[we].maxY;ve<Te.minX&&(Te.minX=ve),Ce<Te.minY&&(Te.minY=Ce),je>Te.maxX&&(Te.maxX=je),et>Te.maxY&&(Te.maxY=et)}return Te}function xi(le,U,$,ie){var re=U.geometry,ye=U.type,Te=[];if("Point"===ye||"MultiPoint"===ye)for(var we=0;we<re.length;we+=3)Te.push(re[we]),Te.push(re[we+1]),le.numPoints++,le.numSimplified++;else if("LineString"===ye)os(Te,re,le,$,!1,!1);else if("MultiLineString"===ye||"Polygon"===ye)for(we=0;we<re.length;we++)os(Te,re[we],le,$,"Polygon"===ye,0===we);else if("MultiPolygon"===ye)for(var ve=0;ve<re.length;ve++){var Ce=re[ve];for(we=0;we<Ce.length;we++)os(Te,Ce[we],le,$,!0,0===we)}if(Te.length){var je=U.tags||null;if("LineString"===ye&&ie.lineMetrics){for(var et in je={},U.tags)je[et]=U.tags[et];je.mapbox_clip_start=re.start/re.size,je.mapbox_clip_end=re.end/re.size}var Ve={geometry:Te,type:"Polygon"===ye||"MultiPolygon"===ye?3:"LineString"===ye||"MultiLineString"===ye?2:1,tags:je};null!==U.id&&(Ve.id=U.id),le.features.push(Ve)}}function os(le,U,$,ie,re,ye){var Te=ie*ie;if(ie>0&&U.size<(re?Te:ie))$.numPoints+=U.length/3;else{for(var we=[],ve=0;ve<U.length;ve+=3)(0===ie||U[ve+2]>Te)&&($.numSimplified++,we.push(U[ve]),we.push(U[ve+1])),$.numPoints++;re&&function(Ce,je){for(var et=0,Ve=0,Et=Ce.length,Mt=Et-2;Ve<Et;Mt=Ve,Ve+=2)et+=(Ce[Ve]-Ce[Mt])*(Ce[Ve+1]+Ce[Mt+1]);if(et>0===je)for(Ve=0,Et=Ce.length;Ve<Et/2;Ve+=2){var ht=Ce[Ve],Wt=Ce[Ve+1];Ce[Ve]=Ce[Et-2-Ve],Ce[Ve+1]=Ce[Et-1-Ve],Ce[Et-2-Ve]=ht,Ce[Et-1-Ve]=Wt}}(we,ye),le.push(we)}}function Wo(le,U){var $=(U=this.options=function(re,ye){for(var Te in ye)re[Te]=ye[Te];return re}(Object.create(this.options),U)).debug;if($&&console.time("preprocess data"),U.maxZoom<0||U.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(U.promoteId&&U.generateId)throw new Error("promoteId and generateId cannot be used together.");var re,ye,Te,we,ve,Ce,ie=function(re,ye){var Te=[];if("FeatureCollection"===re.type)for(var we=0;we<re.features.length;we++)pt(Te,re.features[we],ye,we);else pt(Te,"Feature"===re.type?re:{geometry:re},ye);return Te}(le,U);this.tiles={},this.tileCoords=[],$&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",U.indexMaxZoom,U.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),we=re=ie,ve=ss(re,1,-1-(Te=(ye=U).buffer/ye.extent),Te,0,-1,2,ye),Ce=ss(re,1,1-Te,2+Te,0,-1,2,ye),(ve||Ce)&&(we=ss(re,1,-Te,1+Te,0,-1,2,ye)||[],ve&&(we=ua(ve,1).concat(we)),Ce&&(we=we.concat(ua(Ce,-1)))),(ie=we).length&&this.splitTile(ie,0,0,0),$&&(ie.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ja(le,U,$){return 32*((1<<le)*$+U)+le}function Cl(le,U){const $=le.tileID.canonical;if(!this._geoJSONIndex)return U(null,null);const ie=this._geoJSONIndex.getTile($.z,$.x,$.y);if(!ie)return U(null,null);const re=new si(ie.features);let ye=is.exports(re);0===ye.byteOffset&&ye.byteLength===ye.buffer.byteLength||(ye=new Uint8Array(ye)),U(null,{vectorTile:re,rawData:ye.buffer})}Wo.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Wo.prototype.splitTile=function(le,U,$,ie,re,ye,Te){for(var we=[le,U,$,ie],ve=this.options,Ce=ve.debug;we.length;){ie=we.pop(),$=we.pop(),U=we.pop(),le=we.pop();var je=1<<U,et=Ja(U,$,ie),Ve=this.tiles[et];if(!Ve&&(Ce>1&&console.time("creation"),Ve=this.tiles[et]=Xr(le,U,$,ie,ve),this.tileCoords.push({z:U,x:$,y:ie}),Ce)){Ce>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",U,$,ie,Ve.numFeatures,Ve.numPoints,Ve.numSimplified),console.timeEnd("creation"));var Et="z"+U;this.stats[Et]=(this.stats[Et]||0)+1,this.total++}if(Ve.source=le,re){if(U===ve.maxZoom||U===re)continue;var Mt=1<<re-U;if($!==Math.floor(ye/Mt)||ie!==Math.floor(Te/Mt))continue}else if(U===ve.indexMaxZoom||Ve.numPoints<=ve.indexMaxPoints)continue;if(Ve.source=null,0!==le.length){Ce>1&&console.time("clipping");var ht,Wt,$t,Qn,nn,fn,pn=.5*ve.buffer/ve.extent,oi=.5-pn,wi=.5+pn,ti=1+pn;ht=Wt=$t=Qn=null,nn=ss(le,je,$-pn,$+wi,0,Ve.minX,Ve.maxX,ve),fn=ss(le,je,$+oi,$+ti,0,Ve.minX,Ve.maxX,ve),le=null,nn&&(ht=ss(nn,je,ie-pn,ie+wi,1,Ve.minY,Ve.maxY,ve),Wt=ss(nn,je,ie+oi,ie+ti,1,Ve.minY,Ve.maxY,ve),nn=null),fn&&($t=ss(fn,je,ie-pn,ie+wi,1,Ve.minY,Ve.maxY,ve),Qn=ss(fn,je,ie+oi,ie+ti,1,Ve.minY,Ve.maxY,ve),fn=null),Ce>1&&console.timeEnd("clipping"),we.push(ht||[],U+1,2*$,2*ie),we.push(Wt||[],U+1,2*$,2*ie+1),we.push($t||[],U+1,2*$+1,2*ie),we.push(Qn||[],U+1,2*$+1,2*ie+1)}}},Wo.prototype.getTile=function(le,U,$){var ie=this.options,re=ie.extent,ye=ie.debug;if(le<0||le>24)return null;var Te=1<<le,we=Ja(le,U=(U%Te+Te)%Te,$);if(this.tiles[we])return Aa(this.tiles[we],re);ye>1&&console.log("drilling down to z%d-%d-%d",le,U,$);for(var ve,Ce=le,je=U,et=$;!ve&&Ce>0;)Ce--,je=Math.floor(je/2),et=Math.floor(et/2),ve=this.tiles[Ja(Ce,je,et)];return ve&&ve.source?(ye>1&&console.log("found parent tile z%d-%d-%d",Ce,je,et),ye>1&&console.time("drilling down"),this.splitTile(ve.source,Ce,je,et,le,U,$),ye>1&&console.timeEnd("drilling down"),this.tiles[we]?Aa(this.tiles[we],re):null):null};class ic extends vt{constructor(U,$,ie,re){super(U,$,ie,Cl),re&&(this.loadGeoJSON=re)}loadData(U,$){var ie;null===(ie=this._pendingRequest)||void 0===ie||ie.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const re=!!(U&&U.request&&U.request.collectResourceTiming)&&new w.RequestPerformance(U.request);this._pendingCallback=$,this._pendingRequest=this.loadGeoJSON(U,(ye,Te)=>{if(delete this._pendingCallback,delete this._pendingRequest,ye||!Te)return $(ye);if("object"!=typeof Te)return $(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`));{di(Te,!0);try{if(U.filter){const ve=w.createExpression(U.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===ve.result)throw new Error(ve.value.map(je=>`${je.key}: ${je.message}`).join(", "));const Ce=Te.features.filter(je=>ve.value.evaluate({zoom:0},je));Te={type:"FeatureCollection",features:Ce}}this._geoJSONIndex=U.cluster?new _r(function({superclusterOptions:ve,clusterProperties:Ce}){if(!Ce||!ve)return ve;const je={},et={},Ve={accumulated:null,zoom:0},Et={properties:null},Mt=Object.keys(Ce);for(const ht of Mt){const[Wt,$t]=Ce[ht],Qn=w.createExpression($t),nn=w.createExpression("string"==typeof Wt?[Wt,["accumulated"],["get",ht]]:Wt);je[ht]=Qn.value,et[ht]=nn.value}return ve.map=ht=>{Et.properties=ht;const Wt={};for(const $t of Mt)Wt[$t]=je[$t].evaluate(Ve,Et);return Wt},ve.reduce=(ht,Wt)=>{Et.properties=Wt;for(const $t of Mt)Ve.accumulated=ht[$t],ht[$t]=et[$t].evaluate(Ve,Et)},ve}(U)).load(Te.features):new Wo(ve=Te,U.geojsonVtOptions)}catch(ve){return $(ve)}this.loaded={};const we={};if(re){const ve=re.finish();ve&&(we.resourceTiming={},we.resourceTiming[U.source]=JSON.parse(JSON.stringify(ve)))}$(null,we)}var ve})}reloadTile(U,$){const ie=this.loaded;return ie&&ie[U.uid]?super.reloadTile(U,$):this.loadTile(U,$)}loadGeoJSON(U,$){if(U.request)return w.getJSON(U.request,$);if("string"==typeof U.data)try{$(null,JSON.parse(U.data))}catch{$(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`))}else $(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(U,$){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),$()}getClusterExpansionZoom(U,$){try{$(null,this._geoJSONIndex.getClusterExpansionZoom(U.clusterId))}catch(ie){$(ie)}}getClusterChildren(U,$){try{$(null,this._geoJSONIndex.getChildren(U.clusterId))}catch(ie){$(ie)}}getClusterLeaves(U,$){try{$(null,this._geoJSONIndex.getLeaves(U.clusterId,U.limit,U.offset))}catch(ie){$(ie)}}}class ha{constructor(U){this.self=U,this.actor=new w.Actor(U,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:vt,geojson:ic},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=($,ie)=>{if(this.workerSourceTypes[$])throw new Error(`Worker source with name "${$}" already registered.`);this.workerSourceTypes[$]=ie},this.self.registerRTLTextPlugin=$=>{if(w.plugin.isParsed())throw new Error("RTL text plugin already registered.");w.plugin.applyArabicShaping=$.applyArabicShaping,w.plugin.processBidirectionalText=$.processBidirectionalText,w.plugin.processStyledBidirectionalText=$.processStyledBidirectionalText}}setReferrer(U,$){this.referrer=$}setImages(U,$,ie){this.availableImages[U]=$;for(const re in this.workerSources[U]){const ye=this.workerSources[U][re];for(const Te in ye)ye[Te].availableImages=$}ie()}setLayers(U,$,ie){this.getLayerIndex(U).replace($),ie()}updateLayers(U,$,ie){this.getLayerIndex(U).update($.layers,$.removedIds),ie()}loadTile(U,$,ie){this.getWorkerSource(U,$.type,$.source).loadTile($,ie)}loadDEMTile(U,$,ie){this.getDEMWorkerSource(U,$.source).loadTile($,ie)}reloadTile(U,$,ie){this.getWorkerSource(U,$.type,$.source).reloadTile($,ie)}abortTile(U,$,ie){this.getWorkerSource(U,$.type,$.source).abortTile($,ie)}removeTile(U,$,ie){this.getWorkerSource(U,$.type,$.source).removeTile($,ie)}removeDEMTile(U,$){this.getDEMWorkerSource(U,$.source).removeTile($)}removeSource(U,$,ie){if(!this.workerSources[U]||!this.workerSources[U][$.type]||!this.workerSources[U][$.type][$.source])return;const re=this.workerSources[U][$.type][$.source];delete this.workerSources[U][$.type][$.source],void 0!==re.removeSource?re.removeSource($,ie):ie()}loadWorkerSource(U,$,ie){try{this.self.importScripts($.url),ie()}catch(re){ie(re.toString())}}syncRTLPluginState(U,$,ie){try{w.plugin.setState($);const re=w.plugin.getPluginURL();if(w.plugin.isLoaded()&&!w.plugin.isParsed()&&null!=re){this.self.importScripts(re);const ye=w.plugin.isParsed();ie(ye?void 0:new Error(`RTL Text Plugin failed to import scripts from ${re}`),ye)}}catch(re){ie(re.toString())}}getAvailableImages(U){let $=this.availableImages[U];return $||($=[]),$}getLayerIndex(U){let $=this.layerIndexes[U];return $||($=this.layerIndexes[U]=new yi),$}getWorkerSource(U,$,ie){return this.workerSources[U]||(this.workerSources[U]={}),this.workerSources[U][$]||(this.workerSources[U][$]={}),this.workerSources[U][$][ie]||(this.workerSources[U][$][ie]=new this.workerSourceTypes[$]({send:(ye,Te,we)=>{this.actor.send(ye,Te,we,U)}},this.getLayerIndex(U),this.getAvailableImages(U))),this.workerSources[U][$][ie]}getDEMWorkerSource(U,$){return this.demWorkerSources[U]||(this.demWorkerSources[U]={}),this.demWorkerSources[U][$]||(this.demWorkerSources[U][$]=new Mn),this.demWorkerSources[U][$]}enforceCacheSizeLimit(U,$){w.enforceCacheSizeLimit($)}}return w.isWorker()&&(self.worker=new ha(self)),ha}),me(0,function(w){var Gt=Fn;function Fn(v){return l=v,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,x,C=new Blob([""],{type:"text/javascript"}),P=URL.createObjectURL(C);try{x=new Worker(P),_=!0}catch{_=!1}return x&&x.terminate(),URL.revokeObjectURL(P),_}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var _=document.createElement("canvas");_.width=_.height=1;var x=_.getContext("2d");if(!x)return!1;var C=x.getImageData(0,0,1,1);return C&&C.width===_.width}()||(void 0===yi[d=l&&l.failIfMajorPerformanceCaveat]&&(yi[d]=function(_){var x,P,L,N,C=(P=_,L=document.createElement("canvas"),(N=Object.create(Fn.webGLContextAttributes)).failIfMajorPerformanceCaveat=P,L.getContext("webgl",N)||L.getContext("experimental-webgl",N));if(!C)return!1;try{x=C.createShader(C.VERTEX_SHADER)}catch{return!1}return!(!x||C.isContextLost())&&(C.shaderSource(x,"void main() {}"),C.compileShader(x),!0===C.getShaderParameter(x,C.COMPILE_STATUS))}(d)),!yi[d]||document.documentMode));var l,d}var yi={};function en(v,l){if(Array.isArray(v)){if(!Array.isArray(l)||v.length!==l.length)return!1;for(let d=0;d<v.length;d++)if(!en(v[d],l[d]))return!1;return!0}if("object"==typeof v&&null!==v&&null!==l){if("object"!=typeof l||Object.keys(v).length!==Object.keys(l).length)return!1;for(const d in v)if(!en(v[d],l[d]))return!1;return!0}return v===l}Fn.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class Ne{static testProp(l){if(!Ne.docStyle)return l[0];for(let d=0;d<l.length;d++)if(l[d]in Ne.docStyle)return l[d];return l[0]}static create(l,d,_){const x=window.document.createElement(l);return void 0!==d&&(x.className=d),_&&_.appendChild(x),x}static createNS(l,d){return window.document.createElementNS(l,d)}static disableDrag(){Ne.docStyle&&Ne.selectProp&&(Ne.userSelect=Ne.docStyle[Ne.selectProp],Ne.docStyle[Ne.selectProp]="none")}static enableDrag(){Ne.docStyle&&Ne.selectProp&&(Ne.docStyle[Ne.selectProp]=Ne.userSelect)}static setTransform(l,d){l.style[Ne.transformProp]=d}static addEventListener(l,d,_,x={}){l.addEventListener(d,_,"passive"in x?x:x.capture)}static removeEventListener(l,d,_,x={}){l.removeEventListener(d,_,"passive"in x?x:x.capture)}static suppressClickInternal(l){l.preventDefault(),l.stopPropagation(),window.removeEventListener("click",Ne.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Ne.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",Ne.suppressClickInternal,!0)},0)}static mousePos(l,d){const _=l.getBoundingClientRect();return new w.pointGeometry(d.clientX-_.left-l.clientLeft,d.clientY-_.top-l.clientTop)}static touchPos(l,d){const _=l.getBoundingClientRect(),x=[];for(let C=0;C<d.length;C++)x.push(new w.pointGeometry(d[C].clientX-_.left-l.clientLeft,d[C].clientY-_.top-l.clientTop));return x}static mouseButton(l){return l.button}static remove(l){l.parentNode&&l.parentNode.removeChild(l)}}Ne.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,Ne.selectProp=Ne.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Ne.transformProp=Ne.testProp(["transform","WebkitTransform"]);class wn{constructor(l){this._transformRequestFn=l}transformRequest(l,d){return this._transformRequestFn&&this._transformRequestFn(l,d)||{url:l}}normalizeSpriteURL(l,d,_){const x=function(C){const P=C.match(sn);if(!P)throw new Error(`Unable to parse URL "${C}"`);return{protocol:P[1],authority:P[2],path:P[3]||"/",params:P[4]?P[4].split("&"):[]}}(l);return x.path+=`${d}${_}`,function(C){const P=C.params.length?`?${C.params.join("&")}`:"";return`${C.protocol}://${C.authority}${C.path}${P}`}(x)}setTransformRequest(l){this._transformRequestFn=l}}const sn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class vt{constructor(l,d,_,x){this.context=l,this.format=_,this.texture=l.gl.createTexture(),this.update(d,x)}update(l,d,_){const{width:x,height:C}=l,P=!(this.size&&this.size[0]===x&&this.size[1]===C||_),{context:L}=this,{gl:N}=L;if(this.useMipmap=Boolean(d&&d.useMipmap),N.bindTexture(N.TEXTURE_2D,this.texture),L.pixelStoreUnpackFlipY.set(!1),L.pixelStoreUnpack.set(1),L.pixelStoreUnpackPremultiplyAlpha.set(this.format===N.RGBA&&(!d||!1!==d.premultiply)),P)this.size=[x,C],l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||w.isImageBitmap(l)?N.texImage2D(N.TEXTURE_2D,0,this.format,this.format,N.UNSIGNED_BYTE,l):N.texImage2D(N.TEXTURE_2D,0,this.format,x,C,0,this.format,N.UNSIGNED_BYTE,l.data);else{const{x:I,y:H}=_||{x:0,y:0};l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||w.isImageBitmap(l)?N.texSubImage2D(N.TEXTURE_2D,0,I,H,N.RGBA,N.UNSIGNED_BYTE,l):N.texSubImage2D(N.TEXTURE_2D,0,I,H,x,C,N.RGBA,N.UNSIGNED_BYTE,l.data)}this.useMipmap&&this.isSizePowerOfTwo()&&N.generateMipmap(N.TEXTURE_2D)}bind(l,d,_){const{context:x}=this,{gl:C}=x;C.bindTexture(C.TEXTURE_2D,this.texture),_!==C.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(_=C.LINEAR),l!==this.filter&&(C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MAG_FILTER,l),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MIN_FILTER,_||l),this.filter=l),d!==this.wrap&&(C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_S,d),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_T,d),this.wrap=d)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}}function Mn(v){const{userImage:l}=v;return!!(l&&l.render&&l.render())&&(v.data.replace(new Uint8Array(l.data.buffer)),!0)}class di extends w.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new w.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(l){if(this.loaded!==l&&(this.loaded=l,l)){for(const{ids:d,callback:_}of this.requestors)this._notify(d,_);this.requestors=[]}}getImage(l){return this.images[l]}addImage(l,d){if(this.images[l])throw new Error(`Image id ${l} already exist, use updateImage instead`);this._validate(l,d)&&(this.images[l]=d)}_validate(l,d){let _=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new w.ErrorEvent(new Error(`Image "${l}" has invalid "stretchX" value`))),_=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new w.ErrorEvent(new Error(`Image "${l}" has invalid "stretchY" value`))),_=!1),this._validateContent(d.content,d)||(this.fire(new w.ErrorEvent(new Error(`Image "${l}" has invalid "content" value`))),_=!1),_}_validateStretch(l,d){if(!l)return!0;let _=0;for(const x of l){if(x[0]<_||x[1]<x[0]||d<x[1])return!1;_=x[1]}return!0}_validateContent(l,d){return!(l&&(4!==l.length||l[0]<0||d.data.width<l[0]||l[1]<0||d.data.height<l[1]||l[2]<0||d.data.width<l[2]||l[3]<0||d.data.height<l[3]||l[2]<l[0]||l[3]<l[1]))}updateImage(l,d){const _=this.images[l];if(_.data.width!==d.data.width||_.data.height!==d.data.height)throw new Error(`size mismatch between old image (${_.data.width}x${_.data.height}) and new image (${d.data.width}x${d.data.height}).`);d.version=_.version+1,this.images[l]=d,this.updatedImages[l]=!0}removeImage(l){const d=this.images[l];delete this.images[l],delete this.patterns[l],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(l,d){let _=!0;if(!this.isLoaded())for(const x of l)this.images[x]||(_=!1);this.isLoaded()||_?this._notify(l,d):this.requestors.push({ids:l,callback:d})}_notify(l,d){const _={};for(const x of l){this.images[x]||this.fire(new w.Event("styleimagemissing",{id:x}));const C=this.images[x];C?_[x]={data:C.data.clone(),pixelRatio:C.pixelRatio,sdf:C.sdf,version:C.version,stretchX:C.stretchX,stretchY:C.stretchY,content:C.content,hasRenderCallback:Boolean(C.userImage&&C.userImage.render)}:w.warnOnce(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}d(null,_)}getPixelSize(){const{width:l,height:d}=this.atlasImage;return{width:l,height:d}}getPattern(l){const d=this.patterns[l],_=this.getImage(l);if(!_)return null;if(d&&d.position.version===_.version)return d.position;if(d)d.position.version=_.version;else{const x={w:_.data.width+2,h:_.data.height+2,x:0,y:0},C=new w.ImagePosition(x,_);this.patterns[l]={bin:x,position:C}}return this._updatePatternAtlas(),this.patterns[l].position}bind(l){const d=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new vt(l,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const l=[];for(const C in this.patterns)l.push(this.patterns[C].bin);const{w:d,h:_}=w.potpack(l),x=this.atlasImage;x.resize({width:d||1,height:_||1});for(const C in this.patterns){const{bin:P}=this.patterns[C],L=P.x+1,N=P.y+1,I=this.images[C].data,H=I.width,q=I.height;w.RGBAImage.copy(I,x,{x:0,y:0},{x:L,y:N},{width:H,height:q}),w.RGBAImage.copy(I,x,{x:0,y:q-1},{x:L,y:N-1},{width:H,height:1}),w.RGBAImage.copy(I,x,{x:0,y:0},{x:L,y:N+q},{width:H,height:1}),w.RGBAImage.copy(I,x,{x:H-1,y:0},{x:L-1,y:N},{width:1,height:q}),w.RGBAImage.copy(I,x,{x:0,y:0},{x:L+H,y:N},{width:1,height:q})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(l){for(const d of l){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const _=this.images[d];_||w.warnOnce(`Image with ID: "${d}" was not found`),Mn(_)&&this.updateImage(d,_)}}}const Jn=1e20;function xn(v,l,d,_,x,C,P,L,N){for(let I=l;I<l+_;I++)er(v,d*C+I,C,x,P,L,N);for(let I=d;I<d+x;I++)er(v,I*C+l,1,_,P,L,N)}function er(v,l,d,_,x,C,P){C[0]=0,P[0]=-Jn,P[1]=Jn,x[0]=v[l];for(let L=1,N=0,I=0;L<_;L++){x[L]=v[l+L*d];const H=L*L;do{const q=C[N];I=(x[L]-x[q]+H-q*q)/(L-q)/2}while(I<=P[N]&&--N>-1);N++,C[N]=L,P[N]=I,P[N+1]=Jn}for(let L=0,N=0;L<_;L++){for(;P[N+1]<L;)N++;const I=C[N],H=L-I;v[l+L*d]=x[I]+H*H}}class Ci{constructor(l,d){this.requestManager=l,this.localIdeographFontFamily=d,this.entries={}}setURL(l){this.url=l}getGlyphs(l,d){const _=[];for(const x in l)for(const C of l[x])_.push({stack:x,id:C});w.asyncAll(_,({stack:x,id:C},P)=>{let L=this.entries[x];L||(L=this.entries[x]={glyphs:{},requests:{},ranges:{}});let N=L.glyphs[C];if(void 0!==N)return void P(null,{stack:x,id:C,glyph:N});if(N=this._tinySDF(L,x,C),N)return L.glyphs[C]=N,void P(null,{stack:x,id:C,glyph:N});const I=Math.floor(C/256);if(256*I>65535)return void P(new Error("glyphs > 65535 not supported"));if(L.ranges[I])return void P(null,{stack:x,id:C,glyph:N});let H=L.requests[I];H||(H=L.requests[I]=[],Ci.loadGlyphRange(x,I,this.url,this.requestManager,(q,Q)=>{if(Q){for(const ce in Q)this._doesCharSupportLocalGlyph(+ce)||(L.glyphs[+ce]=Q[+ce]);L.ranges[I]=!0}for(const ce of H)ce(q,Q);delete L.requests[I]})),H.push((q,Q)=>{q?P(q):Q&&P(null,{stack:x,id:C,glyph:Q[C]||null})})},(x,C)=>{if(x)d(x);else if(C){const P={};for(const{stack:L,id:N,glyph:I}of C)(P[L]||(P[L]={}))[N]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics};d(null,P)}})}_doesCharSupportLocalGlyph(l){return!!this.localIdeographFontFamily&&(w.unicodeBlockLookup["CJK Unified Ideographs"](l)||w.unicodeBlockLookup["Hangul Syllables"](l)||w.unicodeBlockLookup.Hiragana(l)||w.unicodeBlockLookup.Katakana(l))}_tinySDF(l,d,_){const x=this.localIdeographFontFamily;if(!x||!this._doesCharSupportLocalGlyph(_))return;let C=l.tinySDF;if(!C){let L="400";/bold/i.test(d)?L="900":/medium/i.test(d)?L="500":/light/i.test(d)&&(L="200"),C=l.tinySDF=new Ci.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:x,fontWeight:L})}const P=C.draw(String.fromCharCode(_));return{id:_,bitmap:new w.AlphaImage({width:P.width||30,height:P.height||30},P.data),metrics:{width:P.glyphWidth||24,height:P.glyphHeight||24,left:P.glyphLeft||0,top:P.glyphTop-27||-8,advance:P.glyphAdvance||24}}}}Ci.loadGlyphRange=function(v,l,d,_,x){const C=256*l,P=C+255,L=_.transformRequest(d.replace("{fontstack}",v).replace("{range}",`${C}-${P}`),w.ResourceType.Glyphs);w.getArrayBuffer(L,(N,I)=>{if(N)x(N);else if(I){const H={};for(const q of w.parseGlyphPbf(I))H[q.id]=q;x(null,H)}})},Ci.TinySDF=class{constructor({fontSize:v=24,buffer:l=3,radius:d=8,cutoff:_=.25,fontFamily:x="sans-serif",fontWeight:C="normal",fontStyle:P="normal"}={}){this.buffer=l,this.cutoff=_,this.radius=d;const L=this.size=v+4*l,N=this._createCanvas(L),I=this.ctx=N.getContext("2d",{willReadFrequently:!0});I.font=`${P} ${C} ${v}px ${x}`,I.textBaseline="alphabetic",I.textAlign="left",I.fillStyle="black",this.gridOuter=new Float64Array(L*L),this.gridInner=new Float64Array(L*L),this.f=new Float64Array(L),this.z=new Float64Array(L+1),this.v=new Uint16Array(L)}_createCanvas(v){const l=document.createElement("canvas");return l.width=l.height=v,l}draw(v){const{width:l,actualBoundingBoxAscent:d,actualBoundingBoxDescent:_,actualBoundingBoxLeft:x,actualBoundingBoxRight:C}=this.ctx.measureText(v),P=Math.ceil(d),L=Math.min(this.size-this.buffer,Math.ceil(C-x)),N=Math.min(this.size-this.buffer,P+Math.ceil(_)),I=L+2*this.buffer,H=N+2*this.buffer,q=Math.max(I*H,0),Q=new Uint8ClampedArray(q),ce={data:Q,width:I,height:H,glyphWidth:L,glyphHeight:N,glyphTop:P,glyphLeft:0,glyphAdvance:l};if(0===L||0===N)return ce;const{ctx:ue,buffer:he,gridInner:Ee,gridOuter:Me}=this;ue.clearRect(he,he,L,N),ue.fillText(v,he,he+P);const Re=ue.getImageData(he,he,L,N);Me.fill(Jn,0,q),Ee.fill(0,0,q);for(let fe=0;fe<N;fe++)for(let Be=0;Be<L;Be++){const ke=Re.data[4*(fe*L+Be)+3]/255;if(0===ke)continue;const We=(fe+he)*I+Be+he;if(1===ke)Me[We]=0,Ee[We]=Jn;else{const $e=.5-ke;Me[We]=$e>0?$e*$e:0,Ee[We]=$e<0?$e*$e:0}}xn(Me,0,0,I,H,I,this.f,this.v,this.z),xn(Ee,he,he,L,N,I,this.f,this.v,this.z);for(let fe=0;fe<q;fe++){const Be=Math.sqrt(Me[fe])-Math.sqrt(Ee[fe]);Q[fe]=Math.round(255-255*(Be/this.radius+this.cutoff))}return ce}};const si=new w.Properties({anchor:new w.DataConstantProperty(w.spec.light.anchor),position:new class{constructor(){this.specification=w.spec.light.position}possiblyEvaluate(v,l){return w.sphericalToCartesian(v.expression.evaluate(l))}interpolate(v,l,d){return{x:w.number(v.x,l.x,d),y:w.number(v.y,l.y,d),z:w.number(v.z,l.z,d)}}},color:new w.DataConstantProperty(w.spec.light.color),intensity:new w.DataConstantProperty(w.spec.light.intensity)}),is="-transition";class hr extends w.Evented{constructor(l){super(),this._transitionable=new w.Transitionable(si),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,d={}){if(!this._validate(w.validateLight,l,d))for(const _ in l){const x=l[_];_.endsWith(is)?this._transitionable.setTransition(_.slice(0,-is.length),x):this._transitionable.setValue(_,x)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,d,_){return(!_||!1!==_.validate)&&w.emitValidationErrors(this,l.call(w.validateStyle,w.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:w.spec})))}}class xo{constructor(l,d){this.width=l,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(l,d){const _=l.join(",")+String(d);return this.dashEntry[_]||(this.dashEntry[_]=this.addDash(l,d)),this.dashEntry[_]}getDashRanges(l,d,_){const x=[];let C=l.length%2==1?-l[l.length-1]*_:0,P=l[0]*_,L=!0;x.push({left:C,right:P,isDash:L,zeroLength:0===l[0]});let N=l[0];for(let I=1;I<l.length;I++){L=!L;const H=l[I];C=N*_,N+=H,P=N*_,x.push({left:C,right:P,isDash:L,zeroLength:0===H})}return x}addRoundDash(l,d,_){const x=d/2;for(let C=-_;C<=_;C++){const P=this.width*(this.nextRow+_+C);let L=0,N=l[L];for(let I=0;I<this.width;I++){I/N.right>1&&(N=l[++L]);const H=Math.abs(I-N.left),q=Math.abs(I-N.right),Q=Math.min(H,q);let ce;const ue=C/_*(x+1);if(N.isDash){const he=x-Math.abs(ue);ce=Math.sqrt(Q*Q+he*he)}else ce=x-Math.sqrt(Q*Q+ue*ue);this.data[P+I]=Math.max(0,Math.min(255,ce+128))}}}addRegularDash(l){for(let L=l.length-1;L>=0;--L){const N=l[L],I=l[L+1];N.zeroLength?l.splice(L,1):I&&I.isDash===N.isDash&&(I.left=N.left,l.splice(L,1))}const d=l[0],_=l[l.length-1];d.isDash===_.isDash&&(d.left=_.left-this.width,_.right=d.right+this.width);const x=this.width*this.nextRow;let C=0,P=l[C];for(let L=0;L<this.width;L++){L/P.right>1&&(P=l[++C]);const N=Math.abs(L-P.left),I=Math.abs(L-P.right),H=Math.min(N,I);this.data[x+L]=Math.max(0,Math.min(255,(P.isDash?H:-H)+128))}}addDash(l,d){const _=d?7:0,x=2*_+1;if(this.nextRow+x>this.height)return w.warnOnce("LineAtlas out of space"),null;let C=0;for(let L=0;L<l.length;L++)C+=l[L];if(0!==C){const L=this.width/C,N=this.getDashRanges(l,this.width,L);d?this.addRoundDash(N,L,_):this.addRegularDash(N)}const P={y:(this.nextRow+_+.5)/this.height,height:2*_/this.height,width:C};return this.nextRow+=x,this.dirty=!0,P}bind(l){const d=l.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))}}class Ir{constructor(l,d){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=w.uniqueId();const _=this.workerPool.acquire(this.id);for(let x=0;x<_.length;x++){const C=new Ir.Actor(_[x],d,this.id);C.name=`Worker ${x}`,this.actors.push(C)}if(!this.actors.length)throw new Error("No actors found")}broadcast(l,d,_){w.asyncAll(this.actors,(x,C)=>{x.send(l,d,C)},_=_||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(l=>{l.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Zr(v,l,d){const _=function(x,C){if(x)return d(x);if(C){const P=w.pick(w.extend(C,v),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);C.vector_layers&&(P.vectorLayers=C.vector_layers,P.vectorLayerIds=P.vectorLayers.map(L=>L.id)),d(null,P)}};return v.url?w.getJSON(l.transformRequest(v.url,w.ResourceType.Source),_):w.exported.frame(()=>_(null,v))}Ir.Actor=w.Actor;class Is{constructor(l,d,_){this.bounds=w.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=d||0,this.maxzoom=_||24}validateBounds(l){return Array.isArray(l)&&4===l.length?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const d=Math.pow(2,l.z),_=Math.floor(w.mercatorXfromLng(this.bounds.getWest())*d),x=Math.floor(w.mercatorYfromLat(this.bounds.getNorth())*d),C=Math.ceil(w.mercatorXfromLng(this.bounds.getEast())*d),P=Math.ceil(w.mercatorYfromLat(this.bounds.getSouth())*d);return l.x>=_&&l.x<C&&l.y>=x&&l.y<P}}class wo extends w.Evented{constructor(l,d,_,x){if(super(),this.id=l,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,w.extend(this,w.pick(d,["url","scheme","tileSize","promoteId"])),this._options=w.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x)}load(){this._loaded=!1,this.fire(new w.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Zr(this._options,this.map._requestManager,(l,d)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),l?this.fire(new w.ErrorEvent(l)):d&&(w.extend(this,d),d.bounds&&(this.tileBounds=new Is(d.bounds,this.minzoom,this.maxzoom)),this.fire(new w.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new w.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}setSourceProperty(l){this._tileJSONRequest&&this._tileJSONRequest.cancel(),l(),this.load()}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return w.extend({},this._options)}loadTile(l,d){const _=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),x={request:this.map._requestManager.transformRequest(_,w.ResourceType.Tile),uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function C(P,L){return delete l.request,l.aborted?d(null):P&&404!==P.status?d(P):(L&&L.resourceTiming&&(l.resourceTiming=L.resourceTiming),this.map._refreshExpiredTiles&&L&&l.setExpiryData(L),l.loadVectorData(L,this.map.painter),w.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}x.request.collectResourceTiming=this._collectResourceTiming,l.actor&&"expired"!==l.state?"loading"===l.state?l.reloadCallback=d:l.request=l.actor.send("reloadTile",x,C.bind(this)):(l.actor=this.dispatcher.getActor(),l.request=l.actor.send("loadTile",x,C.bind(this)))}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id},void 0)}unloadTile(l){l.unloadVectorData(),l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Xs extends w.Evented{constructor(l,d,_,x){super(),this.id=l,this.dispatcher=_,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=w.extend({type:"raster"},d),w.extend(this,w.pick(d,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new w.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Zr(this._options,this.map._requestManager,(l,d)=>{this._tileJSONRequest=null,this._loaded=!0,l?this.fire(new w.ErrorEvent(l)):d&&(w.extend(this,d),d.bounds&&(this.tileBounds=new Is(d.bounds,this.minzoom,this.maxzoom)),this.fire(new w.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new w.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return w.extend({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,d){const _=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);l.request=w.getImage(this.map._requestManager.transformRequest(_,w.ResourceType.Tile),(x,C,P)=>{if(delete l.request,l.aborted)l.state="unloaded",d(null);else if(x)l.state="errored",d(x);else if(C){this.map._refreshExpiredTiles&&l.setExpiryData(P);const L=this.map.painter.context,N=L.gl;l.texture=this.map.painter.getTileTexture(C.width),l.texture?l.texture.update(C,{useMipmap:!0}):(l.texture=new vt(L,C,N.RGBA,{useMipmap:!0}),l.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST),L.extTextureFilterAnisotropic&&N.texParameterf(N.TEXTURE_2D,L.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,L.extTextureFilterAnisotropicMax)),l.state="loaded",w.cacheEntryPossiblyAdded(this.dispatcher),d(null)}})}abortTile(l,d){l.request&&(l.request.cancel(),delete l.request),d()}unloadTile(l,d){l.texture&&this.map.painter.saveTileTexture(l.texture),d()}hasTransition(){return!1}}let Ys;class Zt extends Xs{constructor(l,d,_,x){super(l,d,_,x),this.type="raster-dem",this.maxzoom=22,this._options=w.extend({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(l,d){const _=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function x(C,P){C&&(l.state="errored",d(C)),P&&(l.dem=P,l.needsHillshadePrepare=!0,l.needsTerrainPrepare=!0,l.state="loaded",d(null))}l.request=w.getImage(this.map._requestManager.transformRequest(_,w.ResourceType.Tile),function(C,P){if(delete l.request,l.aborted)l.state="unloaded",d(null);else if(C)l.state="errored",d(C);else if(P){this.map._refreshExpiredTiles&&l.setExpiryData(P),delete P.cacheControl,delete P.expires;const L=w.isImageBitmap(P)&&(null==Ys&&(Ys=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof createImageBitmap),Ys)?P:w.exported.getImageData(P,1),N={uid:l.uid,coord:l.tileID,source:this.id,rawImageData:L,encoding:this.encoding};l.actor&&"expired"!==l.state||(l.actor=this.dispatcher.getActor(),l.actor.send("loadDEMTile",N,x.bind(this)))}}.bind(this)),l.neighboringTiles=this._getNeighboringTiles(l.tileID)}_getNeighboringTiles(l){const d=l.canonical,_=Math.pow(2,d.z),x=(d.x-1+_)%_,C=0===d.x?l.wrap-1:l.wrap,P=(d.x+1+_)%_,L=d.x+1===_?l.wrap+1:l.wrap,N={};return N[new w.OverscaledTileID(l.overscaledZ,C,d.z,x,d.y).key]={backfilled:!1},N[new w.OverscaledTileID(l.overscaledZ,L,d.z,P,d.y).key]={backfilled:!1},d.y>0&&(N[new w.OverscaledTileID(l.overscaledZ,C,d.z,x,d.y-1).key]={backfilled:!1},N[new w.OverscaledTileID(l.overscaledZ,l.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},N[new w.OverscaledTileID(l.overscaledZ,L,d.z,P,d.y-1).key]={backfilled:!1}),d.y+1<_&&(N[new w.OverscaledTileID(l.overscaledZ,C,d.z,x,d.y+1).key]={backfilled:!1},N[new w.OverscaledTileID(l.overscaledZ,l.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},N[new w.OverscaledTileID(l.overscaledZ,L,d.z,P,d.y+1).key]={backfilled:!1}),N}unloadTile(l){l.demTexture&&this.map.painter.saveTileTexture(l.demTexture),l.fbo&&(l.fbo.destroy(),delete l.fbo),l.dem&&delete l.dem,delete l.neighboringTiles,l.state="unloaded",l.actor&&l.actor.send("removeDEMTile",{uid:l.uid,source:this.id})}}class ys extends w.Evented{constructor(l,d,_,x){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=_.getActor(),this.setEventedParent(x),this._data=d.data,this._options=w.extend({},d),this._collectResourceTiming=d.collectResourceTiming,void 0!==d.maxzoom&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;const C=w.EXTENT/this.tileSize;this.workerOptions=w.extend({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(void 0!==d.buffer?d.buffer:128)*C,tolerance:(void 0!==d.tolerance?d.tolerance:.375)*C,extent:w.EXTENT,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:void 0!==d.clusterMaxZoom?d.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:w.EXTENT,radius:(d.clusterRadius||50)*C,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(l){this.map=l,this.load()}setData(l){return this._data=l,this._updateWorkerData("content"),this}getClusterExpansionZoom(l,d){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:l,source:this.id},d),this}getClusterChildren(l,d){return this.actor.send("geojson.getClusterChildren",{clusterId:l,source:this.id},d),this}getClusterLeaves(l,d,_,x){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:l,limit:d,offset:_},x),this}_updateWorkerData(l){const d=w.extend({},this.workerOptions),_=this._data;"string"==typeof _?(d.request=this.map._requestManager.transformRequest(w.exported.resolveURL(_),w.ResourceType.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(_),this._pendingLoads++,this.fire(new w.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,d,(x,C)=>{if(this._pendingLoads--,this._removed||C&&C.abandoned)return void this.fire(new w.Event("dataabort",{dataType:"source",sourceDataType:l}));let P=null;if(C&&C.resourceTiming&&C.resourceTiming[this.id]&&(P=C.resourceTiming[this.id].slice(0)),x)return void this.fire(new w.ErrorEvent(x));const L={dataType:"source",sourceDataType:l};this._collectResourceTiming&&P&&P.length>0&&w.extend(L,{resourceTiming:P}),this.fire(new w.Event("data",L))})}loaded(){return 0===this._pendingLoads}loadTile(l,d){const _=l.actor?"reloadTile":"loadTile";l.actor=this.actor;const x={type:this.type,uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};l.request=this.actor.send(_,x,(C,P)=>(delete l.request,l.unloadVectorData(),l.aborted?d(null):C?d(C):(l.loadVectorData(P,this.map.painter,"reloadTile"===_),d(null))))}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.aborted=!0}unloadTile(l){l.unloadVectorData(),this.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return w.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var jo=w.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Eo extends w.Evented{constructor(l,d,_,x){super(),this.id=l,this.dispatcher=_,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=d}load(l,d){this._loaded=!1,this.fire(new w.Event("dataloading",{dataType:"source"})),this.url=this.options.url,w.getImage(this.map._requestManager.transformRequest(this.url,w.ResourceType.Image),(_,x)=>{this._loaded=!0,_?this.fire(new w.ErrorEvent(_)):x&&(this.image=x,l&&(this.coordinates=l),d&&d(),this._finishLoading())})}loaded(){return this._loaded}updateImage(l){return this.image&&l.url?(this.options.url=l.url,this.load(l.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new w.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}setCoordinates(l){this.coordinates=l;const d=l.map(w.MercatorCoordinate.fromLngLat);this.tileID=function(x){let C=1/0,P=1/0,L=-1/0,N=-1/0;for(const Q of x)C=Math.min(C,Q.x),P=Math.min(P,Q.y),L=Math.max(L,Q.x),N=Math.max(N,Q.y);const I=Math.max(L-C,N-P),H=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),q=Math.pow(2,H);return new w.CanonicalTileID(H,Math.floor((C+L)/2*q),Math.floor((P+N)/2*q))}(d),this.minzoom=this.maxzoom=this.tileID.z;const _=d.map(x=>this.tileID.getTilePoint(x)._round());return this._boundsArray=new w.RasterBoundsArray,this._boundsArray.emplaceBack(_[0].x,_[0].y,0,0),this._boundsArray.emplaceBack(_[1].x,_[1].y,w.EXTENT,0),this._boundsArray.emplaceBack(_[3].x,_[3].y,0,w.EXTENT),this._boundsArray.emplaceBack(_[2].x,_[2].y,w.EXTENT,w.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new w.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const l=this.map.painter.context,d=l.gl;this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,jo.members)),this.boundsSegments||(this.boundsSegments=w.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new vt(l,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));for(const _ in this.tiles){const x=this.tiles[_];"loaded"!==x.state&&(x.state="loaded",x.texture=this.texture)}}loadTile(l,d){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={},d(null)):(l.state="errored",d(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Yn extends Eo{constructor(l,d,_,x){super(l,d,_,x),this.roundZoom=!0,this.type="video",this.options=d}load(){this._loaded=!1;const l=this.options;this.urls=[];for(const d of l.urls)this.urls.push(this.map._requestManager.transformRequest(d,w.ResourceType.Source).url);w.getVideo(this.urls,(d,_)=>{this._loaded=!0,d?this.fire(new w.ErrorEvent(d)):_&&(this.video=_,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const d=this.video.seekable;l<d.start(0)||l>d.end(0)?this.fire(new w.ErrorEvent(new w.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${d.start(0)} and ${d.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const l=this.map.painter.context,d=l.gl;this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,jo.members)),this.boundsSegments||(this.boundsSegments=w.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new vt(l,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));for(const _ in this.tiles){const x=this.tiles[_];"loaded"!==x.state&&(x.state="loaded",x.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class vs extends Eo{constructor(l,d,_,x){super(l,d,_,x),d.coordinates?Array.isArray(d.coordinates)&&4===d.coordinates.length&&!d.coordinates.some(C=>!Array.isArray(C)||2!==C.length||C.some(P=>"number"!=typeof P))||this.fire(new w.ErrorEvent(new w.ValidationError(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new w.ErrorEvent(new w.ValidationError(`sources.${l}`,null,'missing required property "coordinates"'))),d.animate&&"boolean"!=typeof d.animate&&this.fire(new w.ErrorEvent(new w.ValidationError(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),d.canvas?"string"==typeof d.canvas||d.canvas instanceof HTMLCanvasElement||this.fire(new w.ErrorEvent(new w.ValidationError(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new w.ErrorEvent(new w.ValidationError(`sources.${l}`,null,'missing required property "canvas"'))),this.options=d,this.animate=void 0===d.animate||d.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new w.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const d=this.map.painter.context,_=d.gl;this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,jo.members)),this.boundsSegments||(this.boundsSegments=w.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(l||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new vt(d,this.canvas,_.RGBA,{premultiply:!0});for(const x in this.tiles){const C=this.tiles[x];"loaded"!==C.state&&(C.state="loaded",C.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}}const tc={vector:wo,raster:Xs,"raster-dem":Zt,geojson:ys,video:Yn,image:Eo,canvas:vs};function aa(v,l){const d=w.create();return w.translate(d,d,[1,1,0]),w.scale(d,d,[.5*v.width,.5*v.height,1]),w.multiply(d,d,v.calculatePosMatrix(l.toUnwrapped()))}function Ps(v,l,d,_,x,C){const P=function(q,Q,ce){if(q)for(const ue of q){const he=Q[ue];if(he&&he.source===ce&&"fill-extrusion"===he.type)return!0}else for(const ue in Q){const he=Q[ue];if(he.source===ce&&"fill-extrusion"===he.type)return!0}return!1}(x&&x.layers,l,v.id),L=C.maxPitchScaleFactor(),N=v.tilesIn(_,L,P);N.sort(Fi);const I=[];for(const q of N)I.push({wrappedTileID:q.tileID.wrapped().key,queryResults:q.tile.queryRenderedFeatures(l,d,v._state,q.queryGeometry,q.cameraQueryGeometry,q.scale,x,C,L,aa(v.transform,q.tileID))});const H=function(q){const Q={},ce={};for(const ue of q){const he=ue.queryResults,Ee=ue.wrappedTileID,Me=ce[Ee]=ce[Ee]||{};for(const Re in he){const fe=he[Re],Be=Me[Re]=Me[Re]||{},ke=Q[Re]=Q[Re]||[];for(const We of fe)Be[We.featureIndex]||(Be[We.featureIndex]=!0,ke.push(We))}}return Q}(I);for(const q in H)H[q].forEach(Q=>{const ce=Q.feature,ue=v.getFeatureState(ce.layer["source-layer"],ce.id);ce.source=ce.layer.source,ce.layer["source-layer"]&&(ce.sourceLayer=ce.layer["source-layer"]),ce.state=ue});return H}function Fi(v,l){const d=v.tileID,_=l.tileID;return d.overscaledZ-_.overscaledZ||d.canonical.y-_.canonical.y||d.wrap-_.wrap||d.canonical.x-_.canonical.x}class Ks{constructor(l,d){this.tileID=l,this.uid=w.uniqueId(),this.uses=0,this.tileSize=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(l){const d=l+this.timeAdded;d<w.exported.now()||this.fadeEndTime&&d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}clearTextures(l){this.demTexture&&l.saveTileTexture(this.demTexture),this.textures.forEach(d=>l.saveTileTexture(d)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(l,d,_){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",l){l.featureIndex&&(this.latestFeatureIndex=l.featureIndex,l.rawTileData?(this.latestRawTileData=l.rawTileData,this.latestFeatureIndex.rawTileData=l.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=l.collisionBoxArray,this.buckets=function(x,C){const P={};if(!C)return P;for(const L of x){const N=L.layerIds.map(I=>C.getLayer(I)).filter(Boolean);if(0!==N.length){L.layers=N,L.stateDependentLayerIds&&(L.stateDependentLayers=L.stateDependentLayerIds.map(I=>N.filter(H=>H.id===I)[0]));for(const I of N)P[I.id]=L}}return P}(l.buckets,d.style),this.hasSymbolBuckets=!1;for(const x in this.buckets){const C=this.buckets[x];if(C instanceof w.SymbolBucket){if(this.hasSymbolBuckets=!0,!_)break;C.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const x in this.buckets){const C=this.buckets[x];if(C instanceof w.SymbolBucket&&C.hasRTLText){this.hasRTLText=!0,w.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const x in this.buckets){const C=this.buckets[x];this.queryPadding=Math.max(this.queryPadding,d.style.getLayer(x).queryRadius(C))}l.imageAtlas&&(this.imageAtlas=l.imageAtlas),l.glyphAtlasImage&&(this.glyphAtlasImage=l.glyphAtlasImage)}else this.collisionBoxArray=new w.CollisionBoxArray}unloadVectorData(){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(l){return this.buckets[l.id]}upload(l){for(const _ in this.buckets){const x=this.buckets[_];x.uploadPending()&&x.upload(l)}const d=l.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new vt(l,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new vt(l,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)}prepare(l){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(l,this.imageAtlasTexture)}queryRenderedFeatures(l,d,_,x,C,P,L,N,I,H){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:x,cameraQueryGeometry:C,scale:P,tileSize:this.tileSize,pixelPosMatrix:H,transform:N,params:L,queryPadding:this.queryPadding*I},l,d,_):{}}querySourceFeatures(l,d){const _=this.latestFeatureIndex;if(!_||!_.rawTileData)return;const x=_.loadVTLayers(),C=d?d.sourceLayer:"",P=x._geojsonTileLayer||x[C];if(!P)return;const L=w.createFilter(d&&d.filter),{z:N,x:I,y:H}=this.tileID.canonical,q={z:N,x:I,y:H};for(let Q=0;Q<P.length;Q++){const ce=P.feature(Q);if(L.needGeometry){const Ee=w.toEvaluationFeature(ce,!0);if(!L.filter(new w.EvaluationParameters(this.tileID.overscaledZ),Ee,this.tileID.canonical))continue}else if(!L.filter(new w.EvaluationParameters(this.tileID.overscaledZ),ce))continue;const ue=_.getId(ce,C),he=new w.GeoJSONFeature(ce,N,I,H,ue);he.tile=q,l.push(he)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(l){const d=this.expirationTime;if(l.cacheControl){const _=w.parseCacheControl(l.cacheControl);_["max-age"]&&(this.expirationTime=Date.now()+1e3*_["max-age"])}else l.expires&&(this.expirationTime=new Date(l.expires).getTime());if(this.expirationTime){const _=Date.now();let x=!1;if(this.expirationTime>_)x=!1;else if(d)if(this.expirationTime<d)x=!0;else{const C=this.expirationTime-d;C?this.expirationTime=_+Math.max(C,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(l,d){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(l).length)return;const _=this.latestFeatureIndex.loadVTLayers();for(const x in this.buckets){if(!d.style.hasLayer(x))continue;const C=this.buckets[x],P=C.layers[0].sourceLayer||"_geojsonTileLayer",L=_[P],N=l[P];if(!L||!N||0===Object.keys(N).length)continue;C.update(N,L,this.imageAtlas&&this.imageAtlas.patternPositions||{});const I=d&&d.style&&d.style.getLayer(x);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(C)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<w.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(l){this.symbolFadeHoldUntil=w.exported.now()+l}setDependencies(l,d){const _={};for(const x of d)_[x]=!0;this.dependencies[l]=_}hasDependency(l,d){for(const _ of l){const x=this.dependencies[_];if(x)for(const C of d)if(x[C])return!0}return!1}}class Za{constructor(l,d){this.max=l,this.onRemove=d,this.reset()}reset(){for(const l in this.data)for(const d of this.data[l])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(l,d,_){const x=l.wrapped().key;void 0===this.data[x]&&(this.data[x]=[]);const C={value:d,timeout:void 0};if(void 0!==_&&(C.timeout=setTimeout(()=>{this.remove(l,C)},_)),this.data[x].push(C),this.order.push(x),this.order.length>this.max){const P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this}has(l){return l.wrapped().key in this.data}getAndRemove(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null}_getAndRemoveByKey(l){const d=this.data[l].shift();return d.timeout&&clearTimeout(d.timeout),0===this.data[l].length&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),d.value}getByKey(l){const d=this.data[l];return d?d[0].value:null}get(l){return this.has(l)?this.data[l.wrapped().key][0].value:null}remove(l,d){if(!this.has(l))return this;const _=l.wrapped().key,x=void 0===d?0:this.data[_].indexOf(d),C=this.data[_][x];return this.data[_].splice(x,1),C.timeout&&clearTimeout(C.timeout),0===this.data[_].length&&delete this.data[_],this.onRemove(C.value),this.order.splice(this.order.indexOf(_),1),this}setMaxSize(l){for(this.max=l;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(l){const d=[];for(const _ in this.data)for(const x of this.data[_])l(x.value)||d.push(x);for(const _ of d)this.remove(_.value.tileID,_)}}class ki{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(l,d,_){const x=String(d);if(this.stateChanges[l]=this.stateChanges[l]||{},this.stateChanges[l][x]=this.stateChanges[l][x]||{},w.extend(this.stateChanges[l][x],_),null===this.deletedStates[l]){this.deletedStates[l]={};for(const C in this.state[l])C!==x&&(this.deletedStates[l][C]=null)}else if(this.deletedStates[l]&&null===this.deletedStates[l][x]){this.deletedStates[l][x]={};for(const C in this.state[l][x])_[C]||(this.deletedStates[l][x][C]=null)}else for(const C in _)this.deletedStates[l]&&this.deletedStates[l][x]&&null===this.deletedStates[l][x][C]&&delete this.deletedStates[l][x][C]}removeFeatureState(l,d,_){if(null===this.deletedStates[l])return;const x=String(d);if(this.deletedStates[l]=this.deletedStates[l]||{},_&&void 0!==d)null!==this.deletedStates[l][x]&&(this.deletedStates[l][x]=this.deletedStates[l][x]||{},this.deletedStates[l][x][_]=null);else if(void 0!==d)if(this.stateChanges[l]&&this.stateChanges[l][x])for(_ in this.deletedStates[l][x]={},this.stateChanges[l][x])this.deletedStates[l][x][_]=null;else this.deletedStates[l][x]=null;else this.deletedStates[l]=null}getState(l,d){const _=String(d),x=w.extend({},(this.state[l]||{})[_],(this.stateChanges[l]||{})[_]);if(null===this.deletedStates[l])return{};if(this.deletedStates[l]){const C=this.deletedStates[l][d];if(null===C)return{};for(const P in C)delete x[P]}return x}initializeTileState(l,d){l.setFeatureState(this.state,d)}coalesceChanges(l,d){const _={};for(const x in this.stateChanges){this.state[x]=this.state[x]||{};const C={};for(const P in this.stateChanges[x])this.state[x][P]||(this.state[x][P]={}),w.extend(this.state[x][P],this.stateChanges[x][P]),C[P]=this.state[x][P];_[x]=C}for(const x in this.deletedStates){this.state[x]=this.state[x]||{};const C={};if(null===this.deletedStates[x])for(const P in this.state[x])C[P]={},this.state[x][P]={};else for(const P in this.deletedStates[x]){if(null===this.deletedStates[x][P])this.state[x][P]={};else for(const L of Object.keys(this.deletedStates[x][P]))delete this.state[x][P][L];C[P]=this.state[x][P]}_[x]=_[x]||{},w.extend(_[x],C)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(_).length)for(const x in l)l[x].setFeatureState(_,d)}}class vi extends w.Evented{constructor(l,d,_){super(),this.id=l,this.dispatcher=_,this.on("data",x=>{"source"===x.dataType&&"metadata"===x.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===x.dataType&&"content"===x.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(x,C,P,L){const N=new tc[C.type](x,C,P,L);if(N.id!==x)throw new Error(`Expected Source id to be ${x} instead of ${N.id}`);return w.bindAll(["load","abort","unload","serialize","prepare"],N),N}(l,d,_,this),this._tiles={},this._cache=new Za(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ki}onAdd(l){this.map=l,this._maxTileCacheSize=l?l._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(l)}onRemove(l){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(l)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const l in this._tiles){const d=this._tiles[l];if("loaded"!==d.state&&"errored"!==d.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const l=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,l&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(l,d){return this._source.loadTile(l,d)}_unloadTile(l){if(this._source.unloadTile)return this._source.unloadTile(l,()=>{})}_abortTile(l){this._source.abortTile&&this._source.abortTile(l,()=>{}),this._source.fire(new w.Event("dataabort",{tile:l,coord:l.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(l){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const _=this._tiles[d];_.upload(l),_.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(l=>l.tileID).sort(nc).map(l=>l.key)}getRenderableIds(l){const d=[];for(const _ in this._tiles)this._isIdRenderable(_,l)&&d.push(this._tiles[_]);return l?d.sort((_,x)=>{const C=_.tileID,P=x.tileID,L=new w.pointGeometry(C.canonical.x,C.canonical.y)._rotate(this.transform.angle),N=new w.pointGeometry(P.canonical.x,P.canonical.y)._rotate(this.transform.angle);return C.overscaledZ-P.overscaledZ||N.y-L.y||N.x-L.x}).map(_=>_.tileID.key):d.map(_=>_.tileID).sort(nc).map(_=>_.key)}hasRenderableParent(l){const d=this.findLoadedParent(l,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(l,d){return this._tiles[l]&&this._tiles[l].hasData()&&!this._coveredTiles[l]&&(d||!this._tiles[l].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const l in this._tiles)"errored"!==this._tiles[l].state&&this._reloadTile(l,"reloading")}}_reloadTile(l,d){const _=this._tiles[l];_&&("loading"!==_.state&&(_.state=d),this._loadTile(_,this._tileLoaded.bind(this,_,l,d)))}_tileLoaded(l,d,_,x){if(x)return l.state="errored",void(404!==x.status?this._source.fire(new w.ErrorEvent(x,{tile:l})):this.update(this.transform,this.terrain));l.timeAdded=w.exported.now(),"expired"===_&&(l.refreshedUponExpiration=!0),this._setTileReloadTimer(d,l),"raster-dem"===this.getSource().type&&l.dem&&this._backfillDEM(l),this._state.initializeTileState(l,this.map?this.map.painter:null),l.aborted||this._source.fire(new w.Event("data",{dataType:"source",tile:l,coord:l.tileID}))}_backfillDEM(l){const d=this.getRenderableIds();for(let x=0;x<d.length;x++){const C=d[x];if(l.neighboringTiles&&l.neighboringTiles[C]){const P=this.getTileByID(C);_(l,P),_(P,l)}}function _(x,C){x.needsHillshadePrepare=!0,x.needsTerrainPrepare=!0;let P=C.tileID.canonical.x-x.tileID.canonical.x;const L=C.tileID.canonical.y-x.tileID.canonical.y,N=Math.pow(2,x.tileID.canonical.z),I=C.tileID.key;0===P&&0===L||Math.abs(L)>1||(Math.abs(P)>1&&(1===Math.abs(P+N)?P+=N:1===Math.abs(P-N)&&(P-=N)),C.dem&&x.dem&&(x.dem.backfillBorder(C.dem,P,L),x.neighboringTiles&&x.neighboringTiles[I]&&(x.neighboringTiles[I].backfilled=!0)))}}getTile(l){return this.getTileByID(l.key)}getTileByID(l){return this._tiles[l]}_retainLoadedChildren(l,d,_,x){for(const C in this._tiles){let P=this._tiles[C];if(x[C]||!P.hasData()||P.tileID.overscaledZ<=d||P.tileID.overscaledZ>_)continue;let L=P.tileID;for(;P&&P.tileID.overscaledZ>d+1;){const I=P.tileID.scaledTo(P.tileID.overscaledZ-1);P=this._tiles[I.key],P&&P.hasData()&&(L=I)}let N=L;for(;N.overscaledZ>d;)if(N=N.scaledTo(N.overscaledZ-1),l[N.key]){x[L.key]=L;break}}}findLoadedParent(l,d){if(l.key in this._loadedParentTiles){const _=this._loadedParentTiles[l.key];return _&&_.tileID.overscaledZ>=d?_:null}for(let _=l.overscaledZ-1;_>=d;_--){const x=l.scaledTo(_),C=this._getLoadedTile(x);if(C)return C}}_getLoadedTile(l){const d=this._tiles[l.key];return d&&d.hasData()?d:this._cache.getByKey(l.wrapped().key)}updateCacheSize(l){const d=Math.ceil(l.width/this._source.tileSize)+1,_=Math.ceil(l.height/this._source.tileSize)+1,x=Math.floor(d*_*5),C="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(C)}handleWrapJump(l){const d=Math.round((l-(void 0===this._prevLng?l:this._prevLng))/360);if(this._prevLng=l,d){const _={};for(const x in this._tiles){const C=this._tiles[x];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+d),_[C.tileID.key]=C}this._tiles=_;for(const x in this._timers)clearTimeout(this._timers[x]),delete this._timers[x];for(const x in this._tiles)this._setTileReloadTimer(x,this._tiles[x])}}update(l,d){if(this.transform=l,this.terrain=d,!this._sourceLoaded||this._paused)return;let _;this.updateCacheSize(l),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?_=l.getVisibleUnwrappedCoordinates(this._source.tileID).map(I=>new w.OverscaledTileID(I.canonical.z,I.wrap,I.canonical.z,I.canonical.x,I.canonical.y)):(_=l.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:d}),this._source.hasTile&&(_=_.filter(I=>this._source.hasTile(I)))):_=[];const x=l.coveringZoomLevel(this._source),C=Math.max(x-vi.maxOverzooming,this._source.minzoom),P=Math.max(x+vi.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const I={};for(const H of _)if(H.canonical.z>this._source.minzoom){const q=H.scaledTo(H.canonical.z-1);I[q.key]=q;const Q=H.scaledTo(Math.max(this._source.minzoom,Math.min(H.canonical.z,5)));I[Q.key]=Q}_=_.concat(Object.values(I))}const L=this._updateRetainedTiles(_,x);if(Kn(this._source.type)){const I={},H={},q=Object.keys(L);for(const Q of q){const ce=L[Q],ue=this._tiles[Q];if(!ue||ue.fadeEndTime&&ue.fadeEndTime<=w.exported.now())continue;const he=this.findLoadedParent(ce,C);he&&(this._addTile(he.tileID),I[he.tileID.key]=he.tileID),H[Q]=ce}this._retainLoadedChildren(H,x,P,L);for(const Q in I)L[Q]||(this._coveredTiles[Q]=!0,L[Q]=I[Q]);if(d){const Q={},ce={};for(const ue of _)this._tiles[ue.key].hasData()?Q[ue.key]=ue:ce[ue.key]=ue;for(const ue in ce){const he=ce[ue].children(this._source.maxzoom);this._tiles[he[0].key]&&this._tiles[he[1].key]&&this._tiles[he[2].key]&&this._tiles[he[3].key]&&(Q[he[0].key]=L[he[0].key]=he[0],Q[he[1].key]=L[he[1].key]=he[1],Q[he[2].key]=L[he[2].key]=he[2],Q[he[3].key]=L[he[3].key]=he[3],delete ce[ue])}for(const ue in ce){const he=this.findLoadedParent(ce[ue],this._source.minzoom);if(he){Q[he.tileID.key]=L[he.tileID.key]=he.tileID;for(const Ee in Q)Q[Ee].isChildOf(he.tileID)&&delete Q[Ee]}}for(const ue in this._tiles)Q[ue]||(this._coveredTiles[ue]=!0)}}for(const I in L)this._tiles[I].clearFadeHold();const N=w.keysDifference(this._tiles,L);for(const I of N){const H=this._tiles[I];H.hasSymbolBuckets&&!H.holdingForFade()?H.setHoldDuration(this.map._fadeDuration):H.hasSymbolBuckets&&!H.symbolFadeFinished()||this._removeTile(I)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const l in this._tiles)this._tiles[l].holdingForFade()&&this._removeTile(l)}_updateRetainedTiles(l,d){const _={},x={},C=Math.max(d-vi.maxOverzooming,this._source.minzoom),P=Math.max(d+vi.maxUnderzooming,this._source.minzoom),L={};for(const N of l){const I=this._addTile(N);_[N.key]=N,I.hasData()||d<this._source.maxzoom&&(L[N.key]=N)}this._retainLoadedChildren(L,d,P,_);for(const N of l){let I=this._tiles[N.key];if(I.hasData())continue;if(d+1>this._source.maxzoom){const q=N.children(this._source.maxzoom)[0],Q=this.getTile(q);if(Q&&Q.hasData()){_[q.key]=q;continue}}else{const q=N.children(this._source.maxzoom);if(_[q[0].key]&&_[q[1].key]&&_[q[2].key]&&_[q[3].key])continue}let H=I.wasRequested();for(let q=N.overscaledZ-1;q>=C;--q){const Q=N.scaledTo(q);if(x[Q.key]||(x[Q.key]=!0,I=this.getTile(Q),!I&&H&&(I=this._addTile(Q)),I&&(_[Q.key]=Q,H=I.wasRequested(),I.hasData())))break}}return _}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const l in this._tiles){const d=[];let _,x=this._tiles[l].tileID;for(;x.overscaledZ>0;){if(x.key in this._loadedParentTiles){_=this._loadedParentTiles[x.key];break}d.push(x.key);const C=x.scaledTo(x.overscaledZ-1);if(_=this._getLoadedTile(C),_)break;x=C}for(const C of d)this._loadedParentTiles[C]=_}}_addTile(l){let d=this._tiles[l.key];if(d)return d;d=this._cache.getAndRemove(l),d&&(this._setTileReloadTimer(l.key,d),d.tileID=l,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[l.key]&&(clearTimeout(this._cacheTimers[l.key]),delete this._cacheTimers[l.key],this._setTileReloadTimer(l.key,d)));const _=d;return d||(d=new Ks(l,this._source.tileSize*l.overscaleFactor()),this._loadTile(d,this._tileLoaded.bind(this,d,l.key,d.state))),d.uses++,this._tiles[l.key]=d,_||this._source.fire(new w.Event("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(l,d){l in this._timers&&(clearTimeout(this._timers[l]),delete this._timers[l]);const _=d.getExpiryTimeout();_&&(this._timers[l]=setTimeout(()=>{this._reloadTile(l,"expired"),delete this._timers[l]},_))}_removeTile(l){const d=this._tiles[l];d&&(d.uses--,delete this._tiles[l],this._timers[l]&&(clearTimeout(this._timers[l]),delete this._timers[l]),d.uses>0||(d.hasData()&&"reloading"!==d.state?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const l in this._tiles)this._removeTile(l);this._cache.reset()}tilesIn(l,d,_){const x=[],C=this.transform;if(!C)return x;const P=_?C.getCameraQueryGeometry(l):l,L=l.map(ue=>C.pointCoordinate(ue,this.terrain)),N=P.map(ue=>C.pointCoordinate(ue,this.terrain)),I=this.getIds();let H=1/0,q=1/0,Q=-1/0,ce=-1/0;for(const ue of N)H=Math.min(H,ue.x),q=Math.min(q,ue.y),Q=Math.max(Q,ue.x),ce=Math.max(ce,ue.y);for(let ue=0;ue<I.length;ue++){const he=this._tiles[I[ue]];if(he.holdingForFade())continue;const Ee=he.tileID,Me=Math.pow(2,C.zoom-he.tileID.overscaledZ),Re=d*he.queryPadding*w.EXTENT/he.tileSize/Me,fe=[Ee.getTilePoint(new w.MercatorCoordinate(H,q)),Ee.getTilePoint(new w.MercatorCoordinate(Q,ce))];if(fe[0].x-Re<w.EXTENT&&fe[0].y-Re<w.EXTENT&&fe[1].x+Re>=0&&fe[1].y+Re>=0){const Be=L.map(We=>Ee.getTilePoint(We)),ke=N.map(We=>Ee.getTilePoint(We));x.push({tile:he,tileID:Ee,queryGeometry:Be,cameraQueryGeometry:ke,scale:Me})}}return x}getVisibleCoordinates(l){const d=this.getRenderableIds(l).map(_=>this._tiles[_].tileID);for(const _ of d)_.posMatrix=this.transform.calculatePosMatrix(_.toUnwrapped());return d}hasTransition(){if(this._source.hasTransition())return!0;if(Kn(this._source.type))for(const l in this._tiles){const d=this._tiles[l];if(void 0!==d.fadeEndTime&&d.fadeEndTime>=w.exported.now())return!0}return!1}setFeatureState(l,d,_){this._state.updateState(l=l||"_geojsonTileLayer",d,_)}removeFeatureState(l,d,_){this._state.removeFeatureState(l=l||"_geojsonTileLayer",d,_)}getFeatureState(l,d){return this._state.getState(l=l||"_geojsonTileLayer",d)}setDependencies(l,d,_){const x=this._tiles[l];x&&x.setDependencies(d,_)}reloadTilesForDependencies(l,d){for(const _ in this._tiles)this._tiles[_].hasDependency(l,d)&&this._reloadTile(_,"reloading");this._cache.filter(_=>!_.hasDependency(l,d))}}function nc(v,l){const d=Math.abs(2*v.wrap)-+(v.wrap<0),_=Math.abs(2*l.wrap)-+(l.wrap<0);return v.overscaledZ-l.overscaledZ||_-d||l.canonical.y-v.canonical.y||l.canonical.x-v.canonical.x}function Kn(v){return"raster"===v||"image"===v||"video"===v}vi.maxOverzooming=10,vi.maxUnderzooming=3;const Mr="mapboxgl_preloaded_worker_pool";class bi{constructor(){this.active={}}acquire(l){if(!this.workers)for(this.workers=[];this.workers.length<bi.workerCount;)this.workers.push(new Worker(La.workerUrl));return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],0===this.numActive()&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Mr]}numActive(){return Object.keys(this.active).length}}const _r=Math.floor(w.exported.hardwareConcurrency/2);let Js;function la(){return Js||(Js=new bi),Js}function Br(v,l){const d={};for(const _ in v)"ref"!==_&&(d[_]=v[_]);return w.refProperties.forEach(_=>{_ in l&&(d[_]=l[_])}),d}function To(v){v=v.slice();const l=Object.create(null);for(let d=0;d<v.length;d++)l[v[d].id]=v[d];for(let d=0;d<v.length;d++)"ref"in v[d]&&(v[d]=Br(v[d],l[v[d].ref]));return v}bi.workerCount=Math.max(Math.min(_r,6),1);const Vn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Zi(v,l,d){d.push({command:Vn.addSource,args:[v,l[v]]})}function bs(v,l,d){l.push({command:Vn.removeSource,args:[v]}),d[v]=!0}function Xa(v,l,d,_){bs(v,d,_),Zi(v,l,d)}function Ho(v,l,d){let _;for(_ in v[d])if(Object.prototype.hasOwnProperty.call(v[d],_)&&"data"!==_&&!en(v[d][_],l[d][_]))return!1;for(_ in l[d])if(Object.prototype.hasOwnProperty.call(l[d],_)&&"data"!==_&&!en(v[d][_],l[d][_]))return!1;return!0}function yr(v,l,d,_,x,C){let P;for(P in l=l||{},v=v||{})Object.prototype.hasOwnProperty.call(v,P)&&(en(v[P],l[P])||d.push({command:C,args:[_,P,l[P],x]}));for(P in l)Object.prototype.hasOwnProperty.call(l,P)&&!Object.prototype.hasOwnProperty.call(v,P)&&(en(v[P],l[P])||d.push({command:C,args:[_,P,l[P],x]}))}function dr(v){return v.id}function Ya(v,l){return v[l.id]=l,v}class Ka{constructor(l,d){this.reset(l,d)}reset(l,d){this.points=l||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(1===this.points.length)return this.points[0];l=w.clamp(l,0,1);let d=1,_=this._distances[d];const x=l*this.paddedLength+this.padding;for(;_<x&&d<this._distances.length;)_=this._distances[++d];const C=d-1,P=this._distances[C],L=_-P,N=L>0?(x-P)/L:0;return this.points[C].mult(1-N).add(this.points[d].mult(N))}}function He(v,l){let d=!0;return"always"===v||"never"!==v&&"never"!==l||(d=!1),d}class pt{constructor(l,d,_){const x=this.boxCells=[],C=this.circleCells=[];this.xCellCount=Math.ceil(l/_),this.yCellCount=Math.ceil(d/_);for(let P=0;P<this.xCellCount*this.yCellCount;P++)x.push([]),C.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=d,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,d,_,x,C){this._forEachCell(d,_,x,C,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(x),this.bboxes.push(C)}insertCircle(l,d,_,x){this._forEachCell(d-x,_-x,d+x,_+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(d),this.circles.push(_),this.circles.push(x)}_insertBoxCell(l,d,_,x,C,P){this.boxCells[C].push(P)}_insertCircleCell(l,d,_,x,C,P){this.circleCells[C].push(P)}_query(l,d,_,x,C,P,L){if(_<0||l>this.width||x<0||d>this.height)return[];const N=[];if(l<=0&&d<=0&&this.width<=_&&this.height<=x){if(C)return[{key:null,x1:l,y1:d,x2:_,y2:x}];for(let I=0;I<this.boxKeys.length;I++)N.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){const H=this.circles[3*I],q=this.circles[3*I+1],Q=this.circles[3*I+2];N.push({key:this.circleKeys[I],x1:H-Q,y1:q-Q,x2:H+Q,y2:q+Q})}}else this._forEachCell(l,d,_,x,this._queryCell,N,{hitTest:C,overlapMode:P,seenUids:{box:{},circle:{}}},L);return N}query(l,d,_,x){return this._query(l,d,_,x,!1,null)}hitTest(l,d,_,x,C,P){return this._query(l,d,_,x,!0,C,P).length>0}hitTestCircle(l,d,_,x,C){const P=l-_,L=l+_,N=d-_,I=d+_;if(L<0||P>this.width||I<0||N>this.height)return!1;const H=[];return this._forEachCell(P,N,L,I,this._queryCellCircle,H,{hitTest:!0,overlapMode:x,circle:{x:l,y:d,radius:_},seenUids:{box:{},circle:{}}},C),H.length>0}_queryCell(l,d,_,x,C,P,L,N){const{seenUids:I,hitTest:H,overlapMode:q}=L,Q=this.boxCells[C];if(null!==Q){const ue=this.bboxes;for(const he of Q)if(!I.box[he]){I.box[he]=!0;const Ee=4*he,Me=this.boxKeys[he];if(l<=ue[Ee+2]&&d<=ue[Ee+3]&&_>=ue[Ee+0]&&x>=ue[Ee+1]&&(!N||N(Me))&&(!H||!He(q,Me.overlapMode))&&(P.push({key:Me,x1:ue[Ee],y1:ue[Ee+1],x2:ue[Ee+2],y2:ue[Ee+3]}),H))return!0}}const ce=this.circleCells[C];if(null!==ce){const ue=this.circles;for(const he of ce)if(!I.circle[he]){I.circle[he]=!0;const Ee=3*he,Me=this.circleKeys[he];if(this._circleAndRectCollide(ue[Ee],ue[Ee+1],ue[Ee+2],l,d,_,x)&&(!N||N(Me))&&(!H||!He(q,Me.overlapMode))){const Re=ue[Ee],fe=ue[Ee+1],Be=ue[Ee+2];if(P.push({key:Me,x1:Re-Be,y1:fe-Be,x2:Re+Be,y2:fe+Be}),H)return!0}}}return!1}_queryCellCircle(l,d,_,x,C,P,L,N){const{circle:I,seenUids:H,overlapMode:q}=L,Q=this.boxCells[C];if(null!==Q){const ue=this.bboxes;for(const he of Q)if(!H.box[he]){H.box[he]=!0;const Ee=4*he,Me=this.boxKeys[he];if(this._circleAndRectCollide(I.x,I.y,I.radius,ue[Ee+0],ue[Ee+1],ue[Ee+2],ue[Ee+3])&&(!N||N(Me))&&!He(q,Me.overlapMode))return P.push(!0),!0}}const ce=this.circleCells[C];if(null!==ce){const ue=this.circles;for(const he of ce)if(!H.circle[he]){H.circle[he]=!0;const Ee=3*he,Me=this.circleKeys[he];if(this._circlesCollide(ue[Ee],ue[Ee+1],ue[Ee+2],I.x,I.y,I.radius)&&(!N||N(Me))&&!He(q,Me.overlapMode))return P.push(!0),!0}}}_forEachCell(l,d,_,x,C,P,L,N){const I=this._convertToXCellCoord(l),H=this._convertToYCellCoord(d),q=this._convertToXCellCoord(_),Q=this._convertToYCellCoord(x);for(let ce=I;ce<=q;ce++)for(let ue=H;ue<=Q;ue++)if(C.call(this,l,d,_,x,this.xCellCount*ue+ce,P,L,N))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,d,_,x,C,P){const L=x-l,N=C-d,I=_+P;return I*I>L*L+N*N}_circleAndRectCollide(l,d,_,x,C,P,L){const N=(P-x)/2,I=Math.abs(l-(x+N));if(I>N+_)return!1;const H=(L-C)/2,q=Math.abs(d-(C+H));if(q>H+_)return!1;if(I<=N||q<=H)return!0;const Q=I-N,ce=q-H;return Q*Q+ce*ce<=_*_}}function ca(v,l,d,_,x){const C=w.create();return l?(w.scale(C,C,[1/x,1/x,1]),d||w.rotateZ(C,C,_.angle)):w.multiply(C,_.labelPlaneMatrix,v),C}function rs(v,l,d,_,x){if(l){const C=w.clone(v);return w.scale(C,C,[x,x,1]),d||w.rotateZ(C,C,-_.angle),C}return _.glCoordMatrix}function $n(v,l,d){let _;d?(_=[v.x,v.y,d(v.x,v.y),1],w.transformMat4(_,_,l)):(_=[v.x,v.y,0,1],ua(_,_,l));const x=_[3];return{point:new w.pointGeometry(_[0]/x,_[1]/x),signedDistanceFromCamera:x}}function ks(v,l){return.5+v/l*.5}function Rs(v,l){const d=v[0]/v[3],_=v[1]/v[3];return d>=-l[0]&&d<=l[0]&&_>=-l[1]&&_<=l[1]}function ss(v,l,d,_,x,C,P,L,N,I){const H=_?v.textSizeData:v.iconSizeData,q=w.evaluateSizeForZoom(H,d.transform.zoom),Q=[256/d.width*2+1,256/d.height*2+1],ce=_?v.text.dynamicLayoutVertexArray:v.icon.dynamicLayoutVertexArray;ce.clear();const ue=v.lineVertexArray,he=_?v.text.placedSymbolArray:v.icon.placedSymbolArray,Ee=d.transform.width/d.transform.height;let Me=!1;for(let Re=0;Re<he.length;Re++){const fe=he.get(Re);if(fe.hidden||fe.writingMode===w.WritingMode.vertical&&!Me){tn(fe.numGlyphs,ce);continue}let Be;if(Me=!1,I?(Be=[fe.anchorX,fe.anchorY,I(fe.anchorX,fe.anchorY),1],w.transformMat4(Be,Be,l)):(Be=[fe.anchorX,fe.anchorY,0,1],ua(Be,Be,l)),!Rs(Be,Q)){tn(fe.numGlyphs,ce);continue}const ke=ks(d.transform.cameraToCenterDistance,Be[3]),We=w.evaluateSizeForFeature(H,q,fe),$e=P?We/ke:We*ke,it=new w.pointGeometry(fe.anchorX,fe.anchorY),Ue=$n(it,x,I).point,wt={},dt=En(fe,$e,!1,L,l,x,C,v.glyphOffsetArray,ue,ce,Ue,it,wt,Ee,N,I);Me=dt.useVertical,(dt.notEnoughRoom||Me||dt.needsFlipping&&En(fe,$e,!0,L,l,x,C,v.glyphOffsetArray,ue,ce,Ue,it,wt,Ee,N,I).notEnoughRoom)&&tn(fe.numGlyphs,ce)}_?v.text.dynamicLayoutVertexBuffer.updateData(ce):v.icon.dynamicLayoutVertexBuffer.updateData(ce)}function Go(v,l,d,_,x,C,P,L,N,I,H,q,Q){const ce=L.glyphStartIndex+L.numGlyphs,ue=L.lineStartIndex,he=L.lineStartIndex+L.lineLength,Ee=l.getoffsetX(L.glyphStartIndex),Me=l.getoffsetX(ce-1),Re=Pr(v*Ee,d,_,x,C,P,L.segment,ue,he,N,I,H,q,Q);if(!Re)return null;const fe=Pr(v*Me,d,_,x,C,P,L.segment,ue,he,N,I,H,q,Q);return fe?{first:Re,last:fe}:null}function ut(v,l,d,_){return v===w.WritingMode.horizontal&&Math.abs(d.y-l.y)>Math.abs(d.x-l.x)*_?{useVertical:!0}:(v===w.WritingMode.vertical?l.y<d.y:l.x>d.x)?{needsFlipping:!0}:null}function En(v,l,d,_,x,C,P,L,N,I,H,q,Q,ce,ue,he){const Ee=l/24,Me=v.lineOffsetX*Ee,Re=v.lineOffsetY*Ee;let fe;if(v.numGlyphs>1){const Be=v.glyphStartIndex+v.numGlyphs,ke=v.lineStartIndex,We=v.lineStartIndex+v.lineLength,$e=Go(Ee,L,Me,Re,d,H,q,v,N,C,Q,ue,he);if(!$e)return{notEnoughRoom:!0};const it=$n($e.first.point,P,he).point,Ue=$n($e.last.point,P,he).point;if(_&&!d){const wt=ut(v.writingMode,it,Ue,ce);if(wt)return wt}fe=[$e.first];for(let wt=v.glyphStartIndex+1;wt<Be-1;wt++)fe.push(Pr(Ee*L.getoffsetX(wt),Me,Re,d,H,q,v.segment,ke,We,N,C,Q,ue,he));fe.push($e.last)}else{if(_&&!d){const ke=$n(q,x,he).point,We=v.lineStartIndex+v.segment+1,$e=new w.pointGeometry(N.getx(We),N.gety(We)),it=$n($e,x,he),Ue=it.signedDistanceFromCamera>0?it.point:on(q,$e,ke,1,x,he),wt=ut(v.writingMode,ke,Ue,ce);if(wt)return wt}const Be=Pr(Ee*L.getoffsetX(v.glyphStartIndex),Me,Re,d,H,q,v.segment,v.lineStartIndex,v.lineStartIndex+v.lineLength,N,C,Q,ue,he);if(!Be)return{notEnoughRoom:!0};fe=[Be]}for(const Be of fe)w.addDynamicAttributes(I,Be.point,Be.angle);return{}}function on(v,l,d,_,x,C){const P=$n(v.add(v.sub(l)._unit()),x,C).point,L=d.sub(P);return d.add(L._mult(_/L.mag()))}function Pr(v,l,d,_,x,C,P,L,N,I,H,q,Q,ce){const ue=_?v-l:v+l;let he=ue>0?1:-1,Ee=0;_&&(he*=-1,Ee=Math.PI),he<0&&(Ee+=Math.PI);let Me=he>0?L+P:L+P+1,Re=x,fe=x,Be=0,ke=0;const We=Math.abs(ue),$e=[];for(;Be+ke<=We;){if(Me+=he,Me<L||Me>=N)return null;if(fe=Re,$e.push(Re),Re=q[Me],void 0===Re){const St=new w.pointGeometry(I.getx(Me),I.gety(Me)),rn=$n(St,H,ce);if(rn.signedDistanceFromCamera>0)Re=q[Me]=rn.point;else{const Pn=Me-he;Re=on(0===Be?C:new w.pointGeometry(I.getx(Pn),I.gety(Pn)),St,fe,We-Be+1,H,ce)}}Be+=ke,ke=fe.dist(Re)}const it=(We-Be)/ke,Ue=Re.sub(fe),wt=Ue.mult(it)._add(fe);wt._add(Ue._unit()._perp()._mult(d*he));const dt=Ee+Math.atan2(Re.y-fe.y,Re.x-fe.x);return $e.push(wt),{point:wt,angle:Q?dt:0,path:$e}}const Ma=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function tn(v,l){for(let d=0;d<v;d++){const _=l.length;l.resize(_+4),l.float32.set(Ma,3*_)}}function ua(v,l,d){const _=l[0],x=l[1];return v[0]=d[0]*_+d[4]*x+d[12],v[1]=d[1]*_+d[5]*x+d[13],v[3]=d[3]*_+d[7]*x+d[15],v}const zr=100;class Aa{constructor(l,d=new pt(l.width+200,l.height+200,25),_=new pt(l.width+200,l.height+200,25)){this.transform=l,this.grid=d,this.ignoredGrid=_,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+zr,this.screenBottomBoundary=l.height+zr,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(l,d,_,x,C,P){const L=this.projectAndGetPerspectiveRatio(x,l.anchorPointX,l.anchorPointY,P),N=_*L.perspectiveRatio,I=l.x1*N+L.point.x,H=l.y1*N+L.point.y,q=l.x2*N+L.point.x,Q=l.y2*N+L.point.y;return!this.isInsideGrid(I,H,q,Q)||"always"!==d&&this.grid.hitTest(I,H,q,Q,d,C)||L.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[I,H,q,Q],offscreen:this.isOffscreen(I,H,q,Q)}}placeCollisionCircles(l,d,_,x,C,P,L,N,I,H,q,Q,ce,ue){const he=[],Ee=new w.pointGeometry(d.anchorX,d.anchorY),Me=$n(Ee,P,ue),Re=ks(this.transform.cameraToCenterDistance,Me.signedDistanceFromCamera),fe=(H?C/Re:C*Re)/w.ONE_EM,Be=$n(Ee,L,ue).point,ke=Go(fe,x,d.lineOffsetX*fe,d.lineOffsetY*fe,!1,Be,Ee,d,_,L,{},!1,ue);let We=!1,$e=!1,it=!0;if(ke){const Ue=.5*Q*Re+ce,wt=new w.pointGeometry(-100,-100),dt=new w.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),St=new Ka,rn=ke.first,Pn=ke.last;let Ht=[];for(let ii=rn.path.length-1;ii>=1;ii--)Ht.push(rn.path[ii]);for(let ii=1;ii<Pn.path.length;ii++)Ht.push(Pn.path[ii]);const Di=2.5*Ue;if(N){const ii=Ht.map(Nn=>$n(Nn,N,ue));Ht=ii.some(Nn=>Nn.signedDistanceFromCamera<=0)?[]:ii.map(Nn=>Nn.point)}let Ei=[];if(Ht.length>0){const ii=Ht[0].clone(),Nn=Ht[0].clone();for(let Ii=1;Ii<Ht.length;Ii++)ii.x=Math.min(ii.x,Ht[Ii].x),ii.y=Math.min(ii.y,Ht[Ii].y),Nn.x=Math.max(Nn.x,Ht[Ii].x),Nn.y=Math.max(Nn.y,Ht[Ii].y);Ei=ii.x>=wt.x&&Nn.x<=dt.x&&ii.y>=wt.y&&Nn.y<=dt.y?[Ht]:Nn.x<wt.x||ii.x>dt.x||Nn.y<wt.y||ii.y>dt.y?[]:w.clipLine([Ht],wt.x,wt.y,dt.x,dt.y)}for(const ii of Ei){St.reset(ii,.25*Ue);let Nn=0;Nn=St.length<=.5*Ue?1:Math.ceil(St.paddedLength/Di)+1;for(let Ii=0;Ii<Nn;Ii++){const cs=Ii/Math.max(Nn-1,1),Wr=St.lerp(cs),ma=Wr.x+zr,Oa=Wr.y+zr;he.push(ma,Oa,Ue,0);const ol=ma-Ue,ga=Oa-Ue,Do=ma+Ue,wr=Oa+Ue;if(it=it&&this.isOffscreen(ol,ga,Do,wr),$e=$e||this.isInsideGrid(ol,ga,Do,wr),"always"!==l&&this.grid.hitTestCircle(ma,Oa,Ue,l,q)&&(We=!0,!I))return{circles:[],offscreen:!1,collisionDetected:We}}}}return{circles:!I&&We||!$e||Re<this.perspectiveRatioCutoff?[]:he,offscreen:it,collisionDetected:We}}queryRenderedSymbols(l){if(0===l.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const d=[];let _=1/0,x=1/0,C=-1/0,P=-1/0;for(const H of l){const q=new w.pointGeometry(H.x+zr,H.y+zr);_=Math.min(_,q.x),x=Math.min(x,q.y),C=Math.max(C,q.x),P=Math.max(P,q.y),d.push(q)}const L=this.grid.query(_,x,C,P).concat(this.ignoredGrid.query(_,x,C,P)),N={},I={};for(const H of L){const q=H.key;if(void 0===N[q.bucketInstanceId]&&(N[q.bucketInstanceId]={}),N[q.bucketInstanceId][q.featureIndex])continue;const Q=[new w.pointGeometry(H.x1,H.y1),new w.pointGeometry(H.x2,H.y1),new w.pointGeometry(H.x2,H.y2),new w.pointGeometry(H.x1,H.y2)];w.polygonIntersectsPolygon(d,Q)&&(N[q.bucketInstanceId][q.featureIndex]=!0,void 0===I[q.bucketInstanceId]&&(I[q.bucketInstanceId]=[]),I[q.bucketInstanceId].push(q.featureIndex))}return I}insertCollisionBox(l,d,_,x,C,P){(_?this.ignoredGrid:this.grid).insert({bucketInstanceId:x,featureIndex:C,collisionGroupID:P,overlapMode:d},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,d,_,x,C,P){const L=_?this.ignoredGrid:this.grid,N={bucketInstanceId:x,featureIndex:C,collisionGroupID:P,overlapMode:d};for(let I=0;I<l.length;I+=4)L.insertCircle(N,l[I],l[I+1],l[I+2])}projectAndGetPerspectiveRatio(l,d,_,x){let C;return x?(C=[d,_,x(d,_),1],w.transformMat4(C,C,l)):(C=[d,_,0,1],ua(C,C,l)),{point:new w.pointGeometry((C[0]/C[3]+1)/2*this.transform.width+zr,(-C[1]/C[3]+1)/2*this.transform.height+zr),perspectiveRatio:.5+this.transform.cameraToCenterDistance/C[3]*.5}}isOffscreen(l,d,_,x){return _<zr||l>=this.screenRightBoundary||x<zr||d>this.screenBottomBoundary}isInsideGrid(l,d,_,x){return _>=0&&l<this.gridRightBoundary&&x>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const l=w.identity([]);return w.translate(l,l,[-100,-100,0]),l}}function vr(v,l,d){return l*(w.EXTENT/(v.tileSize*Math.pow(2,d-v.tileID.overscaledZ)))}class Xr{constructor(l,d,_,x){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?d:-d))):x&&_?1:0,this.placed=_}isHidden(){return 0===this.opacity&&!this.placed}}class xi{constructor(l,d,_,x,C){this.text=new Xr(l?l.text:null,d,_,C),this.icon=new Xr(l?l.icon:null,d,x,C)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class os{constructor(l,d,_){this.text=l,this.icon=d,this.skipFade=_}}class Wo{constructor(){this.invProjMatrix=w.create(),this.viewportMatrix=w.create(),this.circles=[]}}class Ja{constructor(l,d,_,x,C){this.bucketInstanceId=l,this.featureIndex=d,this.sourceLayerIndex=_,this.bucketIndex=x,this.tileID=C}}class Cl{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const d=++this.maxGroupID;this.collisionGroups[l]={ID:d,predicate:_=>_.collisionGroupID===d}}return this.collisionGroups[l]}}function ic(v,l,d,_,x){const{horizontalAlign:C,verticalAlign:P}=w.getAnchorAlignment(v),L=-(C-.5)*l,N=-(P-.5)*d,I=w.evaluateVariableOffset(v,_);return new w.pointGeometry(L+I[0]*x,N+I[1]*x)}function ha(v,l,d,_,x,C){const{x1:P,x2:L,y1:N,y2:I,anchorPointX:H,anchorPointY:q}=v,Q=new w.pointGeometry(l,d);return _&&Q._rotate(x?C:-C),{x1:P+Q.x,y1:N+Q.y,x2:L+Q.x,y2:I+Q.y,anchorPointX:H,anchorPointY:q}}class le{constructor(l,d,_,x,C){this.transform=l.clone(),this.terrain=d,this.collisionIndex=new Aa(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=_,this.retainedQueryData={},this.collisionGroups=new Cl(x),this.collisionCircleArrays={},this.prevPlacement=C,C&&(C.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,d,_,x){const C=_.getBucket(d),P=_.latestFeatureIndex;if(!C||!P||d.id!==C.layerIds[0])return;const L=_.collisionBoxArray,N=C.layers[0].layout,I=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),H=_.tileSize/w.EXTENT,q=this.transform.calculatePosMatrix(_.tileID.toUnwrapped()),Q="map"===N.get("text-pitch-alignment"),ce="map"===N.get("text-rotation-alignment"),ue=vr(_,1,this.transform.zoom),he=ca(q,Q,ce,this.transform,ue);let Ee=null;if(Q){const Re=rs(q,Q,ce,this.transform,ue);Ee=w.multiply([],this.transform.labelPlaneMatrix,Re)}this.retainedQueryData[C.bucketInstanceId]=new Ja(C.bucketInstanceId,P,C.sourceLayerIndex,C.index,_.tileID);const Me={bucket:C,layout:N,posMatrix:q,textLabelPlaneMatrix:he,labelToScreenMatrix:Ee,scale:I,textPixelRatio:H,holdingForFade:_.holdingForFade(),collisionBoxArray:L,partiallyEvaluatedTextSize:w.evaluateSizeForZoom(C.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(C.sourceID)};if(x)for(const Re of C.sortKeyRanges){const{sortKey:fe,symbolInstanceStart:Be,symbolInstanceEnd:ke}=Re;l.push({sortKey:fe,symbolInstanceStart:Be,symbolInstanceEnd:ke,parameters:Me})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:C.symbolInstances.length,parameters:Me})}attemptAnchorPlacement(l,d,_,x,C,P,L,N,I,H,q,Q,ce,ue,he,Ee){const Me=[Q.textOffset0,Q.textOffset1],Re=ic(l,_,x,Me,C),fe=this.collisionIndex.placeCollisionBox(ha(d,Re.x,Re.y,P,L,this.transform.angle),q,N,I,H.predicate,Ee);if((!he||0!==this.collisionIndex.placeCollisionBox(ha(he,Re.x,Re.y,P,L,this.transform.angle),q,N,I,H.predicate,Ee).box.length)&&fe.box.length>0){let Be;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Q.crossTileID]&&this.prevPlacement.placements[Q.crossTileID]&&this.prevPlacement.placements[Q.crossTileID].text&&(Be=this.prevPlacement.variableOffsets[Q.crossTileID].anchor),0===Q.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Q.crossTileID]={textOffset:Me,width:_,height:x,anchor:l,textBoxScale:C,prevAnchor:Be},this.markUsedJustification(ce,l,Q,ue),ce.allowVerticalPlacement&&(this.markUsedOrientation(ce,ue,Q),this.placedOrientations[Q.crossTileID]=ue),{shift:Re,placedGlyphBoxes:fe}}}placeLayerBucketPart(l,d,_){const{bucket:x,layout:C,posMatrix:P,textLabelPlaneMatrix:L,labelToScreenMatrix:N,textPixelRatio:I,holdingForFade:H,collisionBoxArray:q,partiallyEvaluatedTextSize:Q,collisionGroup:ce}=l.parameters,ue=C.get("text-optional"),he=C.get("icon-optional"),Ee=w.getOverlapMode(C,"text-overlap","text-allow-overlap"),Me="always"===Ee,Re=w.getOverlapMode(C,"icon-overlap","icon-allow-overlap"),fe="always"===Re,Be="map"===C.get("text-rotation-alignment"),ke="map"===C.get("text-pitch-alignment"),We="none"!==C.get("icon-text-fit"),$e="viewport-y"===C.get("symbol-z-order"),it=Me&&(fe||!x.hasIconData()||he),Ue=fe&&(Me||!x.hasTextData()||ue);!x.collisionArrays&&q&&x.deserializeCollisionBoxes(q);const wt=(dt,St)=>{if(d[dt.crossTileID])return;if(H)return void(this.placements[dt.crossTileID]=new os(!1,!1,!1));let rn=!1,Pn=!1,Ht=!0,Di=null,Ei={box:null,offscreen:null},ii={box:null,offscreen:null},Nn=null,Ii=null,cs=null,Wr=0,ma=0,Oa=0;St.textFeatureIndex?Wr=St.textFeatureIndex:dt.useRuntimeCollisionCircles&&(Wr=dt.featureIndex),St.verticalTextFeatureIndex&&(ma=St.verticalTextFeatureIndex);const ol=this.retainedQueryData[x.bucketInstanceId].tileID,ga=this.terrain?(Zn,On)=>this.terrain.getElevation(ol,Zn,On):null;for(const Zn of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const On=St[Zn];On&&(On.elevation=ga?ga(On.anchorPointX,On.anchorPointY):0)}const Do=St.textBox;if(Do){const Zn=gi=>{let Lr=w.WritingMode.horizontal;if(x.allowVerticalPlacement&&!gi&&this.prevPlacement){const $r=this.prevPlacement.placedOrientations[dt.crossTileID];$r&&(this.placedOrientations[dt.crossTileID]=$r,Lr=$r,this.markUsedOrientation(x,Lr,dt))}return Lr},On=(gi,Lr)=>{if(x.allowVerticalPlacement&&dt.numVerticalGlyphVertices>0&&St.verticalTextBox){for(const $r of x.writingModes)if($r===w.WritingMode.vertical?(Ei=Lr(),ii=Ei):Ei=gi(),Ei&&Ei.box&&Ei.box.length)break}else Ei=gi()};if(C.get("text-variable-anchor")){let gi=C.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[dt.crossTileID]){const mr=this.prevPlacement.variableOffsets[dt.crossTileID];gi.indexOf(mr.anchor)>0&&(gi=gi.filter(Ko=>Ko!==mr.anchor),gi.unshift(mr.anchor))}const Lr=(mr,Ko,al)=>{const Io=mr.x2-mr.x1,Fa=mr.y2-mr.y1,ll=dt.textBoxScale,lo=We&&"never"===Re?Ko:null;let hc={box:[],offscreen:!1};const co="never"!==Ee?2*gi.length:gi.length;for(let ya=0;ya<co;++ya){const dc=this.attemptAnchorPlacement(gi[ya%gi.length],mr,Io,Fa,ll,Be,ke,I,P,ce,ya>=gi.length?Ee:"never",dt,x,al,lo,ga);if(dc&&(hc=dc.placedGlyphBoxes,hc&&hc.box&&hc.box.length)){rn=!0,Di=dc.shift;break}}return hc};On(()=>Lr(Do,St.iconBox,w.WritingMode.horizontal),()=>{const mr=St.verticalTextBox;return x.allowVerticalPlacement&&!(Ei&&Ei.box&&Ei.box.length)&&dt.numVerticalGlyphVertices>0&&mr?Lr(mr,St.verticalIconBox,w.WritingMode.vertical):{box:null,offscreen:null}}),Ei&&(rn=Ei.box,Ht=Ei.offscreen);const $r=Zn(Ei&&Ei.box);if(!rn&&this.prevPlacement){const mr=this.prevPlacement.variableOffsets[dt.crossTileID];mr&&(this.variableOffsets[dt.crossTileID]=mr,this.markUsedJustification(x,mr.anchor,dt,$r))}}else{const gi=(Lr,$r)=>{const mr=this.collisionIndex.placeCollisionBox(Lr,Ee,I,P,ce.predicate,ga);return mr&&mr.box&&mr.box.length&&(this.markUsedOrientation(x,$r,dt),this.placedOrientations[dt.crossTileID]=$r),mr};On(()=>gi(Do,w.WritingMode.horizontal),()=>{const Lr=St.verticalTextBox;return x.allowVerticalPlacement&&dt.numVerticalGlyphVertices>0&&Lr?gi(Lr,w.WritingMode.vertical):{box:null,offscreen:null}}),Zn(Ei&&Ei.box&&Ei.box.length)}}if(Nn=Ei,rn=Nn&&Nn.box&&Nn.box.length>0,Ht=Nn&&Nn.offscreen,dt.useRuntimeCollisionCircles){const Zn=x.text.placedSymbolArray.get(dt.centerJustifiedTextSymbolIndex),On=w.evaluateSizeForFeature(x.textSizeData,Q,Zn),gi=C.get("text-padding");Ii=this.collisionIndex.placeCollisionCircles(Ee,Zn,x.lineVertexArray,x.glyphOffsetArray,On,P,L,N,_,ke,ce.predicate,dt.collisionCircleDiameter,gi,ga),Ii.circles.length&&Ii.collisionDetected&&!_&&w.warnOnce("Collisions detected, but collision boxes are not shown"),rn=Me||Ii.circles.length>0&&!Ii.collisionDetected,Ht=Ht&&Ii.offscreen}if(St.iconFeatureIndex&&(Oa=St.iconFeatureIndex),St.iconBox){const Zn=On=>{const gi=We&&Di?ha(On,Di.x,Di.y,Be,ke,this.transform.angle):On;return this.collisionIndex.placeCollisionBox(gi,Re,I,P,ce.predicate,ga)};ii&&ii.box&&ii.box.length&&St.verticalIconBox?(cs=Zn(St.verticalIconBox),Pn=cs.box.length>0):(cs=Zn(St.iconBox),Pn=cs.box.length>0),Ht=Ht&&cs.offscreen}const wr=ue||0===dt.numHorizontalGlyphVertices&&0===dt.numVerticalGlyphVertices,_a=he||0===dt.numIconVertices;if(wr||_a?_a?wr||(Pn=Pn&&rn):rn=Pn&&rn:Pn=rn=Pn&&rn,rn&&Nn&&Nn.box&&this.collisionIndex.insertCollisionBox(Nn.box,Ee,C.get("text-ignore-placement"),x.bucketInstanceId,ii&&ii.box&&ma?ma:Wr,ce.ID),Pn&&cs&&this.collisionIndex.insertCollisionBox(cs.box,Re,C.get("icon-ignore-placement"),x.bucketInstanceId,Oa,ce.ID),Ii&&(rn&&this.collisionIndex.insertCollisionCircles(Ii.circles,Ee,C.get("text-ignore-placement"),x.bucketInstanceId,Wr,ce.ID),_)){const Zn=x.bucketInstanceId;let On=this.collisionCircleArrays[Zn];void 0===On&&(On=this.collisionCircleArrays[Zn]=new Wo);for(let gi=0;gi<Ii.circles.length;gi+=4)On.circles.push(Ii.circles[gi+0]),On.circles.push(Ii.circles[gi+1]),On.circles.push(Ii.circles[gi+2]),On.circles.push(Ii.collisionDetected?1:0)}if(0===dt.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");if(0===x.bucketInstanceId)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[dt.crossTileID]=new os(rn||it,Pn||Ue,Ht||x.justReloaded),d[dt.crossTileID]=!0};if($e){if(0!==l.symbolInstanceStart)throw new Error("bucket.bucketInstanceId should be 0");const dt=x.getSortedSymbolIndexes(this.transform.angle);for(let St=dt.length-1;St>=0;--St){const rn=dt[St];wt(x.symbolInstances.get(rn),x.collisionArrays[rn])}}else for(let dt=l.symbolInstanceStart;dt<l.symbolInstanceEnd;dt++)wt(x.symbolInstances.get(dt),x.collisionArrays[dt]);if(_&&x.bucketInstanceId in this.collisionCircleArrays){const dt=this.collisionCircleArrays[x.bucketInstanceId];w.invert(dt.invProjMatrix,P),dt.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(l,d,_,x){let C;C=x===w.WritingMode.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[w.getAnchorJustification(d)];const P=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(const L of P)L>=0&&(l.text.placedSymbolArray.get(L).crossTileID=C>=0&&L!==C?0:_.crossTileID)}markUsedOrientation(l,d,_){const x=d===w.WritingMode.horizontal||d===w.WritingMode.horizontalOnly?d:0,C=d===w.WritingMode.vertical?d:0,P=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];for(const L of P)l.text.placedSymbolArray.get(L).placedOrientation=x;_.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=C)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let _=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const x=d?d.symbolFadeChange(l):1,C=d?d.opacities:{},P=d?d.variableOffsets:{},L=d?d.placedOrientations:{};for(const N in this.placements){const I=this.placements[N],H=C[N];H?(this.opacities[N]=new xi(H,x,I.text,I.icon),_=_||I.text!==H.text.placed||I.icon!==H.icon.placed):(this.opacities[N]=new xi(null,x,I.text,I.icon,I.skipFade),_=_||I.text||I.icon)}for(const N in C){const I=C[N];if(!this.opacities[N]){const H=new xi(I,x,!1,!1);H.isHidden()||(this.opacities[N]=H,_=_||I.text.placed||I.icon.placed)}}for(const N in P)this.variableOffsets[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.variableOffsets[N]=P[N]);for(const N in L)this.placedOrientations[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.placedOrientations[N]=L[N]);if(d&&void 0===d.lastPlacementChangeTime)throw new Error("Last placement time for previous placement is not defined");_?this.lastPlacementChangeTime=l:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:l)}updateLayerOpacities(l,d){const _={};for(const x of d){const C=x.getBucket(l);C&&x.latestFeatureIndex&&l.id===C.layerIds[0]&&this.updateBucketOpacities(C,_,x.collisionBoxArray)}}updateBucketOpacities(l,d,_){l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const x=l.layers[0].layout,C=new xi(null,0,!1,!1,!0),P=x.get("text-allow-overlap"),L=x.get("icon-allow-overlap"),N=x.get("text-variable-anchor"),I="map"===x.get("text-rotation-alignment"),H="map"===x.get("text-pitch-alignment"),q="none"!==x.get("icon-text-fit"),Q=new xi(null,0,P&&(L||!l.hasIconData()||x.get("icon-optional")),L&&(P||!l.hasTextData()||x.get("text-optional")),!0);!l.collisionArrays&&_&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(_);const ce=(ue,he,Ee)=>{for(let Me=0;Me<he/4;Me++)ue.opacityVertexArray.emplaceBack(Ee)};for(let ue=0;ue<l.symbolInstances.length;ue++){const he=l.symbolInstances.get(ue),{numHorizontalGlyphVertices:Ee,numVerticalGlyphVertices:Me,crossTileID:Re}=he;let fe=this.opacities[Re];d[Re]?fe=C:fe||(fe=Q,this.opacities[Re]=fe),d[Re]=!0;const Be=he.numIconVertices>0,ke=this.placedOrientations[he.crossTileID],We=ke===w.WritingMode.vertical,$e=ke===w.WritingMode.horizontal||ke===w.WritingMode.horizontalOnly;if(Ee>0||Me>0){const it=Ce(fe.text);ce(l.text,Ee,We?je:it),ce(l.text,Me,$e?je:it);const Ue=fe.text.isHidden();[he.rightJustifiedTextSymbolIndex,he.centerJustifiedTextSymbolIndex,he.leftJustifiedTextSymbolIndex].forEach(St=>{St>=0&&(l.text.placedSymbolArray.get(St).hidden=Ue||We?1:0)}),he.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(he.verticalPlacedTextSymbolIndex).hidden=Ue||$e?1:0);const wt=this.variableOffsets[he.crossTileID];wt&&this.markUsedJustification(l,wt.anchor,he,ke);const dt=this.placedOrientations[he.crossTileID];dt&&(this.markUsedJustification(l,"left",he,dt),this.markUsedOrientation(l,dt,he))}if(Be){const it=Ce(fe.icon),Ue=!(q&&he.verticalPlacedIconSymbolIndex&&We);he.placedIconSymbolIndex>=0&&(ce(l.icon,he.numIconVertices,Ue?it:je),l.icon.placedSymbolArray.get(he.placedIconSymbolIndex).hidden=fe.icon.isHidden()),he.verticalPlacedIconSymbolIndex>=0&&(ce(l.icon,he.numVerticalIconVertices,Ue?je:it),l.icon.placedSymbolArray.get(he.verticalPlacedIconSymbolIndex).hidden=fe.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const it=l.collisionArrays[ue];if(it){let Ue=new w.pointGeometry(0,0);if(it.textBox||it.verticalTextBox){let dt=!0;if(N){const St=this.variableOffsets[Re];St?(Ue=ic(St.anchor,St.width,St.height,St.textOffset,St.textBoxScale),I&&Ue._rotate(H?this.transform.angle:-this.transform.angle)):dt=!1}it.textBox&&U(l.textCollisionBox.collisionVertexArray,fe.text.placed,!dt||We,Ue.x,Ue.y),it.verticalTextBox&&U(l.textCollisionBox.collisionVertexArray,fe.text.placed,!dt||$e,Ue.x,Ue.y)}const wt=Boolean(!$e&&it.verticalIconBox);it.iconBox&&U(l.iconCollisionBox.collisionVertexArray,fe.icon.placed,wt,q?Ue.x:0,q?Ue.y:0),it.verticalIconBox&&U(l.iconCollisionBox.collisionVertexArray,fe.icon.placed,!wt,q?Ue.x:0,q?Ue.y:0)}}}if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.text.opacityVertexArray.length!==l.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${l.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${l.text.layoutVertexArray.length}) / 4`);if(l.icon.opacityVertexArray.length!==l.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${l.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${l.icon.layoutVertexArray.length}) / 4`);if(l.bucketInstanceId in this.collisionCircleArrays){const ue=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=ue.invProjMatrix,l.placementViewportMatrix=ue.viewportMatrix,l.collisionCircleArray=ue.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return 0===this.fadeDuration?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,d){const _=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*_>l}setStale(){this.stale=!0}}function U(v,l,d,_,x){v.emplaceBack(l?1:0,d?1:0,_||0,x||0),v.emplaceBack(l?1:0,d?1:0,_||0,x||0),v.emplaceBack(l?1:0,d?1:0,_||0,x||0),v.emplaceBack(l?1:0,d?1:0,_||0,x||0)}const $=Math.pow(2,25),ie=Math.pow(2,24),re=Math.pow(2,17),ye=Math.pow(2,16),Te=Math.pow(2,9),we=Math.pow(2,8),ve=Math.pow(2,1);function Ce(v){if(0===v.opacity&&!v.placed)return 0;if(1===v.opacity&&v.placed)return 4294967295;const l=v.placed?1:0,d=Math.floor(127*v.opacity);return d*$+l*ie+d*re+l*ye+d*Te+l*we+d*ve+l}const je=0;class et{constructor(l){this._sortAcrossTiles="viewport-y"!==l.layout.get("symbol-z-order")&&!l.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(l,d,_,x,C){const P=this._bucketParts;for(;this._currentTileIndex<l.length;)if(d.getBucketParts(P,x,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,C())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort((L,N)=>L.sortKey-N.sortKey));this._currentPartIndex<P.length;)if(d.placeLayerBucketPart(P[this._currentPartIndex],this._seenCrossTileIDs,_),this._currentPartIndex++,C())return!0;return!1}}class Ve{constructor(l,d,_,x,C,P,L,N){this.placement=new le(l,d,P,L,N),this._currentPlacementIndex=_.length-1,this._forceFullPlacement=x,this._showCollisionBoxes=C,this._done=!1}isDone(){return this._done}continuePlacement(l,d,_){const x=w.exported.now(),C=()=>{const P=w.exported.now()-x;return!this._forceFullPlacement&&P>2};for(;this._currentPlacementIndex>=0;){const P=d[l[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if("symbol"===P.type&&(!P.minzoom||P.minzoom<=L)&&(!P.maxzoom||P.maxzoom>L)){if(this._inProgressLayer||(this._inProgressLayer=new et(P)),this._inProgressLayer.continuePlacement(_[P.source],this.placement,this._showCollisionBoxes,P,C))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const Et=512/w.EXTENT/2;class Mt{constructor(l,d,_){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=_;for(let x=0;x<d.length;x++){const C=d.get(x),P=C.key;this.indexedSymbolInstances[P]||(this.indexedSymbolInstances[P]=[]),this.indexedSymbolInstances[P].push({crossTileID:C.crossTileID,coord:this.getScaledCoordinates(C,l)})}}getScaledCoordinates(l,d){const _=Et/Math.pow(2,d.canonical.z-this.tileID.canonical.z);return{x:Math.floor((d.canonical.x*w.EXTENT+l.anchorX)*_),y:Math.floor((d.canonical.y*w.EXTENT+l.anchorY)*_)}}findMatches(l,d,_){const x=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let C=0;C<l.length;C++){const P=l.get(C);if(P.crossTileID)continue;const L=this.indexedSymbolInstances[P.key];if(!L)continue;const N=this.getScaledCoordinates(P,d);for(const I of L)if(Math.abs(I.coord.x-N.x)<=x&&Math.abs(I.coord.y-N.y)<=x&&!_[I.crossTileID]){_[I.crossTileID]=!0,P.crossTileID=I.crossTileID;break}}}}class ht{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Wt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const d=Math.round((l-this.lng)/360);if(0!==d)for(const _ in this.indexes){const x=this.indexes[_],C={};for(const P in x){const L=x[P];L.tileID=L.tileID.unwrapTo(L.tileID.wrap+d),C[L.tileID.key]=L}this.indexes[_]=C}this.lng=l}addBucket(l,d,_){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let C=0;C<d.symbolInstances.length;C++)d.symbolInstances.get(C).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});const x=this.usedCrossTileIDs[l.overscaledZ];for(const C in this.indexes){const P=this.indexes[C];if(Number(C)>l.overscaledZ)for(const L in P){const N=P[L];N.tileID.isChildOf(l)&&N.findMatches(d.symbolInstances,l,x)}else{const L=P[l.scaledTo(Number(C)).key];L&&L.findMatches(d.symbolInstances,l,x)}}for(let C=0;C<d.symbolInstances.length;C++){const P=d.symbolInstances.get(C);P.crossTileID||(P.crossTileID=_.generate(),x[P.crossTileID]=!0)}return void 0===this.indexes[l.overscaledZ]&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Mt(l,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(l,d){for(const _ in d.indexedSymbolInstances)for(const x of d.indexedSymbolInstances[_])delete this.usedCrossTileIDs[l][x.crossTileID]}removeStaleBuckets(l){let d=!1;for(const _ in this.indexes){const x=this.indexes[_];for(const C in x)l[x[C].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,x[C]),delete x[C],d=!0)}return d}}class $t{constructor(){this.layerIndexes={},this.crossTileIDs=new ht,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,d,_){let x=this.layerIndexes[l.id];void 0===x&&(x=this.layerIndexes[l.id]=new Wt);let C=!1;const P={};x.handleWrapJump(_);for(const L of d){const N=L.getBucket(l);N&&l.id===N.layerIds[0]&&(N.bucketInstanceId||(N.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(L.tileID,N,this.crossTileIDs)&&(C=!0),P[N.bucketInstanceId]=!0)}return x.removeStaleBuckets(P)&&(C=!0),C}pruneUnusedLayers(l){const d={};l.forEach(_=>{d[_]=!0});for(const _ in this.layerIndexes)d[_]||delete this.layerIndexes[_]}}var Qn=w.createLayout([{name:"a_pos",type:"Int16",components:2}]);class nn extends w.Evented{constructor(l){super(),this.sourceCache=l,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=l._cache.max,l.usedForTerrain=!0,l.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(const l in this._tiles){const d=this._tiles[l];d.textures.forEach(_=>_.destroy()),d.textures=[]}}update(l,d){this.sourceCache.update(l,d),this._renderableTilesKeys=[];for(const _ of l.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:d}))this._renderableTilesKeys.push(_.key),this._tiles[_.key]||(_.posMatrix=new Float64Array(16),w.ortho(_.posMatrix,0,w.EXTENT,0,w.EXTENT,0,1),this._tiles[_.key]=new Ks(_,this.tileSize))}removeOutdated(l){const d={};this.renderHistory=this.renderHistory.filter((_,x)=>this.renderHistory.indexOf(_)===x).slice(0,this.renderHistorySize);for(const _ of this._renderableTilesKeys)d[_]=!0;for(const _ of this.renderHistory)d[_]=!0;for(const _ in this._tiles)d[_]||(this._tiles[_].clearTextures(l),delete this._tiles[_])}getRenderableTiles(){return this._renderableTilesKeys.map(l=>this.getTileByID(l))}getTileByID(l){return this._tiles[l]}getTerrainCoords(l){const d={};for(const _ of this._renderableTilesKeys){const x=this._tiles[_].tileID;if(x.canonical.equals(l.canonical)){const C=l.clone();C.posMatrix=new Float64Array(16),w.ortho(C.posMatrix,0,w.EXTENT,0,w.EXTENT,0,1),d[_]=C}else if(x.canonical.isChildOf(l.canonical)){const C=l.clone();C.posMatrix=new Float64Array(16);const P=x.canonical.z-l.canonical.z,L=x.canonical.x-(x.canonical.x>>P<<P),N=x.canonical.y-(x.canonical.y>>P<<P),I=w.EXTENT>>P;w.ortho(C.posMatrix,0,I,0,I,0,1),w.translate(C.posMatrix,C.posMatrix,[-L*I,-N*I,0]),d[_]=C}else if(l.canonical.isChildOf(x.canonical)){const C=l.clone();C.posMatrix=new Float64Array(16);const P=l.canonical.z-x.canonical.z,L=l.canonical.x-(l.canonical.x>>P<<P),N=l.canonical.y-(l.canonical.y>>P<<P),I=w.EXTENT>>P;w.ortho(C.posMatrix,0,w.EXTENT,0,w.EXTENT,0,1),w.translate(C.posMatrix,C.posMatrix,[L*I,N*I,0]),w.scale(C.posMatrix,C.posMatrix,[1/2**P,1/2**P,0]),d[_]=C}}return d}getSourceTile(l,d){const _=this.sourceCache._source;let x=l.overscaledZ-this.deltaZoom;if(x>_.maxzoom&&(x=_.maxzoom),x<_.minzoom)return null;this._sourceTileCache[l.key]||(this._sourceTileCache[l.key]=l.scaledTo(x).key);let C=this.sourceCache.getTileByID(this._sourceTileCache[l.key]);if((!C||!C.dem)&&d)for(;x>=_.minzoom&&(!C||!C.dem);)C=this.sourceCache.getTileByID(l.scaledTo(x--).key);return C}tilesAfterTime(l=Date.now()){return Object.values(this._tiles).filter(d=>d.timeLoaded>=l)}}class fn{constructor(l,d,_){this.style=l,this.sourceCache=new nn(d),this.options=_,this.exaggeration="number"==typeof _.exaggeration?_.exaggeration:1,this.elevationOffset="number"==typeof _.elevationOffset?_.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(l,d,_,x=w.EXTENT){if(!(d>=0&&d<x&&_>=0&&_<x))return this.elevationOffset;let C=0;const P=this.getTerrainData(l);if(P.tile&&P.tile.dem){const L=w.transformMat4$1([],[d/x*w.EXTENT,_/x*w.EXTENT],P.u_terrain_matrix),N=[L[0]*P.tile.dem.dim,L[1]*P.tile.dem.dim],I=[Math.floor(N[0]),Math.floor(N[1])],H=P.tile.dem.get(I[0],I[1]),q=P.tile.dem.get(I[0],I[1]+1),Q=P.tile.dem.get(I[0]+1,I[1]),ce=P.tile.dem.get(I[0]+1,I[1]+1);C=w.number(w.number(H,q,N[0]-I[0]),w.number(Q,ce,N[0]-I[0]),N[1]-I[1])}return C}rememberForRerender(l,d){for(const _ in this.sourceCache._tiles){const x=this.sourceCache._tiles[_];(x.tileID.equals(d)||x.tileID.isChildOf(d))&&(l===this.sourceCache.sourceCache.id&&(x.timeLoaded=Date.now()),this._rerender[l]=this._rerender[l]||{},this._rerender[l][x.tileID.key]=!0)}}needsRerender(l,d){return this._rerender[l]&&this._rerender[l][d.key]}clearRerenderCache(){this._rerender={}}getElevation(l,d,_,x=w.EXTENT){return(this.getDEMElevation(l,d,_,x)+this.elevationOffset)*this.exaggeration}getTerrainData(l){if(!this._emptyDemTexture){const x=this.style.map.painter.context,C=new w.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new vt(x,C,x.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new vt(x,new w.RGBAImage({width:1,height:1}),x.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(x.gl.NEAREST,x.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=w.identity([])}const d=this.sourceCache.getSourceTile(l,!0);if(d&&d.dem&&(!d.demTexture||d.needsTerrainPrepare)){const x=this.style.map.painter.context;d.demTexture=this.style.map.painter.getTileTexture(d.dem.stride),d.demTexture?d.demTexture.update(d.dem.getPixels(),{premultiply:!1}):d.demTexture=new vt(x,d.dem.getPixels(),x.gl.RGBA,{premultiply:!1}),d.demTexture.bind(x.gl.NEAREST,x.gl.CLAMP_TO_EDGE),d.needsTerrainPrepare=!1}const _=d&&d+d.tileID.key+l.key;if(_&&!this._demMatrixCache[_]){const x=this.sourceCache.sourceCache._source.maxzoom;let C=l.canonical.z-d.tileID.canonical.z;l.overscaledZ>l.canonical.z&&(l.canonical.z>=x?C=l.canonical.z-x:w.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const P=l.canonical.x-(l.canonical.x>>C<<C),L=l.canonical.y-(l.canonical.y>>C<<C),N=w.fromScaling(new Float64Array(16),[1/(w.EXTENT<<C),1/(w.EXTENT<<C),0]);w.translate(N,N,[P*w.EXTENT,L*w.EXTENT,0]),this._demMatrixCache[l.key]={matrix:N,coord:l}}return{u_depth:2,u_terrain:3,u_terrain_dim:d&&d.dem&&d.dem.dim||1,u_terrain_matrix:_?this._demMatrixCache[l.key].matrix:this._emptyDemMatrix,u_terrain_unpack:d&&d.dem&&d.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(d&&d.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:d}}getRTTFramebuffer(){const l=this.style.map.painter;if(!this._rttFramebuffer){const d=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=l.context.createFramebuffer(d,d,!0),this._rttFramebuffer.depthAttachment.set(l.context.createRenderbuffer(l.context.gl.DEPTH_COMPONENT16,d,d))}return this._rttFramebuffer}getFramebuffer(l){const d=this.style.map.painter,_=d.width/devicePixelRatio,x=d.height/devicePixelRatio;return!this._fbo||this._fbo.width===_&&this._fbo.height===x||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new vt(d.context,{width:_,height:x,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new vt(d.context,{width:_,height:x,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=d.context.createFramebuffer(_,x,!0),this._fbo.depthAttachment.set(d.context.createRenderbuffer(d.context.gl.DEPTH_COMPONENT16,_,x))),this._fbo.colorAttachment.set("coords"===l?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const l=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;const d=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let C=0,P=0;C<this._coordsTextureSize;C++)for(let L=0;L<this._coordsTextureSize;L++,P+=4)d[P+0]=255&L,d[P+1]=255&C,d[P+2]=L>>8<<4|C>>8,d[P+3]=0;const _=new w.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(d.buffer)),x=new vt(l,_,l.gl.RGBA,{premultiply:!1});return x.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),this._coordsTexture=x,x}pointCoordinate(l){const d=new Uint8Array(4),_=this.style.map.painter,x=_.context,C=x.gl;x.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),C.readPixels(l.x,_.height/devicePixelRatio-l.y-1,1,1,C.RGBA,C.UNSIGNED_BYTE,d),x.bindFramebuffer.set(null);const P=d[0]+(d[2]>>4<<8),L=d[1]+((15&d[2])<<8),N=this.coordsIndex[255-d[3]],I=N&&this.sourceCache.getTileByID(N);if(!I)return null;const H=this._coordsTextureSize,q=(1<<I.tileID.canonical.z)*H;return new w.MercatorCoordinate((I.tileID.canonical.x*H+P)/q,(I.tileID.canonical.y*H+L)/q,this.getElevation(I.tileID,P,L,H))}getTerrainMesh(){if(this._mesh)return this._mesh;const l=this.style.map.painter.context,d=new w.PosArray,_=new w.TriangleIndexArray,x=this.meshSize,C=w.EXTENT/x,P=x*x;for(let L=0;L<=x;L++)for(let N=0;N<=x;N++)d.emplaceBack(N*C,L*C);for(let L=0;L<P;L+=x+1)for(let N=0;N<x;N++)_.emplaceBack(N+L,x+N+L+1,x+N+L+2),_.emplaceBack(N+L,x+N+L+2,N+L+1);return this._mesh={indexBuffer:l.createIndexBuffer(_),vertexBuffer:l.createVertexBuffer(d,Qn.members),segments:w.SegmentVector.simpleSegment(0,0,d.length,_.length)},this._mesh}getMinMaxElevation(l){const d=this.getTerrainData(l).tile,_={minElevation:null,maxElevation:null};return d&&d.dem&&(_.minElevation=(d.dem.min+this.elevationOffset)*this.exaggeration,_.maxElevation=(d.dem.max+this.elevationOffset)*this.exaggeration),_}}const pn=(v,l)=>w.emitValidationErrors(v,l&&l.filter(d=>"source.canvas"!==d.identifier)),oi=w.pick(Vn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),wi=w.pick(Vn,["setCenter","setZoom","setBearing","setPitch"]),ti=function(){const v={},l=w.spec.$version;for(const d in w.spec.$root){const _=w.spec.$root[d];if(_.required){let x=null;x="version"===d?l:"array"===_.type?[]:{},null!=x&&(v[d]=x)}}return v}();class br extends w.Evented{constructor(l,d={}){super(),this.map=l,this.dispatcher=new Ir(la(),this),this.imageManager=new di,this.imageManager.setEventedParent(this),this.glyphManager=new Ci(l._requestManager,d.localIdeographFontFamily),this.lineAtlas=new xo(256,512),this.crossTileSymbolIndex=new $t,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new w.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",w.getReferrer());const _=this;this._rtlTextPluginCallback=br.registerForPluginStateChange(x=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(C,P)=>{if(w.triggerPluginCompletionEvent(C),P&&P.every(L=>L))for(const L in _.sourceCaches)_.sourceCaches[L].reload()})}),this.on("data",x=>{if("source"!==x.dataType||"metadata"!==x.sourceDataType)return;const C=this.sourceCaches[x.sourceId];if(!C)return;const P=C.getSource();if(P&&P.vectorLayerIds)for(const L in this._layers){const N=this._layers[L];N.source===P.id&&this._validateLayer(N)}})}loadURL(l,d={}){this.fire(new w.Event("dataloading",{dataType:"style"}));const _="boolean"!=typeof d.validate||d.validate,x=this.map._requestManager.transformRequest(l,w.ResourceType.Style);this._request=w.getJSON(x,(C,P)=>{this._request=null,C?this.fire(new w.ErrorEvent(C)):P&&this._load(P,_)})}loadJSON(l,d={}){this.fire(new w.Event("dataloading",{dataType:"style"})),this._request=w.exported.frame(()=>{this._request=null,this._load(l,!1!==d.validate)})}loadEmpty(){this.fire(new w.Event("dataloading",{dataType:"style"})),this._load(ti,!1)}_load(l,d){if(d&&pn(this,w.validateStyle(l)))return;this._loaded=!0,this.stylesheet=l;for(const x in l.sources)this.addSource(x,l.sources[x],{validate:!1});l.sprite?this._loadSprite(l.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(l.glyphs);const _=To(this.stylesheet.layers);this._order=_.map(x=>x.id),this._layers={},this._serializedLayers={};for(let x of _)x=w.createStyleLayer(x),x.setEventedParent(this,{layer:{id:x.id}}),this._layers[x.id]=x,this._serializedLayers[x.id]=x.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new hr(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new w.Event("data",{dataType:"style"})),this.fire(new w.Event("style.load"))}_loadSprite(l){this._spriteRequest=function(d,_,x,C){let P,L,N;const I=x>1?"@2x":"";let H=w.getJSON(_.transformRequest(_.normalizeSpriteURL(d,I,".json"),w.ResourceType.SpriteJSON),(ce,ue)=>{H=null,N||(N=ce,P=ue,Q())}),q=w.getImage(_.transformRequest(_.normalizeSpriteURL(d,I,".png"),w.ResourceType.SpriteImage),(ce,ue)=>{q=null,N||(N=ce,L=ue,Q())});function Q(){if(N)C(N);else if(P&&L){const ce=w.exported.getImageData(L),ue={};for(const he in P){const{width:Ee,height:Me,x:Re,y:fe,sdf:Be,pixelRatio:ke,stretchX:We,stretchY:$e,content:it}=P[he],Ue=new w.RGBAImage({width:Ee,height:Me});w.RGBAImage.copy(ce,Ue,{x:Re,y:fe},{x:0,y:0},{width:Ee,height:Me}),ue[he]={data:Ue,pixelRatio:ke,sdf:Be,stretchX:We,stretchY:$e,content:it}}C(null,ue)}}return{cancel(){H&&(H.cancel(),H=null),q&&(q.cancel(),q=null)}}}(l,this.map._requestManager,this.map.getPixelRatio(),(d,_)=>{if(this._spriteRequest=null,d)this.fire(new w.ErrorEvent(d));else if(_)for(const x in _)this.imageManager.addImage(x,_[x]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new w.Event("data",{dataType:"style"}))})}_validateLayer(l){const d=this.sourceCaches[l.source];if(!d)return;const _=l.sourceLayer;if(!_)return;const x=d.getSource();("geojson"===x.type||x.vectorLayerIds&&-1===x.vectorLayerIds.indexOf(_))&&this.fire(new w.ErrorEvent(new Error(`Source layer "${_}" does not exist on source "${x.id}" as specified by style layer "${l.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const l in this.sourceCaches)if(!this.sourceCaches[l].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(l){const d=[];for(const _ of l){const x=this._layers[_];"custom"!==x.type&&d.push(x.serialize())}return d}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const l in this.sourceCaches)if(this.sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(l){if(!this._loaded)return;const d=this._changed;if(this._changed){const x=Object.keys(this._updatedLayers),C=Object.keys(this._removedLayers);(x.length||C.length)&&this._updateWorkerLayers(x,C);for(const P in this._updatedSources){const L=this._updatedSources[P];if("reload"===L)this._reloadSource(P);else{if("clear"!==L)throw new Error(`Invalid action ${L}`);this._clearSource(P)}}this._updateTilesForChangedImages();for(const P in this._updatedPaintProps)this._layers[P].updateTransitions(l);this.light.updateTransitions(l),this._resetUpdates()}const _={};for(const x in this.sourceCaches){const C=this.sourceCaches[x];_[x]=C.used,C.used=!1}for(const x of this._order){const C=this._layers[x];C.recalculate(l,this._availableImages),!C.isHidden(l.zoom)&&C.source&&(this.sourceCaches[C.source].used=!0)}for(const x in _){const C=this.sourceCaches[x];_[x]!==C.used&&C.fire(new w.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:x}))}this.light.recalculate(l),this.z=l.zoom,d&&this.fire(new w.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=Object.keys(this._changedImages);if(l.length){for(const d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}}_updateWorkerLayers(l,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(l),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(l){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),l){const d=this.sourceCaches[l.source];if(!d)throw new Error(`cannot load terrain, because there exists no source with ID: ${l.source}`);this.terrain=new fn(this,d,l),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=_=>{_.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=_=>{_.tile&&(_.sourceId===l.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(_.sourceId,_.tile.tileID)):"geojson"===_.source.type&&this.terrain.rememberForRerender(_.sourceId,_.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new w.Event("terrain",{terrain:l}))}setState(l){if(this._checkLoaded(),pn(this,w.validateStyle(l)))return!1;(l=w.clone$1(l)).layers=To(l.layers);const d=function(x,C){if(!x)return[{command:Vn.setStyle,args:[C]}];let P=[];try{if(!en(x.version,C.version))return[{command:Vn.setStyle,args:[C]}];en(x.center,C.center)||P.push({command:Vn.setCenter,args:[C.center]}),en(x.zoom,C.zoom)||P.push({command:Vn.setZoom,args:[C.zoom]}),en(x.bearing,C.bearing)||P.push({command:Vn.setBearing,args:[C.bearing]}),en(x.pitch,C.pitch)||P.push({command:Vn.setPitch,args:[C.pitch]}),en(x.sprite,C.sprite)||P.push({command:Vn.setSprite,args:[C.sprite]}),en(x.glyphs,C.glyphs)||P.push({command:Vn.setGlyphs,args:[C.glyphs]}),en(x.transition,C.transition)||P.push({command:Vn.setTransition,args:[C.transition]}),en(x.light,C.light)||P.push({command:Vn.setLight,args:[C.light]});const L={},N=[];!function(H,q,Q,ce){let ue;for(ue in q=q||{},H=H||{})Object.prototype.hasOwnProperty.call(H,ue)&&(Object.prototype.hasOwnProperty.call(q,ue)||bs(ue,Q,ce));for(ue in q)Object.prototype.hasOwnProperty.call(q,ue)&&(Object.prototype.hasOwnProperty.call(H,ue)?en(H[ue],q[ue])||("geojson"===H[ue].type&&"geojson"===q[ue].type&&Ho(H,q,ue)?Q.push({command:Vn.setGeoJSONSourceData,args:[ue,q[ue].data]}):Xa(ue,q,Q,ce)):Zi(ue,q,Q))}(x.sources,C.sources,N,L);const I=[];x.layers&&x.layers.forEach(H=>{L[H.source]?P.push({command:Vn.removeLayer,args:[H.id]}):I.push(H)}),P=P.concat(N),function(H,q,Q){q=q||[];const ce=(H=H||[]).map(dr),ue=q.map(dr),he=H.reduce(Ya,{}),Ee=q.reduce(Ya,{}),Me=ce.slice(),Re=Object.create(null);let fe,Be,ke,We,$e,it,Ue;for(fe=0,Be=0;fe<ce.length;fe++)ke=ce[fe],Object.prototype.hasOwnProperty.call(Ee,ke)?Be++:(Q.push({command:Vn.removeLayer,args:[ke]}),Me.splice(Me.indexOf(ke,Be),1));for(fe=0,Be=0;fe<ue.length;fe++)ke=ue[ue.length-1-fe],Me[Me.length-1-fe]!==ke&&(Object.prototype.hasOwnProperty.call(he,ke)?(Q.push({command:Vn.removeLayer,args:[ke]}),Me.splice(Me.lastIndexOf(ke,Me.length-Be),1)):Be++,it=Me[Me.length-fe],Q.push({command:Vn.addLayer,args:[Ee[ke],it]}),Me.splice(Me.length-fe,0,ke),Re[ke]=!0);for(fe=0;fe<ue.length;fe++)if(ke=ue[fe],We=he[ke],$e=Ee[ke],!Re[ke]&&!en(We,$e))if(en(We.source,$e.source)&&en(We["source-layer"],$e["source-layer"])&&en(We.type,$e.type)){for(Ue in yr(We.layout,$e.layout,Q,ke,null,Vn.setLayoutProperty),yr(We.paint,$e.paint,Q,ke,null,Vn.setPaintProperty),en(We.filter,$e.filter)||Q.push({command:Vn.setFilter,args:[ke,$e.filter]}),en(We.minzoom,$e.minzoom)&&en(We.maxzoom,$e.maxzoom)||Q.push({command:Vn.setLayerZoomRange,args:[ke,$e.minzoom,$e.maxzoom]}),We)Object.prototype.hasOwnProperty.call(We,Ue)&&"layout"!==Ue&&"paint"!==Ue&&"filter"!==Ue&&"metadata"!==Ue&&"minzoom"!==Ue&&"maxzoom"!==Ue&&(0===Ue.indexOf("paint.")?yr(We[Ue],$e[Ue],Q,ke,Ue.slice(6),Vn.setPaintProperty):en(We[Ue],$e[Ue])||Q.push({command:Vn.setLayerProperty,args:[ke,Ue,$e[Ue]]}));for(Ue in $e)Object.prototype.hasOwnProperty.call($e,Ue)&&!Object.prototype.hasOwnProperty.call(We,Ue)&&"layout"!==Ue&&"paint"!==Ue&&"filter"!==Ue&&"metadata"!==Ue&&"minzoom"!==Ue&&"maxzoom"!==Ue&&(0===Ue.indexOf("paint.")?yr(We[Ue],$e[Ue],Q,ke,Ue.slice(6),Vn.setPaintProperty):en(We[Ue],$e[Ue])||Q.push({command:Vn.setLayerProperty,args:[ke,Ue,$e[Ue]]}))}else Q.push({command:Vn.removeLayer,args:[ke]}),it=Me[Me.lastIndexOf(ke)+1],Q.push({command:Vn.addLayer,args:[$e,it]})}(I,C.layers,P)}catch(L){console.warn("Unable to compute style diff:",L),P=[{command:Vn.setStyle,args:[C]}]}return P}(this.serialize(),l).filter(x=>!(x.command in wi));if(0===d.length)return!1;const _=d.filter(x=>!(x.command in oi));if(_.length>0)throw new Error(`Unimplemented: ${_.map(x=>x.command).join(", ")}.`);return d.forEach(x=>{"setTransition"!==x.command&&this[x.command].apply(this,x.args)}),this.stylesheet=l,!0}addImage(l,d){if(this.getImage(l))return this.fire(new w.ErrorEvent(new Error(`An image named "${l}" already exists.`)));this.imageManager.addImage(l,d),this._afterImageUpdated(l)}updateImage(l,d){this.imageManager.updateImage(l,d)}getImage(l){return this.imageManager.getImage(l)}removeImage(l){if(!this.getImage(l))return this.fire(new w.ErrorEvent(new Error(`An image named "${l}" does not exist.`)));this.imageManager.removeImage(l),this._afterImageUpdated(l)}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new w.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(l,d,_={}){if(this._checkLoaded(),void 0!==this.sourceCaches[l])throw new Error(`Source "${l}" already exists.`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(w.validateStyle.source,`sources.${l}`,d,null,_))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const x=this.sourceCaches[l]=new vi(l,d,this.dispatcher);x.style=this,x.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:x.serialize(),sourceId:l})),x.onAdd(this.map),this._changed=!0}removeSource(l){if(this._checkLoaded(),void 0===this.sourceCaches[l])throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===l)return this.fire(new w.ErrorEvent(new Error(`Source "${l}" cannot be removed while layer "${_}" is using it.`)));const d=this.sourceCaches[l];delete this.sourceCaches[l],delete this._updatedSources[l],d.fire(new w.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:l})),d.setEventedParent(null),d.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(l,d){if(this._checkLoaded(),void 0===this.sourceCaches[l])throw new Error(`There is no source with this ID=${l}`);const _=this.sourceCaches[l].getSource();if("geojson"!==_.type)throw new Error(`geojsonSource.type is ${_.type}, which is !== 'geojson`);_.setData(d),this._changed=!0}getSource(l){return this.sourceCaches[l]&&this.sourceCaches[l].getSource()}addLayer(l,d,_={}){this._checkLoaded();const x=l.id;if(this.getLayer(x))return void this.fire(new w.ErrorEvent(new Error(`Layer "${x}" already exists on this map.`)));let C;if("custom"===l.type){if(pn(this,w.validateCustomStyleLayer(l)))return;C=w.createStyleLayer(l)}else{if("object"==typeof l.source&&(this.addSource(x,l.source),l=w.clone$1(l),l=w.extend(l,{source:x})),this._validate(w.validateStyle.layer,`layers.${x}`,l,{arrayIndex:-1},_))return;C=w.createStyleLayer(l),this._validateLayer(C),C.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[C.id]=C.serialize()}const P=d?this._order.indexOf(d):this._order.length;if(d&&-1===P)this.fire(new w.ErrorEvent(new Error(`Cannot add layer "${x}" before non-existing layer "${d}".`)));else{if(this._order.splice(P,0,x),this._layerOrderChanged=!0,this._layers[x]=C,this._removedLayers[x]&&C.source&&"custom"!==C.type){const L=this._removedLayers[x];delete this._removedLayers[x],L.type!==C.type?this._updatedSources[C.source]="clear":(this._updatedSources[C.source]="reload",this.sourceCaches[C.source].pause())}this._updateLayer(C),C.onAdd&&C.onAdd(this.map)}}moveLayer(l,d){if(this._checkLoaded(),this._changed=!0,!this._layers[l])return void this.fire(new w.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be moved.`)));if(l===d)return;const _=this._order.indexOf(l);this._order.splice(_,1);const x=d?this._order.indexOf(d):this._order.length;d&&-1===x?this.fire(new w.ErrorEvent(new Error(`Cannot move layer "${l}" before non-existing layer "${d}".`))):(this._order.splice(x,0,l),this._layerOrderChanged=!0)}removeLayer(l){this._checkLoaded();const d=this._layers[l];if(!d)return void this.fire(new w.ErrorEvent(new Error(`Cannot remove non-existing layer "${l}".`)));d.setEventedParent(null);const _=this._order.indexOf(l);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=d,delete this._layers[l],delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],d.onRemove&&d.onRemove(this.map)}getLayer(l){return this._layers[l]}hasLayer(l){return l in this._layers}setLayerZoomRange(l,d,_){this._checkLoaded();const x=this.getLayer(l);x?x.minzoom===d&&x.maxzoom===_||(null!=d&&(x.minzoom=d),null!=_&&(x.maxzoom=_),this._updateLayer(x)):this.fire(new w.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${l}".`)))}setFilter(l,d,_={}){this._checkLoaded();const x=this.getLayer(l);if(x){if(!en(x.filter,d))return null==d?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(w.validateStyle.filter,`layers.${x.id}.filter`,d,null,_)||(x.filter=w.clone$1(d),this._updateLayer(x)))}else this.fire(new w.ErrorEvent(new Error(`Cannot filter non-existing layer "${l}".`)))}getFilter(l){return w.clone$1(this.getLayer(l).filter)}setLayoutProperty(l,d,_,x={}){this._checkLoaded();const C=this.getLayer(l);C?en(C.getLayoutProperty(d),_)||(C.setLayoutProperty(d,_,x),this._updateLayer(C)):this.fire(new w.ErrorEvent(new Error(`Cannot style non-existing layer "${l}".`)))}getLayoutProperty(l,d){const _=this.getLayer(l);if(_)return _.getLayoutProperty(d);this.fire(new w.ErrorEvent(new Error(`Cannot get style of non-existing layer "${l}".`)))}setPaintProperty(l,d,_,x={}){this._checkLoaded();const C=this.getLayer(l);C?en(C.getPaintProperty(d),_)||(C.setPaintProperty(d,_,x)&&this._updateLayer(C),this._changed=!0,this._updatedPaintProps[l]=!0):this.fire(new w.ErrorEvent(new Error(`Cannot style non-existing layer "${l}".`)))}getPaintProperty(l,d){return this.getLayer(l).getPaintProperty(d)}setFeatureState(l,d){this._checkLoaded();const _=l.source,x=l.sourceLayer,C=this.sourceCaches[_];if(void 0===C)return void this.fire(new w.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const P=C.getSource().type;"geojson"===P&&x?this.fire(new w.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==P||x?(void 0===l.id&&this.fire(new w.ErrorEvent(new Error("The feature id parameter must be provided."))),C.setFeatureState(x,l.id,d)):this.fire(new w.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(l,d){this._checkLoaded();const _=l.source,x=this.sourceCaches[_];if(void 0===x)return void this.fire(new w.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const C=x.getSource().type,P="vector"===C?l.sourceLayer:void 0;"vector"!==C||P?d&&"string"!=typeof l.id&&"number"!=typeof l.id?this.fire(new w.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):x.removeFeatureState(P,l.id,d):this.fire(new w.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(l){this._checkLoaded();const d=l.source,_=l.sourceLayer,x=this.sourceCaches[d];if(void 0!==x)return"vector"!==x.getSource().type||_?(void 0===l.id&&this.fire(new w.ErrorEvent(new Error("The feature id parameter must be provided."))),x.getFeatureState(_,l.id)):void this.fire(new w.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new w.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return w.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return w.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:w.mapObject(this.sourceCaches,l=>l.serialize()),layers:this._serializeLayers(this._order)},l=>void 0!==l)}_updateLayer(l){this._updatedLayers[l.id]=!0,l.source&&!this._updatedSources[l.source]&&"raster"!==this.sourceCaches[l.source].getSource().type&&(this._updatedSources[l.source]="reload",this.sourceCaches[l.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(l){const d=P=>"fill-extrusion"===this._layers[P].type,_={},x=[];for(let P=this._order.length-1;P>=0;P--){const L=this._order[P];if(d(L)){_[L]=P;for(const N of l){const I=N[L];if(I)for(const H of I)x.push(H)}}}x.sort((P,L)=>L.intersectionZ-P.intersectionZ);const C=[];for(let P=this._order.length-1;P>=0;P--){const L=this._order[P];if(d(L))for(let N=x.length-1;N>=0;N--){const I=x[N].feature;if(_[I.layer.id]<P)break;C.push(I),x.pop()}else for(const N of l){const I=N[L];if(I)for(const H of I)C.push(H.feature)}}return C}queryRenderedFeatures(l,d,_){d&&d.filter&&this._validate(w.validateStyle.filter,"queryRenderedFeatures.filter",d.filter,null,d);const x={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new w.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const P of d.layers){const L=this._layers[P];if(!L)return this.fire(new w.ErrorEvent(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];x[L.source]=!0}}const C=[];d.availableImages=this._availableImages;for(const P in this.sourceCaches)d.layers&&!x[P]||C.push(Ps(this.sourceCaches[P],this._layers,this._serializedLayers,l,d,_));return this.placement&&C.push(function(P,L,N,I,H,q,Q){const ce={},ue=q.queryRenderedSymbols(I),he=[];for(const Ee of Object.keys(ue).map(Number))he.push(Q[Ee]);he.sort(Fi);for(const Ee of he){const Me=Ee.featureIndex.lookupSymbolFeatures(ue[Ee.bucketInstanceId],L,Ee.bucketIndex,Ee.sourceLayerIndex,H.filter,H.layers,H.availableImages,P);for(const Re in Me){const fe=ce[Re]=ce[Re]||[],Be=Me[Re];Be.sort((ke,We)=>{const $e=Ee.featureSortOrder;if($e){const it=$e.indexOf(ke.featureIndex);return $e.indexOf(We.featureIndex)-it}return We.featureIndex-ke.featureIndex});for(const ke of Be)fe.push(ke)}}for(const Ee in ce)ce[Ee].forEach(Me=>{const Re=Me.feature,fe=N[P[Ee].source].getFeatureState(Re.layer["source-layer"],Re.id);Re.source=Re.layer.source,Re.layer["source-layer"]&&(Re.sourceLayer=Re.layer["source-layer"]),Re.state=fe});return ce}(this._layers,this._serializedLayers,this.sourceCaches,l,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(C)}querySourceFeatures(l,d){d&&d.filter&&this._validate(w.validateStyle.filter,"querySourceFeatures.filter",d.filter,null,d);const _=this.sourceCaches[l];return _?function(x,C){const P=x.getRenderableIds().map(I=>x.getTileByID(I)),L=[],N={};for(let I=0;I<P.length;I++){const H=P[I],q=H.tileID.canonical.key;N[q]||(N[q]=!0,H.querySourceFeatures(L,C))}return L}(_,d):[]}addSourceType(l,d,_){return br.getSourceType(l)?_(new Error(`A source type called "${l}" already exists.`)):(br.setSourceType(l,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:l,url:d.workerSourceURL},_):_(null,null))}getLight(){return this.light.getLight()}setLight(l,d={}){this._checkLoaded();const _=this.light.getLight();let x=!1;for(const P in l)if(!en(l[P],_[P])){x=!0;break}if(!x)return;const C={now:w.exported.now(),transition:w.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(l,d),this.light.updateTransitions(C)}_validate(l,d,_,x,C={}){return(!C||!1!==C.validate)&&pn(this,l.call(w.validateStyle,w.extend({key:d,style:this.serialize(),value:_,styleSpec:w.spec},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),w.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const l in this._layers)this._layers[l].setEventedParent(null);for(const l in this.sourceCaches){const d=this.sourceCaches[l];d.setEventedParent(null),d.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(l){this.sourceCaches[l].clearTiles()}_reloadSource(l){this.sourceCaches[l].resume(),this.sourceCaches[l].reload()}_updateSources(l){for(const d in this.sourceCaches)this.sourceCaches[d].update(l,this.terrain)}_generateCollisionBoxes(){for(const l in this.sourceCaches)this._reloadSource(l)}_updatePlacement(l,d,_,x,C=!1){let P=!1,L=!1;const N={};for(const I of this._order){const H=this._layers[I];if("symbol"!==H.type)continue;if(!N[H.source]){const Q=this.sourceCaches[H.source];N[H.source]=Q.getRenderableIds(!0).map(ce=>Q.getTileByID(ce)).sort((ce,ue)=>ue.tileID.overscaledZ-ce.tileID.overscaledZ||(ce.tileID.isLessThan(ue.tileID)?-1:1))}const q=this.crossTileSymbolIndex.addLayer(H,N[H.source],l.center.lng);P=P||q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((C=C||this._layerOrderChanged||0===_)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(w.exported.now(),l.zoom))&&(this.pauseablePlacement=new Ve(l,this.terrain,this._order,C,d,_,x,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,N),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(w.exported.now()),L=!0),P&&this.pauseablePlacement.placement.setStale()),L||P)for(const I of this._order){const H=this._layers[I];"symbol"===H.type&&this.placement.updateLayerOpacities(H,N[H.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(w.exported.now())}_releaseSymbolFadeTiles(){for(const l in this.sourceCaches)this.sourceCaches[l].releaseSymbolFadeTiles()}getImages(l,d,_){this.imageManager.getImages(d.icons,_),this._updateTilesForChangedImages();const x=this.sourceCaches[d.source];x&&x.setDependencies(d.tileID.key,d.type,d.icons)}getGlyphs(l,d,_){this.glyphManager.getGlyphs(d.stacks,_)}getResource(l,d,_){return w.makeRequest(d,_)}}br.getSourceType=function(v){return tc[v]},br.setSourceType=function(v,l){tc[v]=l},br.registerForPluginStateChange=w.registerForPluginStateChange;var as="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";const Hn={prelude:fi("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}\n#ifdef TERRAIN3D\nuniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;\n#endif\nconst highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {\n#ifdef TERRAIN3D\nhighp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));\n#else\nreturn 1.0;\n#endif\n}float calculate_visibility(vec4 pos) {\n#ifdef TERRAIN3D\nvec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;\n#else\nreturn 1.0;\n#endif\n}float ele(vec2 pos) {\n#ifdef TERRAIN3D\nvec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;\n#else\nreturn 0.0;\n#endif\n}float get_elevation(vec2 pos) {\n#ifdef TERRAIN3D\nvec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;\n#else\nreturn 0.0;\n#endif\n}"),background:fi("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:fi("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:fi("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),clippingMask:fi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:fi("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),heatmapTexture:fi("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:fi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:fi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:fi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:fi("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),fillOutline:fi("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillOutlinePattern:fi("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillPattern:fi("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),fillExtrusion:fi("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;\n#ifdef TERRAIN3D\nattribute vec2 a_centroid;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;\n#ifdef TERRAIN3D\nfloat baseDelta=10.0;float ele=get_elevation(a_centroid);\n#else\nfloat baseDelta=0.0;float ele=0.0;\n#endif\nbase=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),fillExtrusionPattern:fi("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;\n#ifdef TERRAIN3D\nattribute vec2 a_centroid;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\n#ifdef TERRAIN3D\nfloat baseDelta=10.0;float ele=get_elevation(a_centroid);\n#else\nfloat baseDelta=0.0;float ele=0.0;\n#endif\nbase=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),hillshadePrepare:fi("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:fi("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:fi("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),lineGradient:fi("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),linePattern:fi("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),lineSDF:fi("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),raster:fi("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:fi("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}"),symbolSDF:fi("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:fi("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrain:fi("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",as),terrainDepth:fi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",as),terrainCoords:fi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",as)};function fi(v,l){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=l.match(/attribute ([\w]+) ([\w]+)/g),x=v.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=C?C.concat(x):x,L={};return{fragmentSource:v=v.replace(d,(N,I,H,q,Q)=>(L[Q]=!0,"define"===I?`\n#ifndef HAS_UNIFORM_u_${Q}\nvarying ${H} ${q} ${Q};\n#else\nuniform ${H} ${q} u_${Q};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${Q}\n    ${H} ${q} ${Q} = u_${Q};\n#endif\n`)),vertexSource:l=l.replace(d,(N,I,H,q,Q)=>{const ce="float"===q?"vec2":"vec4",ue=Q.match(/color/)?"color":ce;return L[Q]?"define"===I?`\n#ifndef HAS_UNIFORM_u_${Q}\nuniform lowp float u_${Q}_t;\nattribute ${H} ${ce} a_${Q};\nvarying ${H} ${q} ${Q};\n#else\nuniform ${H} ${q} u_${Q};\n#endif\n`:"vec4"===ue?`\n#ifndef HAS_UNIFORM_u_${Q}\n    ${Q} = a_${Q};\n#else\n    ${H} ${q} ${Q} = u_${Q};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Q}\n    ${Q} = unpack_mix_${ue}(a_${Q}, u_${Q}_t);\n#else\n    ${H} ${q} ${Q} = u_${Q};\n#endif\n`:"define"===I?`\n#ifndef HAS_UNIFORM_u_${Q}\nuniform lowp float u_${Q}_t;\nattribute ${H} ${ce} a_${Q};\n#else\nuniform ${H} ${q} u_${Q};\n#endif\n`:"vec4"===ue?`\n#ifndef HAS_UNIFORM_u_${Q}\n    ${H} ${q} ${Q} = a_${Q};\n#else\n    ${H} ${q} ${Q} = u_${Q};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Q}\n    ${H} ${q} ${Q} = unpack_mix_${ue}(a_${Q}, u_${Q}_t);\n#else\n    ${H} ${q} ${Q} = u_${Q};\n#endif\n`}),staticAttributes:_,staticUniforms:P}}class Si{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(l,d,_,x,C,P,L,N,I){this.context=l;let H=this.boundPaintVertexBuffers.length!==x.length;for(let q=0;!H&&q<x.length;q++)this.boundPaintVertexBuffers[q]!==x[q]&&(H=!0);l.extVertexArrayObject&&this.vao&&this.boundProgram===d&&this.boundLayoutVertexBuffer===_&&!H&&this.boundIndexBuffer===C&&this.boundVertexOffset===P&&this.boundDynamicVertexBuffer===L&&this.boundDynamicVertexBuffer2===N&&this.boundDynamicVertexBuffer3===I?(l.bindVertexArrayOES.set(this.vao),L&&L.bind(),C&&C.dynamicDraw&&C.bind(),N&&N.bind(),I&&I.bind()):this.freshBind(d,_,x,C,P,L,N,I)}freshBind(l,d,_,x,C,P,L,N){let I;const H=l.numAttributes,q=this.context,Q=q.gl;if(q.extVertexArrayObject)this.vao&&this.destroy(),this.vao=q.extVertexArrayObject.createVertexArrayOES(),q.bindVertexArrayOES.set(this.vao),I=0,this.boundProgram=l,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=x,this.boundVertexOffset=C,this.boundDynamicVertexBuffer=P,this.boundDynamicVertexBuffer2=L,this.boundDynamicVertexBuffer3=N;else{I=q.currentNumAttributes||0;for(let ce=H;ce<I;ce++)Q.disableVertexAttribArray(ce)}d.enableAttributes(Q,l);for(const ce of _)ce.enableAttributes(Q,l);P&&P.enableAttributes(Q,l),L&&L.enableAttributes(Q,l),N&&N.enableAttributes(Q,l),d.bind(),d.setVertexAttribPointers(Q,l,C);for(const ce of _)ce.bind(),ce.setVertexAttribPointers(Q,l,C);P&&(P.bind(),P.setVertexAttribPointers(Q,l,C)),x&&x.bind(),L&&(L.bind(),L.setVertexAttribPointers(Q,l,C)),N&&(N.bind(),N.setVertexAttribPointers(Q,l,C)),q.currentNumAttributes=H}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Da(v){const l=[];for(let d=0;d<v.length;d++){if(null===v[d])continue;const _=v[d].split(" ");l.push(_.pop())}return l}class Qs{constructor(l,d,_,x,C,P,L){const N=l.gl;this.program=N.createProgram();const I=Da(_.staticAttributes),H=x?x.getBinderAttributes():[],q=I.concat(H),Q=Hn.prelude.staticUniforms?Da(Hn.prelude.staticUniforms):[],ce=_.staticUniforms?Da(_.staticUniforms):[],ue=x?x.getBinderUniforms():[],he=Q.concat(ce).concat(ue),Ee=[];for(const $e of he)Ee.indexOf($e)<0&&Ee.push($e);const Me=x?x.defines():[];P&&Me.push("#define OVERDRAW_INSPECTOR;"),L&&Me.push("#define TERRAIN3D;");const Re=Me.concat(Hn.prelude.fragmentSource,_.fragmentSource).join("\n"),fe=Me.concat(Hn.prelude.vertexSource,_.vertexSource).join("\n"),Be=N.createShader(N.FRAGMENT_SHADER);if(N.isContextLost())return void(this.failedToCreate=!0);N.shaderSource(Be,Re),N.compileShader(Be),N.attachShader(this.program,Be);const ke=N.createShader(N.VERTEX_SHADER);if(N.isContextLost())return void(this.failedToCreate=!0);N.shaderSource(ke,fe),N.compileShader(ke),N.attachShader(this.program,ke),this.attributes={};const We={};this.numAttributes=q.length;for(let $e=0;$e<this.numAttributes;$e++)q[$e]&&(N.bindAttribLocation(this.program,$e,q[$e]),this.attributes[q[$e]]=$e);N.linkProgram(this.program),N.deleteShader(ke),N.deleteShader(Be);for(let $e=0;$e<Ee.length;$e++){const it=Ee[$e];if(it&&!We[it]){const Ue=N.getUniformLocation(this.program,it);Ue&&(We[it]=Ue)}}var $e,it;this.fixedUniforms=C(l,We),this.terrainUniforms={u_depth:new w.Uniform1i($e=l,(it=We).u_depth),u_terrain:new w.Uniform1i($e,it.u_terrain),u_terrain_dim:new w.Uniform1f($e,it.u_terrain_dim),u_terrain_matrix:new w.UniformMatrix4f($e,it.u_terrain_matrix),u_terrain_unpack:new w.Uniform4f($e,it.u_terrain_unpack),u_terrain_offset:new w.Uniform1f($e,it.u_terrain_offset),u_terrain_exaggeration:new w.Uniform1f($e,it.u_terrain_exaggeration)},this.binderUniforms=x?x.getUniforms(l,We):[]}draw(l,d,_,x,C,P,L,N,I,H,q,Q,ce,ue,he,Ee,Me,Re){const fe=l.gl;if(this.failedToCreate)return;if(l.program.set(this.program),l.setDepthMode(_),l.setStencilMode(x),l.setColorMode(C),l.setCullFace(P),N){l.activeTexture.set(fe.TEXTURE2),fe.bindTexture(fe.TEXTURE_2D,N.depthTexture),l.activeTexture.set(fe.TEXTURE3),fe.bindTexture(fe.TEXTURE_2D,N.texture);for(const ke in this.terrainUniforms)this.terrainUniforms[ke].set(N[ke])}for(const ke in this.fixedUniforms)this.fixedUniforms[ke].set(L[ke]);he&&he.setUniforms(l,this.binderUniforms,ce,{zoom:ue});let Be=0;switch(d){case fe.LINES:Be=2;break;case fe.TRIANGLES:Be=3;break;case fe.LINE_STRIP:Be=1}for(const ke of Q.get()){const We=ke.vaos||(ke.vaos={});(We[I]||(We[I]=new Si)).bind(l,this,H,he?he.getPaintVertexBuffers():[],q,ke.vertexOffset,Ee,Me,Re),fe.drawElements(d,ke.primitiveLength*Be,fe.UNSIGNED_SHORT,ke.primitiveOffset*Be*2)}}}function pi(v,l,d){const _=1/vr(d,1,l.transform.tileZoom),x=Math.pow(2,d.tileID.overscaledZ),C=d.tileSize*Math.pow(2,l.transform.tileZoom)/x,P=C*(d.tileID.canonical.x+d.tileID.wrap*x),L=C*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[_,v.fromScale,v.toScale],u_fade:v.t,u_pixel_coord_upper:[P>>16,L>>16],u_pixel_coord_lower:[65535&P,65535&L]}}const Kt=(v,l,d,_)=>{const x=l.style.light,C=x.properties.get("position"),P=[C.x,C.y,C.z],L=w.create$1();"viewport"===x.properties.get("anchor")&&w.fromRotation(L,-l.transform.angle),w.transformMat3(P,P,L);const N=x.properties.get("color");return{u_matrix:v,u_lightpos:P,u_lightintensity:x.properties.get("intensity"),u_lightcolor:[N.r,N.g,N.b],u_vertical_gradient:+d,u_opacity:_}},Ec=(v,l,d,_,x,C,P)=>w.extend(Kt(v,l,d,_),pi(C,l,P),{u_height_factor:-Math.pow(2,x.overscaledZ)/P.tileSize/8}),rc=v=>({u_matrix:v}),st=(v,l,d,_)=>w.extend(rc(v),pi(d,l,_)),Ia=(v,l)=>({u_matrix:v,u_world:l}),an=(v,l,d,_,x)=>w.extend(st(v,l,d,_),{u_world:x}),ci=(v,l,d,_)=>{const x=v.transform;let C,P;if("map"===_.paint.get("circle-pitch-alignment")){const L=vr(d,1,x.zoom);C=!0,P=[L,L]}else C=!1,P=x.pixelsToGLUnits;return{u_camera_to_center_distance:x.cameraToCenterDistance,u_scale_with_map:+("map"===_.paint.get("circle-pitch-scale")),u_matrix:v.translatePosMatrix(l.posMatrix,d,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_pitch_with_map:+C,u_device_pixel_ratio:v.pixelRatio,u_extrude_scale:P}},Pa=(v,l,d)=>{const _=vr(d,1,l.zoom),x=Math.pow(2,l.zoom-d.tileID.overscaledZ),C=d.tileID.overscaleFactor();return{u_matrix:v,u_camera_to_center_distance:l.cameraToCenterDistance,u_pixels_to_tile_units:_,u_extrude_scale:[l.pixelsToGLUnits[0]/(_*x),l.pixelsToGLUnits[1]/(_*x)],u_overscale_factor:C}},Qa=(v,l,d=1)=>({u_matrix:v,u_color:l,u_overlay:0,u_overlay_scale:d}),Sl=v=>({u_matrix:v}),el=(v,l,d,_)=>({u_matrix:v,u_extrude_scale:vr(l,1,d),u_intensity:_});function Yr(v,l){const d=Math.pow(2,l.canonical.z),_=l.canonical.y;return[new w.MercatorCoordinate(0,_/d).toLngLat().lat,new w.MercatorCoordinate(0,(_+1)/d).toLngLat().lat]}const ee=(v,l,d,_)=>{const x=v.transform;return{u_matrix:At(v,l,d,_),u_ratio:1/vr(l,1,x.zoom),u_device_pixel_ratio:v.pixelRatio,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},oe=(v,l,d,_,x)=>w.extend(ee(v,l,d,x),{u_image:0,u_image_height:_}),xe=(v,l,d,_,x)=>{const C=v.transform,P=Je(l,C);return{u_matrix:At(v,l,d,x),u_texsize:l.imageAtlasTexture.size,u_ratio:1/vr(l,1,C.zoom),u_device_pixel_ratio:v.pixelRatio,u_image:0,u_scale:[P,_.fromScale,_.toScale],u_fade:_.t,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]]}},Fe=(v,l,d,_,x,C)=>{const P=v.lineAtlas,L=Je(l,v.transform),N="round"===d.layout.get("line-cap"),I=P.getDash(_.from,N),H=P.getDash(_.to,N),q=I.width*x.fromScale,Q=H.width*x.toScale;return w.extend(ee(v,l,d,C),{u_patternscale_a:[L/q,-I.height/2],u_patternscale_b:[L/Q,-H.height/2],u_sdfgamma:P.width/(256*Math.min(q,Q)*v.pixelRatio)/2,u_image:0,u_tex_y_a:I.y,u_tex_y_b:H.y,u_mix:x.t})};function Je(v,l){return 1/vr(v,1,l.tileZoom)}function At(v,l,d,_){return v.translatePosMatrix(_?_.posMatrix:l.tileID.posMatrix,l,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}const qn=(v,l,d,_,x)=>{return{u_matrix:v,u_tl_parent:l,u_scale_parent:d,u_buffer_scale:1,u_fade_t:_.mix,u_opacity:_.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(P=x.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(C=x.paint.get("raster-contrast"),C>0?1/(1-C):1+C),u_spin_weights:Vr(x.paint.get("raster-hue-rotate"))};var C,P};function Vr(v){v*=Math.PI/180;const l=Math.sin(v),d=Math.cos(v);return[(2*d+1)/3,(-Math.sqrt(3)*l-d+1)/3,(Math.sqrt(3)*l-d+1)/3]}const kr=(v,l,d,_,x,C,P,L,N,I)=>{const H=x.transform;return{u_is_size_zoom_constant:+("constant"===v||"source"===v),u_is_size_feature_constant:+("constant"===v||"camera"===v),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:H.cameraToCenterDistance,u_pitch:H.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:H.width/H.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:P,u_coord_matrix:L,u_is_text:+N,u_pitch_with_map:+_,u_texsize:I,u_texture:0}},ls=(v,l,d,_,x,C,P,L,N,I,H)=>{const q=x.transform;return w.extend(kr(v,l,d,_,x,C,P,L,N,I),{u_gamma_scale:_?Math.cos(q._pitch)*q.cameraToCenterDistance:1,u_device_pixel_ratio:x.pixelRatio,u_is_halo:+H})},$o=(v,l,d,_,x,C,P,L,N,I)=>w.extend(ls(v,l,d,_,x,C,P,L,!0,N,!0),{u_texsize_icon:I,u_texture_icon:1}),hg=(v,l,d)=>({u_matrix:v,u_opacity:l,u_color:d}),Co=(v,l,d,_,x,C)=>w.extend(function(P,L,N,I){const H=N.imageManager.getPattern(P.from.toString()),q=N.imageManager.getPattern(P.to.toString()),{width:Q,height:ce}=N.imageManager.getPixelSize(),ue=Math.pow(2,I.tileID.overscaledZ),he=I.tileSize*Math.pow(2,N.transform.tileZoom)/ue,Ee=he*(I.tileID.canonical.x+I.tileID.wrap*ue),Me=he*I.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:H.tl,u_pattern_br_a:H.br,u_pattern_tl_b:q.tl,u_pattern_br_b:q.br,u_texsize:[Q,ce],u_mix:L.t,u_pattern_size_a:H.displaySize,u_pattern_size_b:q.displaySize,u_scale_a:L.fromScale,u_scale_b:L.toScale,u_tile_units_to_pixels:1/vr(I,1,N.transform.tileZoom),u_pixel_coord_upper:[Ee>>16,Me>>16],u_pixel_coord_lower:[65535&Ee,65535&Me]}}(_,C,d,x),{u_matrix:v,u_opacity:l}),Mi={fillExtrusion:(v,l)=>({u_matrix:new w.UniformMatrix4f(v,l.u_matrix),u_lightpos:new w.Uniform3f(v,l.u_lightpos),u_lightintensity:new w.Uniform1f(v,l.u_lightintensity),u_lightcolor:new w.Uniform3f(v,l.u_lightcolor),u_vertical_gradient:new w.Uniform1f(v,l.u_vertical_gradient),u_opacity:new w.Uniform1f(v,l.u_opacity)}),fillExtrusionPattern:(v,l)=>({u_matrix:new w.UniformMatrix4f(v,l.u_matrix),u_lightpos:new w.Uniform3f(v,l.u_lightpos),u_lightintensity:new w.Uniform1f(v,l.u_lightintensity),u_lightcolor:new w.Uniform3f(v,l.u_lightcolor),u_vertical_gradient:new w.Uniform1f(v,l.u_vertical_gradient),u_height_factor:new w.Uniform1f(v,l.u_height_factor),u_image:new w.Uniform1i(v,l.u_image),u_texsize:new w.Uniform2f(v,l.u_texsize),u_pixel_coord_upper:new w.Uniform2f(v,l.u_pixel_coord_upper),u_pixel_coord_lower:new w.Uniform2f(v,l.u_pixel_coord_lower),u_scale:new w.Uniform3f(v,l.u_scale),u_fade:new w.Uniform1f(v,l.u_fade),u_opacity:new w.Uniform1f(v,l.u_opacity)}),fill:(v,l)=>({u_matrix:new w.UniformMatrix4f(v,l.u_matrix)}),fillPattern:(v,l)=>({u_matrix:new w.UniformMatrix4f(v,l.u_matrix),u_image:new w.Uniform1i(v,l.u_image),u_texsize:new w.Uniform2f(v,l.u_texsize),u_pixel_coord_upper:new w.Uniform2f(v,l.u_pixel_coord_upper),u_pixel_coord_lower:new w.Uniform2f(v,l.u_pixel_coord_lower),u_scale:new w.Uniform3f(v,l.u_scale),u_fade:new w.Uniform1f(v,l.u_fade)}),fillOutline:(v,l)=>({u_matrix:new w.UniformMatrix4f(v,l.u_matrix),u_world:new w.Uniform2f(v,l.u_world)}),fillOutlinePattern:(v,l)=>({u_matrix:new w.UniformMatrix4f(v,l.u_matrix),u_world:new w.Uniform2f(v,l.u_world),u_image:new w.Uniform1i(v,l.u_image),u_texsize:new w.Uniform2f(v,l.u_texsize),u_pixel_coord_upper:new w.Uniform2f(v,l.u_pixel_coord_upper),u_pixel_coord_lower:new w.Uniform2f(v,l.u_pixel_coord_lower),u_scale:new w.Uniform3f(v,l.u_scale),u_fade:new w.Uniform1f(v,l.u_fade)}),circle:(v,l)=>({u_camera_to_center_distance:new w.Uniform1f(v,l.u_camera_to_center_distance),u_scale_with_map:new w.Uniform1i(v,l.u_scale_with_map),u_pitch_with_map:new w.Uniform1i(v,l.u_pitch_with_map),u_extrude_scale:new w.Uniform2f(v,l.u_extrude_scale),u_device_pixel_ratio:new w.Uniform1f(v,l.u_device_pixel_ratio),u_matrix:new w.UniformMatrix4f(v,l.u_matrix)}),collisionBox:(v,l)=>({u_matrix:new w.UniformMatrix4f(v,l.u_matrix),u_camera_to_center_distance:new w.Uniform1f(v,l.u_camera_to_center_distance),u_pixels_to_tile_units:new w.Uniform1f(v,l.u_pixels_to_tile_units),u_extrude_scale:new w.Uniform2f(v,l.u_extrude_scale),u_overscale_factor:new w.Uniform1f(v,l.u_overscale_factor)}),collisionCircle:(v,l)=>({u_matrix:new w.UniformMatrix4f(v,l.u_matrix),u_inv_matrix:new w.UniformMatrix4f(v,l.u_inv_matrix),u_camera_to_center_distance:new w.Uniform1f(v,l.u_camera_to_center_distance),u_viewport_size:new w.Uniform2f(v,l.u_viewport_size)}),debug:(v,l)=>({u_color:new w.UniformColor(v,l.u_color),u_matrix:new w.UniformMatrix4f(v,l.u_matrix),u_overlay:new w.Uniform1i(v,l.u_overlay),u_overlay_scale:new w.Uniform1f(v,l.u_overlay_scale)}),clippingMask:(v,l)=>({u_matrix:new w.UniformMatrix4f(v,l.u_matrix)}),heatmap:(v,l)=>({u_extrude_scale:new w.Uniform1f(v,l.u_extrude_scale),u_intensity:new w.Uniform1f(v,l.u_intensity),u_matrix:new w.UniformMatrix4f(v,l.u_matrix)}),heatmapTexture:(v,l)=>({u_matrix:new w.UniformMatrix4f(v,l.u_matrix),u_world:new w.Uniform2f(v,l.u_world),u_image:new w.Uniform1i(v,l.u_image),u_color_ramp:new w.Uniform1i(v,l.u_color_ramp),u_opacity:new w.Uniform1f(v,l.u_opacity)}),hillshade:(v,l)=>({u_matrix:new w.UniformMatrix4f(v,l.u_matrix),u_image:new w.Uniform1i(v,l.u_image),u_latrange:new w.Uniform2f(v,l.u_latrange),u_light:new w.Uniform2f(v,l.u_light),u_shadow:new w.UniformColor(v,l.u_shadow),u_highlight:new w.UniformColor(v,l.u_highlight),u_accent:new w.UniformColor(v,l.u_accent)}),hillshadePrepare:(v,l)=>({u_matrix:new w.UniformMatrix4f(v,l.u_matrix),u_image:new w.Uniform1i(v,l.u_image),u_dimension:new w.Uniform2f(v,l.u_dimension),u_zoom:new w.Uniform1f(v,l.u_zoom),u_unpack:new w.Uniform4f(v,l.u_unpack)}),line:(v,l)=>({u_matrix:new w.UniformMatrix4f(v,l.u_matrix),u_ratio:new w.Uniform1f(v,l.u_ratio),u_device_pixel_ratio:new w.Uniform1f(v,l.u_device_pixel_ratio),u_units_to_pixels:new w.Uniform2f(v,l.u_units_to_pixels)}),lineGradient:(v,l)=>({u_matrix:new w.UniformMatrix4f(v,l.u_matrix),u_ratio:new w.Uniform1f(v,l.u_ratio),u_device_pixel_ratio:new w.Uniform1f(v,l.u_device_pixel_ratio),u_units_to_pixels:new w.Uniform2f(v,l.u_units_to_pixels),u_image:new w.Uniform1i(v,l.u_image),u_image_height:new w.Uniform1f(v,l.u_image_height)}),linePattern:(v,l)=>({u_matrix:new w.UniformMatrix4f(v,l.u_matrix),u_texsize:new w.Uniform2f(v,l.u_texsize),u_ratio:new w.Uniform1f(v,l.u_ratio),u_device_pixel_ratio:new w.Uniform1f(v,l.u_device_pixel_ratio),u_image:new w.Uniform1i(v,l.u_image),u_units_to_pixels:new w.Uniform2f(v,l.u_units_to_pixels),u_scale:new w.Uniform3f(v,l.u_scale),u_fade:new w.Uniform1f(v,l.u_fade)}),lineSDF:(v,l)=>({u_matrix:new w.UniformMatrix4f(v,l.u_matrix),u_ratio:new w.Uniform1f(v,l.u_ratio),u_device_pixel_ratio:new w.Uniform1f(v,l.u_device_pixel_ratio),u_units_to_pixels:new w.Uniform2f(v,l.u_units_to_pixels),u_patternscale_a:new w.Uniform2f(v,l.u_patternscale_a),u_patternscale_b:new w.Uniform2f(v,l.u_patternscale_b),u_sdfgamma:new w.Uniform1f(v,l.u_sdfgamma),u_image:new w.Uniform1i(v,l.u_image),u_tex_y_a:new w.Uniform1f(v,l.u_tex_y_a),u_tex_y_b:new w.Uniform1f(v,l.u_tex_y_b),u_mix:new w.Uniform1f(v,l.u_mix)}),raster:(v,l)=>({u_matrix:new w.UniformMatrix4f(v,l.u_matrix),u_tl_parent:new w.Uniform2f(v,l.u_tl_parent),u_scale_parent:new w.Uniform1f(v,l.u_scale_parent),u_buffer_scale:new w.Uniform1f(v,l.u_buffer_scale),u_fade_t:new w.Uniform1f(v,l.u_fade_t),u_opacity:new w.Uniform1f(v,l.u_opacity),u_image0:new w.Uniform1i(v,l.u_image0),u_image1:new w.Uniform1i(v,l.u_image1),u_brightness_low:new w.Uniform1f(v,l.u_brightness_low),u_brightness_high:new w.Uniform1f(v,l.u_brightness_high),u_saturation_factor:new w.Uniform1f(v,l.u_saturation_factor),u_contrast_factor:new w.Uniform1f(v,l.u_contrast_factor),u_spin_weights:new w.Uniform3f(v,l.u_spin_weights)}),symbolIcon:(v,l)=>({u_is_size_zoom_constant:new w.Uniform1i(v,l.u_is_size_zoom_constant),u_is_size_feature_constant:new w.Uniform1i(v,l.u_is_size_feature_constant),u_size_t:new w.Uniform1f(v,l.u_size_t),u_size:new w.Uniform1f(v,l.u_size),u_camera_to_center_distance:new w.Uniform1f(v,l.u_camera_to_center_distance),u_pitch:new w.Uniform1f(v,l.u_pitch),u_rotate_symbol:new w.Uniform1i(v,l.u_rotate_symbol),u_aspect_ratio:new w.Uniform1f(v,l.u_aspect_ratio),u_fade_change:new w.Uniform1f(v,l.u_fade_change),u_matrix:new w.UniformMatrix4f(v,l.u_matrix),u_label_plane_matrix:new w.UniformMatrix4f(v,l.u_label_plane_matrix),u_coord_matrix:new w.UniformMatrix4f(v,l.u_coord_matrix),u_is_text:new w.Uniform1i(v,l.u_is_text),u_pitch_with_map:new w.Uniform1i(v,l.u_pitch_with_map),u_texsize:new w.Uniform2f(v,l.u_texsize),u_texture:new w.Uniform1i(v,l.u_texture)}),symbolSDF:(v,l)=>({u_is_size_zoom_constant:new w.Uniform1i(v,l.u_is_size_zoom_constant),u_is_size_feature_constant:new w.Uniform1i(v,l.u_is_size_feature_constant),u_size_t:new w.Uniform1f(v,l.u_size_t),u_size:new w.Uniform1f(v,l.u_size),u_camera_to_center_distance:new w.Uniform1f(v,l.u_camera_to_center_distance),u_pitch:new w.Uniform1f(v,l.u_pitch),u_rotate_symbol:new w.Uniform1i(v,l.u_rotate_symbol),u_aspect_ratio:new w.Uniform1f(v,l.u_aspect_ratio),u_fade_change:new w.Uniform1f(v,l.u_fade_change),u_matrix:new w.UniformMatrix4f(v,l.u_matrix),u_label_plane_matrix:new w.UniformMatrix4f(v,l.u_label_plane_matrix),u_coord_matrix:new w.UniformMatrix4f(v,l.u_coord_matrix),u_is_text:new w.Uniform1i(v,l.u_is_text),u_pitch_with_map:new w.Uniform1i(v,l.u_pitch_with_map),u_texsize:new w.Uniform2f(v,l.u_texsize),u_texture:new w.Uniform1i(v,l.u_texture),u_gamma_scale:new w.Uniform1f(v,l.u_gamma_scale),u_device_pixel_ratio:new w.Uniform1f(v,l.u_device_pixel_ratio),u_is_halo:new w.Uniform1i(v,l.u_is_halo)}),symbolTextAndIcon:(v,l)=>({u_is_size_zoom_constant:new w.Uniform1i(v,l.u_is_size_zoom_constant),u_is_size_feature_constant:new w.Uniform1i(v,l.u_is_size_feature_constant),u_size_t:new w.Uniform1f(v,l.u_size_t),u_size:new w.Uniform1f(v,l.u_size),u_camera_to_center_distance:new w.Uniform1f(v,l.u_camera_to_center_distance),u_pitch:new w.Uniform1f(v,l.u_pitch),u_rotate_symbol:new w.Uniform1i(v,l.u_rotate_symbol),u_aspect_ratio:new w.Uniform1f(v,l.u_aspect_ratio),u_fade_change:new w.Uniform1f(v,l.u_fade_change),u_matrix:new w.UniformMatrix4f(v,l.u_matrix),u_label_plane_matrix:new w.UniformMatrix4f(v,l.u_label_plane_matrix),u_coord_matrix:new w.UniformMatrix4f(v,l.u_coord_matrix),u_is_text:new w.Uniform1i(v,l.u_is_text),u_pitch_with_map:new w.Uniform1i(v,l.u_pitch_with_map),u_texsize:new w.Uniform2f(v,l.u_texsize),u_texsize_icon:new w.Uniform2f(v,l.u_texsize_icon),u_texture:new w.Uniform1i(v,l.u_texture),u_texture_icon:new w.Uniform1i(v,l.u_texture_icon),u_gamma_scale:new w.Uniform1f(v,l.u_gamma_scale),u_device_pixel_ratio:new w.Uniform1f(v,l.u_device_pixel_ratio),u_is_halo:new w.Uniform1i(v,l.u_is_halo)}),background:(v,l)=>({u_matrix:new w.UniformMatrix4f(v,l.u_matrix),u_opacity:new w.Uniform1f(v,l.u_opacity),u_color:new w.UniformColor(v,l.u_color)}),backgroundPattern:(v,l)=>({u_matrix:new w.UniformMatrix4f(v,l.u_matrix),u_opacity:new w.Uniform1f(v,l.u_opacity),u_image:new w.Uniform1i(v,l.u_image),u_pattern_tl_a:new w.Uniform2f(v,l.u_pattern_tl_a),u_pattern_br_a:new w.Uniform2f(v,l.u_pattern_br_a),u_pattern_tl_b:new w.Uniform2f(v,l.u_pattern_tl_b),u_pattern_br_b:new w.Uniform2f(v,l.u_pattern_br_b),u_texsize:new w.Uniform2f(v,l.u_texsize),u_mix:new w.Uniform1f(v,l.u_mix),u_pattern_size_a:new w.Uniform2f(v,l.u_pattern_size_a),u_pattern_size_b:new w.Uniform2f(v,l.u_pattern_size_b),u_scale_a:new w.Uniform1f(v,l.u_scale_a),u_scale_b:new w.Uniform1f(v,l.u_scale_b),u_pixel_coord_upper:new w.Uniform2f(v,l.u_pixel_coord_upper),u_pixel_coord_lower:new w.Uniform2f(v,l.u_pixel_coord_lower),u_tile_units_to_pixels:new w.Uniform1f(v,l.u_tile_units_to_pixels)}),terrain:(v,l)=>({u_matrix:new w.UniformMatrix4f(v,l.u_matrix),u_texture:new w.Uniform1i(v,l.u_texture)}),terrainDepth:(v,l)=>({u_matrix:new w.UniformMatrix4f(v,l.u_matrix)}),terrainCoords:(v,l)=>({u_matrix:new w.UniformMatrix4f(v,l.u_matrix),u_texture:new w.Uniform1i(v,l.u_texture),u_terrain_coords_id:new w.Uniform1f(v,l.u_terrain_coords_id)})};class Nf{constructor(l,d,_){this.context=l;const x=l.gl;this.buffer=x.createBuffer(),this.dynamicDraw=Boolean(_),this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){const d=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Bf={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class zf{constructor(l,d,_,x){this.length=d.length,this.attributes=_,this.itemSize=d.bytesPerElement,this.dynamicDraw=x,this.context=l;const C=l.gl;this.buffer=C.createBuffer(),l.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){if(l.length!==this.length)throw new Error(`Length of new data is ${l.length}, which doesn't match current length of ${this.length}`);const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,d){for(let _=0;_<this.attributes.length;_++){const x=d.attributes[this.attributes[_].name];void 0!==x&&l.enableVertexAttribArray(x)}}setVertexAttribPointers(l,d,_){for(let x=0;x<this.attributes.length;x++){const C=this.attributes[x],P=d.attributes[C.name];void 0!==P&&l.vertexAttribPointer(P,C.components,l[Bf[C.type]],!1,this.itemSize,C.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class lt{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Hp extends lt{getDefault(){return w.Color.transparent}set(l){const d=this.current;(l.r!==d.r||l.g!==d.g||l.b!==d.b||l.a!==d.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class xr extends lt{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class sc extends lt{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class wh extends lt{getDefault(){return[!0,!0,!0,!0]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||l[3]!==d[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Pd extends lt{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class ni extends lt{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class Xi extends lt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const d=this.current;(l.func!==d.func||l.ref!==d.ref||l.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class zu extends lt{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class Tc extends lt{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=l,this.dirty=!1}}class Vu extends lt{getDefault(){return[0,1]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class Eh extends lt{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=l,this.dirty=!1}}class Th extends lt{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class _n extends lt{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.BLEND):d.disable(d.BLEND),this.current=l,this.dirty=!1}}class cu extends lt{getDefault(){const l=this.gl;return[l.ONE,l.ZERO]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)}}class Ch extends lt{getDefault(){return w.Color.transparent}set(l){const d=this.current;(l.r!==d.r||l.g!==d.g||l.b!==d.b||l.a!==d.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Wi extends lt{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)}}class Sh extends lt{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=l,this.dirty=!1}}class Ml extends lt{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class Al extends lt{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}class qo extends lt{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}}class ka extends lt{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class Gp extends lt{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||l[3]!==d[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class da extends lt{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class tr extends lt{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class kd extends lt{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class Mh extends lt{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Dl extends lt{getDefault(){return null}set(l){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class An extends lt{constructor(l){super(l),this.vao=l.extVertexArrayObject}getDefault(){return null}set(l){this.vao&&(l!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(l),this.current=l,this.dirty=!1)}}class Il extends lt{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class eo extends lt{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class Ah extends lt{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class uu extends lt{constructor(l,d){super(l),this.context=l,this.parent=d}getDefault(){return null}}class Rr extends uu{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Pl extends uu{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class oc{constructor(l,d,_,x){this.context=l,this.width=d,this.height=_;const C=l.gl,P=this.framebuffer=C.createFramebuffer();if(this.colorAttachment=new Rr(l,P),x&&(this.depthAttachment=new Pl(l,P)),C.checkFramebufferStatus(C.FRAMEBUFFER)!==C.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const l=this.context.gl,d=this.colorAttachment.get();if(d&&l.deleteTexture(d),this.depthAttachment){const _=this.depthAttachment.get();_&&l.deleteRenderbuffer(_)}l.deleteFramebuffer(this.framebuffer)}}class jt{constructor(l,d,_){this.blendFunction=l,this.blendColor=d,this.mask=_}}jt.Replace=[1,0],jt.disabled=new jt(jt.Replace,w.Color.transparent,[!1,!1,!1,!1]),jt.unblended=new jt(jt.Replace,w.Color.transparent,[!0,!0,!0,!0]),jt.alphaBlended=new jt([1,771],w.Color.transparent,[!0,!0,!0,!0]);class kl{constructor(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Hp(this),this.clearDepth=new xr(this),this.clearStencil=new sc(this),this.colorMask=new wh(this),this.depthMask=new Pd(this),this.stencilMask=new ni(this),this.stencilFunc=new Xi(this),this.stencilOp=new zu(this),this.stencilTest=new Tc(this),this.depthRange=new Vu(this),this.depthTest=new Eh(this),this.depthFunc=new Th(this),this.blend=new _n(this),this.blendFunc=new cu(this),this.blendColor=new Ch(this),this.blendEquation=new Wi(this),this.cullFace=new Sh(this),this.cullFaceSide=new Ml(this),this.frontFace=new Al(this),this.program=new qo(this),this.activeTexture=new ka(this),this.viewport=new Gp(this),this.bindFramebuffer=new da(this),this.bindRenderbuffer=new tr(this),this.bindTexture=new kd(this),this.bindVertexBuffer=new Mh(this),this.bindElementBuffer=new Dl(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new An(this),this.pixelStoreUnpack=new Il(this),this.pixelStoreUnpackPremultiplyAlpha=new eo(this),this.pixelStoreUnpackFlipY=new Ah(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,d){return new Nf(this,l,d)}createVertexBuffer(l,d,_){return new zf(this,l,d,_)}createRenderbuffer(l,d,_){const x=this.gl,C=x.createRenderbuffer();return this.bindRenderbuffer.set(C),x.renderbufferStorage(x.RENDERBUFFER,l,d,_),this.bindRenderbuffer.set(null),C}createFramebuffer(l,d,_){return new oc(this,l,d,_)}clear({color:l,depth:d}){const _=this.gl;let x=0;l&&(x|=_.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set([!0,!0,!0,!0])),void 0!==d&&(x|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),_.clear(x)}setCullFace(l){!1===l.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){en(l.blendFunction,jt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Un{constructor(l,d,_){this.func=l,this.mask=d,this.range=_}}Un.ReadOnly=!1,Un.ReadWrite=!0,Un.disabled=new Un(519,Un.ReadOnly,[0,1]);class un{constructor(l,d,_,x,C,P){this.test=l,this.ref=d,this.mask=_,this.fail=x,this.depthFail=C,this.pass=P}}un.disabled=new un({func:519,mask:0},0,0,7680,7680,7680);class fr{constructor(l,d,_){this.enable=l,this.mode=d,this.frontFace=_}}let hu;function Jt(v,l,d,_,x,C,P){const L=v.context,N=L.gl,I=v.useProgram("collisionBox"),H=[];let q=0,Q=0;for(let fe=0;fe<_.length;fe++){const Be=_[fe],ke=l.getTile(Be),We=ke.getBucket(d);if(!We)continue;let $e=Be.posMatrix;0===x[0]&&0===x[1]||($e=v.translatePosMatrix(Be.posMatrix,ke,x,C));const it=P?We.textCollisionBox:We.iconCollisionBox,Ue=We.collisionCircleArray;if(Ue.length>0){const wt=w.create(),dt=$e;w.mul(wt,We.placementInvProjMatrix,v.transform.glCoordMatrix),w.mul(wt,wt,We.placementViewportMatrix),H.push({circleArray:Ue,circleOffset:Q,transform:dt,invTransform:wt,coord:Be}),q+=Ue.length/4,Q=q}it&&I.draw(L,N.LINES,Un.disabled,un.disabled,v.colorModeForRenderPass(),fr.disabled,Pa($e,v.transform,ke),v.style.terrain&&v.style.terrain.getTerrainData(Be),d.id,it.layoutVertexBuffer,it.indexBuffer,it.segments,null,v.transform.zoom,null,null,it.collisionVertexBuffer)}if(!P||!H.length)return;const ce=v.useProgram("collisionCircle"),ue=new w.CollisionCircleLayoutArray;ue.resize(4*q),ue._trim();let he=0;for(const fe of H)for(let Be=0;Be<fe.circleArray.length/4;Be++){const ke=4*Be,We=fe.circleArray[ke+0],$e=fe.circleArray[ke+1],it=fe.circleArray[ke+2],Ue=fe.circleArray[ke+3];ue.emplace(he++,We,$e,it,Ue,0),ue.emplace(he++,We,$e,it,Ue,1),ue.emplace(he++,We,$e,it,Ue,2),ue.emplace(he++,We,$e,it,Ue,3)}(!hu||hu.length<2*q)&&(hu=function(fe){const Be=2*fe,ke=new w.QuadTriangleArray;ke.resize(Be),ke._trim();for(let We=0;We<Be;We++){const $e=6*We;ke.uint16[$e+0]=4*We+0,ke.uint16[$e+1]=4*We+1,ke.uint16[$e+2]=4*We+2,ke.uint16[$e+3]=4*We+2,ke.uint16[$e+4]=4*We+3,ke.uint16[$e+5]=4*We+0}return ke}(q));const Ee=L.createIndexBuffer(hu,!0),Me=L.createVertexBuffer(ue,w.collisionCircleLayout.members,!0);for(const fe of H){const Be={u_matrix:fe.transform,u_inv_matrix:fe.invTransform,u_camera_to_center_distance:(Re=v.transform).cameraToCenterDistance,u_viewport_size:[Re.width,Re.height]};ce.draw(L,N.TRIANGLES,Un.disabled,un.disabled,v.colorModeForRenderPass(),fr.disabled,Be,v.style.terrain&&v.style.terrain.getTerrainData(fe.coord),d.id,Me,Ee,w.SegmentVector.simpleSegment(0,2*fe.circleOffset,fe.circleArray.length,fe.circleArray.length/2),null,v.transform.zoom,null,null,null)}var Re;Me.destroy(),Ee.destroy()}fr.disabled=new fr(!1,1029,2305),fr.backCCW=new fr(!0,1029,2305);const to=w.identity(new Float32Array(16));function Ai(v,l,d,_,x,C){const{horizontalAlign:P,verticalAlign:L}=w.getAnchorAlignment(v),N=-(P-.5)*l,I=-(L-.5)*d,H=w.evaluateVariableOffset(v,_);return new w.pointGeometry((N/x+H[0])*C,(I/x+H[1])*C)}function Ur(v,l,d,_,x,C,P,L,N,I,H){const q=v.text.placedSymbolArray,Q=v.text.dynamicLayoutVertexArray,ce=v.icon.dynamicLayoutVertexArray,ue={};Q.clear();for(let he=0;he<q.length;he++){const Ee=q.get(he),Me=v.allowVerticalPlacement&&!Ee.placedOrientation,Re=Ee.hidden||!Ee.crossTileID||Me?null:_[Ee.crossTileID];if(Re){const fe=new w.pointGeometry(Ee.anchorX,Ee.anchorY),Be=$n(fe,d?P:C,H),ke=ks(x.cameraToCenterDistance,Be.signedDistanceFromCamera);let We=w.evaluateSizeForFeature(v.textSizeData,N,Ee)*ke/w.ONE_EM;d&&(We*=v.tilePixelRatio/L);const{width:$e,height:it,anchor:Ue,textOffset:wt,textBoxScale:dt}=Re,St=Ai(Ue,$e,it,wt,dt,We),rn=d?$n(fe.add(St),C,H).point:Be.point.add(l?St.rotate(-x.angle):St),Pn=v.allowVerticalPlacement&&Ee.placedOrientation===w.WritingMode.vertical?Math.PI/2:0;for(let Ht=0;Ht<Ee.numGlyphs;Ht++)w.addDynamicAttributes(Q,rn,Pn);I&&Ee.associatedIconIndex>=0&&(ue[Ee.associatedIconIndex]={shiftedAnchor:rn,angle:Pn})}else tn(Ee.numGlyphs,Q)}if(I){ce.clear();const he=v.icon.placedSymbolArray;for(let Ee=0;Ee<he.length;Ee++){const Me=he.get(Ee);if(Me.hidden)tn(Me.numGlyphs,ce);else{const Re=ue[Ee];if(Re)for(let fe=0;fe<Me.numGlyphs;fe++)w.addDynamicAttributes(ce,Re.shiftedAnchor,Re.angle);else tn(Me.numGlyphs,ce)}}v.icon.dynamicLayoutVertexBuffer.updateData(ce)}v.text.dynamicLayoutVertexBuffer.updateData(Q)}function no(v,l,d){return d.iconsInText&&l?"symbolTextAndIcon":v?"symbolSDF":"symbolIcon"}function Rl(v,l,d,_,x,C,P,L,N,I,H,q){const Q=v.context,ce=Q.gl,ue=v.transform,he="map"===L,Ee="map"===N,Me="viewport"!==L&&"point"!==d.layout.get("symbol-placement"),Re=he&&!Ee&&!Me,fe=!d.layout.get("symbol-sort-key").isConstant();let Be=!1;const ke=v.depthModeForSublayer(0,Un.ReadOnly),We=d.layout.get("text-variable-anchor"),$e=[];for(const it of _){const Ue=l.getTile(it),wt=Ue.getBucket(d);if(!wt)continue;const dt=x?wt.text:wt.icon;if(!dt||!dt.segments.get().length)continue;const St=dt.programConfigurations.get(d.id),rn=x||wt.sdfIcons,Pn=x?wt.textSizeData:wt.iconSizeData,Ht=Ee||0!==ue.pitch,Di=v.useProgram(no(rn,x,wt),St),Ei=w.evaluateSizeForZoom(Pn,ue.zoom),ii=v.style.terrain&&v.style.terrain.getTerrainData(it);let Nn,Ii,cs,Wr,ma=[0,0],Oa=null;if(x){if(Ii=Ue.glyphAtlasTexture,cs=ce.LINEAR,Nn=Ue.glyphAtlasTexture.size,wt.iconsInText){ma=Ue.imageAtlasTexture.size,Oa=Ue.imageAtlasTexture;const Ko="composite"===Pn.kind||"camera"===Pn.kind;Wr=Ht||v.options.rotating||v.options.zooming||Ko?ce.LINEAR:ce.NEAREST}}else{const Ko=1!==d.layout.get("icon-size").constantOr(0)||wt.iconsNeedLinear;Ii=Ue.imageAtlasTexture,cs=rn||v.options.rotating||v.options.zooming||Ko||Ht?ce.LINEAR:ce.NEAREST,Nn=Ue.imageAtlasTexture.size}const ol=vr(Ue,1,v.transform.zoom),ga=ca(it.posMatrix,Ee,he,v.transform,ol),Do=rs(it.posMatrix,Ee,he,v.transform,ol),wr=We&&wt.hasTextData(),_a="none"!==d.layout.get("icon-text-fit")&&wr&&wt.hasIconData();if(Me){const Ko=v.style.terrain?(Io,Fa)=>v.style.terrain.getElevation(it,Io,Fa):null,al="map"===d.layout.get("text-rotation-alignment");ss(wt,it.posMatrix,v,x,ga,Do,Ee,I,al,Ko)}const Zn=v.translatePosMatrix(it.posMatrix,Ue,C,P),On=Me||x&&We||_a?to:ga,gi=v.translatePosMatrix(Do,Ue,C,P,!0),Lr=rn&&0!==d.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1);let $r;$r=rn?wt.iconsInText?$o(Pn.kind,Ei,Re,Ee,v,Zn,On,gi,Nn,ma):ls(Pn.kind,Ei,Re,Ee,v,Zn,On,gi,x,Nn,!0):kr(Pn.kind,Ei,Re,Ee,v,Zn,On,gi,x,Nn);const mr={program:Di,buffers:dt,uniformValues:$r,atlasTexture:Ii,atlasTextureIcon:Oa,atlasInterpolation:cs,atlasInterpolationIcon:Wr,isSDF:rn,hasHalo:Lr};if(fe&&wt.canOverlap){Be=!0;const Ko=dt.segments.get();for(const al of Ko)$e.push({segments:new w.SegmentVector([al]),sortKey:al.sortKey,state:mr,terrainData:ii})}else $e.push({segments:dt.segments,sortKey:0,state:mr,terrainData:ii})}Be&&$e.sort((it,Ue)=>it.sortKey-Ue.sortKey);for(const it of $e){const Ue=it.state;if(Q.activeTexture.set(ce.TEXTURE0),Ue.atlasTexture.bind(Ue.atlasInterpolation,ce.CLAMP_TO_EDGE),Ue.atlasTextureIcon&&(Q.activeTexture.set(ce.TEXTURE1),Ue.atlasTextureIcon&&Ue.atlasTextureIcon.bind(Ue.atlasInterpolationIcon,ce.CLAMP_TO_EDGE)),Ue.isSDF){const wt=Ue.uniformValues;Ue.hasHalo&&(wt.u_is_halo=1,xs(Ue.buffers,it.segments,d,v,Ue.program,ke,H,q,wt,it.terrainData)),wt.u_is_halo=0}xs(Ue.buffers,it.segments,d,v,Ue.program,ke,H,q,Ue.uniformValues,it.terrainData)}}function xs(v,l,d,_,x,C,P,L,N,I){const H=_.context;x.draw(H,H.gl.TRIANGLES,C,P,L,fr.disabled,N,I,d.id,v.layoutVertexBuffer,v.indexBuffer,l,d.paint,_.transform.zoom,v.programConfigurations.get(d.id),v.dynamicLayoutVertexBuffer,v.opacityVertexBuffer)}function ws(v,l,d,_,x,C,P){const L=v.context.gl,N=d.paint.get("fill-pattern"),I=N&&N.constantOr(1),H=d.getCrossfadeParameters();let q,Q,ce,ue,he;P?(Q=I&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",q=L.LINES):(Q=I?"fillPattern":"fill",q=L.TRIANGLES);for(const Ee of _){const Me=l.getTile(Ee);if(I&&!Me.patternsLoaded())continue;const Re=Me.getBucket(d);if(!Re)continue;const fe=Re.programConfigurations.get(d.id),Be=v.useProgram(Q,fe),ke=v.style.terrain&&v.style.terrain.getTerrainData(Ee);I&&(v.context.activeTexture.set(L.TEXTURE0),Me.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),fe.updatePaintBuffers(H));const We=N.constantOr(null);if(We&&Me.imageAtlas){const Ue=Me.imageAtlas,wt=Ue.patternPositions[We.to.toString()],dt=Ue.patternPositions[We.from.toString()];wt&&dt&&fe.setConstantPatternPositions(wt,dt)}const $e=ke?Ee:null,it=v.translatePosMatrix($e?$e.posMatrix:Ee.posMatrix,Me,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(P){ue=Re.indexBuffer2,he=Re.segments2;const Ue=[L.drawingBufferWidth,L.drawingBufferHeight];ce="fillOutlinePattern"===Q&&I?an(it,v,H,Me,Ue):Ia(it,Ue)}else ue=Re.indexBuffer,he=Re.segments,ce=I?st(it,v,H,Me):rc(it);Be.draw(v.context,q,x,v.stencilModeForClipping(Ee),C,fr.disabled,ce,ke,d.id,Re.layoutVertexBuffer,ue,he,d.paint,v.transform.zoom,fe)}}function xt(v,l,d,_,x,C,P){const L=v.context,N=L.gl,I=d.paint.get("fill-extrusion-pattern"),H=I.constantOr(1),q=d.getCrossfadeParameters(),Q=d.paint.get("fill-extrusion-opacity");for(const ce of _){const ue=l.getTile(ce),he=ue.getBucket(d);if(!he)continue;const Ee=v.style.terrain&&v.style.terrain.getTerrainData(ce),Me=he.programConfigurations.get(d.id),Re=v.useProgram(H?"fillExtrusionPattern":"fillExtrusion",Me);H&&(v.context.activeTexture.set(N.TEXTURE0),ue.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),Me.updatePaintBuffers(q));const fe=I.constantOr(null);if(fe&&ue.imageAtlas){const $e=ue.imageAtlas,it=$e.patternPositions[fe.to.toString()],Ue=$e.patternPositions[fe.from.toString()];it&&Ue&&Me.setConstantPatternPositions(it,Ue)}const Be=v.translatePosMatrix(ce.posMatrix,ue,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),ke=d.paint.get("fill-extrusion-vertical-gradient"),We=H?Ec(Be,v,ke,Q,ce,q,ue):Kt(Be,v,ke,Q);Re.draw(L,L.gl.TRIANGLES,x,C,P,fr.backCCW,We,Ee,d.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,d.paint,v.transform.zoom,Me,v.style.terrain&&he.centroidVertexBuffer)}}function Dn(v,l,d,_,x,C,P){const L=v.context,N=L.gl,I=d.fbo;if(!I)return;const H=v.useProgram("hillshade"),q=v.style.terrain&&v.style.terrain.getTerrainData(l);L.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,I.colorAttachment.get()),H.draw(L,N.TRIANGLES,x,C,P,fr.disabled,((Q,ce,ue,he)=>{const Ee=ue.paint.get("hillshade-shadow-color"),Me=ue.paint.get("hillshade-highlight-color"),Re=ue.paint.get("hillshade-accent-color");let fe=ue.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===ue.paint.get("hillshade-illumination-anchor")&&(fe-=Q.transform.angle);const Be=!Q.options.moving;return{u_matrix:he?he.posMatrix:Q.transform.calculatePosMatrix(ce.tileID.toUnwrapped(),Be),u_image:0,u_latrange:Yr(0,ce.tileID),u_light:[ue.paint.get("hillshade-exaggeration"),fe],u_shadow:Ee,u_highlight:Me,u_accent:Re}})(v,d,_,q?l:null),q,_.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments)}function pr(v,l,d,_,x,C){const P=v.context,L=P.gl,N=l.dem;if(N&&N.data){const I=N.dim,H=N.stride,q=N.getPixels();if(P.activeTexture.set(L.TEXTURE1),P.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||v.getTileTexture(H),l.demTexture){const ce=l.demTexture;ce.update(q,{premultiply:!1}),ce.bind(L.NEAREST,L.CLAMP_TO_EDGE)}else l.demTexture=new vt(P,q,L.RGBA,{premultiply:!1}),l.demTexture.bind(L.NEAREST,L.CLAMP_TO_EDGE);P.activeTexture.set(L.TEXTURE0);let Q=l.fbo;if(!Q){const ce=new vt(P,{width:I,height:I,data:null},L.RGBA);ce.bind(L.LINEAR,L.CLAMP_TO_EDGE),Q=l.fbo=P.createFramebuffer(I,I,!0),Q.colorAttachment.set(ce.texture)}P.bindFramebuffer.set(Q.framebuffer),P.viewport.set([0,0,I,I]),v.useProgram("hillshadePrepare").draw(P,L.TRIANGLES,_,x,C,fr.disabled,((ce,ue)=>{const he=ue.stride,Ee=w.create();return w.ortho(Ee,0,w.EXTENT,-w.EXTENT,0,0,1),w.translate(Ee,Ee,[0,-w.EXTENT,0]),{u_matrix:Ee,u_image:1,u_dimension:[he,he],u_zoom:ce.overscaledZ,u_unpack:ue.getUnpackVector()}})(l.tileID,N),null,d.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments),l.needsHillshadePrepare=!1}}function Es(v,l,d,_,x,C){const P=_.paint.get("raster-fade-duration");if(!C&&P>0){const L=w.exported.now(),N=(L-v.timeAdded)/P,I=l?(L-l.timeAdded)/P:-1,H=d.getSource(),q=x.coveringZoomLevel({tileSize:H.tileSize,roundZoom:H.roundZoom}),Q=!l||Math.abs(l.tileID.overscaledZ-q)>Math.abs(v.tileID.overscaledZ-q),ce=Q&&v.refreshedUponExpiration?1:w.clamp(Q?N:1-I,0,1);return v.refreshedUponExpiration&&N>=1&&(v.refreshedUponExpiration=!1),l?{opacity:1,mix:1-ce}:{opacity:ce,mix:0}}return{opacity:1,mix:0}}const fa=new w.Color(1,0,0,1),Yi=new w.Color(0,1,0,1),Ll=new w.Color(0,0,1,1),ai=new w.Color(1,0,1,1),ac=new w.Color(0,1,1,1);function io(v,l,d,_){tl(v,0,l+d/2,v.transform.width,d,_)}function In(v,l,d,_){tl(v,l-d/2,0,d,v.transform.height,_)}function tl(v,l,d,_,x,C){const P=v.context,L=P.gl;L.enable(L.SCISSOR_TEST),L.scissor(l*v.pixelRatio,d*v.pixelRatio,_*v.pixelRatio,x*v.pixelRatio),P.clear({color:C}),L.disable(L.SCISSOR_TEST)}function du(v,l,d){const _=v.context,x=_.gl,C=d.posMatrix,P=v.useProgram("debug"),L=Un.disabled,N=un.disabled,I=v.colorModeForRenderPass(),H="$debug",q=v.style.terrain&&v.style.terrain.getTerrainData(d);_.activeTexture.set(x.TEXTURE0),v.emptyTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE);const Q=l.getTileByID(d.key).latestRawTileData,ce=Math.floor((Q&&Q.byteLength||0)/1024),ue=l.getTile(d).tileSize,he=512/Math.min(ue,512)*(d.overscaledZ/v.transform.zoom)*.5;let Ee=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(Ee+=` => ${d.overscaledZ}`),function(Me,Re){Me.initDebugOverlayCanvas();const fe=Me.debugOverlayCanvas,Be=Me.context.gl,ke=Me.debugOverlayCanvas.getContext("2d");ke.clearRect(0,0,fe.width,fe.height),ke.shadowColor="white",ke.shadowBlur=2,ke.lineWidth=1.5,ke.strokeStyle="white",ke.textBaseline="top",ke.font="bold 36px Open Sans, sans-serif",ke.fillText(Re,5,5),ke.strokeText(Re,5,5),Me.debugOverlayTexture.update(fe),Me.debugOverlayTexture.bind(Be.LINEAR,Be.CLAMP_TO_EDGE)}(v,`${Ee} ${ce}kB`),P.draw(_,x.TRIANGLES,L,N,jt.alphaBlended,fr.disabled,Qa(C,w.Color.transparent,he),null,H,v.debugBuffer,v.quadTriangleIndexBuffer,v.debugSegments),P.draw(_,x.LINE_STRIP,L,N,I,fr.disabled,Qa(C,w.Color.red),q,H,v.debugBuffer,v.tileBorderIndexBuffer,v.debugSegments)}function fu(v,l,d){const _=v.context,x=_.gl,C=v.colorModeForRenderPass(),P=new Un(x.LEQUAL,Un.ReadWrite,v.depthRangeFor3D),L=v.useProgram("terrain"),N=l.getTerrainMesh(),I=l.getTerrainData(d.tileID);_.bindFramebuffer.set(null),_.viewport.set([0,0,v.width,v.height]),_.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,l.getRTTFramebuffer().colorAttachment.get());const H=v.transform.calculatePosMatrix(d.tileID.toUnwrapped());L.draw(_,x.TRIANGLES,P,un.disabled,C,fr.backCCW,{u_matrix:H,u_texture:0},I,"terrain",N.vertexBuffer,N.indexBuffer,N.segments)}function lc(v,l,d,_){const x=v.context,C=d.tileSize*l.qualityFactor;d.textures[_]||(d.textures[_]=v.getTileTexture(C)||new vt(x,{width:C,height:C,data:null},x.gl.RGBA),d.textures[_].bind(x.gl.LINEAR,x.gl.CLAMP_TO_EDGE),0===_&&l.sourceCache.renderHistory.unshift(d.tileID.key));const P=l.getRTTFramebuffer();P.colorAttachment.set(d.textures[_].texture),x.bindFramebuffer.set(P.framebuffer),x.viewport.set([0,0,C,C])}class Ls{constructor(l){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=l,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=l.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){const l=this.painter.style,d=l.terrain;for(const _ in l.sourceCaches){this._coordsDescendingInv[_]={};const x=l.sourceCaches[_].getVisibleCoordinates();for(const C of x){const P=d.sourceCache.getTerrainCoords(C);for(const L in P)this._coordsDescendingInv[_][L]||(this._coordsDescendingInv[_][L]=[]),this._coordsDescendingInv[_][L].push(P[L])}}for(const _ of l._order){const x=l._layers[_],C=x.source;if(this._renderToTexture[x.type]&&!this._coordsDescendingInvStr[C]){this._coordsDescendingInvStr[C]={};for(const P in this._coordsDescendingInv[C])this._coordsDescendingInvStr[C][P]=this._coordsDescendingInv[C][P].map(L=>L.key).sort().join()}}return this._renderableTiles.forEach(_=>{for(const x in this._coordsDescendingInvStr){const C=this._coordsDescendingInvStr[x][_.tileID.key];C&&C!==_.textureCoords[x]&&_.clearTextures(this.painter),d.needsRerender(x,_.tileID)&&_.clearTextures(this.painter)}this._rerender[_.tileID.key]=!_.textures.length}),d.clearRerenderCache(),d.sourceCache.removeOutdated(this.painter),this}renderLayer(l){const d=l.type,_=this.painter,x=_.style._order,C=_.currentLayer,P=C+1===x.length;if(this._renderToTexture[d]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(x[C]),!P))return!0;if(this._renderToTexture[this._prevType]||"hillshade"===d||this._renderToTexture[d]&&P){this._prevType=d;const L=this._stacks.length-1,N=this._stacks[L]||[];for(const I of this._renderableTiles){if(lc(_,_.style.terrain,I,L),this._rerender[I.tileID.key]){_.context.clear({color:w.Color.transparent});for(let H=0;H<N.length;H++){const q=_.style._layers[N[H]],Q=q.source?this._coordsDescendingInv[q.source][I.tileID.key]:[I.tileID];_._renderTileClippingMasks(q,Q),_.renderLayer(_,_.style.sourceCaches[q.source],q,Q),q.source&&(I.textureCoords[q.source]=this._coordsDescendingInvStr[q.source][I.tileID.key])}}fu(_,_.style.terrain,I)}if("hillshade"===d){this._stacks.push([x[C]]);for(const I of this._renderableTiles){const H=this._coordsDescendingInv[l.source][I.tileID.key];lc(_,_.style.terrain,I,this._stacks.length-1),_.context.clear({color:w.Color.transparent}),_._renderTileClippingMasks(l,H),_.renderLayer(_,_.style.sourceCaches[l.source],l,H),fu(_,_.style.terrain,I)}return!0}return this._renderToTexture[d]}return!1}}const Ol={symbol:function(v,l,d,_,x){if("translucent"!==v.renderPass)return;const C=un.disabled,P=v.colorModeForRenderPass();d.layout.get("text-variable-anchor")&&function(L,N,I,H,q,Q,ce){const ue=N.transform,he="map"===q,Ee="map"===Q;for(const Me of L){const Re=H.getTile(Me),fe=Re.getBucket(I);if(!fe||!fe.text||!fe.text.segments.get().length)continue;const Be=w.evaluateSizeForZoom(fe.textSizeData,ue.zoom),ke=vr(Re,1,N.transform.zoom),We=ca(Me.posMatrix,Ee,he,N.transform,ke),$e="none"!==I.layout.get("icon-text-fit")&&fe.hasIconData();if(Be){const it=Math.pow(2,ue.zoom-Re.tileID.overscaledZ);Ur(fe,he,Ee,ce,ue,We,Me.posMatrix,it,Be,$e,N.style.terrain?(Ue,wt)=>N.style.terrain.getElevation(Me,Ue,wt):null)}}}(_,v,d,l,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),x),0!==d.paint.get("icon-opacity").constantOr(1)&&Rl(v,l,d,_,!1,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),d.layout.get("icon-rotation-alignment"),d.layout.get("icon-pitch-alignment"),d.layout.get("icon-keep-upright"),C,P),0!==d.paint.get("text-opacity").constantOr(1)&&Rl(v,l,d,_,!0,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),d.layout.get("text-keep-upright"),C,P),l.map.showCollisionBoxes&&(Jt(v,l,d,_,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),Jt(v,l,d,_,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))},circle:function(v,l,d,_){if("translucent"!==v.renderPass)return;const x=d.paint.get("circle-opacity"),C=d.paint.get("circle-stroke-width"),P=d.paint.get("circle-stroke-opacity"),L=!d.layout.get("circle-sort-key").isConstant();if(0===x.constantOr(1)&&(0===C.constantOr(1)||0===P.constantOr(1)))return;const N=v.context,I=N.gl,H=v.depthModeForSublayer(0,Un.ReadOnly),q=un.disabled,Q=v.colorModeForRenderPass(),ce=[];for(let ue=0;ue<_.length;ue++){const he=_[ue],Ee=l.getTile(he),Me=Ee.getBucket(d);if(!Me)continue;const Re=Me.programConfigurations.get(d.id),fe=v.useProgram("circle",Re),Be=Me.layoutVertexBuffer,ke=Me.indexBuffer,We=v.style.terrain&&v.style.terrain.getTerrainData(he),$e={programConfiguration:Re,program:fe,layoutVertexBuffer:Be,indexBuffer:ke,uniformValues:ci(v,he,Ee,d),terrainData:We};if(L){const it=Me.segments.get();for(const Ue of it)ce.push({segments:new w.SegmentVector([Ue]),sortKey:Ue.sortKey,state:$e})}else ce.push({segments:Me.segments,sortKey:0,state:$e})}L&&ce.sort((ue,he)=>ue.sortKey-he.sortKey);for(const ue of ce){const{programConfiguration:he,program:Ee,layoutVertexBuffer:Me,indexBuffer:Re,uniformValues:fe,terrainData:Be}=ue.state;Ee.draw(N,I.TRIANGLES,H,q,Q,fr.disabled,fe,Be,d.id,Me,Re,ue.segments,d.paint,v.transform.zoom,he)}},heatmap:function(v,l,d,_){if(0!==d.paint.get("heatmap-opacity"))if("offscreen"===v.renderPass){const x=v.context,C=x.gl,P=un.disabled,L=new jt([C.ONE,C.ONE],w.Color.transparent,[!0,!0,!0,!0]);(function(N,I,H){const q=N.gl;N.activeTexture.set(q.TEXTURE1),N.viewport.set([0,0,I.width/4,I.height/4]);let Q=H.heatmapFbo;if(Q)q.bindTexture(q.TEXTURE_2D,Q.colorAttachment.get()),N.bindFramebuffer.set(Q.framebuffer);else{const ce=q.createTexture();q.bindTexture(q.TEXTURE_2D,ce),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MAG_FILTER,q.LINEAR),Q=H.heatmapFbo=N.createFramebuffer(I.width/4,I.height/4,!1),function(ue,he,Ee,Me){const Re=ue.gl;Re.texImage2D(Re.TEXTURE_2D,0,Re.RGBA,he.width/4,he.height/4,0,Re.RGBA,ue.extRenderToTextureHalfFloat?ue.extTextureHalfFloat.HALF_FLOAT_OES:Re.UNSIGNED_BYTE,null),Me.colorAttachment.set(Ee)}(N,I,ce,Q)}})(x,v,d),x.clear({color:w.Color.transparent});for(let N=0;N<_.length;N++){const I=_[N];if(l.hasRenderableParent(I))continue;const H=l.getTile(I),q=H.getBucket(d);if(!q)continue;const Q=q.programConfigurations.get(d.id),ce=v.useProgram("heatmap",Q),{zoom:ue}=v.transform;ce.draw(x,C.TRIANGLES,Un.disabled,P,L,fr.disabled,el(I.posMatrix,H,ue,d.paint.get("heatmap-intensity")),null,d.id,q.layoutVertexBuffer,q.indexBuffer,q.segments,d.paint,v.transform.zoom,Q)}x.viewport.set([0,0,v.width,v.height])}else"translucent"===v.renderPass&&(v.context.setColorMode(v.colorModeForRenderPass()),function(x,C){const P=x.context,L=P.gl,N=C.heatmapFbo;if(!N)return;P.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,N.colorAttachment.get()),P.activeTexture.set(L.TEXTURE1);let I=C.colorRampTexture;I||(I=C.colorRampTexture=new vt(P,C.colorRamp,L.RGBA)),I.bind(L.LINEAR,L.CLAMP_TO_EDGE),x.useProgram("heatmapTexture").draw(P,L.TRIANGLES,Un.disabled,un.disabled,x.colorModeForRenderPass(),fr.disabled,((H,q,Q,ce)=>{const ue=w.create();w.ortho(ue,0,H.width,H.height,0,0,1);const he=H.context.gl;return{u_matrix:ue,u_world:[he.drawingBufferWidth,he.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:q.paint.get("heatmap-opacity")}})(x,C),null,C.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,C.paint,x.transform.zoom)}(v,d))},line:function(v,l,d,_){if("translucent"!==v.renderPass)return;const x=d.paint.get("line-opacity"),C=d.paint.get("line-width");if(0===x.constantOr(1)||0===C.constantOr(1))return;const P=v.depthModeForSublayer(0,Un.ReadOnly),L=v.colorModeForRenderPass(),N=d.paint.get("line-dasharray"),I=d.paint.get("line-pattern"),H=I.constantOr(1),q=d.paint.get("line-gradient"),Q=d.getCrossfadeParameters(),ce=H?"linePattern":N?"lineSDF":q?"lineGradient":"line",ue=v.context,he=ue.gl;let Ee=!0;for(const Me of _){const Re=l.getTile(Me);if(H&&!Re.patternsLoaded())continue;const fe=Re.getBucket(d);if(!fe)continue;const Be=fe.programConfigurations.get(d.id),ke=v.context.program.get(),We=v.useProgram(ce,Be),$e=Ee||We.program!==ke,it=v.style.terrain&&v.style.terrain.getTerrainData(Me),Ue=I.constantOr(null);if(Ue&&Re.imageAtlas){const St=Re.imageAtlas,rn=St.patternPositions[Ue.to.toString()],Pn=St.patternPositions[Ue.from.toString()];rn&&Pn&&Be.setConstantPatternPositions(rn,Pn)}const wt=it?Me:null,dt=H?xe(v,Re,d,Q,wt):N?Fe(v,Re,d,N,Q,wt):q?oe(v,Re,d,fe.lineClipsArray.length,wt):ee(v,Re,d,wt);if(H)ue.activeTexture.set(he.TEXTURE0),Re.imageAtlasTexture.bind(he.LINEAR,he.CLAMP_TO_EDGE),Be.updatePaintBuffers(Q);else if(N&&($e||v.lineAtlas.dirty))ue.activeTexture.set(he.TEXTURE0),v.lineAtlas.bind(ue);else if(q){const St=fe.gradients[d.id];let rn=St.texture;if(d.gradientVersion!==St.version){let Pn=256;if(d.stepInterpolant){const Ht=l.getSource().maxzoom,Di=Me.canonical.z===Ht?Math.ceil(1<<v.transform.maxZoom-Me.canonical.z):1;Pn=w.clamp(w.nextPowerOfTwo(fe.maxLineLength/w.EXTENT*1024*Di),256,ue.maxTextureSize)}St.gradient=w.renderColorRamp({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:Pn,image:St.gradient||void 0,clips:fe.lineClipsArray}),St.texture?St.texture.update(St.gradient):St.texture=new vt(ue,St.gradient,he.RGBA),St.version=d.gradientVersion,rn=St.texture}ue.activeTexture.set(he.TEXTURE0),rn.bind(d.stepInterpolant?he.NEAREST:he.LINEAR,he.CLAMP_TO_EDGE)}We.draw(ue,he.TRIANGLES,P,v.stencilModeForClipping(Me),L,fr.disabled,dt,it,d.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,d.paint,v.transform.zoom,Be,fe.layoutVertexBuffer2),Ee=!1}},fill:function(v,l,d,_){const x=d.paint.get("fill-color"),C=d.paint.get("fill-opacity");if(0===C.constantOr(1))return;const P=v.colorModeForRenderPass(),L=d.paint.get("fill-pattern"),N=v.opaquePassEnabledForLayer()&&!L.constantOr(1)&&1===x.constantOr(w.Color.transparent).a&&1===C.constantOr(0)?"opaque":"translucent";if(v.renderPass===N){const I=v.depthModeForSublayer(1,"opaque"===v.renderPass?Un.ReadWrite:Un.ReadOnly);ws(v,l,d,_,I,P,!1)}if("translucent"===v.renderPass&&d.paint.get("fill-antialias")){const I=v.depthModeForSublayer(d.getPaintProperty("fill-outline-color")?2:0,Un.ReadOnly);ws(v,l,d,_,I,P,!0)}},"fill-extrusion":function(v,l,d,_){const x=d.paint.get("fill-extrusion-opacity");if(0!==x&&"translucent"===v.renderPass){const C=new Un(v.context.gl.LEQUAL,Un.ReadWrite,v.depthRangeFor3D);if(1!==x||d.paint.get("fill-extrusion-pattern").constantOr(1))xt(v,l,d,_,C,un.disabled,jt.disabled),xt(v,l,d,_,C,v.stencilModeFor3D(),v.colorModeForRenderPass());else{const P=v.colorModeForRenderPass();xt(v,l,d,_,C,un.disabled,P)}}},hillshade:function(v,l,d,_){if("offscreen"!==v.renderPass&&"translucent"!==v.renderPass)return;const x=v.context,C=v.depthModeForSublayer(0,Un.ReadOnly),P=v.colorModeForRenderPass(),[L,N]="translucent"===v.renderPass?v.stencilConfigForOverlap(_):[{},_];for(const I of N){const H=l.getTile(I);void 0!==H.needsHillshadePrepare&&H.needsHillshadePrepare&&"offscreen"===v.renderPass?pr(v,H,d,C,un.disabled,P):"translucent"===v.renderPass&&Dn(v,I,H,d,C,L[I.overscaledZ],P)}x.viewport.set([0,0,v.width,v.height])},raster:function(v,l,d,_){if("translucent"!==v.renderPass||0===d.paint.get("raster-opacity")||!_.length)return;const x=v.context,C=x.gl,P=l.getSource(),L=v.useProgram("raster"),N=v.colorModeForRenderPass(),[I,H]=P instanceof Eo?[{},_]:v.stencilConfigForOverlap(_),q=H[H.length-1].overscaledZ,Q=!v.options.moving;for(const ce of H){const ue=v.depthModeForSublayer(ce.overscaledZ-q,1===d.paint.get("raster-opacity")?Un.ReadWrite:Un.ReadOnly,C.LESS),he=l.getTile(ce);he.registerFadeDuration(d.paint.get("raster-fade-duration"));const Ee=l.findLoadedParent(ce,0),Me=Es(he,Ee,l,d,v.transform,v.style.terrain);let Re,fe;const Be="nearest"===d.paint.get("raster-resampling")?C.NEAREST:C.LINEAR;x.activeTexture.set(C.TEXTURE0),he.texture.bind(Be,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),x.activeTexture.set(C.TEXTURE1),Ee?(Ee.texture.bind(Be,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),Re=Math.pow(2,Ee.tileID.overscaledZ-he.tileID.overscaledZ),fe=[he.tileID.canonical.x*Re%1,he.tileID.canonical.y*Re%1]):he.texture.bind(Be,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST);const ke=v.style.terrain&&v.style.terrain.getTerrainData(ce),We=ke?ce:null,$e=We?We.posMatrix:v.transform.calculatePosMatrix(ce.toUnwrapped(),Q),it=qn($e,fe||[0,0],Re||1,Me,d);P instanceof Eo?L.draw(x,C.TRIANGLES,ue,un.disabled,N,fr.disabled,it,ke,d.id,P.boundsBuffer,v.quadTriangleIndexBuffer,P.boundsSegments):L.draw(x,C.TRIANGLES,ue,I[ce.overscaledZ],N,fr.disabled,it,ke,d.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments)}},background:function(v,l,d,_){const x=d.paint.get("background-color"),C=d.paint.get("background-opacity");if(0===C)return;const P=v.context,L=P.gl,N=v.transform,I=N.tileSize,H=d.paint.get("background-pattern");if(v.isPatternMissing(H))return;const q=!H&&1===x.a&&1===C&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==q)return;const Q=un.disabled,ce=v.depthModeForSublayer(0,"opaque"===q?Un.ReadWrite:Un.ReadOnly),ue=v.colorModeForRenderPass(),he=v.useProgram(H?"backgroundPattern":"background"),Ee=_||N.coveringTiles({tileSize:I,terrain:v.style.terrain});H&&(P.activeTexture.set(L.TEXTURE0),v.imageManager.bind(v.context));const Me=d.getCrossfadeParameters();for(const Re of Ee){const fe=_?Re.posMatrix:v.transform.calculatePosMatrix(Re.toUnwrapped()),Be=H?Co(fe,C,v,H,{tileID:Re,tileSize:I},Me):hg(fe,C,x),ke=v.style.terrain&&v.style.terrain.getTerrainData(Re);he.draw(P,L.TRIANGLES,ce,Q,ue,fr.disabled,Be,ke,d.id,v.tileExtentBuffer,v.quadTriangleIndexBuffer,v.tileExtentSegments)}},debug:function(v,l,d){for(let _=0;_<d.length;_++)du(v,l,d[_])},custom:function(v,l,d){const _=v.context,x=d.implementation;if("offscreen"===v.renderPass){const C=x.prerender;C&&(v.setCustomLayerDefaults(),_.setColorMode(v.colorModeForRenderPass()),C.call(x,_.gl,v.transform.customLayerMatrix()),_.setDirty(),v.setBaseState())}else if("translucent"===v.renderPass){v.setCustomLayerDefaults(),_.setColorMode(v.colorModeForRenderPass()),_.setStencilMode(un.disabled);const C="3d"===x.renderingMode?new Un(v.context.gl.LEQUAL,Un.ReadWrite,v.depthRangeFor3D):v.depthModeForSublayer(0,Un.ReadOnly);_.setDepthMode(C),x.render(_.gl,v.transform.customLayerMatrix()),_.setDirty(),v.setBaseState(),_.bindFramebuffer.set(null)}}};class Zo{constructor(l,d){this.context=new kl(l),this.transform=d,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:w.create(),renderTime:0},this.setup(),this.numSublayers=vi.maxUnderzooming+vi.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new $t,this.gpuTimers={}}resize(l,d,_){if(this.width=l*_,this.height=d*_,this.pixelRatio=_,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const x of this.style._order)this.style._layers[x].resize()}setup(){const l=this.context,d=new w.PosArray;d.emplaceBack(0,0),d.emplaceBack(w.EXTENT,0),d.emplaceBack(0,w.EXTENT),d.emplaceBack(w.EXTENT,w.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(d,Qn.members),this.tileExtentSegments=w.SegmentVector.simpleSegment(0,0,4,2);const _=new w.PosArray;_.emplaceBack(0,0),_.emplaceBack(w.EXTENT,0),_.emplaceBack(0,w.EXTENT),_.emplaceBack(w.EXTENT,w.EXTENT),this.debugBuffer=l.createVertexBuffer(_,Qn.members),this.debugSegments=w.SegmentVector.simpleSegment(0,0,4,5);const x=new w.RasterBoundsArray;x.emplaceBack(0,0,0,0),x.emplaceBack(w.EXTENT,0,w.EXTENT,0),x.emplaceBack(0,w.EXTENT,0,w.EXTENT),x.emplaceBack(w.EXTENT,w.EXTENT,w.EXTENT,w.EXTENT),this.rasterBoundsBuffer=l.createVertexBuffer(x,jo.members),this.rasterBoundsSegments=w.SegmentVector.simpleSegment(0,0,4,2);const C=new w.PosArray;C.emplaceBack(0,0),C.emplaceBack(1,0),C.emplaceBack(0,1),C.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(C,Qn.members),this.viewportSegments=w.SegmentVector.simpleSegment(0,0,4,2);const P=new w.LineStripIndexArray;P.emplaceBack(0),P.emplaceBack(1),P.emplaceBack(3),P.emplaceBack(2),P.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(P);const L=new w.TriangleIndexArray;L.emplaceBack(0,1,2),L.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(L),this.emptyTexture=new vt(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA);const N=this.context.gl;this.stencilClearMode=new un({func:N.ALWAYS,mask:0},0,255,N.ZERO,N.ZERO,N.ZERO)}clearStencil(){const l=this.context,d=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const _=w.create();w.ortho(_,0,this.width,this.height,0,0,1),w.scale(_,_,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,d.TRIANGLES,Un.disabled,this.stencilClearMode,jt.disabled,fr.disabled,Sl(_),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(l,d){if(this.currentStencilSource===l.source||!l.isTileClipped()||!d||!d.length)return;this.currentStencilSource=l.source;const _=this.context,x=_.gl;this.nextStencilID+d.length>256&&this.clearStencil(),_.setColorMode(jt.disabled),_.setDepthMode(Un.disabled);const C=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const P of d){const L=this._tileClippingMaskIDs[P.key]=this.nextStencilID++,N=this.style.terrain&&this.style.terrain.getTerrainData(P);C.draw(_,x.TRIANGLES,Un.disabled,new un({func:x.ALWAYS,mask:0},L,255,x.KEEP,x.KEEP,x.REPLACE),jt.disabled,fr.disabled,Sl(P.posMatrix),N,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,d=this.context.gl;return new un({func:d.NOTEQUAL,mask:255},l,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(l){const d=this.context.gl;return new un({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(l){const d=this.context.gl,_=l.sort((P,L)=>L.overscaledZ-P.overscaledZ),x=_[_.length-1].overscaledZ,C=_[0].overscaledZ-x+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();const P={};for(let L=0;L<C;L++)P[L+x]=new un({func:d.GEQUAL,mask:255},L+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=C,[P,_]}return[{[x]:un.disabled},_]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new jt([l.CONSTANT_COLOR,l.ONE],new w.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?jt.unblended:jt.alphaBlended}depthModeForSublayer(l,d,_){if(!this.opaquePassEnabledForLayer())return Un.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new Un(_||this.context.gl.LEQUAL,d,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,d){this.style=l,this.options=d,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(w.exported.now()),this.imageManager.beginFrame();const _=this.style._order,x=this.style.sourceCaches,C=this.style.terrain&&new Ls(this);for(const I in x){const H=x[I];H.used&&H.prepare(this.context)}const P={},L={},N={};for(const I in x){const H=x[I];P[I]=H.getVisibleCoordinates(),L[I]=P[I].slice().reverse(),N[I]=H.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let I=0;I<_.length;I++)if(this.style._layers[_[I]].is3D()){this.opaquePassCutoff=I;break}if(C){this.opaquePassCutoff=0;const I=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!w.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||I.length)&&(w.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(H,q){const Q=H.context,ce=Q.gl,ue=jt.unblended,he=new Un(ce.LEQUAL,Un.ReadWrite,[0,1]),Ee=q.getTerrainMesh(),Me=q.sourceCache.getRenderableTiles(),Re=H.useProgram("terrainDepth");Q.bindFramebuffer.set(q.getFramebuffer("depth").framebuffer),Q.viewport.set([0,0,H.width/devicePixelRatio,H.height/devicePixelRatio]),Q.clear({color:w.Color.transparent,depth:1});for(const fe of Me){const Be=q.getTerrainData(fe.tileID),ke=H.transform.calculatePosMatrix(fe.tileID.toUnwrapped());Re.draw(Q,ce.TRIANGLES,he,un.disabled,ue,fr.backCCW,{u_matrix:ke},Be,"terrain",Ee.vertexBuffer,Ee.indexBuffer,Ee.segments)}Q.bindFramebuffer.set(null),Q.viewport.set([0,0,H.width,H.height])}(this,this.style.terrain),function(H,q){const Q=H.context,ce=Q.gl,ue=jt.unblended,he=new Un(ce.LEQUAL,Un.ReadWrite,[0,1]),Ee=q.getTerrainMesh(),Me=q.getCoordsTexture(),Re=q.sourceCache.getRenderableTiles(),fe=H.useProgram("terrainCoords");Q.bindFramebuffer.set(q.getFramebuffer("coords").framebuffer),Q.viewport.set([0,0,H.width/devicePixelRatio,H.height/devicePixelRatio]),Q.clear({color:w.Color.transparent,depth:1}),q.coordsIndex=[];for(const Be of Re){const ke=q.getTerrainData(Be.tileID);Q.activeTexture.set(ce.TEXTURE0),ce.bindTexture(ce.TEXTURE_2D,Me.texture);const We=H.transform.calculatePosMatrix(Be.tileID.toUnwrapped());fe.draw(Q,ce.TRIANGLES,he,un.disabled,ue,fr.backCCW,{u_matrix:We,u_terrain_coords_id:(255-q.coordsIndex.length)/255,u_texture:0},ke,"terrain",Ee.vertexBuffer,Ee.indexBuffer,Ee.segments),q.coordsIndex.push(Be.tileID.key)}Q.bindFramebuffer.set(null),Q.viewport.set([0,0,H.width,H.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(const I of _){const H=this.style._layers[I];if(!H.hasOffscreenPass()||H.isHidden(this.transform.zoom))continue;const q=L[H.source];("custom"===H.type||q.length)&&this.renderLayer(this,x[H.source],H,q)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?w.Color.black:w.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],!C)for(this.renderPass="opaque",this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const I=this.style._layers[_[this.currentLayer]],H=x[I.source],q=P[I.source];this._renderTileClippingMasks(I,q),this.renderLayer(this,H,I,q)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const I=this.style._layers[_[this.currentLayer]],H=x[I.source];if(C&&C.renderLayer(I))continue;const q=("symbol"===I.type?N:L)[I.source];this._renderTileClippingMasks(I,P[I.source]),this.renderLayer(this,H,I,q)}if(this.options.showTileBoundaries){let I,H;Object.values(this.style._layers).forEach(q=>{q.source&&!q.isHidden(this.transform.zoom)&&(q.source!==(H&&H.id)&&(H=this.style.sourceCaches[q.source]),(!I||I.getSource().maxzoom<H.getSource().maxzoom)&&(I=H))}),I&&Ol.debug(this,I,I.getVisibleCoordinates())}this.options.showPadding&&function(I){const H=I.transform.padding;io(I,I.transform.height-(H.top||0),3,fa),io(I,H.bottom||0,3,Yi),In(I,H.left||0,3,Ll),In(I,I.transform.width-(H.right||0),3,ai);const q=I.transform.centerPoint;var Q,ce,ue,he;tl(Q=I,(ce=q.x)-1,(ue=I.transform.height-q.y)-10,2,20,he=ac),tl(Q,ce-10,ue-1,20,2,he)}(this),this.context.setDefault()}renderLayer(l,d,_,x){_.isHidden(this.transform.zoom)||("background"===_.type||"custom"===_.type||(x||[]).length)&&(this.id=_.id,this.gpuTimingStart(_),Ol[_.type](l,d,_,x,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(l){if(!this.options.gpuTiming)return;const d=this.context.extTimerQuery;let _=this.gpuTimers[l.id];_||(_=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),_.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,_.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}collectGpuTimers(){const l=this.gpuTimers;return this.gpuTimers={},l}queryGpuTimers(l){const d={};for(const _ in l){const x=l[_],C=this.context.extTimerQuery,P=C.getQueryObjectEXT(x.query,C.QUERY_RESULT_EXT)/1e6;C.deleteQueryEXT(x.query),d[_]=P}return d}translatePosMatrix(l,d,_,x,C){if(!_[0]&&!_[1])return l;const P=C?"map"===x?this.transform.angle:0:"viewport"===x?-this.transform.angle:0;if(P){const I=Math.sin(P),H=Math.cos(P);_=[_[0]*H-_[1]*I,_[0]*I+_[1]*H]}const L=[C?_[0]:vr(d,_[0],this.transform.zoom),C?_[1]:vr(d,_[1],this.transform.zoom),0],N=new Float32Array(16);return w.translate(N,l,L),N}saveTileTexture(l){const d=this._tileTextures[l.size[0]];d?d.push(l):this._tileTextures[l.size[0]]=[l]}getTileTexture(l){const d=this._tileTextures[l];return d&&d.length>0?d.pop():null}isPatternMissing(l){if(!l)return!1;if(!l.from||!l.to)return!0;const d=this.imageManager.getPattern(l.from.toString()),_=this.imageManager.getPattern(l.to.toString());return!d||!_}useProgram(l,d){this.cache=this.cache||{};const _=l+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[_]||(this.cache[_]=new Qs(this.context,l,Hn[l],d,Mi[l],this._showOverdrawInspector,this.style.terrain)),this.cache[_]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new vt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class So{constructor(l,d){this.points=l,this.planes=d}static fromInvProjectionMatrix(l,d,_){const x=Math.pow(2,_),C=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(L=>{const N=1/(L=w.transformMat4([],L,l))[3]/d*x;return w.mul$1(L,L,[N,N,1/L[3],N])}),P=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(L=>{const N=w.sub([],C[L[0]],C[L[1]]),I=w.sub([],C[L[2]],C[L[1]]),H=w.normalize([],w.cross([],N,I)),q=-w.dot(H,C[L[1]]);return H.concat(q)});return new So(C,P)}}class nl{constructor(l,d){this.min=l,this.max=d,this.center=w.scale$1([],w.add([],this.min,this.max),.5)}quadrant(l){const d=[l%2==0,l<2],_=w.clone$2(this.min),x=w.clone$2(this.max);for(let C=0;C<d.length;C++)_[C]=d[C]?this.min[C]:this.center[C],x[C]=d[C]?this.center[C]:this.max[C];return x[2]=this.max[2],new nl(_,x)}distanceX(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]}distanceY(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]}intersects(l){const d=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let _=!0;for(let x=0;x<l.planes.length;x++){const C=l.planes[x];let P=0;for(let L=0;L<d.length;L++)w.dot$1(C,d[L])>=0&&P++;if(0===P)return 0;P!==d.length&&(_=!1)}if(_)return 2;for(let x=0;x<3;x++){let C=Number.MAX_VALUE,P=-Number.MAX_VALUE;for(let L=0;L<l.points.length;L++){const N=l.points[L][x]-this.min[x];C=Math.min(C,N),P=Math.max(P,N)}if(P<0||C>this.max[x]-this.min[x])return 0}return 1}}class Fl{constructor(l=0,d=0,_=0,x=0){if(isNaN(l)||l<0||isNaN(d)||d<0||isNaN(_)||_<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=d,this.left=_,this.right=x}interpolate(l,d,_){return null!=d.top&&null!=l.top&&(this.top=w.number(l.top,d.top,_)),null!=d.bottom&&null!=l.bottom&&(this.bottom=w.number(l.bottom,d.bottom,_)),null!=d.left&&null!=l.left&&(this.left=w.number(l.left,d.left,_)),null!=d.right&&null!=l.right&&(this.right=w.number(l.right,d.right,_)),this}getCenter(l,d){const _=w.clamp((this.left+l-this.right)/2,0,l),x=w.clamp((this.top+d-this.bottom)/2,0,d);return new w.pointGeometry(_,x)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new Fl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Ri{constructor(l,d,_,x,C){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=void 0===C||!!C,this._minZoom=l||0,this._maxZoom=d||22,this._minPitch=_??0,this._maxPitch=x??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new w.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Fl,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const l=new Ri(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.tileSize=this.tileSize,l.latRange=this.latRange,l.width=this.width,l.height=this.height,l._center=this._center,l._elevation=this._elevation,l.zoom=this.zoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(l){void 0===l?l=!0:null===l&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new w.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(l){const d=-w.wrap(l,-180,180)*Math.PI/180;var _,x,C,P,L,N,I,H,q,Q;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=(_=new w.ARRAY_TYPE(4),w.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_),x=this.rotationMatrix,P=this.angle,L=(C=this.rotationMatrix)[0],N=C[1],I=C[2],H=C[3],q=Math.sin(P),Q=Math.cos(P),x[0]=L*Q+I*q,x[1]=N*Q+H*q,x[2]=L*-q+I*Q,x[3]=N*-q+H*Q)}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const d=w.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(l){const d=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.scale=this.zoomScale(d),this.tileZoom=Math.floor(d),this.zoomFraction=d-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(l){l!==this._elevation&&(this._elevation=l,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,d,_){this._unmodified=!1,this._edgeInsets.interpolate(l,d,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const d=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(l){const d=[new w.UnwrappedTileID(0,l)];if(this._renderWorldCopies){const _=this.pointCoordinate(new w.pointGeometry(0,0)),x=this.pointCoordinate(new w.pointGeometry(this.width,0)),C=this.pointCoordinate(new w.pointGeometry(this.width,this.height)),P=this.pointCoordinate(new w.pointGeometry(0,this.height)),L=Math.floor(Math.min(_.x,x.x,C.x,P.x)),N=Math.floor(Math.max(_.x,x.x,C.x,P.x)),I=1;for(let H=L-I;H<=N+I;H++)0!==H&&d.push(new w.UnwrappedTileID(H,l))}return d}coveringTiles(l){var d,_;let x=this.coveringZoomLevel(l);const C=x;if(void 0!==l.minzoom&&x<l.minzoom)return[];void 0!==l.maxzoom&&x>l.maxzoom&&(x=l.maxzoom);const P=this.pointCoordinate(this.getCameraPoint()),L=w.MercatorCoordinate.fromLngLat(this.center),N=Math.pow(2,x),I=[N*P.x,N*P.y,0],H=[N*L.x,N*L.y,0],q=So.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,x);let Q=l.minzoom||0;!l.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(Q=x);const ce=l.terrain?2/Math.min(this.tileSize,l.tileSize)*this.tileSize:3,ue=fe=>({aabb:new nl([fe*N,0,0],[(fe+1)*N,N,0]),zoom:0,x:0,y:0,wrap:fe,fullyVisible:!1}),he=[],Ee=[],Me=x,Re=l.reparseOverscaled?C:x;if(this._renderWorldCopies)for(let fe=1;fe<=3;fe++)he.push(ue(-fe)),he.push(ue(fe));for(he.push(ue(0));he.length>0;){const fe=he.pop(),Be=fe.x,ke=fe.y;let We=fe.fullyVisible;if(!We){const St=fe.aabb.intersects(q);if(0===St)continue;We=2===St}const $e=l.terrain?I:H,it=fe.aabb.distanceX($e),Ue=fe.aabb.distanceY($e),wt=Math.max(Math.abs(it),Math.abs(Ue)),dt=ce+(1<<Me-fe.zoom)-2;if(fe.zoom===Me||wt>dt&&fe.zoom>=Q){const St=Me-fe.zoom,rn=I[0]-.5-(Be<<St),Pn=I[1]-.5-(ke<<St);Ee.push({tileID:new w.OverscaledTileID(fe.zoom===Me?Re:fe.zoom,fe.wrap,fe.zoom,Be,ke),distanceSq:w.sqrLen([H[0]-.5-Be,H[1]-.5-ke]),tileDistanceToCamera:Math.sqrt(rn*rn+Pn*Pn)})}else for(let St=0;St<4;St++){const rn=(Be<<1)+St%2,Pn=(ke<<1)+(St>>1),Ht=fe.zoom+1;let Di=fe.aabb.quadrant(St);if(l.terrain){const Ei=new w.OverscaledTileID(Ht,fe.wrap,Ht,rn,Pn),ii=l.terrain.getMinMaxElevation(Ei),Nn=null!==(d=ii.minElevation)&&void 0!==d?d:this.elevation,Ii=null!==(_=ii.maxElevation)&&void 0!==_?_:this.elevation;Di=new nl([Di.min[0],Di.min[1],Nn],[Di.max[0],Di.max[1],Ii])}he.push({aabb:Di,zoom:Ht,x:rn,y:Pn,wrap:fe.wrap,fullyVisible:We})}}return Ee.sort((fe,Be)=>fe.distanceSq-Be.distanceSq).map(fe=>fe.tileID)}resize(l,d){this.width=l,this.height=d,this.pixelsToGLUnits=[2/l,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const d=w.clamp(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new w.pointGeometry(w.mercatorXfromLng(l.lng)*this.worldSize,w.mercatorYfromLat(d)*this.worldSize)}unproject(l){return new w.MercatorCoordinate(l.x/this.worldSize,l.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(l){this.freezeElevation||(this.elevation=l?this.getElevation(this._center,l):0)}getElevation(l,d){const _=w.MercatorCoordinate.fromLngLat(l),x=(1<<this.tileZoom)*w.EXTENT,C=_.x*x,P=_.y*x,L=Math.floor(C/w.EXTENT),N=Math.floor(P/w.EXTENT),I=new w.OverscaledTileID(this.tileZoom,0,this.tileZoom,L,N);return d.getElevation(I,C%w.EXTENT,P%w.EXTENT,w.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(l){const d=this.pointLocation(this.centerPoint,l),_=this.getElevation(d,l);if(!(this.elevation-_))return;const x=this.getCameraPosition(),C=w.MercatorCoordinate.fromLngLat(x.lngLat,x.altitude),P=w.MercatorCoordinate.fromLngLat(d,_),L=C.x-P.x,N=C.y-P.y,I=C.z-P.z,H=Math.sqrt(L*L+N*N+I*I),q=this.scaleZoom(this.cameraToCenterDistance/H/this.tileSize);this._elevation=_,this._center=d,this.zoom=q}setLocationAtPoint(l,d){const _=this.pointCoordinate(d),x=this.pointCoordinate(this.centerPoint),C=this.locationCoordinate(l),P=new w.MercatorCoordinate(C.x-(_.x-x.x),C.y-(_.y-x.y));this.center=this.coordinateLocation(P),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(l,d){return d?this.coordinatePoint(this.locationCoordinate(l),this.getElevation(l,d),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(l))}pointLocation(l,d){return this.coordinateLocation(this.pointCoordinate(l,d))}locationCoordinate(l){return w.MercatorCoordinate.fromLngLat(l)}coordinateLocation(l){return l&&l.toLngLat()}pointCoordinate(l,d){if(d){const Q=d.pointCoordinate(l);if(null!=Q)return Q}const _=[l.x,l.y,0,1],x=[l.x,l.y,1,1];w.transformMat4(_,_,this.pixelMatrixInverse),w.transformMat4(x,x,this.pixelMatrixInverse);const C=_[3],P=x[3],L=_[1]/C,N=x[1]/P,I=_[2]/C,H=x[2]/P,q=I===H?0:(0-I)/(H-I);return new w.MercatorCoordinate(w.number(_[0]/C,x[0]/P,q)/this.worldSize,w.number(L,N,q)/this.worldSize)}coordinatePoint(l,d=0,_=this.pixelMatrix){const x=[l.x*this.worldSize,l.y*this.worldSize,d,1];return w.transformMat4(x,x,_),new w.pointGeometry(x[0]/x[3],x[1]/x[3])}getBounds(){const l=Math.max(0,this.height/2-this.getHorizon());return(new w.LngLatBounds).extend(this.pointLocation(new w.pointGeometry(0,l))).extend(this.pointLocation(new w.pointGeometry(this.width,l))).extend(this.pointLocation(new w.pointGeometry(this.width,this.height))).extend(this.pointLocation(new w.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new w.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(l,d=!1){const _=l.key,x=d?this._alignedPosMatrixCache:this._posMatrixCache;if(x[_])return x[_];const C=l.canonical,P=this.worldSize/this.zoomScale(C.z),L=C.x+Math.pow(2,C.z)*l.wrap,N=w.identity(new Float64Array(16));return w.translate(N,N,[L*P,C.y*P,0]),w.scale(N,N,[P/w.EXTENT,P/w.EXTENT,1]),w.multiply(N,d?this.alignedProjMatrix:this.projMatrix,N),x[_]=new Float32Array(N),x[_]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let l,d,_,x,C=-90,P=90,L=-180,N=180;const I=this.size,H=this._unmodified;if(this.latRange){const ce=this.latRange;C=w.mercatorYfromLat(ce[1])*this.worldSize,P=w.mercatorYfromLat(ce[0])*this.worldSize,l=P-C<I.y?I.y/(P-C):0}if(this.lngRange){const ce=this.lngRange;L=w.wrap(w.mercatorXfromLng(ce[0])*this.worldSize,0,this.worldSize),N=w.wrap(w.mercatorXfromLng(ce[1])*this.worldSize,0,this.worldSize),N<L&&(N+=this.worldSize),d=N-L<I.x?I.x/(N-L):0}const q=this.point,Q=Math.max(d||0,l||0);if(Q)return this.center=this.unproject(new w.pointGeometry(d?(N+L)/2:q.x,l?(P+C)/2:q.y)),this.zoom+=this.scaleZoom(Q),this._unmodified=H,void(this._constraining=!1);if(this.latRange){const ce=q.y,ue=I.y/2;ce-ue<C&&(x=C+ue),ce+ue>P&&(x=P-ue)}if(this.lngRange){const ce=(L+N)/2,ue=w.wrap(q.x,ce-this.worldSize/2,ce+this.worldSize/2),he=I.x/2;ue-he<L&&(_=L+he),ue+he>N&&(_=N-he)}void 0===_&&void 0===x||(this.center=this.unproject(new w.pointGeometry(void 0!==_?_:q.x,void 0!==x?x:q.y)).wrap()),this._unmodified=H,this._constraining=!1}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,d=this.point.x,_=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=w.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let x=w.identity(new Float64Array(16));w.scale(x,x,[this.width/2,-this.height/2,1]),w.translate(x,x,[1,-1,0]),this.labelPlaneMatrix=x,x=w.identity(new Float64Array(16)),w.scale(x,x,[1,-1,1]),w.translate(x,x,[-1,-1,0]),w.scale(x,x,[2/this.width,2/this.height,1]),this.glCoordMatrix=x,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const C=Math.PI/2+this._pitch,P=this._fov*(.5+l.y/this.height),L=Math.sin(P)*this.cameraToSeaLevelDistance/Math.sin(w.clamp(Math.PI-C-P,.01,Math.PI-.01)),N=this.getHorizon(),I=2*Math.atan(N/this.cameraToCenterDistance)*(.5+l.y/(2*N)),H=Math.sin(I)*this.cameraToSeaLevelDistance/Math.sin(w.clamp(Math.PI-C-I,.01,Math.PI-.01)),q=Math.cos(Math.PI/2-this._pitch)*L+this.cameraToSeaLevelDistance,Q=Math.cos(Math.PI/2-this._pitch)*H+this.cameraToSeaLevelDistance,ce=1.01*Math.min(q,Q),ue=this.height/50;x=new Float64Array(16),w.perspective(x,this._fov,this.width/this.height,ue,ce),x[8]=2*-l.x/this.width,x[9]=2*l.y/this.height,w.scale(x,x,[1,-1,1]),w.translate(x,x,[0,0,-this.cameraToCenterDistance]),w.rotateX(x,x,this._pitch),w.rotateZ(x,x,this.angle),w.translate(x,x,[-d,-_,0]),this.mercatorMatrix=w.scale([],x,[this.worldSize,this.worldSize,this.worldSize]),w.scale(x,x,[1,1,this._pixelPerMeter]),this.pixelMatrix=w.multiply(new Float64Array(16),this.labelPlaneMatrix,x),w.translate(x,x,[0,0,-this.elevation]),this.projMatrix=x,this.invProjMatrix=w.invert([],x),this.pixelMatrix3D=w.multiply(new Float64Array(16),this.labelPlaneMatrix,x);const he=this.width%2/2,Ee=this.height%2/2,Me=Math.cos(this.angle),Re=Math.sin(this.angle),fe=d-Math.round(d)+Me*he+Re*Ee,Be=_-Math.round(_)+Me*Ee+Re*he,ke=new Float64Array(x);if(w.translate(ke,ke,[fe>.5?fe-1:fe,Be>.5?Be-1:Be,0]),this.alignedProjMatrix=ke,x=w.invert(new Float64Array(16),this.pixelMatrix),!x)throw new Error("failed to invert matrix");this.pixelMatrixInverse=x,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const l=this.pointCoordinate(new w.pointGeometry(0,0)),d=[l.x*this.worldSize,l.y*this.worldSize,0,1];return w.transformMat4(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new w.pointGeometry(0,l))}getCameraQueryGeometry(l){const d=this.getCameraPoint();if(1===l.length)return[l[0],d];{let _=d.x,x=d.y,C=d.x,P=d.y;for(const L of l)_=Math.min(_,L.x),x=Math.min(x,L.y),C=Math.max(C,L.x),P=Math.max(P,L.y);return[new w.pointGeometry(_,x),new w.pointGeometry(C,x),new w.pointGeometry(C,P),new w.pointGeometry(_,P),new w.pointGeometry(_,x)]}}}class Nl{constructor(l){this._hashName=l&&encodeURIComponent(l),w.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(d,_){let x=!1,C=null;const P=()=>{C=null,x&&(d(),C=setTimeout(P,300),x=!1)};return()=>(x=!0,C||P(),C)}(this._updateHashUnthrottled.bind(this))}addTo(l){return this._map=l,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(l){const d=this._map.getCenter(),_=Math.round(100*this._map.getZoom())/100,x=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),C=Math.pow(10,x),P=Math.round(d.lng*C)/C,L=Math.round(d.lat*C)/C,N=this._map.getBearing(),I=this._map.getPitch();let H="";if(H+=l?`/${P}/${L}/${_}`:`${_}/${L}/${P}`,(N||I)&&(H+="/"+Math.round(10*N)/10),I&&(H+=`/${Math.round(I)}`),this._hashName){const q=this._hashName;let Q=!1;const ce=window.location.hash.slice(1).split("&").map(ue=>{const he=ue.split("=")[0];return he===q?(Q=!0,`${he}=${H}`):ue}).filter(ue=>ue);return Q||ce.push(`${q}=${H}`),`#${ce.join("&")}`}return`#${H}`}_getCurrentHash(){const l=window.location.hash.replace("#","");if(this._hashName){let d;return l.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(d=_)}),(d&&d[1]||"").split("/")}return l.split("/")}_onHashChange(){const l=this._getCurrentHash();if(l.length>=3&&!l.some(d=>isNaN(d))){const d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:d,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){const l=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,l)}catch{}}}const cc={linearity:.3,easing:w.bezier(0,0,.3,1)},Uu=w.extend({deceleration:2500,maxSpeed:1400},cc),Dh=w.extend({deceleration:20,maxSpeed:1400},cc),pu=w.extend({deceleration:1e3,maxSpeed:360},cc),Mo=w.extend({deceleration:1e3,maxSpeed:90},cc);class Ts{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:w.exported.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,d=w.exported.now();for(;l.length>0&&d-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,pan:new w.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:C}of this._inertiaBuffer)d.zoom+=C.zoomDelta||0,d.bearing+=C.bearingDelta||0,d.pitch+=C.pitchDelta||0,C.panDelta&&d.pan._add(C.panDelta),C.around&&(d.around=C.around),C.pinchAround&&(d.pinchAround=C.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(d.pan.mag()){const C=ju(d.pan.mag(),_,w.extend({},Uu,l||{}));x.offset=d.pan.mult(C.amount/d.pan.mag()),x.center=this._map.transform.center,jr(x,C)}if(d.zoom){const C=ju(d.zoom,_,Dh);x.zoom=this._map.transform.zoom+C.amount,jr(x,C)}if(d.bearing){const C=ju(d.bearing,_,pu);x.bearing=this._map.transform.bearing+w.clamp(C.amount,-179,179),jr(x,C)}if(d.pitch){const C=ju(d.pitch,_,Mo);x.pitch=this._map.transform.pitch+C.amount,jr(x,C)}if(x.zoom||x.bearing){const C=void 0===d.pinchAround?d.around:d.pinchAround;x.around=C?this._map.unproject(C):this._map.getCenter()}return this.clear(),w.extend(x,{noMoveStart:!0})}}function jr(v,l){(!v.duration||v.duration<l.duration)&&(v.duration=l.duration,v.easing=l.easing)}function ju(v,l,d){const{maxSpeed:_,linearity:x,deceleration:C}=d,P=w.clamp(v*x/(l/1e3),-_,_),L=Math.abs(P)/(C*x);return{easing:d.easing,duration:1e3*L,amount:P*(L/2)}}class nr extends w.Event{constructor(l,d,_,x={}){const C=Ne.mousePos(d.getCanvasContainer(),_),P=d.unproject(C);super(l,w.extend({point:C,lngLat:P,originalEvent:_},x)),this._defaultPrevented=!1,this.target=d}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class ro extends w.Event{constructor(l,d,_){const x="touchend"===l?_.changedTouches:_.touches,C=Ne.touchPos(d.getCanvasContainer(),x),P=C.map(N=>d.unproject(N)),L=C.reduce((N,I,H,q)=>N.add(I.div(q.length)),new w.pointGeometry(0,0));super(l,{points:C,point:L,lngLats:P,lngLat:d.unproject(L),originalEvent:_}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class so extends w.Event{constructor(l,d,_){super(l,{originalEvent:_}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Ih{constructor(l,d){this._map=l,this._clickTolerance=d.clickTolerance}reset(){delete this._mousedownPos}wheel(l){return this._firePreventable(new so(l.type,this._map,l))}mousedown(l,d){return this._mousedownPos=d,this._firePreventable(new nr(l.type,this._map,l))}mouseup(l){this._map.fire(new nr(l.type,this._map,l))}click(l,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new nr(l.type,this._map,l))}dblclick(l){return this._firePreventable(new nr(l.type,this._map,l))}mouseover(l){this._map.fire(new nr(l.type,this._map,l))}mouseout(l){this._map.fire(new nr(l.type,this._map,l))}touchstart(l){return this._firePreventable(new ro(l.type,this._map,l))}touchmove(l){this._map.fire(new ro(l.type,this._map,l))}touchend(l){this._map.fire(new ro(l.type,this._map,l))}touchcancel(l){this._map.fire(new ro(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ao{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(l){this._map.fire(new nr(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new nr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._ignoreContextMenu||this._map.fire(new nr(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ae{constructor(l,d){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,d){this.isEnabled()&&l.shiftKey&&0===l.button&&(Ne.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(l,d){if(!this._active)return;const _=d;if(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)return;const x=this._startPos;this._lastPos=_,this._box||(this._box=Ne.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));const C=Math.min(x.x,_.x),P=Math.max(x.x,_.x),L=Math.min(x.y,_.y),N=Math.max(x.y,_.y);Ne.setTransform(this._box,`translate(${C}px,${L}px)`),this._box.style.width=P-C+"px",this._box.style.height=N-L+"px"}mouseupWindow(l,d){if(!this._active||0!==l.button)return;const _=this._startPos,x=d;if(this.reset(),Ne.suppressClick(),_.x!==x.x||_.y!==x.y)return this._map.fire(new w.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:C=>C.fitScreenCoordinates(_,x,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",l)}keydown(l){this._active&&27===l.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",l))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(Ne.remove(this._box),this._box=null),Ne.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(l,d){return this._map.fire(new w.Event(l,{originalEvent:d}))}}function Xe(v,l){if(v.length!==l.length)throw new Error(`The number of touches and points are not equal - touches ${v.length}, points ${l.length}`);const d={};for(let _=0;_<v.length;_++)d[v[_].identifier]=l[_];return d}class Ge{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(l,d,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=l.timeStamp),_.length===this.numTouches&&(this.centroid=function(x){const C=new w.pointGeometry(0,0);for(const P of x)C._add(P);return C.div(x.length)}(d),this.touches=Xe(_,d)))}touchmove(l,d,_){if(this.aborted||!this.centroid)return;const x=Xe(_,d);for(const C in this.touches){const P=this.touches[C],L=x[C];(!L||L.dist(P)>30)&&(this.aborted=!0)}}touchend(l,d,_){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),0===_.length){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class Rt{constructor(l){this.singleTap=new Ge(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(l,d,_){this.singleTap.touchstart(l,d,_)}touchmove(l,d,_){this.singleTap.touchmove(l,d,_)}touchend(l,d,_){const x=this.singleTap.touchend(l,d,_);if(x){const C=l.timeStamp-this.lastTime<500,P=!this.lastTap||this.lastTap.dist(x)<30;if(C&&P||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class Ln{constructor(){this._zoomIn=new Rt({numTouches:1,numTaps:2}),this._zoomOut=new Rt({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,d,_){this._zoomIn.touchstart(l,d,_),this._zoomOut.touchstart(l,d,_)}touchmove(l,d,_){this._zoomIn.touchmove(l,d,_),this._zoomOut.touchmove(l,d,_)}touchend(l,d,_){const x=this._zoomIn.touchend(l,d,_),C=this._zoomOut.touchend(l,d,_);return x?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:P.getZoom()+1,around:P.unproject(x)},{originalEvent:l})}):C?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:P.getZoom()-1,around:P.unproject(C)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Ni={0:1,2:2};class Hr{constructor(l){this.reset(),this._clickTolerance=l.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(l,d){return!1}_move(l,d){return{}}mousedown(l,d){if(this._lastPoint)return;const _=Ne.mouseButton(l);this._correctButton(l,_)&&(this._lastPoint=d,this._eventButton=_)}mousemoveWindow(l,d){const _=this._lastPoint;if(_)if(l.preventDefault(),function(x,C){const P=Ni[C];return void 0===x.buttons||(x.buttons&P)!==P}(l,this._eventButton))this.reset();else if(this._moved||!(d.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(_,d)}mouseupWindow(l){this._lastPoint&&Ne.mouseButton(l)===this._eventButton&&(this._moved&&Ne.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bi extends Hr{mousedown(l,d){super.mousedown(l,d),this._lastPoint&&(this._active=!0)}_correctButton(l,d){return 0===d&&!l.ctrlKey}_move(l,d){return{around:d,panDelta:d.sub(l)}}}class il extends Hr{_correctButton(l,d){return 0===d&&l.ctrlKey||2===d}_move(l,d){const _=.8*(d.x-l.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(l){l.preventDefault()}}class Dt extends Hr{_correctButton(l,d){return 0===d&&l.ctrlKey||2===d}_move(l,d){const _=-.5*(d.y-l.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(l){l.preventDefault()}}class pa{constructor(l,d){this._minTouches=l.cooperativeGestures?2:1,this._clickTolerance=l.clickTolerance||1,this._map=d,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new w.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(l,d,_){return this._calculateTransform(l,d,_)}touchmove(l,d,_){if(this._map._cooperativeGestures&&(2===this._minTouches&&_.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(l,!1,_.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(_.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,d,_)}touchend(l,d,_){this._calculateTransform(l,d,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,d,_){_.length>0&&(this._active=!0);const x=Xe(_,d),C=new w.pointGeometry(0,0),P=new w.pointGeometry(0,0);let L=0;for(const I in x){const H=x[I],q=this._touches[I];q&&(C._add(H),P._add(H.sub(q)),L++,x[I]=H)}if(this._touches=x,L<this._minTouches||!P.mag())return;const N=P.div(L);return this._sum._add(N),this._sum.mag()<this._clickTolerance?void 0:{around:C.div(L),panDelta:N}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bl{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(l){}_move(l,d,_){return{}}touchstart(l,d,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([d[0],d[1]]))}touchmove(l,d,_){if(!this._firstTwoTouches)return;l.preventDefault();const[x,C]=this._firstTwoTouches,P=Cc(_,d,x),L=Cc(_,d,C);if(!P||!L)return;const N=this._aroundCenter?null:P.add(L).div(2);return this._move([P,L],N,l)}touchend(l,d,_){if(!this._firstTwoTouches)return;const[x,C]=this._firstTwoTouches,P=Cc(_,d,x),L=Cc(_,d,C);P&&L||(this._active&&Ne.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&"center"===l.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Cc(v,l,d){for(let _=0;_<v.length;_++)if(v[_].identifier===d)return l[_]}function Sc(v,l){return Math.log(v/l)/Math.LN2}class yt extends Bl{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,d){const _=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(Sc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Sc(this._distance,_),pinchAround:d}}}function mu(v,l){return 180*v.angleWith(l)/Math.PI}class Ki extends Bl{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,d){const _=this._vector;if(this._vector=l[0].sub(l[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:mu(this._vector,_),pinchAround:d}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const d=25/(Math.PI*this._minDiameter)*360,_=mu(l,this._startVector);return Math.abs(_)<d}}function Vf(v){return Math.abs(v.y)>Math.abs(v.x)}class Rd extends Bl{constructor(l){super(),this._map=l}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(l,d,_){super.touchstart(l,d,_),this._currentTouchCount=_.length}_start(l){this._lastPoints=l,Vf(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,d,_){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const x=l[0].sub(this._lastPoints[0]),C=l[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(x,C,_.timeStamp),this._valid?(this._lastPoints=l,this._active=!0,{pitchDelta:(x.y+C.y)/2*-.5}):void 0}gestureBeginsVertically(l,d,_){if(void 0!==this._valid)return this._valid;const x=l.mag()>=2,C=d.mag()>=2;if(!x&&!C)return;if(!x||!C)return void 0===this._firstMove&&(this._firstMove=_),_-this._firstMove<100&&void 0;const P=l.y>0==d.y>0;return Vf(l)&&Vf(d)&&P}}const gu={panStep:100,bearingStep:15,pitchStep:10};class Ph{constructor(){const l=gu;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let d=0,_=0,x=0,C=0,P=0;switch(l.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:l.shiftKey?_=-1:(l.preventDefault(),C=-1);break;case 39:l.shiftKey?_=1:(l.preventDefault(),C=1);break;case 38:l.shiftKey?x=1:(l.preventDefault(),P=-1);break;case 40:l.shiftKey?x=-1:(l.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(_=0,x=0),{cameraAnimation:L=>{const N=L.getZoom();L.easeTo({duration:300,easeId:"keyboardHandler",easing:dg,zoom:d?Math.round(N)+d*(l.shiftKey?2:1):N,bearing:L.getBearing()+_*this._bearingStep,pitch:L.getPitch()+x*this._pitchStep,offset:[-C*this._panStep,-P*this._panStep],center:L.getCenter()},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function dg(v){return v*(2-v)}const Wp=4.000244140625;class Hu{constructor(l,d){this._map=l,this._el=l.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,w.bindAll(["_onTimeout"],this)}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=l&&"center"===l.around)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(l){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;l.preventDefault()}let d=l.deltaMode===WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const _=w.exported.now(),x=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,0!==d&&d%Wp==0?this._type="wheel":0!==d&&Math.abs(d)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(x*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),l.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=l,this._delta-=d,this._active||this._start(l)),l.preventDefault()}_onTimeout(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=Ne.mousePos(this._el,l);this._around=w.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(d)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._map.transform;if(0!==this._delta){const L="wheel"===this._type&&Math.abs(this._delta)>Wp?this._wheelZoomRate:this._defaultZoomRate;let N=2/(1+Math.exp(-Math.abs(this._delta*L)));this._delta<0&&0!==N&&(N=1/N);const I="number"==typeof this._targetZoom?l.zoomScale(this._targetZoom):l.scale;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(I*N))),"wheel"===this._type&&(this._startZoom=l.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const d="number"==typeof this._targetZoom?this._targetZoom:l.zoom,_=this._startZoom,x=this._easing;let C,P=!1;if("wheel"===this._type&&_&&x){const L=Math.min((w.exported.now()-this._lastWheelEventTime)/200,1),N=x(L);C=w.number(_,d,N),L<1?this._frameId||(this._frameId=!0):P=!0}else C=d,P=!0;return this._active=!0,P&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!P,zoomDelta:C-l.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let d=w.ease;if(this._prevEase){const _=this._prevEase,x=(w.exported.now()-_.start)/_.duration,C=_.easing(x+.01)-_.easing(x),P=.27/Math.sqrt(C*C+1e-4)*.01,L=Math.sqrt(.0729-P*P);d=w.bezier(P,L,.25,1)}return this._prevEase={start:w.exported.now(),duration:l,easing:d},d}reset(){this._active=!1}}class Gs{constructor(l,d){this._clickZoom=l,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class _u{constructor(){this.reset()}reset(){this._active=!1}dblclick(l,d){return l.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(l.shiftKey?-1:1),around:_.unproject(d)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xo{constructor(){this._tap=new Rt({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(l,d,_){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=d[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(l,d,_))}touchmove(l,d,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const x=d[0],C=x.y-this._swipePoint.y;return this._swipePoint=x,l.preventDefault(),this._active=!0,{zoomDelta:C/128}}}else this._tap.touchmove(l,d,_)}touchend(l,d,_){this._tapTime?this._swipePoint&&0===_.length&&this.reset():this._tap.touchend(l,d,_)&&(this._tapTime=l.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Cs{constructor(l,d,_){this._el=l,this._mousePan=d,this._touchPan=_}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class zl{constructor(l,d,_){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=d,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ld{constructor(l,d,_,x){this._el=l,this._touchZoom=d,this._touchRotate=_,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const rl=v=>v.zoom||v.drag||v.pitch||v.rotate;class Gu extends w.Event{}function Vl(v){return v.panDelta&&v.panDelta.mag()||v.zoomDelta||v.bearingDelta||v.pitchDelta}class sl{constructor(l,d){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ts(l),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d),w.bindAll(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(const[x,C,P]of this._listeners)Ne.addEventListener(x,C,x===document?this.handleWindowEvent:this.handleEvent,P)}destroy(){for(const[l,d,_]of this._listeners)Ne.removeEventListener(l,d,l===document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(l){const d=this._map,_=d.getCanvasContainer();this._add("mapEvent",new Ih(d,l));const x=d.boxZoom=new Ae(d,l);this._add("boxZoom",x);const C=new Ln,P=new _u;d.doubleClickZoom=new Gs(P,C),this._add("tapZoom",C),this._add("clickZoom",P);const L=new Xo;this._add("tapDragZoom",L);const N=d.touchPitch=new Rd(d);this._add("touchPitch",N);const I=new il(l),H=new Dt(l);d.dragRotate=new zl(l,I,H),this._add("mouseRotate",I,["mousePitch"]),this._add("mousePitch",H,["mouseRotate"]);const q=new Bi(l),Q=new pa(l,d);d.dragPan=new Cs(_,q,Q),this._add("mousePan",q),this._add("touchPan",Q,["touchZoom","touchRotate"]);const ce=new Ki,ue=new yt;d.touchZoomRotate=new Ld(_,ue,ce,L),this._add("touchRotate",ce,["touchPan","touchZoom"]),this._add("touchZoom",ue,["touchPan","touchRotate"]);const he=d.scrollZoom=new Hu(d,this);this._add("scrollZoom",he,["mousePan"]);const Ee=d.keyboard=new Ph;this._add("keyboard",Ee),this._add("blockableMapEvent",new Ao(d));for(const Me of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])l.interactive&&l[Me]&&d[Me].enable(l[Me])}_add(l,d,_){this._handlers.push({handlerName:l,handler:d,allowed:_}),this._handlersById[l]=d}stop(l){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(rl(this._eventsInProgress))||this.isZooming()}_blockedByActive(l,d,_){for(const x in l)if(x!==_&&(!d||d.indexOf(x)<0))return!0;return!1}handleWindowEvent(l){this.handleEvent(l,`${l.type}Window`)}_getMapTouches(l){const d=[];for(const _ of l)this._el.contains(_.target)&&d.push(_);return d}handleEvent(l,d){if("blur"===l.type)return void this.stop(!0);this._updatingCamera=!0;const _="renderFrame"===l.type?void 0:l,x={needsRenderFrame:!1},C={},P={},L=l.touches,N=L?this._getMapTouches(L):void 0,I=N?Ne.touchPos(this._el,N):Ne.mousePos(this._el,l);for(const{handlerName:Q,handler:ce,allowed:ue}of this._handlers){if(!ce.isEnabled())continue;let he;this._blockedByActive(P,ue,Q)?ce.reset():ce[d||l.type]&&(he=ce[d||l.type](l,I,N),this.mergeHandlerResult(x,C,he,Q,_),he&&he.needsRenderFrame&&this._triggerRenderFrame()),(he||ce.isActive())&&(P[Q]=ce)}const H={};for(const Q in this._previousActiveHandlers)P[Q]||(H[Q]=_);this._previousActiveHandlers=P,(Object.keys(H).length||Vl(x))&&(this._changes.push([x,C,H]),this._triggerRenderFrame()),(Object.keys(P).length||Vl(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:q}=x;q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],q(this._map))}mergeHandlerResult(l,d,_,x,C){if(!_)return;w.extend(l,_);const P={handlerName:x,originalEvent:_.originalEvent||C};void 0!==_.zoomDelta&&(d.zoom=P),void 0!==_.panDelta&&(d.drag=P),void 0!==_.pitchDelta&&(d.pitch=P),void 0!==_.bearingDelta&&(d.rotate=P)}_applyChanges(){const l={},d={},_={};for(const[x,C,P]of this._changes)x.panDelta&&(l.panDelta=(l.panDelta||new w.pointGeometry(0,0))._add(x.panDelta)),x.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+x.pitchDelta),void 0!==x.around&&(l.around=x.around),void 0!==x.pinchAround&&(l.pinchAround=x.pinchAround),x.noInertia&&(l.noInertia=x.noInertia),w.extend(d,C),w.extend(_,P);this._updateMapTransform(l,d,_),this._changes=[]}_updateMapTransform(l,d,_){const x=this._map,C=x.transform,P=x.style&&x.style.terrain;if(!(Vl(l)||P&&this._drag))return this._fireEvents(d,_,!0);let{panDelta:L,zoomDelta:N,bearingDelta:I,pitchDelta:H,around:q,pinchAround:Q}=l;void 0!==Q&&(q=Q),x._stop(!0),q=q||x.transform.centerPoint;const ce=C.pointLocation(L?q.sub(L):q);I&&(C.bearing+=I),H&&(C.pitch+=H),N&&(C.zoom+=N),P?d.drag&&!this._drag?(this._drag={center:C.centerPoint,lngLat:C.pointLocation(q),point:q,handlerName:d.drag.handlerName},x.fire(new w.Event("freezeElevation",{freeze:!0}))):this._drag&&_[this._drag.handlerName]?(x.fire(new w.Event("freezeElevation",{freeze:!1})),this._drag=null):d.drag&&this._drag&&(C.center=C.pointLocation(C.centerPoint.sub(L))):C.setLocationAtPoint(ce,q),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(d,_,!0)}_fireEvents(l,d,_){const x=rl(this._eventsInProgress),C=rl(l),P={};for(const H in l){const{originalEvent:q}=l[H];this._eventsInProgress[H]||(P[`${H}start`]=q),this._eventsInProgress[H]=l[H]}!x&&C&&this._fireEvent("movestart",C.originalEvent);for(const H in P)this._fireEvent(H,P[H]);C&&this._fireEvent("move",C.originalEvent);for(const H in l){const{originalEvent:q}=l[H];this._fireEvent(H,q)}const L={};let N;for(const H in this._eventsInProgress){const{handlerName:q,originalEvent:Q}=this._eventsInProgress[H];this._handlersById[q].isActive()||(delete this._eventsInProgress[H],N=d[q]||Q,L[`${H}end`]=N)}for(const H in L)this._fireEvent(H,L[H]);const I=rl(this._eventsInProgress);if(_&&(x||C)&&!I){this._updatingCamera=!0;const H=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),q=Q=>0!==Q&&-this._bearingSnap<Q&&Q<this._bearingSnap;H?(q(H.bearing||this._map.getBearing())&&(H.bearing=0),this._map.easeTo(H,{originalEvent:N})):(this._map.fire(new w.Event("moveend",{originalEvent:N})),q(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(l,d){this._map.fire(new w.Event(l,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{delete this._frameId,this.handleEvent(new Gu("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const oo={extend:(v,...l)=>w.extend(v,...l),run(v){v()},logToElement(v,l=!1,d="log"){const _=window.document.getElementById(d);_&&(l&&(_.innerHTML=""),_.innerHTML+=`<br>${v}`)}};class li extends w.Evented{constructor(l,d){super(),this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=d.bearingSnap,w.bindAll(["_renderFrameCallback"],this)}getCenter(){return new w.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(l,d){return this.jumpTo({center:l},d)}panBy(l,d,_){return l=w.pointGeometry.convert(l).mult(-1),this.panTo(this.transform.center,w.extend({offset:l},d),_)}panTo(l,d,_){return this.easeTo(w.extend({center:l},d),_)}getZoom(){return this.transform.zoom}setZoom(l,d){return this.jumpTo({zoom:l},d),this}zoomTo(l,d,_){return this.easeTo(w.extend({zoom:l},d),_)}zoomIn(l,d){return this.zoomTo(this.getZoom()+1,l,d),this}zoomOut(l,d){return this.zoomTo(this.getZoom()-1,l,d),this}getBearing(){return this.transform.bearing}setBearing(l,d){return this.jumpTo({bearing:l},d),this}getPadding(){return this.transform.padding}setPadding(l,d){return this.jumpTo({padding:l},d),this}rotateTo(l,d,_){return this.easeTo(w.extend({bearing:l},d),_)}resetNorth(l,d){return this.rotateTo(0,w.extend({duration:1e3},l),d),this}resetNorthPitch(l,d){return this.easeTo(w.extend({bearing:0,pitch:0,duration:1e3},l),d),this}snapToNorth(l,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,d):this}getPitch(){return this.transform.pitch}setPitch(l,d){return this.jumpTo({pitch:l},d),this}cameraForBounds(l,d){l=w.LngLatBounds.convert(l);const _=d&&d.bearing||0;return this._cameraForBoxAndBearing(l.getNorthWest(),l.getSouthEast(),_,d)}_cameraForBoxAndBearing(l,d,_,x){const C={top:0,bottom:0,right:0,left:0};if("number"==typeof(x=w.extend({padding:C,offset:[0,0],maxZoom:this.transform.maxZoom},x)).padding){const ke=x.padding;x.padding={top:ke,bottom:ke,right:ke,left:ke}}x.padding=w.extend(C,x.padding);const P=this.transform,L=P.padding,N=P.project(w.LngLat.convert(l)),I=P.project(w.LngLat.convert(d)),H=N.rotate(-_*Math.PI/180),q=I.rotate(-_*Math.PI/180),Q=new w.pointGeometry(Math.max(H.x,q.x),Math.max(H.y,q.y)),ce=new w.pointGeometry(Math.min(H.x,q.x),Math.min(H.y,q.y)),ue=Q.sub(ce),he=(P.width-(L.left+L.right+x.padding.left+x.padding.right))/ue.x,Ee=(P.height-(L.top+L.bottom+x.padding.top+x.padding.bottom))/ue.y;if(Ee<0||he<0)return void w.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Me=Math.min(P.scaleZoom(P.scale*Math.min(he,Ee)),x.maxZoom),Re=w.pointGeometry.convert(x.offset),fe=new w.pointGeometry((x.padding.left-x.padding.right)/2,(x.padding.top-x.padding.bottom)/2).rotate(_*Math.PI/180),Be=Re.add(fe).mult(P.scale/P.zoomScale(Me));return{center:P.unproject(N.add(I).div(2).sub(Be)),zoom:Me,bearing:_}}fitBounds(l,d,_){return this._fitInternal(this.cameraForBounds(l,d),d,_)}fitScreenCoordinates(l,d,_,x,C){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(w.pointGeometry.convert(l)),this.transform.pointLocation(w.pointGeometry.convert(d)),_,x),x,C)}_fitInternal(l,d,_){return l?(delete(d=w.extend(l,d)).padding,d.linear?this.easeTo(d,_):this.flyTo(d,_)):this}jumpTo(l,d){this.stop();const _=this.transform;let x=!1,C=!1,P=!1;return"zoom"in l&&_.zoom!==+l.zoom&&(x=!0,_.zoom=+l.zoom),void 0!==l.center&&(_.center=w.LngLat.convert(l.center)),"bearing"in l&&_.bearing!==+l.bearing&&(C=!0,_.bearing=+l.bearing),"pitch"in l&&_.pitch!==+l.pitch&&(P=!0,_.pitch=+l.pitch),null==l.padding||_.isPaddingEqual(l.padding)||(_.padding=l.padding),this.fire(new w.Event("movestart",d)).fire(new w.Event("move",d)),x&&this.fire(new w.Event("zoomstart",d)).fire(new w.Event("zoom",d)).fire(new w.Event("zoomend",d)),C&&this.fire(new w.Event("rotatestart",d)).fire(new w.Event("rotate",d)).fire(new w.Event("rotateend",d)),P&&this.fire(new w.Event("pitchstart",d)).fire(new w.Event("pitch",d)).fire(new w.Event("pitchend",d)),this.fire(new w.Event("moveend",d))}calculateCameraOptionsFromTo(l,d,_,x=0){const C=w.MercatorCoordinate.fromLngLat(l,d),P=w.MercatorCoordinate.fromLngLat(_,x),L=P.x-C.x,N=P.y-C.y,I=P.z-C.z,H=Math.hypot(L,N,I);if(0===H)throw new Error("Can't calculate camera options with same From and To");const q=Math.hypot(L,N),Q=this.transform.scaleZoom(this.transform.cameraToCenterDistance/H/this.transform.tileSize),ce=180*Math.atan2(L,-N)/Math.PI;let ue=180*Math.acos(q/H)/Math.PI;return ue=I<0?90-ue:90+ue,{center:P.toLngLat(),zoom:Q,pitch:ue,bearing:ce}}easeTo(l,d){this._stop(!1,l.easeId),(!1===(l=w.extend({offset:[0,0],duration:500,easing:w.ease},l)).animate||!l.essential&&w.exported.prefersReducedMotion)&&(l.duration=0);const _=this.transform,x=this.getZoom(),C=this.getBearing(),P=this.getPitch(),L=this.getPadding(),N="zoom"in l?+l.zoom:x,I="bearing"in l?this._normalizeBearing(l.bearing,C):C,H="pitch"in l?+l.pitch:P,q="padding"in l?l.padding:_.padding,Q=w.pointGeometry.convert(l.offset);let ce=_.centerPoint.add(Q);const ue=_.pointLocation(ce),he=w.LngLat.convert(l.center||ue);this._normalizeCenter(he);const Ee=_.project(ue),Me=_.project(he).sub(Ee),Re=_.zoomScale(N-x);let fe,Be;l.around&&(fe=w.LngLat.convert(l.around),Be=_.locationPoint(fe));const ke={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||N!==x,this._rotating=this._rotating||C!==I,this._pitching=this._pitching||H!==P,this._padding=!_.isPaddingEqual(q),this._easeId=l.easeId,this._prepareEase(d,l.noMoveStart,ke),this._ease(We=>{if(this._zooming&&(_.zoom=w.number(x,N,We)),this._rotating&&(_.bearing=w.number(C,I,We)),this._pitching&&(_.pitch=w.number(P,H,We)),this._padding&&(_.interpolatePadding(L,q,We),ce=_.centerPoint.add(Q)),fe)_.setLocationAtPoint(fe,Be);else{const $e=_.zoomScale(_.zoom-x),it=N>x?Math.min(2,Re):Math.max(.5,Re),Ue=Math.pow(it,1-We),wt=_.unproject(Ee.add(Me.mult(We*Ue)).mult($e));_.setLocationAtPoint(_.renderWorldCopies?wt.wrap():wt,ce)}this._fireMoveEvents(d)},We=>{this._afterEase(d,We)},l),this}_prepareEase(l,d,_={}){this._moving=!0,this.fire(new w.Event("freezeElevation",{freeze:!0})),d||_.moving||this.fire(new w.Event("movestart",l)),this._zooming&&!_.zooming&&this.fire(new w.Event("zoomstart",l)),this._rotating&&!_.rotating&&this.fire(new w.Event("rotatestart",l)),this._pitching&&!_.pitching&&this.fire(new w.Event("pitchstart",l))}_fireMoveEvents(l){this.fire(new w.Event("move",l)),this._zooming&&this.fire(new w.Event("zoom",l)),this._rotating&&this.fire(new w.Event("rotate",l)),this._pitching&&this.fire(new w.Event("pitch",l))}_afterEase(l,d){if(this._easeId&&d&&this._easeId===d)return;delete this._easeId,this.fire(new w.Event("freezeElevation",{freeze:!1}));const _=this._zooming,x=this._rotating,C=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new w.Event("zoomend",l)),x&&this.fire(new w.Event("rotateend",l)),C&&this.fire(new w.Event("pitchend",l)),this.fire(new w.Event("moveend",l))}flyTo(l,d){if(!l.essential&&w.exported.prefersReducedMotion){const Ht=w.pick(l,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ht,d)}this.stop(),l=w.extend({offset:[0,0],speed:1.2,curve:1.42,easing:w.ease},l);const _=this.transform,x=this.getZoom(),C=this.getBearing(),P=this.getPitch(),L=this.getPadding(),N="zoom"in l?w.clamp(+l.zoom,_.minZoom,_.maxZoom):x,I="bearing"in l?this._normalizeBearing(l.bearing,C):C,H="pitch"in l?+l.pitch:P,q="padding"in l?l.padding:_.padding,Q=_.zoomScale(N-x),ce=w.pointGeometry.convert(l.offset);let ue=_.centerPoint.add(ce);const he=_.pointLocation(ue),Ee=w.LngLat.convert(l.center||he);this._normalizeCenter(Ee);const Me=_.project(he),Re=_.project(Ee).sub(Me);let fe=l.curve;const Be=Math.max(_.width,_.height),ke=Be/Q,We=Re.mag();if("minZoom"in l){const Ht=w.clamp(Math.min(l.minZoom,x,N),_.minZoom,_.maxZoom),Di=Be/_.zoomScale(Ht-x);fe=Math.sqrt(Di/We*2)}const $e=fe*fe;function it(Ht){const Di=(ke*ke-Be*Be+(Ht?-1:1)*$e*$e*We*We)/(2*(Ht?ke:Be)*$e*We);return Math.log(Math.sqrt(Di*Di+1)-Di)}function Ue(Ht){return(Math.exp(Ht)-Math.exp(-Ht))/2}function wt(Ht){return(Math.exp(Ht)+Math.exp(-Ht))/2}const dt=it(0);let St=function(Ht){return wt(dt)/wt(dt+fe*Ht)},rn=function(Ht){return Be*((wt(dt)*(Ue(Di=dt+fe*Ht)/wt(Di))-Ue(dt))/$e)/We;var Di},Pn=(it(1)-dt)/fe;if(Math.abs(We)<1e-6||!isFinite(Pn)){if(Math.abs(Be-ke)<1e-6)return this.easeTo(l,d);const Ht=ke<Be?-1:1;Pn=Math.abs(Math.log(ke/Be))/fe,rn=function(){return 0},St=function(Di){return Math.exp(Ht*fe*Di)}}return l.duration="duration"in l?+l.duration:1e3*Pn/("screenSpeed"in l?+l.screenSpeed/fe:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0),this._zooming=!0,this._rotating=C!==I,this._pitching=H!==P,this._padding=!_.isPaddingEqual(q),this._prepareEase(d,!1),this._ease(Ht=>{const Di=Ht*Pn,Ei=1/St(Di);_.zoom=1===Ht?N:x+_.scaleZoom(Ei),this._rotating&&(_.bearing=w.number(C,I,Ht)),this._pitching&&(_.pitch=w.number(P,H,Ht)),this._padding&&(_.interpolatePadding(L,q,Ht),ue=_.centerPoint.add(ce));const ii=1===Ht?Ee:_.unproject(Me.add(Re.mult(rn(Di))).mult(Ei));_.setLocationAtPoint(_.renderWorldCopies?ii.wrap():ii,ue),this._fireMoveEvents(d)},()=>this._afterEase(d),l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const _=this._onEaseEnd;delete this._onEaseEnd,_.call(this,d)}if(!l){const _=this.handlers;_&&_.stop(!1)}return this}_ease(l,d,_){!1===_.animate||0===_.duration?(l(1),d()):(this._easeStart=w.exported.now(),this._easeOptions=_,this._onEaseFrame=l,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const l=Math.min((w.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(l)),l<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(l,d){l=w.wrap(l,-180,180);const _=Math.abs(l-d);return Math.abs(l-360-d)<_&&(l-=360),Math.abs(l+360-d)<_&&(l+=360),l}_normalizeCenter(l){const d=this.transform;if(!d.renderWorldCopies||d.lngRange)return;const _=l.lng-d.center.lng;l.lng+=_>180?-360:_<-180?360:0}}class Mc{constructor(l={}){this.options=l,w.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(l){return this._map=l,this._compact=this.options&&this.options.compact,this._container=Ne.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Ne.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Ne.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Ne.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(l,d){const _=this._map._getUIString(`AttributionControl.${d}`);l.title=_,l.setAttribute("aria-label",_)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(l){!l||"metadata"!==l.sourceDataType&&"visibility"!==l.sourceDataType&&"style"!==l.dataType&&"terrain"!==l.type||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(x=>"string"!=typeof x?"":x)):"string"==typeof this.options.customAttribution&&l.push(this.options.customAttribution)),this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const d=this._map.style.sourceCaches;for(const x in d){const C=d[x];if(C.used||C.usedForTerrain){const P=C.getSource();P.attribution&&l.indexOf(P.attribution)<0&&l.push(P.attribution)}}l=l.filter(x=>String(x).trim()),l.sort((x,C)=>x.length-C.length),l=l.filter((x,C)=>{for(let P=C+1;P<l.length;P++)if(l[P].indexOf(x)>=0)return!1;return!0});const _=l.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,l.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1===this._compact?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class kh{constructor(l={}){this.options=l,w.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(l){this._map=l,this._compact=this.options&&this.options.compact,this._container=Ne.create("div","maplibregl-ctrl mapboxgl-ctrl");const d=Ne.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://maplibre.org/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Ne.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const l=this._container.children;if(l.length){const d=l[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1!==this._compact&&d.classList.add("maplibregl-compact","mapboxgl-compact"):d.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class Ac{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const d=++this._id;return this._queue.push({callback:l,id:d,cancelled:!1}),d}remove(l){const d=this._currentlyRunning,_=d?this._queue.concat(d):this._queue;for(const x of _)if(x.id===l)return void(x.cancelled=!0)}run(l=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const d=this._currentlyRunning=this._queue;this._queue=[];for(const _ of d)if(!_.cancelled&&(_.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Wu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},Od={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},Kr={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ra{constructor(l,d,_=!1){this._clickTolerance=10,this.element=d,this.mouseRotate=new il({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,_&&(this.mousePitch=new Dt({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),w.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),Ne.addEventListener(d,"mousedown",this.mousedown),Ne.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),Ne.addEventListener(d,"touchmove",this.touchmove),Ne.addEventListener(d,"touchend",this.touchend),Ne.addEventListener(d,"touchcancel",this.reset)}down(l,d){this.mouseRotate.mousedown(l,d),this.mousePitch&&this.mousePitch.mousedown(l,d),Ne.disableDrag()}move(l,d){const _=this.map,x=this.mouseRotate.mousemoveWindow(l,d);if(x&&x.bearingDelta&&_.setBearing(_.getBearing()+x.bearingDelta),this.mousePitch){const C=this.mousePitch.mousemoveWindow(l,d);C&&C.pitchDelta&&_.setPitch(_.getPitch()+C.pitchDelta)}}off(){const l=this.element;Ne.removeEventListener(l,"mousedown",this.mousedown),Ne.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),Ne.removeEventListener(l,"touchmove",this.touchmove),Ne.removeEventListener(l,"touchend",this.touchend),Ne.removeEventListener(l,"touchcancel",this.reset),this.offTemp()}offTemp(){Ne.enableDrag(),Ne.removeEventListener(window,"mousemove",this.mousemove),Ne.removeEventListener(window,"mouseup",this.mouseup)}mousedown(l){this.down(w.extend({},l,{ctrlKey:!0,preventDefault:()=>l.preventDefault()}),Ne.mousePos(this.element,l)),Ne.addEventListener(window,"mousemove",this.mousemove),Ne.addEventListener(window,"mouseup",this.mouseup)}mousemove(l){this.move(l,Ne.mousePos(this.element,l))}mouseup(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()}touchstart(l){1!==l.targetTouches.length?this.reset():(this._startPos=this._lastPos=Ne.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>l.preventDefault()},this._startPos))}touchmove(l){1!==l.targetTouches.length?this.reset():(this._lastPos=Ne.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:()=>l.preventDefault()},this._lastPos))}touchend(l){0===l.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Rh(v,l,d){if(v=new w.LngLat(v.lng,v.lat),l){const _=new w.LngLat(v.lng-360,v.lat),x=new w.LngLat(v.lng+360,v.lat),C=d.locationPoint(v).distSqr(l);d.locationPoint(_).distSqr(l)<C?v=_:d.locationPoint(x).distSqr(l)<C&&(v=x)}for(;Math.abs(v.lng-d.center.lng)>180;){const _=d.locationPoint(v);if(_.x>=0&&_.y>=0&&_.x<=d.width&&_.y<=d.height)break;v.lng>d.center.lng?v.lng-=360:v.lng+=360}return v}const Pt={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function mt(v,l,d){const _=v.classList;for(const x in Pt)_.remove(`maplibregl-${d}-anchor-${x}`,`mapboxgl-${d}-anchor-${x}`);_.add(`maplibregl-${d}-anchor-${l}`,`mapboxgl-${d}-anchor-${l}`)}class Gr extends w.Evented{constructor(l,d){if(super(),(l instanceof HTMLElement||d)&&(l=w.extend({element:l},d)),w.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&"auto"!==l.pitchAlignment?l.pitchAlignment:this._rotationAlignment,l&&l.element)this._element=l.element,this._offset=w.pointGeometry.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ne.create("div"),this._element.setAttribute("aria-label","Map marker");const _=Ne.createNS("http://www.w3.org/2000/svg","svg"),x=41,C=27;_.setAttributeNS(null,"display","block"),_.setAttributeNS(null,"height",`${x}px`),_.setAttributeNS(null,"width",`${C}px`),_.setAttributeNS(null,"viewBox",`0 0 ${C} ${x}`);const P=Ne.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"stroke","none"),P.setAttributeNS(null,"stroke-width","1"),P.setAttributeNS(null,"fill","none"),P.setAttributeNS(null,"fill-rule","evenodd");const L=Ne.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"fill-rule","nonzero");const N=Ne.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"transform","translate(3.0, 29.0)"),N.setAttributeNS(null,"fill","#000000");const I=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Re of I){const fe=Ne.createNS("http://www.w3.org/2000/svg","ellipse");fe.setAttributeNS(null,"opacity","0.04"),fe.setAttributeNS(null,"cx","10.5"),fe.setAttributeNS(null,"cy","5.80029008"),fe.setAttributeNS(null,"rx",Re.rx),fe.setAttributeNS(null,"ry",Re.ry),N.appendChild(fe)}const H=Ne.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"fill",this._color);const q=Ne.createNS("http://www.w3.org/2000/svg","path");q.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),H.appendChild(q);const Q=Ne.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"opacity","0.25"),Q.setAttributeNS(null,"fill","#000000");const ce=Ne.createNS("http://www.w3.org/2000/svg","path");ce.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Q.appendChild(ce);const ue=Ne.createNS("http://www.w3.org/2000/svg","g");ue.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ue.setAttributeNS(null,"fill","#FFFFFF");const he=Ne.createNS("http://www.w3.org/2000/svg","g");he.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Ee=Ne.createNS("http://www.w3.org/2000/svg","circle");Ee.setAttributeNS(null,"fill","#000000"),Ee.setAttributeNS(null,"opacity","0.25"),Ee.setAttributeNS(null,"cx","5.5"),Ee.setAttributeNS(null,"cy","5.5"),Ee.setAttributeNS(null,"r","5.4999962");const Me=Ne.createNS("http://www.w3.org/2000/svg","circle");Me.setAttributeNS(null,"fill","#FFFFFF"),Me.setAttributeNS(null,"cx","5.5"),Me.setAttributeNS(null,"cy","5.5"),Me.setAttributeNS(null,"r","5.4999962"),he.appendChild(Ee),he.appendChild(Me),L.appendChild(N),L.appendChild(H),L.appendChild(Q),L.appendChild(ue),L.appendChild(he),_.appendChild(L),_.setAttributeNS(null,"height",x*this._scale+"px"),_.setAttributeNS(null,"width",C*this._scale+"px"),this._element.appendChild(_),this._offset=w.pointGeometry.convert(l&&l.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",_=>{_.preventDefault()}),this._element.addEventListener("mousedown",_=>{_.preventDefault()}),mt(this._element,this._anchor,"marker"),this._popup=null}addTo(l){return this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._update),l.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Ne.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=w.LngLat.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(24.6+x)],"bottom-right":[-x,-1*(24.6+x)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=l,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(l){const d=l.code,_=l.charCode||l.keyCode;"Space"!==d&&"Enter"!==d&&32!==_&&13!==_||this.togglePopup()}_onMapClick(l){const d=l.originalEvent.target,_=this._element;this._popup&&(d===_||_.contains(d))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const l=this._popup;return l?(l.isOpen()?l.remove():l.addTo(this._map),this):this}_update(l){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Rh(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let d="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?d=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(d=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let _="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?_="rotateX(0deg)":"map"===this._pitchAlignment&&(_=`rotateX(${this._map.getPitch()}deg)`),l&&"moveend"!==l.type||(this._pos=this._pos.round()),Ne.setTransform(this._element,`${Pt[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${_} ${d}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const x=this._map.unproject(this._pos),C=40075016.686*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=x.distanceTo(this._lngLat)>20*C?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(l){return this._offset=w.pointGeometry.convert(l),this._update(),this}_onMove(l){if(!this._isDragging){const d=this._clickTolerance||this._map._clickTolerance;this._isDragging=l.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=l.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new w.Event("dragstart"))),this.fire(new w.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new w.Event("dragend")),this._state="inactive"}_addDragHandler(l){this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(this._pos).add(this._offset),this._pointerdownPos=l.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(l){return this._draggable=!!l,this._map&&(l?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l&&"auto"!==l?l:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const $u={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Yo,zi=0,uc=!1;const ao={maxWidth:100,unit:"metric"};function yu(v,l,d){const _=d&&d.maxWidth||100,x=v._container.clientHeight/2,C=v.unproject([0,x]),P=v.unproject([_,x]),L=C.distanceTo(P);if(d&&"imperial"===d.unit){const N=3.2808*L;N>5280?Os(l,_,N/5280,v._getUIString("ScaleControl.Miles")):Os(l,_,N,v._getUIString("ScaleControl.Feet"))}else d&&"nautical"===d.unit?Os(l,_,L/1852,v._getUIString("ScaleControl.NauticalMiles")):L>=1e3?Os(l,_,L/1e3,v._getUIString("ScaleControl.Kilometers")):Os(l,_,L,v._getUIString("ScaleControl.Meters"))}function Os(v,l,d,_){const x=function(C){const P=Math.pow(10,`${Math.floor(C)}`.length-1);let L=C/P;return L=L>=10?10:L>=5?5:L>=3?3:L>=2?2:L>=1?1:function(N){const I=Math.pow(10,Math.ceil(-Math.log(N)/Math.LN10));return Math.round(N*I)/I}(L),P*L}(d);v.style.width=l*(x/d)+"px",v.innerHTML=`${x}&nbsp;${_}`}const Ji={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ir=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function hn(v){if(v){if("number"==typeof v){const l=Math.round(Math.sqrt(.5*Math.pow(v,2)));return{center:new w.pointGeometry(0,0),top:new w.pointGeometry(0,v),"top-left":new w.pointGeometry(l,l),"top-right":new w.pointGeometry(-l,l),bottom:new w.pointGeometry(0,-v),"bottom-left":new w.pointGeometry(l,-l),"bottom-right":new w.pointGeometry(-l,-l),left:new w.pointGeometry(v,0),right:new w.pointGeometry(-v,0)}}if(v instanceof w.pointGeometry||Array.isArray(v)){const l=w.pointGeometry.convert(v);return{center:l,top:l,"top-left":l,"top-right":l,bottom:l,"bottom-left":l,"bottom-right":l,left:l,right:l}}return{center:w.pointGeometry.convert(v.center||[0,0]),top:w.pointGeometry.convert(v.top||[0,0]),"top-left":w.pointGeometry.convert(v["top-left"]||[0,0]),"top-right":w.pointGeometry.convert(v["top-right"]||[0,0]),bottom:w.pointGeometry.convert(v.bottom||[0,0]),"bottom-left":w.pointGeometry.convert(v["bottom-left"]||[0,0]),"bottom-right":w.pointGeometry.convert(v["bottom-right"]||[0,0]),left:w.pointGeometry.convert(v.left||[0,0]),right:w.pointGeometry.convert(v.right||[0,0])}}return hn(new w.pointGeometry(0,0))}const La={supported:Gt,setRTLTextPlugin:w.setRTLTextPlugin,getRTLTextPluginStatus:w.getRTLTextPluginStatus,Map:class extends li{constructor(v){var l;if(w.PerformanceUtils.mark(w.PerformanceMarkers.create),null!=(v=w.extend({},Od,v)).minZoom&&null!=v.maxZoom&&v.minZoom>v.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=v.minPitch&&null!=v.maxPitch&&v.minPitch>v.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=v.minPitch&&v.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=v.maxPitch&&v.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Ri(v.minZoom,v.maxZoom,v.minPitch,v.maxPitch,v.renderWorldCopies),{bearingSnap:v.bearingSnap}),this._interactive=v.interactive,this._cooperativeGestures=v.cooperativeGestures,this._maxTileCacheSize=v.maxTileCacheSize,this._failIfMajorPerformanceCaveat=v.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=v.preserveDrawingBuffer,this._antialias=v.antialias,this._trackResize=v.trackResize,this._bearingSnap=v.bearingSnap,this._refreshExpiredTiles=v.refreshExpiredTiles,this._fadeDuration=v.fadeDuration,this._crossSourceCollisions=v.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=v.collectResourceTiming,this._renderTaskQueue=new Ac,this._controls=[],this._mapId=w.uniqueId(),this._locale=w.extend({},Wu,v.locale),this._clickTolerance=v.clickTolerance,this._pixelRatio=null!==(l=v.pixelRatio)&&void 0!==l?l:devicePixelRatio,this._requestManager=new wn(v.transformRequest),"string"==typeof v.container){if(this._container=document.getElementById(v.container),!this._container)throw new Error(`Container '${v.container}' not found.`)}else{if(!(v.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=v.container}if(v.maxBounds&&this.setMaxBounds(v.maxBounds),w.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new sl(this,v),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=v.hash&&new Nl("string"==typeof v.hash&&v.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:v.center,zoom:v.zoom,bearing:v.bearing,pitch:v.pitch}),v.bounds&&(this.resize(),this.fitBounds(v.bounds,w.extend({},v.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=v.localIdeographFontFamily,v.style&&this.setStyle(v.style,{localIdeographFontFamily:v.localIdeographFontFamily}),v.attributionControl&&this.addControl(new Mc({customAttribution:v.customAttribution})),v.maplibreLogo&&this.addControl(new kh,v.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",d=>{this._update("style"===d.dataType),this.fire(new w.Event(`${d.dataType}data`,d))}),this.on("dataloading",d=>{this.fire(new w.Event(`${d.dataType}dataloading`,d))}),this.on("dataabort",d=>{this.fire(new w.Event("sourcedataabort",d))})}_getMapId(){return this._mapId}addControl(v,l){if(void 0===l&&(l=v.getDefaultPosition?v.getDefaultPosition():"top-right"),!v||!v.onAdd)return this.fire(new w.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=v.onAdd(this);this._controls.push(v);const _=this._controlPositions[l];return-1!==l.indexOf("bottom")?_.insertBefore(d,_.firstChild):_.appendChild(d),this}removeControl(v){if(!v||!v.onRemove)return this.fire(new w.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(v);return l>-1&&this._controls.splice(l,1),v.onRemove(this),this}hasControl(v){return this._controls.indexOf(v)>-1}calculateCameraOptionsFromTo(v,l,d,_){return null==_&&this.style.terrain&&(_=this.transform.getElevation(d,this.style.terrain)),super.calculateCameraOptionsFromTo(v,l,d,_)}resize(v){const l=this._containerDimensions(),d=l[0],_=l[1];this._resizeCanvas(d,_,this.getPixelRatio()),this.transform.resize(d,_),this.painter.resize(d,_,this.getPixelRatio());const x=!this._moving;return x&&(this.stop(),this.fire(new w.Event("movestart",v)).fire(new w.Event("move",v))),this.fire(new w.Event("resize",v)),x&&this.fire(new w.Event("moveend",v)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(v){const[l,d]=this._containerDimensions();this._pixelRatio=v,this._resizeCanvas(l,d,v),this.painter.resize(l,d,v)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(v){return this.transform.setMaxBounds(w.LngLatBounds.convert(v)),this._update()}setMinZoom(v){if((v=v??-2)>=-2&&v<=this.transform.maxZoom)return this.transform.minZoom=v,this._update(),this.getZoom()<v&&this.setZoom(v),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(v){if((v=v??22)>=this.transform.minZoom)return this.transform.maxZoom=v,this._update(),this.getZoom()>v&&this.setZoom(v),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(v){if((v=v??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(v>=0&&v<=this.transform.maxPitch)return this.transform.minPitch=v,this._update(),this.getPitch()<v&&this.setPitch(v),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(v){if((v=v??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(v>=this.transform.minPitch)return this.transform.maxPitch=v,this._update(),this.getPitch()>v&&this.setPitch(v),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(v){return this.transform.renderWorldCopies=v,this._update()}project(v){return this.transform.locationPoint(w.LngLat.convert(v),this.style&&this.style.terrain)}unproject(v){return this.transform.pointLocation(w.pointGeometry.convert(v),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(v,l,d){if("mouseenter"===v||"mouseover"===v){let _=!1;return{layer:l,listener:d,delegates:{mousemove:C=>{const P=this.getLayer(l)?this.queryRenderedFeatures(C.point,{layers:[l]}):[];P.length?_||(_=!0,d.call(this,new nr(v,this,C.originalEvent,{features:P}))):_=!1},mouseout:()=>{_=!1}}}}if("mouseleave"===v||"mouseout"===v){let _=!1;return{layer:l,listener:d,delegates:{mousemove:P=>{(this.getLayer(l)?this.queryRenderedFeatures(P.point,{layers:[l]}):[]).length?_=!0:_&&(_=!1,d.call(this,new nr(v,this,P.originalEvent)))},mouseout:P=>{_&&(_=!1,d.call(this,new nr(v,this,P.originalEvent)))}}}}{const _=x=>{const C=this.getLayer(l)?this.queryRenderedFeatures(x.point,{layers:[l]}):[];C.length&&(x.features=C,d.call(this,x),delete x.features)};return{layer:l,listener:d,delegates:{[v]:_}}}}on(v,l,d){if(void 0===d)return super.on(v,l);const _=this._createDelegatedListener(v,l,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[v]=this._delegatedListeners[v]||[],this._delegatedListeners[v].push(_);for(const x in _.delegates)this.on(x,_.delegates[x]);return this}once(v,l,d){if(void 0===d)return super.once(v,l);const _=this._createDelegatedListener(v,l,d);for(const x in _.delegates)this.once(x,_.delegates[x]);return this}off(v,l,d){return void 0===d?super.off(v,l):(this._delegatedListeners&&this._delegatedListeners[v]&&(_=>{const x=this._delegatedListeners[v];for(let C=0;C<x.length;C++){const P=x[C];if(P.layer===l&&P.listener===d){for(const L in P.delegates)this.off(L,P.delegates[L]);return x.splice(C,1),this}}})(),this)}queryRenderedFeatures(v,l){if(!this.style)return[];let d;if(void 0!==l||void 0===v||v instanceof w.pointGeometry||Array.isArray(v)||(l=v,v=void 0),l=l||{},(v=v||[[0,0],[this.transform.width,this.transform.height]])instanceof w.pointGeometry||"number"==typeof v[0])d=[w.pointGeometry.convert(v)];else{const _=w.pointGeometry.convert(v[0]),x=w.pointGeometry.convert(v[1]);d=[_,new w.pointGeometry(x.x,_.y),x,new w.pointGeometry(_.x,x.y),_]}return this.style.queryRenderedFeatures(d,l,this.transform)}querySourceFeatures(v,l){return this.style.querySourceFeatures(v,l)}setStyle(v,l){return!1!==(l=w.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},l)).diff&&l.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&v?(this._diffStyle(v,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._updateStyle(v,l))}setTransformRequest(v){return this._requestManager.setTransformRequest(v),this}_getUIString(v){const l=this._locale[v];if(null==l)throw new Error(`Missing UI string '${v}'`);return l}_updateStyle(v,l){return this.style&&(this.style.setEventedParent(null),this.style._remove()),v?(this.style=new br(this,l||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof v?this.style.loadURL(v):this.style.loadJSON(v),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new br(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(v,l){if("string"==typeof v){const d=this._requestManager.transformRequest(v,w.ResourceType.Style);w.getJSON(d,(_,x)=>{_?this.fire(new w.ErrorEvent(_)):x&&this._updateDiff(x,l)})}else"object"==typeof v&&this._updateDiff(v,l)}_updateDiff(v,l){try{this.style.setState(v)&&this._update(!0)}catch(d){w.warnOnce(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(v,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():w.warnOnce("There is no style added to the map.")}addSource(v,l){return this._lazyInitEmptyStyle(),this.style.addSource(v,l),this._update(!0)}isSourceLoaded(v){const l=this.style&&this.style.sourceCaches[v];if(void 0!==l)return l.loaded();this.fire(new w.ErrorEvent(new Error(`There is no source with ID '${v}'`)))}setTerrain(v){return this.style.setTerrain(v),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){const v=this.style&&this.style.sourceCaches;for(const l in v){const d=v[l]._tiles;for(const _ in d){const x=d[_];if("loaded"!==x.state&&"errored"!==x.state)return!1}}return!0}addSourceType(v,l,d){return this._lazyInitEmptyStyle(),this.style.addSourceType(v,l,d)}removeSource(v){return this.style.removeSource(v),this._update(!0)}getSource(v){return this.style.getSource(v)}addImage(v,l,{pixelRatio:d=1,sdf:_=!1,stretchX:x,stretchY:C,content:P}={}){if(this._lazyInitEmptyStyle(),l instanceof HTMLImageElement||w.isImageBitmap(l)){const{width:L,height:N,data:I}=w.exported.getImageData(l);this.style.addImage(v,{data:new w.RGBAImage({width:L,height:N},I),pixelRatio:d,stretchX:x,stretchY:C,content:P,sdf:_,version:0})}else{if(void 0===l.width||void 0===l.height)return this.fire(new w.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:L,height:N,data:I}=l,H=l;this.style.addImage(v,{data:new w.RGBAImage({width:L,height:N},new Uint8Array(I)),pixelRatio:d,stretchX:x,stretchY:C,content:P,sdf:_,version:0,userImage:H}),H.onAdd&&H.onAdd(this,v)}}}updateImage(v,l){const d=this.style.getImage(v);if(!d)return this.fire(new w.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=l instanceof HTMLImageElement||w.isImageBitmap(l)?w.exported.getImageData(l):l,{width:x,height:C,data:P}=_;if(void 0===x||void 0===C)return this.fire(new w.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(x!==d.data.width||C!==d.data.height)return this.fire(new w.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const L=!(l instanceof HTMLImageElement||w.isImageBitmap(l));d.data.replace(P,L),this.style.updateImage(v,d)}hasImage(v){return v?!!this.style.getImage(v):(this.fire(new w.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(v){this.style.removeImage(v)}loadImage(v,l){w.getImage(this._requestManager.transformRequest(v,w.ResourceType.Image),l)}listImages(){return this.style.listImages()}addLayer(v,l){return this._lazyInitEmptyStyle(),this.style.addLayer(v,l),this._update(!0)}moveLayer(v,l){return this.style.moveLayer(v,l),this._update(!0)}removeLayer(v){return this.style.removeLayer(v),this._update(!0)}getLayer(v){return this.style.getLayer(v)}setLayerZoomRange(v,l,d){return this.style.setLayerZoomRange(v,l,d),this._update(!0)}setFilter(v,l,d={}){return this.style.setFilter(v,l,d),this._update(!0)}getFilter(v){return this.style.getFilter(v)}setPaintProperty(v,l,d,_={}){return this.style.setPaintProperty(v,l,d,_),this._update(!0)}getPaintProperty(v,l){return this.style.getPaintProperty(v,l)}setLayoutProperty(v,l,d,_={}){return this.style.setLayoutProperty(v,l,d,_),this._update(!0)}getLayoutProperty(v,l){return this.style.getLayoutProperty(v,l)}setLight(v,l={}){return this._lazyInitEmptyStyle(),this.style.setLight(v,l),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(v,l){return this.style.setFeatureState(v,l),this._update()}removeFeatureState(v,l){return this.style.removeFeatureState(v,l),this._update()}getFeatureState(v){return this.style.getFeatureState(v)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let v=0,l=0;return this._container&&(v=this._container.clientWidth||400,l=this._container.clientHeight||300),[v,l]}_setupContainer(){const v=this._container;v.classList.add("maplibregl-map","mapboxgl-map");const l=this._canvasContainer=Ne.create("div","maplibregl-canvas-container mapboxgl-canvas-container",v);this._interactive&&l.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=Ne.create("canvas","maplibregl-canvas mapboxgl-canvas",l),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const d=this._containerDimensions();this._resizeCanvas(d[0],d[1],this.getPixelRatio());const _=this._controlContainer=Ne.create("div","maplibregl-control-container mapboxgl-control-container",v),x=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(C=>{x[C]=Ne.create("div",`maplibregl-ctrl-${C} mapboxgl-ctrl-${C}`,_)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const v=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=Ne.create("div","maplibregl-cooperative-gesture-screen",v);let l="Control",d="boolean"!=typeof this._cooperativeGestures&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";0===navigator.platform.indexOf("Mac")&&(d="boolean"!=typeof this._cooperativeGestures&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use \u2318 + scroll to zoom the map",l="Meta"),this._cooperativeGesturesScreen.innerHTML=`\n            <div class="maplibregl-desktop-message">${d}</div>\n            <div class="maplibregl-mobile-message">${"boolean"!=typeof this._cooperativeGestures&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>\n        `,document.addEventListener("keydown",_=>{_.key===l&&(this._metaPress=!0)}),document.addEventListener("keyup",_=>{_.key===l&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",_=>{this._onCooperativeGesture(_,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(v,l,d){this._canvas.width=d*v,this._canvas.height=d*l,this._canvas.style.width=`${v}px`,this._canvas.style.height=`${l}px`}_setupPainter(){const v=w.extend({},Gt.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),l=this._canvas.getContext("webgl",v)||this._canvas.getContext("experimental-webgl",v);l?(this.painter=new Zo(l,this.transform),w.exported$1.testSupport(l)):this.fire(new w.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(v){v.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new w.Event("webglcontextlost",{originalEvent:v}))}_contextRestored(v){this._setupPainter(),this.resize(),this._update(),this.fire(new w.Event("webglcontextrestored",{originalEvent:v}))}_onMapScroll(v){if(v.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(v,l,d){return!l&&d<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(v){return this.style?(this._styleDirty=this._styleDirty||v,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(v){return this._update(),this._renderTaskQueue.add(v)}_cancelRenderFrame(v){this._renderTaskQueue.remove(v)}_render(v){let l,d=0;const _=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(l=_.createQueryEXT(),_.beginQueryEXT(_.TIME_ELAPSED_EXT,l),d=w.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(v),this._removed)return;let x=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const P=this.transform.zoom,L=w.exported.now();this.style.zoomHistory.update(P,L);const N=new w.EvaluationParameters(P,{now:L,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),I=N.crossFadingFactor();1===I&&I===this._crossFadingFactor||(x=!0,this._crossFadingFactor=I),this.style.update(N)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new w.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,w.PerformanceUtils.mark(w.PerformanceMarkers.load),this.fire(new w.Event("load"))),this.style&&(this.style.hasTransitions()||x)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const P=w.exported.now()-d;_.endQueryEXT(_.TIME_ELAPSED_EXT,l),setTimeout(()=>{const L=_.getQueryObjectEXT(l,_.QUERY_RESULT_EXT)/1e6;_.deleteQueryEXT(l),this.fire(new w.Event("gpu-timing-frame",{cpuTime:P,gpuTime:L}))},50)}if(this.listens("gpu-timing-layer")){const P=this.painter.collectGpuTimers();setTimeout(()=>{const L=this.painter.queryGpuTimers(P);this.fire(new w.Event("gpu-timing-layer",{layerTimes:L}))},50)}const C=this._sourcesDirty||this._styleDirty||this._placementDirty;return C||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new w.Event("idle")),!this._loaded||this._fullyLoaded||C||(this._fullyLoaded=!0,w.PerformanceUtils.mark(w.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const l of this._controls)l.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const v=this.painter.context.gl.getExtension("WEBGL_lose_context");v&&v.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Ne.remove(this._canvasContainer),Ne.remove(this._controlContainer),this._cooperativeGestures&&Ne.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),w.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new w.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=w.exported.frame(v=>{w.PerformanceUtils.frame(v),this._frame=null,this._render(v)}))}_onWindowOnline(){this._update()}_onWindowResize(v){this._trackResize&&this.resize({originalEvent:v})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(v){this._showTileBoundaries!==v&&(this._showTileBoundaries=v,this._update())}get showPadding(){return!!this._showPadding}set showPadding(v){this._showPadding!==v&&(this._showPadding=v,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(v){this._showCollisionBoxes!==v&&(this._showCollisionBoxes=v,v?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(v){this._showOverdrawInspector!==v&&(this._showOverdrawInspector=v,this._update())}get repaint(){return!!this._repaint}set repaint(v){this._repaint!==v&&(this._repaint=v,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(v){this._vertices=v,this._update()}_setCacheLimits(v,l){w.setCacheLimits(v,l)}get version(){return"2.4.0"}},NavigationControl:class{constructor(v){this.options=w.extend({},Kr,v),this._container=Ne.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(w.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",l=>this._map.zoomIn({},{originalEvent:l})),Ne.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",l=>this._map.zoomOut({},{originalEvent:l})),Ne.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(w.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",l=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:l}):this._map.resetNorth({},{originalEvent:l})}),this._compassIcon=Ne.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const v=this._map.getZoom(),l=v===this._map.getMaxZoom(),d=v===this._map.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){const v=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=v}onAdd(v){return this._map=v,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ra(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Ne.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(v,l){const d=Ne.create("button",v,this._container);return d.type="button",d.addEventListener("click",l),d}_setButtonTitle(v,l){const d=this._map._getUIString(`NavigationControl.${l}`);v.title=d,v.setAttribute("aria-label",d)}},GeolocateControl:class extends w.Evented{constructor(v){super(),this.options=w.extend({},$u,v),w.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(v){var l;return this._map=v,this._container=Ne.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),l=this._setupUI,void 0!==Yo?l(Yo):void 0!==window.navigator.permissions?window.navigator.permissions.query({name:"geolocation"}).then(d=>{Yo="denied"!==d.state,l(Yo)}):(Yo=!!window.navigator.geolocation,l(Yo)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Ne.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,zi=0,uc=!1}_isOutOfMapMaxBounds(v){const l=this._map.getMaxBounds(),d=v.coords;return l&&(d.longitude<l.getWest()||d.longitude>l.getEast()||d.latitude<l.getSouth()||d.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(v){if(this._map){if(this._isOutOfMapMaxBounds(v))return this._setErrorState(),this.fire(new w.Event("outofmaxbounds",v)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=v,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(v),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(v),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new w.Event("geolocate",v)),this._finish()}}_updateCamera(v){const l=new w.LngLat(v.coords.longitude,v.coords.latitude),d=v.coords.accuracy,_=this._map.getBearing(),x=w.extend({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(l.toBounds(d),x,{geolocateSource:!0})}_updateMarker(v){if(v){const l=new w.LngLat(v.coords.longitude,v.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=v.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const v=this._map._container.clientHeight/2,l=this._map.unproject([0,v]),d=this._map.unproject([1,v]),_=l.distanceTo(d),x=Math.ceil(2*this._accuracy/_);this._circleElement.style.width=`${x}px`,this._circleElement.style.height=`${x}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(v){if(this._map){if(this.options.trackUserLocation)if(1===v.code){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=l,this._geolocateButton.setAttribute("aria-label",l),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===v.code&&uc)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new w.Event("error",v)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(v){if(this._container.addEventListener("contextmenu",l=>l.preventDefault()),this._geolocateButton=Ne.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),Ne.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===v){w.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=l,this._geolocateButton.setAttribute("aria-label",l)}else{const l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=l,this._geolocateButton.setAttribute("aria-label",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ne.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new Gr(this._dotElement),this._circleElement=Ne.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Gr({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",l=>{l.geolocateSource||"ACTIVE_LOCK"!==this._watchState||l.originalEvent&&"resize"===l.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new w.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return w.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new w.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":zi--,uc=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new w.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new w.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let v;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),zi++,zi>1?(v={maximumAge:6e5,timeout:0},uc=!0):(v=this.options.positionOptions,uc=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,v)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Mc,LogoControl:kh,ScaleControl:class{constructor(v){this.options=w.extend({},ao,v),w.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){yu(this._map,this._container,this.options)}onAdd(v){return this._map=v,this._container=Ne.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",v.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Ne.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(v){this.options.unit=v,yu(this._map,this._container,this.options)}},FullscreenControl:class{constructor(v){this._fullscreen=!1,v&&v.container&&(v.container instanceof HTMLElement?this._container=v.container:w.warnOnce("Full screen control 'container' must be a DOM element.")),w.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(v){return this._map=v,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ne.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",w.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){Ne.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const v=this._fullscreenButton=Ne.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);Ne.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",v).setAttribute("aria-hidden","true"),v.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const v=this._getTitle();this._fullscreenButton.setAttribute("aria-label",v),this._fullscreenButton.title=v}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(v){this.options=v,w.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(v){return this._map=v,this._container=Ne.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=Ne.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),Ne.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Ne.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends w.Evented{constructor(v){super(),this.options=w.extend(Object.create(Ji),v),w.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(v){return this._map&&this.remove(),this._map=v,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new w.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&Ne.remove(this._content),this._container&&(Ne.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new w.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(v){return this._lngLat=w.LngLat.convert(v),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(v){return this.setDOMContent(document.createTextNode(v))}setHTML(v){const l=document.createDocumentFragment(),d=document.createElement("body");let _;for(d.innerHTML=v;_=d.firstChild,_;)l.appendChild(_);return this.setDOMContent(l)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(v){return this.options.maxWidth=v,this._update(),this}setDOMContent(v){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Ne.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(v),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(v){this._container&&this._container.classList.add(v)}removeClassName(v){this._container&&this._container.classList.remove(v)}setOffset(v){return this.options.offset=v,this._update(),this}toggleClassName(v){if(this._container)return this._container.classList.toggle(v)}_createCloseButton(){this.options.closeButton&&(this._closeButton=Ne.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(v){this._update(v.point)}_onMouseMove(v){this._update(v.point)}_onDrag(v){this._update(v.point)}_update(v){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=Ne.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=Ne.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(C=>this._container.classList.add(C)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Rh(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!v))return;const l=this._pos=this._trackPointer&&v?v:this._map.project(this._lngLat);let d=this.options.anchor;const _=hn(this.options.offset);if(!d){const C=this._container.offsetWidth,P=this._container.offsetHeight;let L;L=l.y+_.bottom.y<P?["top"]:l.y>this._map.transform.height-P?["bottom"]:[],l.x<C/2?L.push("left"):l.x>this._map.transform.width-C/2&&L.push("right"),d=0===L.length?"bottom":L.join("-")}const x=l.add(_[d]).round();Ne.setTransform(this._container,`${Pt[d]} translate(${x.x}px,${x.y}px)`),mt(this._container,d,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const v=this._container.querySelector(ir);v&&v.focus()}_onClose(){this.remove()}},Marker:Gr,Style:br,LngLat:w.LngLat,LngLatBounds:w.LngLatBounds,Point:w.pointGeometry,MercatorCoordinate:w.MercatorCoordinate,Evented:w.Evented,AJAXError:w.AJAXError,config:w.config,CanvasSource:vs,GeoJSONSource:ys,ImageSource:Eo,RasterDEMTileSource:Zt,RasterTileSource:Xs,VectorTileSource:wo,VideoSource:Yn,prewarm:function(){la().acquire(Mr)},clearPrewarmedResources:function(){const v=Js;v&&(v.isPreloaded()&&1===v.numActive()?(v.release(Mr),Js=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return bi.workerCount},set workerCount(v){bi.workerCount=v},get maxParallelImageRequests(){return w.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(v){w.config.MAX_PARALLEL_IMAGE_REQUESTS=v},clearStorage(v){w.clearTileCache(v)},workerUrl:"",addProtocol(v,l){w.config.REGISTERED_PROTOCOLS[v]=l},removeProtocol(v){delete w.config.REGISTERED_PROTOCOLS[v]}};return oo.extend(La,{isSafari:w.isSafari,getPerformanceMetrics:w.PerformanceUtils.getPerformanceMetrics}),La}),Wn}()}},Uo=>{Uo(Uo.s=108)}]);